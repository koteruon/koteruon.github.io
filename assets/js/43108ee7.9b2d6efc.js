"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[7202],{88039:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});var r=s(74848),c=s(28453);const l={},i="AutoScaling - Vertical Pod AutoScaler",t={id:"notes/kubernetes-basics/autoscaling-vertical-pod-autoscaler",title:"AutoScaling - Vertical Pod AutoScaler",description:"\u4ec0\u9ebc\u662f Vertical Pod Autoscaler\uff1f",source:"@site/docs/notes/kubernetes-basics/27-autoscaling-vertical-pod-autoscaler.mdx",sourceDirName:"notes/kubernetes-basics",slug:"/notes/kubernetes-basics/autoscaling-vertical-pod-autoscaler",permalink:"/docs/notes/kubernetes-basics/autoscaling-vertical-pod-autoscaler",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:27,frontMatter:{},sidebar:"notesSidebar",previous:{title:"AutoScaling - Horizontal Pod AutoScaler",permalink:"/docs/notes/kubernetes-basics/autoscaling-horizontal-pod-autoscaler"},next:{title:"AutoScaling - Custom Pod AutoScaler",permalink:"/docs/notes/kubernetes-basics/autoscaling-custom-pod-autoscaler"}},d={},o=[{value:"\u4ec0\u9ebc\u662f Vertical Pod Autoscaler\uff1f",id:"\u4ec0\u9ebc\u662f-vertical-pod-autoscaler",level:2},{value:"VPA \u7684\u6838\u5fc3\u529f\u80fd",id:"vpa-\u7684\u6838\u5fc3\u529f\u80fd",level:2},{value:"VPA \u7684\u904b\u4f5c\u65b9\u5f0f",id:"vpa-\u7684\u904b\u4f5c\u65b9\u5f0f",level:2},{value:"VPA \u914d\u7f6e\u7bc4\u4f8b",id:"vpa-\u914d\u7f6e\u7bc4\u4f8b",level:2},{value:"VPA \u6307\u6a19\u985e\u578b",id:"vpa-\u6307\u6a19\u985e\u578b",level:2},{value:"<code>spec.updatePolicy.updateMode</code>",id:"specupdatepolicyupdatemode",level:3},{value:"\u61c9\u7528\u5834\u666f",id:"\u61c9\u7528\u5834\u666f",level:4},{value:"<code>spec.resourcePolicy.containerPolicies</code>",id:"specresourcepolicycontainerpolicies",level:3},{value:"VPA \u9069\u7528\u5834\u666f",id:"vpa-\u9069\u7528\u5834\u666f",level:2},{value:"VPA \u4f7f\u7528\u9650\u5236",id:"vpa-\u4f7f\u7528\u9650\u5236",level:2},{value:"VPA vs HPA",id:"vpa-vs-hpa",level:2},{value:"\u5be6\u4f5c\u4e00\u500b VPA",id:"\u5be6\u4f5c\u4e00\u500b-vpa",level:2},{value:"\u78ba\u8a8d Metrics Server \u662f\u5426\u6709\u6210\u529f\u57f7\u884c",id:"\u78ba\u8a8d-metrics-server-\u662f\u5426\u6709\u6210\u529f\u57f7\u884c",level:3},{value:"\u5b89\u88dd Custom Resource - VPA",id:"\u5b89\u88dd-custom-resource---vpa",level:3},{value:"\u88fd\u4f5c\u4e00\u500b VPA",id:"\u88fd\u4f5c\u4e00\u500b-vpa",level:3},{value:"VPA Recommendation \u53c3\u6578\u8a73\u89e3",id:"vpa-recommendation-\u53c3\u6578\u8a73\u89e3",level:4},{value:"\u79fb\u9664 VPA \u6a21\u7d44",id:"\u79fb\u9664-vpa-\u6a21\u7d44",level:3},{value:"\u7e3d\u7d50",id:"\u7e3d\u7d50",level:2}];function a(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"autoscaling---vertical-pod-autoscaler",children:"AutoScaling - Vertical Pod AutoScaler"})}),"\n",(0,r.jsx)(n.h2,{id:"\u4ec0\u9ebc\u662f-vertical-pod-autoscaler",children:"\u4ec0\u9ebc\u662f Vertical Pod Autoscaler\uff1f"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"vertical-pod-autoscaler",src:s(97764).A+"",width:"596",height:"165"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Vertical Pod Autoscaler\uff08VPA\uff09"})," \u662f Kubernetes \u63d0\u4f9b\u7684\u4e00\u7a2e\u8cc7\u6e90\u81ea\u52d5\u8abf\u6574\u6a5f\u5236\uff0c\u4e3b\u8981\u7528\u65bc ",(0,r.jsx)(n.strong,{children:"\u52d5\u614b\u8abf\u6574 Pod \u7684 CPU \u548c\u8a18\u61b6\u9ad4\u8cc7\u6e90"}),"\uff0c\u4ee5\u78ba\u4fdd\u61c9\u7528\u7a0b\u5f0f\u80fd\u5920\u7372\u5f97\u9069\u7576\u7684\u8cc7\u6e90\uff0c\u63d0\u5347\u6548\u80fd\u4e26\u964d\u4f4e\u4e0d\u5fc5\u8981\u7684\u8cc7\u6e90\u6d6a\u8cbb\u3002\n\u8207 ",(0,r.jsx)(n.strong,{children:"Horizontal Pod Autoscaler\uff08HPA\uff09"})," \u4e0d\u540c\uff0cVPA \u662f\u900f\u904e ",(0,r.jsx)(n.strong,{children:"\u8abf\u6574\u55ae\u500b Pod \u7684\u8cc7\u6e90\u9650\u5236\uff08CPU / Memory Requests & Limits\uff09"})," \u4f86\u6700\u4f73\u5316\u8cc7\u6e90\u4f7f\u7528\u3002"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"vpa-\u7684\u6838\u5fc3\u529f\u80fd",children:"VPA \u7684\u6838\u5fc3\u529f\u80fd"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u81ea\u52d5\u8abf\u6574 Pod \u8cc7\u6e90\u5206\u914d"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u6839\u64da\u5be6\u969b\u8ca0\u8f09\uff0c\u52d5\u614b\u8abf\u6574 CPU \u548c\u8a18\u61b6\u9ad4\u7684 ",(0,r.jsx)(n.code,{children:"requests"})," \u548c ",(0,r.jsx)(n.code,{children:"limits"}),"\uff0c\u6e1b\u5c11\u904e\u591a\u914d\u7f6e\u9020\u6210\u7684\u6d6a\u8cbb\uff0c\u6216\u907f\u514d\u8cc7\u6e90\u4e0d\u8db3\u5c0e\u81f4\u7684\u6548\u80fd\u554f\u984c\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u907f\u514d OOM\uff08Out of Memory\uff09\u554f\u984c"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c Pod \u9700\u8981\u7684\u8a18\u61b6\u9ad4\u8d85\u51fa\u7576\u524d\u914d\u7f6e\uff0cVPA \u6703\u6839\u64da\u9700\u6c42\u589e\u52a0 ",(0,r.jsx)(n.code,{children:"requests"}),"\uff0c\u9632\u6b62\u56e0\u70ba\u8a18\u61b6\u9ad4\u4e0d\u8db3\u800c\u5c0e\u81f4 Pod Crash\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u63d0\u4f9b\u8cc7\u6e90\u5efa\u8b70\uff08Recommendation Mode\uff09"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["VPA \u53ef\u4ee5\u904b\u884c\u5728 ",(0,r.jsx)(n.strong,{children:"\u63a8\u85a6\u6a21\u5f0f"}),"\uff08Recommend Only\uff09\uff0c\u63d0\u4f9b\u5408\u9069\u7684\u8cc7\u6e90\u914d\u7f6e\u5efa\u8b70\uff0c\u800c\u4e0d\u6703\u81ea\u52d5\u8abf\u6574 Pod \u914d\u7f6e\uff0c\u8b93\u4f7f\u7528\u8005\u81ea\u884c\u6c7a\u5b9a\u662f\u5426\u63a1\u7d0d\u5efa\u8b70\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8207 HPA \u642d\u914d\u4f7f\u7528"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u96d6\u7136 VPA \u548c HPA \u4e3b\u8981\u89e3\u6c7a\u4e0d\u540c\u5c64\u9762\u7684\u8cc7\u6e90\u7ba1\u7406\u554f\u984c\uff0c\u4f46\u5b83\u5011\u53ef\u4ee5\u642d\u914d\u4f7f\u7528\uff0c\u4f8b\u5982\uff1aVPA \u8ca0\u8cac\u8abf\u6574\u500b\u5225 Pod \u7684\u8cc7\u6e90\u8acb\u6c42\uff0c\u800c HPA \u8ca0\u8cac\u64f4\u5c55 Pod \u7684\u6578\u91cf\uff0c\u4ee5\u78ba\u4fdd\u61c9\u7528\u7684\u9ad8\u53ef\u7528\u6027\u548c\u64f4\u5c55\u6027\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"vpa-\u7684\u904b\u4f5c\u65b9\u5f0f",children:"VPA \u7684\u904b\u4f5c\u65b9\u5f0f"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"vertical-pod-autoscaler",src:s(72766).A+"",width:"758",height:"421"})}),"\n",(0,r.jsx)(n.p,{children:"VPA \u7531\u4e09\u500b\u4e3b\u8981\u5143\u4ef6\u7d44\u6210\uff1a"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Recommender\uff08\u5efa\u8b70\u5668\uff09"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u8ca0\u8cac\u76e3\u63a7 Pod \u7684\u8cc7\u6e90\u4f7f\u7528\u60c5\u6cc1\uff0c\u4e26\u6839\u64da\u6b77\u53f2\u6578\u64da\u8a08\u7b97\u51fa\u6700\u4f73\u7684 CPU/\u8a18\u61b6\u9ad4\u9700\u6c42\uff0c\u63d0\u4f9b\u5efa\u8b70\u503c\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Updater\uff08\u66f4\u65b0\u5668\uff09"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u8ca0\u8cac\u6aa2\u67e5\u73fe\u6709\u7684 Pod \u662f\u5426\u9700\u8981\u8abf\u6574\u8cc7\u6e90\u5206\u914d\u3002\u82e5\u9700\u8981\uff0c\u6703\u91cd\u65b0\u5efa\u7acb\u65b0\u7684 Pod\uff08\u56e0\u70ba Kubernetes \u4e0d\u5141\u8a31\u76f4\u63a5\u4fee\u6539 Pod \u7684 ",(0,r.jsx)(n.code,{children:"requests"})," \u548c ",(0,r.jsx)(n.code,{children:"limits"}),"\uff09\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Admission Controller\uff08\u51c6\u5165\u63a7\u5236\u5668\uff09"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5728 Pod \u5275\u5efa\u6642\uff0c\u81ea\u52d5\u70ba\u5176\u8a2d\u5b9a\u9069\u7576\u7684\u8cc7\u6e90\u9650\u5236\uff0c\u78ba\u4fdd\u65b0\u5275\u5efa\u7684 Pod \u7b26\u5408 VPA \u7684\u5efa\u8b70\u914d\u7f6e\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"vpa-\u914d\u7f6e\u7bc4\u4f8b",children:"VPA \u914d\u7f6e\u7bc4\u4f8b"}),"\n",(0,r.jsxs)(n.p,{children:["\u9019\u500b VPA \u7269\u4ef6\u6703 ",(0,r.jsx)(n.strong,{children:"\u81ea\u52d5\u8abf\u6574 CPU \u548c\u8a18\u61b6\u9ad4\u7684 Requests"}),"\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: autoscaling.k8s.io/v1\nkind: VerticalPodAutoscaler\nmetadata:\n  name: hamster-vpa\n  namespace: default\nspec:\n  targetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: hamster\n  updatePolicy:\n    updateMode: \'Auto\' # \u53ef\u9078 "Off"\u3001"Initial"\u3001"Recreate" \u6216 "Auto"\n  resourcePolicy:\n    containerPolicies:\n      - containerName: hamster\n        minAllowed:\n          cpu: 50m\n          memory: 20Mi\n        maxAllowed:\n          cpu: 2\n          memory: 1Gi\n        controlledResources: [\'cpu\', \'memory\']\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"vpa-\u6307\u6a19\u985e\u578b",children:"VPA \u6307\u6a19\u985e\u578b"}),"\n",(0,r.jsx)(n.h3,{id:"specupdatepolicyupdatemode",children:(0,r.jsx)(n.code,{children:"spec.updatePolicy.updateMode"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"updateMode"})," \u63a7\u5236 ",(0,r.jsxs)(n.strong,{children:["VPA \u5982\u4f55\u8abf\u6574 Pod \u7684 ",(0,r.jsx)(n.code,{children:"requests"})]}),"\uff0c\u5b83\u6709\u56db\u7a2e\u6a21\u5f0f\uff1a"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"\u6a21\u5f0f"})}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"\u884c\u70ba"})})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'"Off"'})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"VPA \u53ea\u63d0\u4f9b\u5efa\u8b70"}),"\uff0c\u4e0d\u6703\u81ea\u52d5\u8abf\u6574 Pod\u3002\u9700\u8981\u624b\u52d5\u67e5\u8a62 VPA \u5efa\u8b70\u503c\u3002"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'"Initial"'})}),(0,r.jsxs)(n.td,{children:[(0,r.jsxs)(n.strong,{children:["\u53ea\u6703\u5728 Pod \u555f\u52d5\u6642\u8abf\u6574 ",(0,r.jsx)(n.code,{children:"requests"})]}),"\uff0c\u4e4b\u5f8c\u4e0d\u518d\u66f4\u65b0\u3002\u9069\u5408\u5c0d\u8b8a\u52d5\u4e0d\u5927\u7684\u61c9\u7528\u3002"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'"Recreate"'})}),(0,r.jsxs)(n.td,{children:[(0,r.jsxs)(n.strong,{children:["\u8abf\u6574 ",(0,r.jsx)(n.code,{children:"requests"})," \u9700\u8981\u522a\u9664\u4e26\u91cd\u65b0\u5efa\u7acb Pod"]}),"\uff0c\u56e0\u6b64\u6703\u6709\u505c\u6a5f\u6642\u9593\u3002\u9069\u5408 ",(0,r.jsxs)(n.strong,{children:["\u7121\u6cd5\u52d5\u614b\u8abf\u6574 ",(0,r.jsx)(n.code,{children:"requests"})]})," \u7684\u61c9\u7528\u3002"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'"Auto"'})}),(0,r.jsxs)(n.td,{children:[(0,r.jsxs)(n.strong,{children:["\u81ea\u52d5\u8abf\u6574 ",(0,r.jsx)(n.code,{children:"requests"}),"\uff0c\u4e26\u76e1\u91cf\u907f\u514d\u91cd\u555f Pod"]}),"\uff08\u9069\u7528\u65bc\u652f\u63f4\u52d5\u614b\u8cc7\u6e90\u8b8a\u66f4\u7684\u61c9\u7528\uff09\u3002"]})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"\u61c9\u7528\u5834\u666f",children:"\u61c9\u7528\u5834\u666f"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:'"Off"'})})," \u2192 \u53ea\u60f3\u67e5\u770b VPA \u7684\u5efa\u8b70\u503c\uff0c\u800c\u4e0d\u8b93\u5b83\u81ea\u52d5\u8abf\u6574\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:'"Initial"'})})," \u2192 \u9069\u5408\u6279\u6b21\u5de5\u4f5c\uff08Batch Jobs\uff09\uff0c\u53ea\u5728\u555f\u52d5\u6642\u8a2d\u5b9a\u5408\u9069\u7684 ",(0,r.jsx)(n.code,{children:"requests"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:'"Recreate"'})})," \u2192 \u9069\u5408 ",(0,r.jsxs)(n.strong,{children:["\u7121\u6cd5\u52d5\u614b\u8b8a\u66f4 ",(0,r.jsx)(n.code,{children:"requests"})]})," \u7684\u61c9\u7528\uff0c\u4f8b\u5982\u67d0\u4e9b\u57fa\u65bc Java \u7684\u61c9\u7528\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:'"Auto"'})})," \u2192 ",(0,r.jsx)(n.strong,{children:"\u63a8\u85a6\u9078\u64c7"}),"\uff0c\u9069\u5408\u5927\u90e8\u5206\u61c9\u7528\uff0c\u80fd\u52d5\u614b\u8abf\u6574 ",(0,r.jsx)(n.code,{children:"requests"})," \u800c\u4e0d\u5f71\u97ff\u904b\u884c\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"specresourcepolicycontainerpolicies",children:(0,r.jsx)(n.code,{children:"spec.resourcePolicy.containerPolicies"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"containerPolicies"})," \u7528\u4f86 ",(0,r.jsx)(n.strong,{children:"\u8a2d\u5b9a VPA \u5141\u8a31\u8abf\u6574\u7684\u8cc7\u6e90\u7bc4\u570d"}),"\uff0c\u7d30\u5206\u5982\u4e0b\uff1a"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"\u6b04\u4f4d"})}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"\u529f\u80fd"})})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"containerName"})}),(0,r.jsxs)(n.td,{children:["\u6307\u5b9a\u8981\u8abf\u6574\u7684\u5bb9\u5668\u540d\u7a31\u3002\u53ef\u4ee5\u662f\u7279\u5b9a\u540d\u7a31\u6216 ",(0,r.jsx)(n.code,{children:'"*"'}),"\uff08\u4ee3\u8868\u6240\u6709\u5bb9\u5668\uff09\u3002"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"minAllowed"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsxs)(n.strong,{children:["VPA \u5141\u8a31\u7684\u6700\u5c0f ",(0,r.jsx)(n.code,{children:"requests"})," \u9650\u5236"]}),"\uff0c\u4f4e\u65bc\u6b64\u503c\u4e0d\u6703\u8abf\u6574\u3002"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"maxAllowed"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsxs)(n.strong,{children:["VPA \u5141\u8a31\u7684\u6700\u5927 ",(0,r.jsx)(n.code,{children:"requests"})," \u9650\u5236"]}),"\uff0c\u8d85\u904e\u6b64\u503c\u4e0d\u6703\u8abf\u6574\u3002"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"controlledResources"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"\u6307\u5b9a\u8981\u8abf\u6574\u7684\u8cc7\u6e90\u985e\u578b"}),"\uff0c\u53ef\u4ee5\u662f ",(0,r.jsx)(n.code,{children:'"cpu"'}),"\u3001",(0,r.jsx)(n.code,{children:'"memory"'}),"\uff0c\u6216 ",(0,r.jsx)(n.code,{children:'["cpu", "memory"]'}),"\u3002"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"controlledValues"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsxs)(n.strong,{children:["\uff08\u9078\u586b\uff09\u53ef\u9078 ",(0,r.jsx)(n.code,{children:'"RequestsAndLimits"'})," \u6216 ",(0,r.jsx)(n.code,{children:'"RequestsOnly"'}),"\uff0c\u9810\u8a2d\u70ba ",(0,r.jsx)(n.code,{children:'"RequestsOnly"'})]}),"\u3002"]})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"vpa-\u9069\u7528\u5834\u666f",children:"VPA \u9069\u7528\u5834\u666f"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6a5f\u5668\u5b78\u7fd2 / \u6279\u6b21\u8655\u7406\u61c9\u7528"}),"\uff1a\u9019\u4e9b\u61c9\u7528\u5c0d CPU \u548c\u8a18\u61b6\u9ad4\u6709\u8f03\u9ad8\u9700\u6c42\uff0cVPA \u80fd\u5920\u78ba\u4fdd\u5b83\u5011\u7372\u5f97\u8db3\u5920\u7684\u8cc7\u6e90\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9577\u6642\u9593\u904b\u884c\u7684\u61c9\u7528"}),"\uff1a\u5c0d\u65bc\u4e00\u4e9b\u9577\u6642\u9593\u904b\u884c\u7684\u61c9\u7528\uff08\u5982\u8cc7\u6599\u5eab\u3001\u5f8c\u53f0\u670d\u52d9\uff09\uff0cVPA \u80fd\u5920\u6839\u64da\u6b77\u53f2\u8ca0\u8f09\u9010\u6b65\u8abf\u6574\u8cc7\u6e90\u914d\u7f6e\uff0c\u63d0\u5347\u6548\u80fd\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9810\u7b97\u53d7\u9650\u7684\u61c9\u7528"}),"\uff1a\u7576\u9700\u8981\u7bc0\u7701\u8cc7\u6e90\u6210\u672c\u6642\uff0cVPA \u53ef\u4ee5\u5e6b\u52a9\u6e1b\u5c11\u4e0d\u5fc5\u8981\u7684 CPU/\u8a18\u61b6\u9ad4\u914d\u7f6e\uff0c\u907f\u514d\u6d6a\u8cbb\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"vpa-\u4f7f\u7528\u9650\u5236",children:"VPA \u4f7f\u7528\u9650\u5236"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"VPA \u9700\u8981\u91cd\u555f Pod"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u7531\u65bc Kubernetes \u4e0d\u5141\u8a31\u52d5\u614b\u4fee\u6539 Pod \u7684 ",(0,r.jsx)(n.code,{children:"requests"})," \u548c ",(0,r.jsx)(n.code,{children:"limits"}),"\uff0c\u6240\u4ee5 VPA \u5728\u8abf\u6574\u8cc7\u6e90\u6642\u6703",(0,r.jsx)(n.strong,{children:"\u522a\u9664\u820a Pod \u4e26\u91cd\u65b0\u5275\u5efa\u65b0 Pod"}),"\uff0c\u53ef\u80fd\u6703\u5c0e\u81f4\u77ed\u66ab\u7684\u505c\u6a5f\u6642\u9593\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8207 HPA \u53ef\u80fd\u885d\u7a81"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5982\u679c HPA \u4f9d\u64da CPU/\u8a18\u61b6\u9ad4\u4f86\u64f4\u5c55 Pod \u6578\u91cf\uff0c\u800c VPA \u540c\u6642\u8abf\u6574 CPU/\u8a18\u61b6\u9ad4\u7684\u8acb\u6c42\u503c\uff0c\u53ef\u80fd\u6703\u7522\u751f\u8cc7\u6e90\u914d\u7f6e\u885d\u7a81\uff0c\u56e0\u6b64\u901a\u5e38 HPA \u6703\u57fa\u65bc\u81ea\u5b9a\u7fa9\u6307\u6a19\uff08\u5982\u8acb\u6c42\u6578\u91cf\uff09\u904b\u884c\uff0c\u800c VPA \u8ca0\u8cac CPU/Memory \u7684\u6700\u4f73\u5316\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u7121\u6cd5\u9069\u7528\u65bc Request \u91cf\u8b8a\u5316\u5927\u4f46\u8cc7\u6e90\u9700\u6c42\u5c0f\u7684\u61c9\u7528"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f8b\u5982 Web \u4f3a\u670d\u5668\u6d41\u91cf\u9ad8\u5cf0\u6642\uff0cVPA \u53ef\u80fd\u7121\u6cd5\u61c9\u5c0d\u7a81\u767c\u8ca0\u8f09\uff0c\u800c HPA \u900f\u904e Pod \u6c34\u5e73\u64f4\u5c55\u66f4\u9069\u5408\u9019\u7a2e\u5834\u666f\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"vpa-vs-hpa",children:"VPA vs HPA"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u7279\u6027"}),(0,r.jsx)(n.th,{children:"VPA\uff08\u5782\u76f4\u64f4\u5c55\uff09"}),(0,r.jsx)(n.th,{children:"HPA\uff08\u6c34\u5e73\u64f4\u5c55\uff09"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u8abf\u6574\u65b9\u5f0f"})}),(0,r.jsx)(n.td,{children:"\u589e\u52a0 / \u6e1b\u5c11 Pod \u7684 CPU & \u8a18\u61b6\u9ad4"}),(0,r.jsx)(n.td,{children:"\u589e\u52a0 / \u6e1b\u5c11 Pod \u7684\u6578\u91cf"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u9069\u7528\u5834\u666f"})}),(0,r.jsx)(n.td,{children:"Pod \u5167\u90e8\u8ca0\u8f09\u8b8a\u5316\uff0c\u4f46\u6574\u9ad4\u6578\u91cf\u4e0d\u9700\u8b8a\u52d5"}),(0,r.jsx)(n.td,{children:"\u9700\u8981\u64f4\u5c55 Pod \u6578\u91cf\u4f86\u61c9\u5c0d\u6d41\u91cf\u8b8a\u5316"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u5f71\u97ff"})}),(0,r.jsx)(n.td,{children:"\u9700\u8981\u91cd\u65b0\u555f\u52d5 Pod"}),(0,r.jsx)(n.td,{children:"\u7121\u9808\u91cd\u555f\uff0c\u53ef\u52d5\u614b\u64f4\u5c55"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u76e3\u63a7\u6307\u6a19"})}),(0,r.jsx)(n.td,{children:"CPU / Memory \u4f7f\u7528\u7387"}),(0,r.jsx)(n.td,{children:"CPU / Memory / \u81ea\u5b9a\u7fa9\u6307\u6a19"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u8207 HPA \u7684\u642d\u914d"})}),(0,r.jsx)(n.td,{children:"\u53ef\u4ee5\u5171\u540c\u4f7f\u7528\uff0c\u4f46\u9808\u907f\u514d\u885d\u7a81"}),(0,r.jsx)(n.td,{children:"\u53ef\u4ee5\u8207 VPA \u914d\u5408\uff0c\u91dd\u5c0d\u4e0d\u540c\u9700\u6c42\u8abf\u6574"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u5be6\u4f5c\u4e00\u500b-vpa",children:"\u5be6\u4f5c\u4e00\u500b VPA"}),"\n",(0,r.jsx)(n.h3,{id:"\u78ba\u8a8d-metrics-server-\u662f\u5426\u6709\u6210\u529f\u57f7\u884c",children:"\u78ba\u8a8d Metrics Server \u662f\u5426\u6709\u6210\u529f\u57f7\u884c"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u9996\u5148\u6211\u5011\u53ef\u4ee5\u89c0\u5bdf Node \u7684\u72c0\u614b\uff0c\u4f86\u78ba\u8a8d Metrics Server \u662f\u5426\u6709\u6b63\u78ba\u57f7\u884c\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl.exe top node\n---\n\nNAME             CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%\ndocker-desktop   155m         0%     3487Mi          22%\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5b89\u88dd-custom-resource---vpa",children:"\u5b89\u88dd Custom Resource - VPA"}),"\n",(0,r.jsxs)(n.p,{children:["\u56e0\u70ba\u5b98\u65b9\u7684\u5167\u5efa\u7684 API \u53ea\u6709\u652f\u63f4 HPA \u800c\u5df2\uff0c\u5982\u679c\u6211\u5011\u9700\u8981\u7528\u5230 ",(0,r.jsx)(n.strong,{children:"cluster autoscaler"})," \u6216 ",(0,r.jsx)(n.strong,{children:"vertical autoscaler"})," \u7b49 CRD \u6642\uff0c\u5247\u9700\u8981\u4ee5\u6a21\u7d44\u7684\u65b9\u5f0f\u8f09\u5165\u3002"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\u56e0\u70ba\u5b89\u88dd\u9700\u8981/bin/sh\uff0c\u9996\u5148\u6211\u5011\u5148\u5b89\u88dd ",(0,r.jsx)(n.strong,{children:"Windows Subsystem for Linux (WSL)"}),"\uff0c\u767b\u51fa\u5f8c\u9700\u8981\u91cd\u65b0\u555f\u52d5\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'wsl --install\n---\n\n\u5b89\u88dd: Ubuntu\nUbuntu \u5df2\u5b89\u88dd\u3002\n\u6b63\u5728\u555f\u52d5 Ubuntu...\nInstalling, this may take a few minutes...\nPlease create a default UNIX user account. The username does not need to match your Windows username.\nFor more information visit: https://aka.ms/wslusers\nEnter new UNIX username: calvin\nNew password:\nRetype new password:\npasswd: password updated successfully\nInstallation successful!\nTo run a command as administrator (user "root"), use "sudo <command>".\nSee "man sudo_root" for details.\n\nWelcome to Ubuntu 24.04.1 LTS (GNU/Linux 5.15.167.4-microsoft-standard-WSL2 x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/pro\n\n System information as of Tue Feb  4 20:29:43 CST 2025\n\n  System load:  0.44                Processes:             87\n  Usage of /:   0.1% of 1006.85GB   Users logged in:       0\n  Memory usage: 23%                 IPv4 address for eth0: 172.22.44.200\n  Swap usage:   0%\n\n\nThis message is shown once a day. To disable it please create the\n/home/calvin/.hushlogin file.\ncalvin@DESKTOP-PT7UK12:~$\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"calvin@DESKTOP-PT7UK12:~$ exit\n---\n\nlogout\n\u64cd\u4f5c\u9806\u5229\u5b8c\u6210\u3002\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u767b\u5165 WSL \u9032\u5230 Ubuntu \u7684\u74b0\u5883\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'wsl -d Ubuntu\n---\n\nTo run a command as administrator (user "root"), use "sudo <command>".\nSee "man sudo_root" for details.\n\ncalvin@DESKTOP-PT7UK12:/mnt/c/Users/calvin$\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"\u56e0\u70ba\u662f\u5168\u65b0\u7684\u74b0\u5883\uff0c\u9700\u8981\u91cd\u65b0\u5b89\u88dd kubectl\uff0c\u4e26\u78ba\u8a8d kubectl \u53ef\u4ee5\u57f7\u884c\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"\nchmod +x kubectl\nsudo mv kubectl /usr/local/bin/\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl version --client\n---\n\nClient Version: v1.32.1\nKustomize Version: v5.5.0\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:"\u63a5\u8457\u6211\u5011\u8f09\u5165\u539f\u672c docker desktop \u9810\u8a2d\u7684 kube config\uff0c\u9019\u6a23\u6211\u5011\u5c31\u80fd\u900f\u904e wsl \u7684 kubectl \u53bb\u64cd\u4f5c\u672c\u6a5f\u7684 kubernetes\uff0c\u4e26\u4e14\u78ba\u8a8d nodes \u6709\u6b63\u78ba\u88ab\u8b80\u53d6\u5230\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export KUBECONFIG=/mnt/c/Users/\u4f60\u7684Windows\u5e33\u865f/.kube/config\nkubectl get nodes\n---\n\nNAME             STATUS   ROLES           AGE    VERSION\ndocker-desktop   Ready    control-plane   111d   v1.27.2\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsx)(n.li,{children:"cd \u5230\u60f3\u8981\u5b89\u88dd\u7684\u8cc7\u6599\u593e\u4e0b\uff0c\u900f\u904e\u5b98\u65b9\u7684 autoscaler repo \u4f86\u9032\u884c VPA \u7684\u5b89\u88dd\uff0c\u9996\u5148\u6211\u5011\u5f9e git \u4e0a\u4e0b\u8f09 repository\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"calvin@DESKTOP-PT7UK12:/mnt/d/kubernetes-from-another-world/ch27$ git clone https://github.com/kubernetes/autoscaler.git\n---\n\nCloning into 'autoscaler'...\nremote: Enumerating objects: 217215, done.\nremote: Counting objects: 100% (2251/2251), done.\nremote: Compressing objects: 100% (1404/1404), done.\nremote: Total 217215 (delta 1546), reused 848 (delta 847), pack-reused 214964 (from 3)\nReceiving objects: 100% (217215/217215), 244.18 MiB | 1.36 MiB/s, done.\nResolving deltas: 100% (139908/139908), done.\nUpdating files: 100% (7918/7918), done.\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"6",children:["\n",(0,r.jsx)(n.li,{children:"\u63a5\u8457\u9032\u5230\u9019\u500b\u5c08\u6848\u7684\u8cc7\u6599\u593e\u4e4b\u4e2d\uff0c\u8981\u9032\u884c\u5b89\u88dd\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"calvin@DESKTOP-PT7UK12:/mnt/d/kubernetes-from-another-world/ch27$ cd ./autoscaler/vertical-pod-autoscaler/\n---\n\ncalvin@DESKTOP-PT7UK12:/mnt/d/kubernetes-from-another-world/ch27/autoscaler/vertical-pod-autoscaler$\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"7",children:["\n",(0,r.jsx)(n.li,{children:"\u57f7\u884c./hack/vpa-up.sh \u5b89\u88dd\uff0c\u5982\u679c\u6c92\u6709\u4efb\u4f55 Error \u5c31\u4ee3\u8868\u6210\u529f\u56c9\uff01"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"calvin@DESKTOP-PT7UK12:/mnt/d/kubernetes-from-another-world/ch27/autoscaler/vertical-pod-autoscaler$ ./hack/vpa-up.sh\n---\n\nHEAD is now at 200a292f8 Merge pull request #7774 from jm-franc/vpa-finalize-branch\ncustomresourcedefinition.apiextensions.k8s.io/verticalpodautoscalercheckpoints.autoscaling.k8s.io created\ncustomresourcedefinition.apiextensions.k8s.io/verticalpodautoscalers.autoscaling.k8s.io created\nclusterrole.rbac.authorization.k8s.io/system:metrics-reader created\nclusterrole.rbac.authorization.k8s.io/system:vpa-actor created\nclusterrole.rbac.authorization.k8s.io/system:vpa-status-actor created\nclusterrole.rbac.authorization.k8s.io/system:vpa-checkpoint-actor created\nclusterrole.rbac.authorization.k8s.io/system:evictioner created\nclusterrolebinding.rbac.authorization.k8s.io/system:metrics-reader created\nclusterrolebinding.rbac.authorization.k8s.io/system:vpa-actor created\nclusterrolebinding.rbac.authorization.k8s.io/system:vpa-status-actor created\nclusterrolebinding.rbac.authorization.k8s.io/system:vpa-checkpoint-actor created\nclusterrole.rbac.authorization.k8s.io/system:vpa-target-reader created\nclusterrolebinding.rbac.authorization.k8s.io/system:vpa-target-reader-binding created\nclusterrolebinding.rbac.authorization.k8s.io/system:vpa-evictioner-binding created\nserviceaccount/vpa-admission-controller created\nserviceaccount/vpa-recommender created\nserviceaccount/vpa-updater created\nclusterrole.rbac.authorization.k8s.io/system:vpa-admission-controller created\nclusterrolebinding.rbac.authorization.k8s.io/system:vpa-admission-controller created\nclusterrole.rbac.authorization.k8s.io/system:vpa-status-reader created\nclusterrolebinding.rbac.authorization.k8s.io/system:vpa-status-reader-binding created\nrole.rbac.authorization.k8s.io/system:leader-locking-vpa-updater created\nrolebinding.rbac.authorization.k8s.io/system:leader-locking-vpa-updater created\nrole.rbac.authorization.k8s.io/system:leader-locking-vpa-recommender created\nrolebinding.rbac.authorization.k8s.io/system:leader-locking-vpa-recommender created\ndeployment.apps/vpa-updater created\ndeployment.apps/vpa-recommender created\nGenerating certs for the VPA Admission Controller in /tmp/vpa-certs.\nCertificate request self-signature ok\nsubject=CN = vpa-webhook.kube-system.svc\nUploading certs to the cluster.\nsecret/vpa-tls-certs created\nDeleting /tmp/vpa-certs.\ndeployment.apps/vpa-admission-controller created\nservice/vpa-webhook created\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"8",children:["\n",(0,r.jsx)(n.li,{children:"\u9000\u51fa WSL \u4e4b\u5f8c\uff0c\u6211\u5011\u53ef\u4ee5\u770b\u5230\u4e09\u500b\u91cd\u8981\u7684 Pod \u88ab\u6b63\u78ba\u57f7\u884c\uff0c\u4e26\u4e14 api-resources \u4e5f\u80fd\u770b\u5230\u6211\u5011\u53ef\u4ee5\u4f7f\u7528 VPA \u4e86\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl.exe get pods -n kube-system | Select-String "vpa"\n---\n\nvpa-admission-controller-66c599944b-8gxtj   1/1     Running   0              3m26s\nvpa-recommender-5bcb9f847-mkx9r             1/1     Running   0              3m26s\nvpa-updater-7fbd7cf94b-95r6x                1/1     Running   0              3m26s\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl.exe api-resources | Select-String "vpa"\n---\n\nverticalpodautoscalercheckpoints   vpacheckpoint   autoscaling.k8s.io/v1                  true         VerticalPodAutoscalerCheckpoint\nverticalpodautoscalers             vpa             autoscaling.k8s.io/v1                  true         VerticalPodAutoscaler\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u88fd\u4f5c\u4e00\u500b-vpa",children:"\u88fd\u4f5c\u4e00\u500b VPA"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u9996\u5148\u6211\u5011\u5148\u88fd\u4f5c\u4e00\u500b deployment\uff0c\u505a\u70ba\u5f8c\u7e8c VPA \u8abf\u6574\u7684\u5c0d\u8c61\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="deployment.yaml"',children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: hamster\n  namespace: default\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: hamster\n  template:\n    metadata:\n      labels:\n        app: hamster\n    spec:\n      containers:\n        - name: hamster\n          image: registry.k8s.io/ubuntu-slim:0.1\n          resources:\n            requests:\n              cpu: 100m\n              memory: 50Mi\n            limits:\n              cpu: '2'\n              memory: 2Gi\n          command: ['/bin/sh']\n          args:\n            - '-c'\n            - 'while true; do timeout 0.2s yes > /dev/null; sleep 0.5s; done'\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u63a5\u8457\u8a2d\u5b9a VPA\uff0c\u8b93\u4ed6\u6839\u64da CPU \u548c Memory \u7684\u4f7f\u7528\u91cf\u4f86\u8abf\u6574 deployment\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="vpa.yaml"',children:"apiVersion: autoscaling.k8s.io/v1\nkind: VerticalPodAutoscaler # \u6307\u5b9a\u9019\u662f\u4e00\u500b VPA \u8cc7\u6e90\nmetadata:\n  name: hamster-vpa # VPA \u8cc7\u6e90\u7684\u540d\u7a31\n  namespace: default # VPA \u4f5c\u7528\u7684\u547d\u540d\u7a7a\u9593\nspec:\n  targetRef: # \u76ee\u6a19 Pod\uff08Deployment\u3001StatefulSet\u3001DaemonSet\uff09\n    apiVersion: apps/v1 # \u76ee\u6a19\u7269\u4ef6\u7684 API \u7248\u672c\n    kind: Deployment # \u76ee\u6a19\u7269\u4ef6\u985e\u578b\n    name: hamster # \u76ee\u6a19 Deployment \u7684\u540d\u7a31\n  updatePolicy:\n    // highlight-next-line\n    updateMode: 'Off'\n  resourcePolicy: # \u8a2d\u5b9a VPA \u76e3\u63a7\u8207\u8abf\u6574\u7684\u8cc7\u6e90\u7bc4\u570d\n    containerPolicies:\n      // highlight-start\n      - containerName: '*'  # \"*\" \u4ee3\u8868\u5f71\u97ff\u6240\u6709\u5bb9\u5668\uff08\u53ef\u80fd\u7121\u6548\uff0c\u5efa\u8b70\u4f7f\u7528\u5177\u9ad4\u5bb9\u5668\u540d\u7a31\uff09\n        minAllowed:  # \u8a2d\u5b9a\u8cc7\u6e90\u7684\u6700\u5c0f\u9650\u5236\uff0c\u907f\u514d VPA \u964d\u5f97\u592a\u4f4e\n          cpu: '100m'  # \u6700\u4f4e CPU \u9650\u5236\u70ba 100m\uff080.1 vCPU\uff09\n          memory: '50Mi'  # \u6700\u4f4e\u8a18\u61b6\u9ad4\u9650\u5236\u70ba 50Mi\uff0850MB\uff09\n        maxAllowed:  # \u8a2d\u5b9a\u8cc7\u6e90\u7684\u6700\u5927\u9650\u5236\uff0c\u907f\u514d VPA \u63d0\u5347\u904e\u982d\n          cpu: '1'  # \u6700\u9ad8 CPU \u9650\u5236\u70ba 1 \u6838\u5fc3\uff081000m\uff09\n          memory: '500Mi'  # \u6700\u9ad8\u8a18\u61b6\u9ad4\u9650\u5236\u70ba 500Mi\uff08500MB\uff09\n        controlledResources: ['cpu', 'memory']  # VPA \u53ea\u8abf\u6574 CPU \u548c\u8a18\u61b6\u9ad4\n      // highlight-end\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"\u901a\u904e\u6307\u4ee4\u4f86\u904b\u884c\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl.exe apply -f deployment.yaml,vpa.yaml\n---\n\ndeployment.apps/hamster created\nverticalpodautoscaler.autoscaling.k8s.io/hamster-vpa created\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:"\u67e5\u770b VPA \u7d66\u51fa\u7684\u5efa\u8b70\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl.exe get vpa\n---\n\nNAME          MODE   CPU    MEM       PROVIDED   AGE\nhamster-vpa   Off    323m   262144k   True       44s\n# 262144k \u7d04\u7b49\u65bc 255Mi\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-powershell",children:"kubectl.exe describe vpa hamster-vpa\n---\n\nName:         hamster-vpa\nNamespace:    default\n...\u4e2d\u9593\u7701\u7565...\nStatus:\n  Conditions:\n    Last Transition Time:  2025-02-04T16:20:30Z\n    Status:                True\n    Type:                  RecommendationProvided\n  Recommendation:\n    Container Recommendations:\n      // highlight-start\n      Container Name:  hamster\n      Lower Bound:\n        Cpu:     100m\n        Memory:  262144k\n      Target:\n        Cpu:     350m\n        Memory:  262144k\n      Uncapped Target:\n        Cpu:     350m\n        Memory:  262144k\n      Upper Bound:\n        Cpu:     1\n        Memory:  500Mi\n      // highlight-end\nEvents:          <none>\n"})}),"\n",(0,r.jsx)(n.h4,{id:"vpa-recommendation-\u53c3\u6578\u8a73\u89e3",children:"VPA Recommendation \u53c3\u6578\u8a73\u89e3"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Lower Bound\uff08\u6700\u4f4e\u5efa\u8b70\u503c\uff09"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u9019\u662f VPA \u5efa\u8b70\u7684\u6700\u5c0f ",(0,r.jsx)(n.code,{children:"requests"})," \u503c"]}),"\uff0c\u4ee3\u8868 ",(0,r.jsx)(n.strong,{children:"\u5bb9\u5668\u81f3\u5c11\u61c9\u8a72\u914d\u7f6e\u9019\u9ebc\u591a\u8cc7\u6e90\uff0c\u5426\u5247\u53ef\u80fd\u6703\u6709\u8cc7\u6e90\u4e0d\u8db3\u7684\u98a8\u96aa"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c\u4f60\u7684 ",(0,r.jsx)(n.code,{children:"requests"})," \u8a2d\u5b9a ",(0,r.jsx)(n.strong,{children:"\u4f4e\u65bc"})," \u9019\u500b\u6578\u503c\uff0c\u5bb9\u5668\u53ef\u80fd\u6703\u9047\u5230\u8cc7\u6e90\u4e0d\u8db3\u7684\u554f\u984c\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Target\uff08\u76ee\u6a19\u5efa\u8b70\u503c\uff09"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u9019\u662f VPA \u5efa\u8b70\u7684\u6700\u4f73 ",(0,r.jsx)(n.code,{children:"requests"})," \u503c"]}),"\uff0c\u4ee3\u8868\u5bb9\u5668\u5728\u7576\u524d\u8ca0\u8f09\u4e0b\u61c9\u8a72\u8a2d\u5b9a\u7684\u8cc7\u6e90\u5927\u5c0f\uff0c\u4ee5\u78ba\u4fdd\u7a69\u5b9a\u904b\u884c\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c\u4f60\u8a2d\u5b9a ",(0,r.jsx)(n.code,{children:"requests"})," ",(0,r.jsx)(n.strong,{children:"\u63a5\u8fd1\u9019\u500b\u503c\uff0c\u8cc7\u6e90\u5229\u7528\u7387\u5c07\u662f\u6700\u512a\u7684"}),"\uff0c\u4e0d\u6703\u6d6a\u8cbb\u592a\u591a\u8cc7\u6e90\uff0c\u4f46\u4e5f\u4e0d\u6703\u767c\u751f\u77ed\u7f3a\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Uncapped Target\uff08\u672a\u53d7\u9650\u7684\u76ee\u6a19\u503c\uff09"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u9019\u662f VPA \u8a08\u7b97\u51fa\u7684\u76ee\u6a19\u503c\uff0c\u4f46\u4e0d\u8003\u616e ",(0,r.jsx)(n.code,{children:"maxAllowed"})," \u9650\u5236"]}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u5982\u679c ",(0,r.jsx)(n.code,{children:"Uncapped Target"})," \u5927\u65bc ",(0,r.jsx)(n.code,{children:"maxAllowed"}),"\uff0c\u90a3\u9ebc ",(0,r.jsx)(n.code,{children:"Target"})," \u6703\u88ab VPA \u9650\u5236\u5728 ",(0,r.jsx)(n.code,{children:"maxAllowed"})," \u5167"]}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Upper Bound\uff08\u6700\u9ad8\u5efa\u8b70\u503c\uff09"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u9019\u662f VPA \u5efa\u8b70\u7684\u6700\u5927 ",(0,r.jsx)(n.code,{children:"requests"})," \u503c"]}),"\uff0c\u4ee3\u8868\u5bb9\u5668 ",(0,r.jsx)(n.strong,{children:"\u6700\u591a\u9700\u8981\u591a\u5c11\u8cc7\u6e90"})," \u624d\u80fd\u61c9\u5c0d\u9ad8\u8ca0\u8f09\u60c5\u6cc1\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u5982\u679c ",(0,r.jsx)(n.code,{children:"requests"})," \u8a2d\u5b9a\u8d85\u904e\u9019\u500b\u503c\uff0c\u53ef\u80fd\u6703\u9020\u6210\u8cc7\u6e90\u6d6a\u8cbb\uff0c\u9664\u975e\u4f60\u7684\u61c9\u7528\u771f\u7684\u9700\u8981\u9019\u9ebc\u591a\u8cc7\u6e90"]}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u53c3\u6578"}),(0,r.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Lower Bound"})}),(0,r.jsxs)(n.td,{children:["\u6700\u5c0f\u5efa\u8b70 ",(0,r.jsx)(n.code,{children:"requests"}),"\uff0c\u4f4e\u65bc\u9019\u500b\u503c\u53ef\u80fd\u6703\u6709\u8cc7\u6e90\u4e0d\u8db3\u98a8\u96aa"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Target"})}),(0,r.jsxs)(n.td,{children:["\u6700\u4f73\u5efa\u8b70 ",(0,r.jsx)(n.code,{children:"requests"}),"\uff0c\u8a2d\u5b9a\u70ba\u9019\u500b\u503c\u53ef\u6700\u4f73\u5316\u6548\u80fd\u8207\u8cc7\u6e90\u5229\u7528\u7387"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Uncapped Target"})}),(0,r.jsxs)(n.td,{children:["\u6c92\u6709 ",(0,r.jsx)(n.code,{children:"maxAllowed"})," \u9650\u5236\u7684\u7406\u60f3 ",(0,r.jsx)(n.code,{children:"requests"})," \u503c"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Upper Bound"})}),(0,r.jsxs)(n.td,{children:["\u6700\u5927\u5efa\u8b70 ",(0,r.jsx)(n.code,{children:"requests"}),"\uff0c\u8d85\u904e\u9019\u500b\u503c\u53ef\u80fd\u662f\u8cc7\u6e90\u6d6a\u8cbb"]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"\u79fb\u9664-vpa-\u6a21\u7d44",children:"\u79fb\u9664 VPA \u6a21\u7d44"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u540c\u4e0a\u9762\u5b89\u88dd\u7684\u65b9\u6cd5\uff0c\u53ea\u662f\u5728\u6700\u5f8c\u9762\u57f7\u884c./hack/vpa-down.sh\uff0c\u5c31\u53ef\u4ee5\u5b8c\u5168\u5c07\u8cc7\u6e90\u79fb\u9664\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./hack/vpa-down.sh\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u7e3d\u7d50",children:"\u7e3d\u7d50"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"VPA \u900f\u904e\u8abf\u6574 Pod \u7684 CPU \u548c\u8a18\u61b6\u9ad4\u5206\u914d\uff0c\u78ba\u4fdd\u61c9\u7528\u7372\u5f97\u9069\u7576\u7684\u8cc7\u6e90\u3002"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"\u5b83\u9069\u5408\u7528\u65bc\u8cc7\u6e90\u9700\u6c42\u7a69\u5b9a\u6216\u9700\u8981\u6700\u4f73\u5316\u8cc7\u6e90\u5206\u914d\u7684\u61c9\u7528\u3002"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.strong,{children:["\u8207 HPA \u4e0d\u540c\uff0cVPA \u4e0d\u6703\u6539\u8b8a Pod \u6578\u91cf\uff0c\u800c\u662f\u8abf\u6574\u55ae\u500b Pod \u7684 ",(0,r.jsx)(n.code,{children:"requests"})," \u548c ",(0,r.jsx)(n.code,{children:"limits"}),"\u3002"]})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"\u4f7f\u7528 VPA \u53ef\u80fd\u6703\u5c0e\u81f4 Pod \u91cd\u555f\uff0c\u56e0\u6b64\u9700\u8981\u8003\u616e\u5f71\u97ff\u3002"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"VPA \u548c HPA \u53ef\u4ee5\u642d\u914d\u4f7f\u7528\uff0c\u4f46\u9700\u8981\u5c0f\u5fc3\u907f\u514d\u885d\u7a81\u3002"})}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u82e5 HPA\uff08Horizontal Pod Autoscaler\uff09\u4f7f\u7528\u7684\u6307\u6a19",(0,r.jsx)(n.strong,{children:"\u4e0d\u662f\u5916\u90e8\u8cc7\u6e90\u6307\u6a19"}),"\uff08\u5982 CPU \u6216 Memory\uff09\uff0c\u5247\u8207 VPA \u7684 ",(0,r.jsx)(n.strong,{children:"Auto \u6a21\u5f0f"})," \u53ef\u80fd\u6703\u7522\u751f\u885d\u7a81\uff0c\u5c0e\u81f4\u4e0d\u53ef\u9810\u6e2c\u7684\u884c\u70ba\u3002\n\u56e0\u6b64\uff0c\u6211\u66f4\u50be\u5411\u65bc\u63a1\u7528 ",(0,r.jsx)(n.strong,{children:"HPA \u642d\u914d VPA \u7684 Off \u6a21\u5f0f"}),"\uff0c\u4e26\u900f\u904e VPA \u63d0\u4f9b\u7684\u5efa\u8b70\u503c\u4f86\u8f14\u52a9\u8cc7\u6e90\u5206\u914d\uff0c\u78ba\u4fdd\u6548\u80fd\u8207\u7a69\u5b9a\u6027\u3002"]})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},97764:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/vertical-pod-autoscaler-626a52a17452b2771b2325dc0e22c1ab.svg"},72766:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/vertical-pod-autoscaler-7e714cd71e5156f7cf1fdccba66087da.svg"},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>t});var r=s(96540);const c={},l=r.createContext(c);function i(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);