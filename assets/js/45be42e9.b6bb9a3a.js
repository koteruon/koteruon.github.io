"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[7589],{25791:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>o});var r=s(74848),i=s(28453);const l={},d="Security - RBAC Authorization",c={id:"notes/kubernetes-basics/security-rbac-authorization",title:"Security - RBAC Authorization",description:"Kubernetes \u7684\u8a8d\u8b49\u3001\u6388\u6b0a\u8207\u51c6\u5165\u63a7\u5236",source:"@site/docs/notes/kubernetes-basics/30-security-rbac-authorization.mdx",sourceDirName:"notes/kubernetes-basics",slug:"/notes/kubernetes-basics/security-rbac-authorization",permalink:"/docs/notes/kubernetes-basics/security-rbac-authorization",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:30,frontMatter:{},sidebar:"notesSidebar",previous:{title:"Security - User Management with Kubernetes Context",permalink:"/docs/notes/kubernetes-basics/security-user-management-with-kubernetes-context"},next:{title:"OWASP TOP10 2021",permalink:"/docs/notes/owasp-top10-2021"}},t={},o=[{value:"Kubernetes \u7684\u8a8d\u8b49\u3001\u6388\u6b0a\u8207\u51c6\u5165\u63a7\u5236",id:"kubernetes-\u7684\u8a8d\u8b49\u6388\u6b0a\u8207\u51c6\u5165\u63a7\u5236",level:2},{value:"\u8a8d\u8b49\uff08Authentication\uff09",id:"\u8a8d\u8b49authentication",level:2},{value:"1. \u666e\u901a\u4f7f\u7528\u8005\uff08User\uff09",id:"1-\u666e\u901a\u4f7f\u7528\u8005user",level:3},{value:"2. \u670d\u52d9\u5e33\u865f\uff08ServiceAccount\uff09",id:"2-\u670d\u52d9\u5e33\u865fserviceaccount",level:3},{value:"\u8eab\u4efd\u9a57\u8b49\u65b9\u5f0f",id:"\u8eab\u4efd\u9a57\u8b49\u65b9\u5f0f",level:3},{value:"\u6388\u6b0a\uff08Authorization\uff09",id:"\u6388\u6b0aauthorization",level:2},{value:"\u6388\u6b0a\u6a5f\u5236",id:"\u6388\u6b0a\u6a5f\u5236",level:3},{value:"\u67e5\u770b\u662f\u5426\u6709\u6b0a\u9650",id:"\u67e5\u770b\u662f\u5426\u6709\u6b0a\u9650",level:3},{value:"\u51c6\u5165\u63a7\u5236\uff08Admission Control\uff09",id:"\u51c6\u5165\u63a7\u5236admission-control",level:2},{value:"\u51c6\u5165\u63a7\u5236\u5668",id:"\u51c6\u5165\u63a7\u5236\u5668",level:3},{value:"<code>ValidatingWebhookConfiguration</code>",id:"validatingwebhookconfiguration",level:3},{value:"<code>MutatingWebhookConfiguration</code>",id:"mutatingwebhookconfiguration",level:3},{value:"\u4f7f\u7528 VM \u5b89\u88dd Kubernetes",id:"\u4f7f\u7528-vm-\u5b89\u88dd-kubernetes",level:2},{value:"\u5efa\u7acb\u4e00\u500b Ubuntu VM",id:"\u5efa\u7acb\u4e00\u500b-ubuntu-vm",level:3},{value:"\u8a2d\u5b9a SSH \u9023\u7dda",id:"\u8a2d\u5b9a-ssh-\u9023\u7dda",level:3},{value:"\u7981\u7528 SWAP\u3001\u8f09\u5165 kernel module",id:"\u7981\u7528-swap\u8f09\u5165-kernel-module",level:3},{value:"\u5b89\u88dd Containerd",id:"\u5b89\u88dd-containerd",level:3},{value:"\u5b89\u88dd Kubernetes \u5143\u4ef6 (Kubeadm\u3001kubelet\u3001kubectl)",id:"\u5b89\u88dd-kubernetes-\u5143\u4ef6-kubeadmkubeletkubectl",level:3},{value:"\u5b89\u88dd Kubernetes",id:"\u5b89\u88dd-kubernetes",level:3},{value:"\u5b89\u88dd Calico Network Add-on Plugin",id:"\u5b89\u88dd-calico-network-add-on-plugin",level:3},{value:"\u5be6\u4f5c\u4e00\u500b RBAC",id:"\u5be6\u4f5c\u4e00\u500b-rbac",level:2},{value:"\u5efa\u7acb\u4e00\u500b\u4ee5 X.509 \u6191\u8b49\u9a57\u8b49\u7684\u666e\u901a\u4f7f\u7528\u8005",id:"\u5efa\u7acb\u4e00\u500b\u4ee5-x509-\u6191\u8b49\u9a57\u8b49\u7684\u666e\u901a\u4f7f\u7528\u8005",level:3},{value:"\u4f7f\u7528 RBAC \u6388\u6b0a\u7d66\u666e\u901a\u4f7f\u7528\u8005",id:"\u4f7f\u7528-rbac-\u6388\u6b0a\u7d66\u666e\u901a\u4f7f\u7528\u8005",level:3},{value:"Kubernetes RBAC Example",id:"kubernetes-rbac-example",level:2},{value:"Role \u8207 ClusterRole",id:"role-\u8207-clusterrole",level:2},{value:"Role",id:"role",level:3},{value:"1. apiGroups",id:"1-apigroups",level:4},{value:"2. resources",id:"2-resources",level:4},{value:"3. verbs",id:"3-verbs",level:4},{value:"ClusterRole",id:"clusterrole",level:3},{value:"RoleBinding \u8207 ClusterRoleBinding",id:"rolebinding-\u8207-clusterrolebinding",level:2},{value:"RoleBinding",id:"rolebinding",level:3},{value:"1. User",id:"1-user",level:4},{value:"2. Service Account",id:"2-service-account",level:4},{value:"3. Group",id:"3-group",level:4},{value:"ClusterRoleBinding",id:"clusterrolebinding",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"security---rbac-authorization",children:"Security - RBAC Authorization"})}),"\n",(0,r.jsx)(n.h2,{id:"kubernetes-\u7684\u8a8d\u8b49\u6388\u6b0a\u8207\u51c6\u5165\u63a7\u5236",children:"Kubernetes \u7684\u8a8d\u8b49\u3001\u6388\u6b0a\u8207\u51c6\u5165\u63a7\u5236"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Triple-A",src:s(96300).A+"",width:"781",height:"161"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 Kubernetes \u4e2d\uff0c\u5b89\u5168\u6027\u6a5f\u5236\u7531 ",(0,r.jsx)(n.strong,{children:"\u8a8d\u8b49\uff08Authentication\uff09"}),"\u3001",(0,r.jsx)(n.strong,{children:"\u6388\u6b0a\uff08Authorization\uff09"})," \u548c ",(0,r.jsx)(n.strong,{children:"\u51c6\u5165\u63a7\u5236\uff08Admission Control\uff09"})," \u7d44\u6210\uff0c\u5171\u540c\u78ba\u4fdd\u53e2\u96c6\u7684\u5b89\u5168\u6027\u8207\u53ef\u63a7\u6027\u3002"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u8a8d\u8b49authentication",children:"\u8a8d\u8b49\uff08Authentication\uff09"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 Kubernetes \u4e2d\uff0c\u8a8d\u8b49\u662f\u4fdd\u969c\u7cfb\u7d71\u5b89\u5168\u7684\u7b2c\u4e00\u9053\u9632\u7dda\uff0c\u78ba\u4fdd\u53ea\u6709\u5408\u6cd5\u7684\u7528\u6236\u548c\u670d\u52d9\u80fd\u5920\u5b58\u53d6 API \u4f3a\u670d\u5668\u3002Kubernetes \u652f\u63f4\u591a\u7a2e\u8a8d\u8b49\u65b9\u5f0f\u4f86\u9a57\u8b49\u8eab\u4efd\uff0c\u5176\u4e2d\u6700\u5e38\u898b\u7684\u662f",(0,r.jsxs)(n.strong,{children:["\u666e\u901a\u4f7f\u7528\u8005\uff08User\uff09",(0,r.jsx)(n.strong,{children:"\u548c"}),"\u670d\u52d9\u5e33\u865f\uff08ServiceAccount\uff09"]}),"\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"1-\u666e\u901a\u4f7f\u7528\u8005user",children:"1. \u666e\u901a\u4f7f\u7528\u8005\uff08User\uff09"}),"\n",(0,r.jsx)(n.p,{children:"\u666e\u901a\u4f7f\u7528\u8005\u662f\u6307\u76f4\u63a5\u8207 Kubernetes API \u4f3a\u670d\u5668\u4ea4\u4e92\u7684\u7528\u6236\u6216\u61c9\u7528\u7a0b\u5f0f\u3002\u9019\u4e9b\u4f7f\u7528\u8005\u901a\u5e38\u6703\u4f7f\u7528 X.509 \u6191\u8b49\u3001Token \u6216 OpenID Connect\uff08OIDC\uff09\u7b49\u65b9\u5f0f\u9032\u884c\u8eab\u4efd\u8a8d\u8b49\u3002"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8eab\u4efd\u8a8d\u8b49\u65b9\u5f0f"}),"\uff1a\u666e\u901a\u4f7f\u7528\u8005\u53ef\u4f7f\u7528 X.509 \u5ba2\u6236\u7aef\u6191\u8b49\u6216 Token \u4f86\u9032\u884c\u8eab\u4efd\u9a57\u8b49\u3002\u4e5f\u53ef\u4ee5\u900f\u904e OIDC \u8207\u5916\u90e8\u8eab\u4efd\u63d0\u4f9b\u8005\uff08\u5982 Google\u3001Azure AD\uff09\u9032\u884c\u6574\u5408\uff0c\u5be6\u73fe\u55ae\u4e00\u767b\u5165\uff08SSO\uff09\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u7528\u9014"}),"\uff1a\u666e\u901a\u4f7f\u7528\u8005\u4e00\u822c\u662f\u7ba1\u7406 Kubernetes \u53e2\u96c6\u7684\u64cd\u4f5c\u4eba\u54e1\u6216\u958b\u767c\u8005\uff0c\u4ed6\u5011\u6703\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"kubectl"})," \u7b49\u5de5\u5177\u4f86\u90e8\u7f72\u61c9\u7528\u3001\u7ba1\u7406\u8cc7\u6e90\u3001\u57f7\u884c\u65e5\u5e38\u64cd\u4f5c\u7b49\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6388\u6b0a\u6a5f\u5236"}),"\uff1a\u666e\u901a\u4f7f\u7528\u8005\u7684\u6b0a\u9650\u901a\u5e38\u900f\u904e\u89d2\u8272\u57fa\u65bc\u5b58\u53d6\u63a7\u5236\uff08RBAC\uff09\u4f86\u7ba1\u7406\u3002\u7ba1\u7406\u54e1\u53ef\u6839\u64da\u4f7f\u7528\u8005\u7684\u89d2\u8272\u4f86\u8a2d\u5b9a\u5176\u5c0d\u4e0d\u540c\u8cc7\u6e90\u7684\u8a2a\u554f\u6b0a\u9650\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7bc4\u4f8b"}),"\uff1a\n\u5047\u8a2d\u6709\u4e00\u540d\u958b\u767c\u8005\u900f\u904e X.509 \u6191\u8b49\u767b\u9304 Kubernetes\uff0c\u9019\u4f4d\u958b\u767c\u8005\u4fbf\u53ef\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"kubectl"})," \u6307\u4ee4\u57f7\u884c\u5404\u7a2e\u64cd\u4f5c\uff0c\u4f46\u6b0a\u9650\u6703\u53d7\u5230 RBAC \u914d\u7f6e\u7684\u9650\u5236\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"2-\u670d\u52d9\u5e33\u865fserviceaccount",children:"2. \u670d\u52d9\u5e33\u865f\uff08ServiceAccount\uff09"}),"\n",(0,r.jsxs)(n.p,{children:["\u670d\u52d9\u5e33\u865f\u662f Kubernetes \u7528\u4f86\u70ba Pod \u63d0\u4f9b\u8eab\u4efd\u8a8d\u8b49\u7684\u6a5f\u5236\uff0c\u4f7f\u5f97 Pod \u80fd\u5920\u5b89\u5168\u5730\u8207 Kubernetes API \u4e92\u52d5\u3002\u6bcf\u500b\u547d\u540d\u7a7a\u9593\u5728\u5efa\u7acb\u6642\u6703\u81ea\u52d5\u5275\u5efa\u4e00\u500b\u540d\u70ba ",(0,r.jsx)(n.code,{children:"default"})," \u7684\u670d\u52d9\u5e33\u865f\uff0c\u4e26\u70ba\u8a72\u547d\u540d\u7a7a\u9593\u5167\u7684 Pod \u63d0\u4f9b\u4e00\u500b Token\uff0c\u7528\u65bc\u8eab\u4efd\u9a57\u8b49\u3002"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8eab\u4efd\u8a8d\u8b49"}),"\uff1a\u670d\u52d9\u5e33\u865f\u6703\u81ea\u52d5\u8207\u4e00\u7d44\u6191\u8b49\uff08\u5982 JSON Web Token\uff09\u95dc\u806f\uff0c\u9019\u4e9b\u6191\u8b49\u88ab Pod \u4f7f\u7528\u4f86\u8207 API \u4f3a\u670d\u5668\u9032\u884c\u4ea4\u4e92\uff0c\u7121\u9700\u624b\u52d5\u914d\u7f6e\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4f5c\u7528\u7bc4\u570d"}),"\uff1a\u670d\u52d9\u5e33\u865f\u7684\u4f5c\u7528\u7bc4\u570d\u662f\u57fa\u65bc\u547d\u540d\u7a7a\u9593\u3002\u6bcf\u500b\u547d\u540d\u7a7a\u9593\u6703\u81ea\u52d5\u5275\u5efa ",(0,r.jsx)(n.code,{children:"default"})," \u670d\u52d9\u5e33\u865f\uff0c\u4e26\u5c07\u5c0d\u61c9\u7684 Token \u63d0\u4f9b\u7d66\u8a72\u547d\u540d\u7a7a\u9593\u4e2d\u7684 Pod \u4f7f\u7528\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u7528\u9014"}),"\uff1a\u670d\u52d9\u5e33\u865f\u4e3b\u8981\u7528\u65bc Pod \u5167\u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u7576\u61c9\u7528\u7a0b\u5f0f\u9700\u8981\u5b58\u53d6 Kubernetes API\uff08\u4f8b\u5982\u8b80\u53d6 ConfigMap \u6216\u5275\u5efa\u8cc7\u6e90\uff09\u6642\uff0c\u6703\u4f7f\u7528\u670d\u52d9\u5e33\u865f\u4f86\u9032\u884c\u8eab\u4efd\u9a57\u8b49\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6388\u6b0a\u6a5f\u5236"}),"\uff1a\u670d\u52d9\u5e33\u865f\u7684\u6b0a\u9650\u900f\u904e\u89d2\u8272\uff08Role\uff09\u548c\u89d2\u8272\u7d81\u5b9a\uff08RoleBinding\uff09\u9032\u884c\u63a7\u5236\u3002\u6bcf\u500b\u670d\u52d9\u5e33\u865f\u53ef\u4ee5\u88ab\u8ce6\u4e88\u4e0d\u540c\u7684\u89d2\u8272\uff0c\u9650\u5236\u5176\u53ef\u64cd\u4f5c\u7684\u8cc7\u6e90\u7bc4\u570d\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7bc4\u4f8b"}),"\uff1a\n\u7576 Pod \u9700\u8981\u5f9e Kubernetes API \u7372\u53d6\u4e00\u500b ConfigMap \u6642\uff0c\u5b83\u6703\u81ea\u52d5\u4f7f\u7528\u8a72\u547d\u540d\u7a7a\u9593\u7684 ",(0,r.jsx)(n.code,{children:"default"})," \u670d\u52d9\u5e33\u865f\u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u4e26\u6839\u64da\u6240\u914d\u7f6e\u7684\u89d2\u8272\u548c\u89d2\u8272\u7d81\u5b9a\u6388\u4e88\u76f8\u61c9\u7684\u6b0a\u9650\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"\u8eab\u4efd\u9a57\u8b49\u65b9\u5f0f",children:"\u8eab\u4efd\u9a57\u8b49\u65b9\u5f0f"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"X.509 \u5ba2\u6236\u7aef\u6191\u8b49"}),"\uff1a\u9019\u662f\u6700\u5e38\u898b\u7684\u65b9\u6cd5\uff0c\u7cfb\u7d71\u7ba1\u7406\u54e1\u53ef\u4ee5\u4f7f\u7528 CA \u7c3d\u7f72\u7684\u6191\u8b49\u4f86\u9a57\u8b49\u7528\u6236\u8eab\u4efd\u3002\u6bcf\u500b\u7528\u6236\u6703\u6709\u7368\u7acb\u7684\u6191\u8b49\u8207\u79c1\u9470\uff0c\u4e26\u900f\u904e ",(0,r.jsx)(n.code,{children:"kubectl"})," \u8a2d\u5b9a\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u975c\u614b Token \u6587\u4ef6"}),"\uff1aKubernetes \u5141\u8a31\u900f\u904e Token \u6587\u4ef6\u4f86\u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u9069\u7528\u65bc\u7c21\u55ae\u7684\u6e2c\u8a66\u74b0\u5883\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"OpenID Connect\uff08OIDC\uff09"}),"\uff1a\u652f\u63f4\u8207\u5916\u90e8\u8eab\u4efd\u63d0\u4f9b\u8005\uff08\u5982 Google\u3001Azure AD\u3001Keycloak\uff09\u6574\u5408\uff0c\u9069\u7528\u65bc\u4f01\u696d\u7d1a SSO\uff08\u55ae\u4e00\u767b\u5165\uff09\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Webhook \u8eab\u4efd\u9a57\u8b49"}),"\uff1aAPI \u4f3a\u670d\u5668\u53ef\u900f\u904e Webhook \u65b9\u5f0f\uff0c\u5c07\u8eab\u4efd\u9a57\u8b49\u8acb\u6c42\u8f49\u767c\u81f3\u5916\u90e8\u7684\u8a8d\u8b49\u670d\u52d9\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u670d\u52d9\u5e33\u6236\uff08ServiceAccount\uff09"}),"\uff1a\u5c08\u70ba Pod \u5167\u7684\u61c9\u7528\u7a0b\u5f0f\u63d0\u4f9b\u7684\u8eab\u4efd\u9a57\u8b49\u6a5f\u5236\uff0c\u4f7f\u5176\u80fd\u5920\u5b58\u53d6 Kubernetes API\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u6388\u6b0aauthorization",children:"\u6388\u6b0a\uff08Authorization\uff09"}),"\n",(0,r.jsx)(n.p,{children:"\u8eab\u4efd\u9a57\u8b49\u901a\u904e\u5f8c\uff0c\u50c5\u80fd\u4ee3\u8868\u7576\u524d\u7684\u4f7f\u7528\u8005\u5141\u8a31\u8207 Kubernetes API Server \u6e9d\u901a\uff0c\u4f46\u8a72\u4f7f\u7528\u8005\u662f\u5426\u6709\u6b0a\u9650\u8acb\u6c42\u4ec0\u9ebc\u8cc7\u6e90\uff0c\u5c31\u662f\u7531\u6388\u6b0a\u6c7a\u5b9a\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u6388\u6b0a\u6a5f\u5236",children:"\u6388\u6b0a\u6a5f\u5236"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"RBAC\uff08Role-Based Access Control\uff0c\u57fa\u65bc\u89d2\u8272\u7684\u5b58\u53d6\u63a7\u5236\uff09"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u900f\u904e ",(0,r.jsx)(n.strong,{children:"Role"}),"\uff08\u89d2\u8272\uff09\u548c ",(0,r.jsx)(n.strong,{children:"RoleBinding"}),"\uff08\u89d2\u8272\u7d81\u5b9a\uff09\u4f86\u7ba1\u7406\u6b0a\u9650\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ClusterRole"})," \u8207 ",(0,r.jsx)(n.strong,{children:"ClusterRoleBinding"})," \u9069\u7528\u65bc\u5168\u57df\u7bc4\u570d\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Role"})," \u8207 ",(0,r.jsx)(n.strong,{children:"RoleBinding"})," \u9650\u5236\u5728\u7279\u5b9a\u547d\u540d\u7a7a\u9593\u5167\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ABAC\uff08Attribute-Based Access Control\uff0c\u57fa\u65bc\u5c6c\u6027\u7684\u5b58\u53d6\u63a7\u5236\uff09"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u63a1\u7528\u7b56\u7565\u6587\u4ef6\u4f86\u5b9a\u7fa9\u5b58\u53d6\u898f\u5247\u3002"}),"\n",(0,r.jsxs)(n.li,{children:["\u9700\u8981\u555f\u7528 ",(0,r.jsx)(n.code,{children:"--authorization-policy-file"})," \u53c3\u6578\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Webhook \u6388\u6b0a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u900f\u904e Webhook \u5c07\u6388\u6b0a\u6c7a\u7b56\u59d4\u6d3e\u7d66\u5916\u90e8\u7cfb\u7d71\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Node \u6388\u6b0a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7528\u65bc\u63a7\u5236\u7bc0\u9ede\uff08Node\uff09\u5c64\u7d1a\u7684\u8a2a\u554f\u6b0a\u9650\uff0c\u78ba\u4fdd\u7bc0\u9ede\u53ea\u80fd\u57f7\u884c\u6388\u6b0a\u7684\u64cd\u4f5c\u3002"}),"\n",(0,r.jsxs)(n.li,{children:["\u4e3b\u8981\u4f9d\u8cf4\u65bc ",(0,r.jsx)(n.strong,{children:"NodeRestriction"}),"\uff0c\u78ba\u4fdd\u53ea\u5141\u8a31\u7bc0\u9ede\u672c\u8eab\u5c0d\u7279\u5b9a\u8cc7\u6e90\uff08\u4f8b\u5982\uff0cPod\uff09\u9032\u884c\u64cd\u4f5c\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u67e5\u770b\u662f\u5426\u6709\u6b0a\u9650",children:"\u67e5\u770b\u662f\u5426\u6709\u6b0a\u9650"}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u5011\u53ef\u4ee5\u901a\u904e",(0,r.jsx)(n.code,{children:"auth can-i"}),"\u6307\u4ee4\uff0c\u4f86\u5feb\u901f\u67e5\u770b API \u662f\u5426\u6709\u6b0a\u9650\u57f7\u884c\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl.exe auth can-i create deployments --namespace default\n---\n\nyes\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u51c6\u5165\u63a7\u5236admission-control",children:"\u51c6\u5165\u63a7\u5236\uff08Admission Control\uff09"}),"\n",(0,r.jsx)(n.p,{children:"\u51c6\u5165\u63a7\u5236\uff08Admission Control\uff09\u662f\u5728\u8eab\u4efd\u9a57\u8b49\u8207\u6388\u6b0a\u5f8c\u7684\u984d\u5916\u5b89\u5168\u6a5f\u5236\uff0c\u80fd\u5920\u6514\u622a\u3001\u4fee\u6539\u6216\u62d2\u7d55 API \u8acb\u6c42\uff0c\u78ba\u4fdd\u53e2\u96c6\u7684\u904b\u884c\u7b26\u5408\u5b89\u5168\u7b56\u7565\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u51c6\u5165\u63a7\u5236\u5668",children:"\u51c6\u5165\u63a7\u5236\u5668"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"NamespaceLifecycle"}),"\uff1a\u9650\u5236\u8acb\u6c42\u50c5\u80fd\u4f5c\u7528\u65bc\u73fe\u6709\u7684\u547d\u540d\u7a7a\u9593\uff0c\u907f\u514d\u4f7f\u7528\u672a\u7d93\u6388\u6b0a\u7684\u547d\u540d\u7a7a\u9593\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"LimitRanger"}),"\uff1a\u78ba\u4fdd Pod\u3001Container\u3001PersistentVolumeClaim \u7b49\u8cc7\u6e90\u4e0d\u8d85\u51fa\u8a2d\u5b9a\u7684\u9650\u5236\u7bc4\u570d\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ResourceQuota"}),"\uff1a\u9650\u5236\u547d\u540d\u7a7a\u9593\u5167\u53ef\u7528\u7684\u8cc7\u6e90\u6578\u91cf\uff0c\u4f8b\u5982 CPU\u3001\u8a18\u61b6\u9ad4\u8207\u5132\u5b58\u7a7a\u9593\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PodSecurityAdmission"}),"\uff08\u53d6\u4ee3\u820a\u7248 PSP\uff09\uff1a\u6839\u64da Pod Security Standards\uff08PSS\uff09\u898f\u5247\u4f86\u9650\u5236 Pod \u4f48\u7f72\u7684\u5b89\u5168\u6027\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ValidatingAdmissionWebhook & MutatingAdmissionWebhook"}),"\uff1a\u5141\u8a31\u900f\u904e Webhook \u4f86\u9a57\u8b49\u8207\u4fee\u6539\u8acb\u6c42\uff0c\u4f8b\u5982\u5f37\u5236\u57f7\u884c\u516c\u53f8\u5b89\u5168\u7b56\u7565\u6216\u81ea\u52d5\u88dc\u5145\u9810\u8a2d\u8a2d\u5b9a\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"validatingwebhookconfiguration",children:(0,r.jsx)(n.code,{children:"ValidatingWebhookConfiguration"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7528\u9014"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u7528\u65bc",(0,r.jsx)(n.strong,{children:"\u9a57\u8b49"})," API \u8acb\u6c42\uff0c\u78ba\u4fdd\u8acb\u6c42\u7684\u5167\u5bb9\u7b26\u5408\u6307\u5b9a\u7684\u5b89\u5168\u898f\u7bc4\u6216\u914d\u7f6e\u8981\u6c42\u3002"]}),"\n",(0,r.jsx)(n.li,{children:"\u9019\u4e9b Webhook \u53ef\u4ee5\u6514\u622a\u4e26\u62d2\u7d55\u4e0d\u7b26\u5408\u689d\u4ef6\u7684 API \u8acb\u6c42\uff0c\u78ba\u4fdd\u53e2\u96c6\u4e2d\u7684\u8cc7\u6e90\u7b26\u5408\u9810\u671f\u7684\u6a19\u6e96\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u4f5c\u7528"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u6703\u5728 ",(0,r.jsx)(n.strong,{children:"API \u8acb\u6c42"})," \u9032\u5165 Kubernetes API Server \u4e4b\u524d\u9032\u884c\u9a57\u8b49\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c\u8acb\u6c42\u672a\u901a\u904e\u9a57\u8b49\uff0c\u6703 ",(0,r.jsx)(n.strong,{children:"\u62d2\u7d55\u8a72\u8acb\u6c42"}),"\uff0c\u4e26\u8fd4\u56de\u932f\u8aa4\u8a0a\u606f\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7bc4\u4f8b"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u9a57\u8b49\u662f\u5426\u90e8\u7f72\u7684 Pod \u7b26\u5408 ",(0,r.jsx)(n.strong,{children:"\u5b89\u5168\u6027\u898f\u7bc4"}),"\uff0c\u4f8b\u5982\u78ba\u4fdd\u5bb9\u5668\u93e1\u50cf\u4f86\u81ea\u53d7\u4fe1\u4efb\u7684\u4f86\u6e90\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5f37\u5236\u898f\u5b9a ",(0,r.jsx)(n.strong,{children:"Pod \u5fc5\u9808\u5305\u542b\u7279\u5b9a\u6a19\u7c64"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u6307\u4ee4"}),"\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl.exe get validatingwebhookconfigurations\n---\n\nNAME                      WEBHOOKS   AGE\ningress-nginx-admission   1          15d\nkeda-admission            3          14h\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"mutatingwebhookconfiguration",children:(0,r.jsx)(n.code,{children:"MutatingWebhookConfiguration"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7528\u9014"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u7528\u65bc",(0,r.jsx)(n.strong,{children:"\u4fee\u6539"})," API \u8acb\u6c42\u7684\u5167\u5bb9\u3002\u7576\u8acb\u6c42\u9032\u5165 Kubernetes API Server \u4e4b\u524d\uff0cWebhook \u6703\u81ea\u52d5\u4fee\u6539\u6216\u589e\u52a0\u8cc7\u6e90\u7684\u67d0\u4e9b\u5c6c\u6027\u3002"]}),"\n",(0,r.jsx)(n.li,{children:"\u9019\u7a2e\u65b9\u5f0f\u53ef\u7528\u65bc\u81ea\u52d5\u88dc\u5145\u6216\u8abf\u6574\u8acb\u6c42\u4e2d\u7684\u8cc7\u6e90\u914d\u7f6e\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u4f5c\u7528"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6703\u5728 API \u8acb\u6c42\u9032\u5165 Kubernetes API Server \u4e4b\u524d\u9032\u884c\u4fee\u6539\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u80fd\u5920\u81ea\u52d5\u5c07\u67d0\u4e9b\u9810\u8a2d\u914d\u7f6e\u6dfb\u52a0\u5230 Pod \u6216\u5176\u4ed6\u8cc7\u6e90\u4e2d\uff0c\u5f9e\u800c\u6e1b\u5c11\u4eba\u5de5\u5e72\u9810\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7bc4\u4f8b"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u81ea\u52d5\u70ba ",(0,r.jsx)(n.strong,{children:"Pod \u52a0\u4e0a\u9810\u8a2d\u6a19\u7c64"})," \u6216 ",(0,r.jsx)(n.strong,{children:"\u9810\u8a2d\u7684\u8cc7\u6e90\u9650\u5236"}),"\uff08\u5982 CPU\u3001\u8a18\u61b6\u9ad4\uff09\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u6ce8\u5165 ",(0,r.jsx)(n.strong,{children:"Sidecar \u5bb9\u5668"}),"\uff08\u4f8b\u5982\uff0cIstio \u6216\u76e3\u63a7\u4ee3\u7406\uff09\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u6307\u4ee4"}),"\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl.exe get mutatingwebhookconfigurations\n---\n\nNAME                 WEBHOOKS   AGE\nvpa-webhook-config   1          14h\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u4f7f\u7528-vm-\u5b89\u88dd-kubernetes",children:"\u4f7f\u7528 VM \u5b89\u88dd Kubernetes"}),"\n",(0,r.jsx)(n.p,{children:"\u56e0\u70ba docker-desktop \u6c92\u6709\u8fa6\u6cd5\u53d6\u5f97\u5167\u90e8\u7684 ca \u6191\u8b49\uff0c\u56e0\u6b64\u4ee5\u4e0b\u6703\u5229\u7528 VM \u5f9e\u982d\u5b89\u88dd\u4e00\u6b21 kubernetes cluster\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u5efa\u7acb\u4e00\u500b-ubuntu-vm",children:"\u5efa\u7acb\u4e00\u500b Ubuntu VM"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u9996\u5148\u6211\u5011\u4f7f\u7528 Oracle VM VirtualBox \u4f86\u5b89\u88dd\u6211\u5011\u7684 ubuntu\uff0c\u5275\u7acb\u4e00\u500b VM\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"create-vm-iso",src:s(36647).A+"",width:"693",height:"378"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u63a5\u4e0b\u4f86\u8a2d\u5b9a\u5e33\u865f\u548c\u5bc6\u78bc\uff0c\u7b49\u4e00\u4e0b\u5b89\u88dd\u597d\u767b\u5165\u8981\u7528\u5230\uff0c\u4e0d\u80fd\u5fd8\u8a18\u5466~"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"create-vm-username-password",src:s(27578).A+"",width:"693",height:"378"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"\u8a18\u61b6\u9ad4\u548c CPU \u53ef\u4ee5\u591a\u7d66\u4e00\u9ede\uff0c\u4f46\u4e0d\u8981\u7d66\u5230\u6574\u53f0\u96fb\u8166\u7684\u91cf\uff0c\u907f\u514d\u539f\u672c\u7684\u96fb\u8166\u7576\u6a5f\uff0c\u5f8c\u7e8c\u53ef\u4ee5\u518d\u8abf\u6574\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"create-vm-memory-cpu",src:s(85026).A+"",width:"693",height:"378"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:"\u786c\u789f\u5927\u5c0f\u53ef\u4ee5\u7d66\u5927\uff0c\u56e0\u70ba\u8a2d\u5b9a\u4e4b\u5f8c\u5c31\u4e0d\u80fd\u8abf\u6574\u4e86\uff0c\u800c\u4e14\u4ed6\u4e0d\u6703\u4e00\u6b21\u5c31\u8981\u6eff\u5168\u90e8\u7684\u91cf\uff0c\u7528\u591a\u5c11\u4f54\u591a\u5c11\uff0c\u6240\u4ee5\u53ef\u4ee5\u591a\u4e00\u9ede\uff0c\u907f\u514d\u672a\u4f86\u60f3\u8981\u7684\u6642\u5019\u53cd\u800c\u8abf\u4e0d\u52d5\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"create-vm-disk",src:s(17521).A+"",width:"693",height:"378"})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsx)(n.li,{children:"\u6309\u4e0b\u5b8c\u6210\u5c31\u5efa\u7acb\u597d\u4e86\uff0c\u5b83\u6703\u81ea\u52d5\u57f7\u884c\uff0c\u9032\u884c\u5b89\u88dd\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"create-vm-overview",src:s(81051).A+"",width:"693",height:"378"})}),"\n",(0,r.jsxs)(n.ol,{start:"6",children:["\n",(0,r.jsx)(n.li,{children:"\u5b8c\u6210\u5b89\u88dd\u4e4b\u5f8c\uff0c\u5c31\u6703\u9032\u5230\u767b\u5165\u756b\u9762\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"ubuntu-login",src:s(48916).A+"",width:"1280",height:"800"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"\u8a2d\u5b9a-ssh-\u9023\u7dda",children:"\u8a2d\u5b9a SSH \u9023\u7dda"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\u63a5\u4e0b\u4f86\u6211\u4e0d\u60f3\u8981\u76f4\u63a5\u64cd\u4f5c VM \u7684 UI\uff0c\u9996\u5148\u6309\u4e0b",(0,r.jsx)(n.code,{children:"ctrl"}),"+",(0,r.jsx)(n.code,{children:"alt"}),"+",(0,r.jsx)(n.code,{children:"F3"}),"\uff0c\u767b\u5165 root\uff0c\u5bc6\u78bc\u662f\u525b\u525b\u8a2d\u5b9a\u7684\u5bc6\u78bc\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"ubuntu-terminal-login",src:s(63015).A+"",width:"1280",height:"800"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u63a5\u8457\u5c07\u6211\u5011\u525b\u525b\u5275\u7acb\u7684\u5e33\u865f\u589e\u52a0 sudoer \u7684\u6b0a\u9650\uff0cexit \u4e4b\u5f8c\u5c31\u53ef\u4ee5\u7528\u81ea\u5df1\u7684\u5e33\u865f\u518d\u767b\u5165\u4e86\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo usermod -aG sudo <username>\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"\u5148\u9032\u884c\u7cfb\u7d71\u7684\u66f4\u65b0\u8207\u5b89\u88dd\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo apt-get update && sudo apt-get upgrade -y\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"\u5b89\u88dd openssh-server\uff0c\u53e6\u5916\u9700\u8981\u5b89\u88dd net-tools \u548c vim\uff0c\u7b49\u4e00\u4e0b\u8981\u4f86\u67e5\u770b IP \u4f4d\u7f6e\uff0c\u5b89\u88dd\u597d\u5f8c\u5c07 ubuntu \u95dc\u6a5f\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo apt-get install openssh-server -y\nsudo apt-get install net-tools -y\nsudo apt-get install vim -y\nsudo shutdown -h 0\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsxs)(n.li,{children:["\u4e4b\u5f8c\uff0c\u8981\u8a2d\u5b9a\u7db2\u8def\u8b93\u672c\u6a5f\u53ef\u4ee5\u9023\u5230\u865b\u64ec\u6a5f\uff0c\u865b\u64ec\u6a5f\u4e5f\u80fd\u9023\u5230\u5916\u7db2\uff0c\u56e0\u6b64\u9ede\u9078\u5de6\u4e0a\u89d2\u7684\u5de5\u5177\uff0c\u5728",(0,r.jsx)(n.code,{children:"\u50c5\u9650\u4e3b\u6a5f"}),"\u9700\u8981\u5275\u7acb\u4e00\u500b\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"create-vm-network-host-only-adapter",src:s(2378).A+"",width:"786",height:"478"})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsxs)(n.li,{children:["\u63a5\u8457\u5c07 VM \u8a2d\u5b9a\u88e1\u9762\u7684\u7db2\u8def\u4ecb\u9762\u5361\u6dfb\u52a0",(0,r.jsx)(n.code,{children:"\u50c5\u9650\u4e3b\u6a5f"}),"\u9019\u500b\u4ecb\u9762\u5361\u5230\u4ecb\u9762 2\uff0c\u6df7\u548c\u6a21\u5f0f\u8a18\u5f97\u8981\u9078\u64c7\u5141\u8a31 VM\uff0c\u78ba\u5b9a\u5f8c\u5c31\u53ef\u958b\u6a5f\u4e86\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"setting-vm-network-host-only-adapter",src:s(6282).A+"",width:"801",height:"478"})}),"\n",(0,r.jsxs)(n.ol,{start:"6",children:["\n",(0,r.jsx)(n.li,{children:"\u63a5\u8457\u6211\u5011\u767b\u5165 ubuntu \u4e4b\u5f8c\uff0c\u53bb\u4fee\u6539 netplan \u7684 yaml \u6a94\u6848\uff0c\u4e26\u57f7\u884c\u4ed6\uff0c\u5c31\u6703\u770b\u5230\u53ef\u4ee5\u53d6\u5f97 IP \u4e86\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo vim /etc/netplan/01-network-manager-all.yaml\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"network:\n  version: 2\n  ethernets:\n    enp0s3:\n      dhcp4: true\n    enp0s8:\n      dhcp4: false\n      addresses:\n        - 192.168.182.2/24 # \u6211\u5011\u525b\u525b\u5efa\u7acb\u7684Host-Only Adapter\u662f192.168.182.1/24\uff0c\u6240\u4ee5\u9078\u64c7192.168.182.2~255\u90fd\u53ef\u4ee5\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo netplan apply\nifconfig\n---\n\nenp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 10.0.2.15  netmask 255.255.255.0  broadcast 10.0.2.255\n\nenp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 192.168.182.2  netmask 255.255.255.0  broadcast 192.168.182.255\n\nlo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536\n        inet 127.0.0.1  netmask 255.0.0.0\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"7",children:["\n",(0,r.jsx)(n.li,{children:"\u63a5\u8457\u6211\u5011\u5c07 VM \u7e2e\u5c0f\uff0c\u7528\u672c\u6a5f\u7684 terminal \u9023\u7dda\u5230 192.168 \u4e0a\u9762\u7684\u90a3\u500b IP\uff0c\u5c31\u53ef\u4ee5\u6210\u529f\u767b\u5165\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh calvin@192.168.182.2\n---\n\ncalvin@k8s-cluster:~$\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u7981\u7528-swap\u8f09\u5165-kernel-module",children:"\u7981\u7528 SWAP\u3001\u8f09\u5165 kernel module"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u9996\u5148\u6211\u5011\u900f\u904e\u4e0a\u9762\u7684 SSH \u9023\u5230 VM \u88e1\u9762\uff0c\u63a5\u8457\u6211\u5011\u8981\u5c0d Ubuntu \u7981\u7528 Swap\uff0c\u9019\u6a23 Kubernetes \u624d\u80fd\u6b63\u5e38\u904b\u4f5c\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo swapoff -a\nsudo sed -i '/ swap / s/^\\(.*\\)$/#\\1/g' /etc/fstab\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u63a5\u4e0b\u4f86\u555f\u52d5 Kuberntes \u9700\u8981\u7684 Linux kernel module\uff0c\u4e26\u5beb\u5230\u8a2d\u5b9a\u6a94\u4e4b\u4e2d\uff0c\u6bcf\u6b21\u90fd\u6703\u555f\u7528\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo modprobe overlay\nsudo modprobe br_netfilter\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo tee /etc/modules-load.d/k8s.conf <<EOF\noverlay\nbr_netfilter\nEOF\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"\u8a2d\u5b9a IP \u8f49\u767c\u7684\u53c3\u6578\u4f9b kernel \u4f7f\u7528\uff0c\u4e00\u6a23\u4e5f\u662f\u8981\u5beb\u5230\u8a2d\u5b9a\u6a94\u4e4b\u4e2d\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo tee /etc/sysctl.d/kubernetes.conf <<EOT\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1\nEOT\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:"\u900f\u904e\u6307\u4ee4\u8f09\u5165\u9019\u4e9b\u53c3\u6578\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo sysctl --system\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5b89\u88dd-containerd",children:"\u5b89\u88dd Containerd"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Containerd \u662f kubernetes \u63d0\u4f9b\u5bb9\u5668\u904b\u884c\uff0c\u9996\u5148\u6211\u5011\u5b89\u88dd\u53d6\u5f97 Containerd \u5957\u4ef6\u7684\u5de5\u5177\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo apt install -y curl gnupg2 software-properties-common apt-transport-https ca-certificates\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u589e\u52a0 Containerd \u7684 repo\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmour -o /etc/apt/trusted.gpg.d/containerd.gpg\nsudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"\u66f4\u65b0 repo \u4ee5\u53ca\u5b89\u88dd Containerd\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo apt update && sudo apt install containerd.io -y\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:"\u8a2d\u5b9a Containerd \u7684 Config\uff0c\u4e26\u4f7f\u7528 SystemdCgroup \u4f86\u57f7\u884c\u547d\u4ee4\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"containerd config default | sudo tee /etc/containerd/config.toml >/dev/null 2>&1\nsudo sed -i 's/SystemdCgroup \\= false/SystemdCgroup \\= true/g' /etc/containerd/config.toml\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsx)(n.li,{children:"\u91cd\u555f Containerd \u7684\u670d\u52d9\uff0c\u8b93\u4e0a\u9762\u7684\u66f4\u6539\u751f\u6548\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart containerd\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5b89\u88dd-kubernetes-\u5143\u4ef6-kubeadmkubeletkubectl",children:"\u5b89\u88dd Kubernetes \u5143\u4ef6 (Kubeadm\u3001kubelet\u3001kubectl)"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u56e0\u70ba Ubuntu 24.04 \u9810\u8a2d\u7684 repo \u4e0d\u80fd\u4f7f\u7528\uff0c\u6211\u5011\u9996\u5148\u8981\u5148\u6dfb\u52a0 repo\uff0c\u4ee5\u4e0b\u4ee5 kubernetes 1.30 \u70ba\u7bc4\u4f8b\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.30/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/k8s.gpg\necho 'deb [signed-by=/etc/apt/keyrings/k8s.gpg] https://pkgs.k8s.io/core:/stable:/v1.30/deb/ /' | sudo tee /etc/apt/sources.list.d/k8s.list\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u66f4\u65b0\u5957\u4ef6\u5f8c\uff0c\u6211\u5011\u5c31\u53ef\u4ee5\u4f86\u5b89\u88dd kubernetes \u7684\u4e09\u5143\u4ef6\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo apt update\nsudo apt install kubelet kubeadm kubectl -y\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5b89\u88dd-kubernetes",children:"\u5b89\u88dd Kubernetes"}),"\n",(0,r.jsxs)(n.p,{children:["\uff11. \u4e0a\u9762\u6240\u6709\u7684\u5143\u4ef6\u90fd\u5b89\u88dd\u597d\u5f8c\uff0c\u6211\u5011\u5c31\u53ef\u4ee5\u958b\u59cb\u5b89\u88dd Kuberentes\uff0c\u6211\u5011\u5728 master \u7684\u7bc0\u9ede\u4e0a\u57f7\u884c",(0,r.jsx)(n.code,{children:"kubeadm"}),"\u6307\u4ee4\uff0c\u7528\u4f86\u521d\u59cb\u5316 Kubernetes \u96c6\u7fa4\uff0ccontrol-plane-endpoint \u5c31\u662f\u6211\u5011\u4e4b\u524d\u5275\u7acb VM \u7684\u540d\u5b57\uff0c\u4ed6\u6703\u8a18\u9304\u5728/etc/hosts\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo kubeadm init --pod-network-cidr=192.168.0.0/16 --control-plane-endpoint=k8s-cluster\n---\n\nYour Kubernetes control-plane has initialized successfully!\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u5b89\u88dd\u6210\u529f\u4e4b\u5f8c\uff0c\u6211\u5011\u7167\u8457\u4ed6\u7684\u6307\u793a\uff0c\u5c07\u8a2d\u5b9a\u6a94\u653e\u5230\u81ea\u5df1\u7684\u5bb6\u76ee\u9304\u5e95\u4e0b\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"\u5982\u679c\u6709\u5176\u4ed6 makter \u6216 worker \u53ef\u4ee5\u900f\u904e\u4e0a\u9762\u7d66\u7684\u6307\u4ee4\u4f86\u589e\u52a0 node(\u6211\u5011\u9019\u908a\u6c92\u6709)\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubeadm join k8s-cluster:6443 --token lzqq9n.7jvhkyj5qugtvm9l \\\n        --discovery-token-ca-cert-hash sha256:bf6a379f7cb0ce846a90cfe9a3a1b6661ed68f93cded0a4ff5ab315b88ffc54f \\\n        --control-plane\n---\nkubeadm join k8s-cluster:6443 --token lzqq9n.7jvhkyj5qugtvm9l \\\n        --discovery-token-ca-cert-hash sha256:bf6a379f7cb0ce846a90cfe9a3a1b6661ed68f93cded0a4ff5ab315b88ffc54f\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5b89\u88dd-calico-network-add-on-plugin",children:"\u5b89\u88dd Calico Network Add-on Plugin"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u56e0\u70ba\u6211\u5011\u5728\u865b\u64ec\u6a5f\u4e0a\u5b89\u88dd\uff0c\u56e0\u6b64\u6211\u9078\u64c7 Manifest based \u7684\u65b9\u6cd5\u4f86\u5b89\u88dd Calico\uff0c\u9996\u5148\u5148\u628a\u8a2d\u5b9a\u6a94\u4e0b\u8f09\u4e0b\u4f86\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"wget https://docs.projectcalico.org/manifests/calico.yaml\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u7528\u7de8\u8f2f\u5668\u6253\u958b\u6587\u4ef6\uff0c\u4e26\u4e14\u5728--cluster-cidr \u5e95\u4e0b\u7684\u5169\u884c\u53d6\u6d88\u8a3b\u89e3\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'vim calico.yaml\n\n---\n# no effect. This should fall within `--cluster-cidr`.\n  - name: CALICO_IPV4POOL_CIDR\n    value: "192.168.0.0/16"\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"\u56e0\u70ba\u6211\u5011\u662f\u4f7f\u7528\u865b\u64ec\u6a5f\uff0c\u7db2\u5361\u4e0d\u662f eth \u958b\u982d\uff0c\u56e0\u6b64\u9700\u8981\u627e\u5c0b\u6709 IP \u7684\u5730\u65b9\uff0c\u7136\u5f8c\u5728\u4ed6\u4e0b\u9762\u52a0\u4e0a\u5169\u884c\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'vim calico.yaml\n\n---\n>> search\n- name: IP\n  value: "autodetect"\n>> add\n- name: IP_AUTODETECTION_METHOD\n  value: "interface=enp0s3"  (\u591a\u7db2\u5361\u7528","\u5206\u9694)\n\n# first-found\u6703\u53bb\u627e\u4e3b\u6a5f\u7684\u7b2c\u4e00\u5f35\u7db2\u5361\uff0c\u4f46\u9810\u8a2d\u662f\u627e"eth*"\uff0c\u6240\u4ee5VM\u7684\u7db2\u5361\u70baens\u5c31\u6703\u5931\u6557\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:"\u900f\u904e\u6307\u4ee4\u4f86\u5275\u5efa calico \u6240\u6709\u7684\u670d\u52d9\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl create -f calico.yaml\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsx)(n.li,{children:"\u7b49\u6578\u5206\u9418\u81f3\u6578\u5341\u5206\u9418\uff0c\u6211\u5011\u53ef\u4ee5\u89c0\u5bdf\u5230\u6240\u6709 kube-system \u5e95\u4e0b\u7684 pod \u90fd\u9806\u5229\u904b\u884c\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n kube-system\n---\n\nNAME                                       READY   STATUS    RESTARTS      AGE\ncalico-kube-controllers-5b9b456c66-2r99b   1/1     Running   0             30m\ncalico-node-bxjr6                          1/1     Running   0             30m\ncoredns-55cb58b774-52nk6                   1/1     Running   0             41m\ncoredns-55cb58b774-cxrzg                   1/1     Running   0             41m\netcd-k8s-cluster                           1/1     Running   3 (25m ago)   42m\nkube-apiserver-k8s-cluster                 1/1     Running   3 (25m ago)   42m\nkube-controller-manager-k8s-cluster        1/1     Running   2 (25m ago)   42m\nkube-proxy-5grwt                           1/1     Running   1 (25m ago)   41m\nkube-scheduler-k8s-cluster                 1/1     Running   3 (25m ago)   42m\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"6",children:["\n",(0,r.jsx)(n.li,{children:"\u9019\u500b\u6642\u5019\u67e5\u770b node \u7684\u72c0\u614b\u5c31\u6703\u5f9e NotReady \u8b8a\u6210 Ready\uff0c\u4ee3\u8868\u6210\u529f\u904b\u884c\u56c9\uff01"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get nodes\n---\n\nNAME          STATUS   ROLES           AGE   VERSION\nk8s-cluster   Ready    control-plane   43m   v1.30.9\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5be6\u4f5c\u4e00\u500b-rbac",children:"\u5be6\u4f5c\u4e00\u500b RBAC"}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u5011\u60f3\u8981\u57fa\u65bc Role \u7684\u6982\u5ff5\u4f86\u5efa\u7acb\u8a2a\u554f\u6b0a\u9650\uff0c\u7528\u4f86\u8abf\u7bc0\u4f7f\u7528\u8005\u5c0d kubernetes API Server \u7684\u8a2a\u554f\u65b9\u6cd5\uff0c\n\u4ee5\u8d85\u7d1a\u7ba1\u7406\u8005\u70ba\u4f8b\uff0c\u9019\u500b\u89d2\u8272\u8207\u700f\u89bd\u8005\u6709\u8457\u6975\u5927\u7684\u6b0a\u9650\u5dee\u8ddd\uff0c\u70ba\u4e86\u4fdd\u8b77\u5167\u90e8\u7684\u91cd\u8981\u57fa\u790e\u5efa\u8a2d\uff0c\u4e0d\u5e0c\u671b\u6bcf\u500b\u4f7f\u7528\u8457\u90fd\u53ef\u4ee5",(0,r.jsx)(n.strong,{children:"\u5efa\u7acb\u6216\u522a\u9664\u8cc7\u6e90"}),"\uff0c\n\u56e0\u6b64\u6211\u5011\u5be6\u73fe\u5c07 ",(0,r.jsx)(n.strong,{children:"\u6b0a\u9650(Permission)"})," \u7d81\u5b9a\u5728\u666e\u901a\u4f7f\u7528\u8457\u4ee5\u53ca\u670d\u52d9\u5e33\u865f\u7684\u6982\u5ff5\u4e0a\uff0c\u5c07\u8907\u96dc\u7684\u696d\u52d9\u6b0a\u9650\u505a\u8f15\u91cf\u5316\uff0c\u4e26\u9075\u5f9e\u6b0a\u9650\u6700\u5c0f\u5316\u539f\u5247\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"\u5efa\u7acb\u4e00\u500b\u4ee5-x509-\u6191\u8b49\u9a57\u8b49\u7684\u666e\u901a\u4f7f\u7528\u8005",children:"\u5efa\u7acb\u4e00\u500b\u4ee5 X.509 \u6191\u8b49\u9a57\u8b49\u7684\u666e\u901a\u4f7f\u7528\u8005"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u9996\u5148\u6211\u5011\u9700\u8981\u4ee5\u81ea\u8eab\u7684 kubernetes \u4f5c\u70ba CA \u767c\u9001\u65b9\uff0c\u4f86\u767c\u9001\u4e00\u500b CA \u6191\u8b49\uff0c\u4e26\u7522\u751f\u4e00\u7d44\u79c1\u9470\uff0c\u540d\u7a31\u53eb\u505a pod-viewer.key\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"openssl genrsa -out pod-viewer.key 2048\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["\u6211\u5011\u900f\u904e pod-viewer.key \u53bb\u7522\u751f CSR (\u6191\u8b49\u7c3d\u540d\u8acb\u6c42)\uff0c\u6a94\u6848\u540d\u7a31\u53eb\u505a pod-viewer.csr\uff0ckubernetes \u6703\u4f7f\u7528\u6191\u8b49\u4e2d\u7684 ",(0,r.jsx)(n.strong,{children:"subject"})," \u7684\u901a\u7528\u540d\u7a31(Common Name)\u6b04\u4f4d\u4f86\u78ba\u5b9a\u4f7f\u7528\u8005\u540d\u7a31\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'openssl req -new -key pod-viewer.key -out pod-viewer.csr -subj "/CN=pod-viewer/O=app"\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u6709\u4e86 CSR\uff0c\u6211\u5011\u5c31\u53ef\u4ee5\u628a\u5b83\u4ea4\u7d66\u53e2\u96c6\u7ba1\u7406\u8005(\u9019\u88e1\u4e5f\u662f\u6211\u5011)\u900f\u904e\u53e2\u96c6 CA \u7c3d\u7f72\u5ba2\u6236\u7aef\u6191\u8b49\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u9032\u5230 master \u7684 node \u88e1\u9762(\u4e5f\u5c31\u662f\u6211\u5011\u6240\u5728\u7684 VM)\uff0c\u6211\u5011\u53ef\u4ee5\u5c07 CA \u6839\u6191\u8b49\u53d6\u51fa\u4f86\uff0c\u8907\u88fd\u4e00\u4efd\u5230\u76ee\u524d\u7684\u5de5\u4f5c\u76ee\u9304\uff0c\u70ba\u4e86\u4f86\u7c3d\u5c6c\u6240\u6709\u9700\u8981\u901a\u8a0a\u7684\u6191\u8b49\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo cp /etc/kubernetes/pki/ca.crt .\nsudo cp /etc/kubernetes/pki/ca.key .\nsudo chown $(id -u):$(id -g) ca.crt ca.key\nls\n---\n\nca.crt ca.key pod-viewer.csr pod-viewer.key\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsx)(n.li,{children:"\u63a5\u8457\u6211\u5011\u62ff\u6839\u6191\u8b49\u4f86\u7522\u751f\u4e00\u500b\u88ab\u53e2\u96c6 CA \u7c3d\u7f72\u904e\u7684\u6191\u8b49\uff0c\u4e26\u4e14\u53ef\u4ee5\u770b\u5230\u4ed6\u7684 CN \u662f kubernetes\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"openssl x509 -req -in pod-viewer.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out pod-viewer.crt -days 365\n---\n\nCertificate request self-signature ok\nsubject=CN = pod-viewer, O = app\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"openssl x509 -noout -text -in pod-viewer.crt\n---\n\nCertificate:\n    Data:\n        Version: 1 (0x0)\n        Serial Number:\n            11:88:92:5c:a6:04:26:5f:6b:1b:c8:55:9a:4d:43:e0:82:cc:e6:80\n        Signature Algorithm: sha256WithRSAEncryption\n        Issuer: CN = kubernetes\n        Validity\n            Not Before: Feb  6 17:38:44 2025 GMT\n            Not After : Feb  6 17:38:44 2026 GMT\n        Subject: CN = pod-viewer, O = app\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"6",children:["\n",(0,r.jsx)(n.li,{children:"\u6709\u4e86\u6191\u8b49\u4e4b\u5f8c\u53ef\u4ee5\u4f86\u5efa\u7acb Context \u548c User \u4e86\uff0c\u4f7f\u7528 pod-viewer \u5efa\u7acb\u4e00\u500b\u666e\u901a\u7684 User\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl config set-credentials pod-viewer \\\n    --client-certificate=pod-viewer.crt \\\n    --client-key=pod-viewer.key \\\n    --embed-certs=true\n\n---\nUser "pod-viewer" set.\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"7",children:["\n",(0,r.jsx)(n.li,{children:"\u63a5\u8457\u6211\u5011\u5efa\u7acb\u4e00\u500b Context \u53eb\u505a only-view\uff0c\u4e26\u4e14\u6307\u5b9a Cluster \u662f kubernetes\uff0cUser \u662f\u525b\u525b\u5efa\u7acb\u7684 pod-viewer\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl config set-context only-view --cluster=kubernetes --user=pod-viewer\n---\n\nContext "only-view" created.\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl config view\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nclusters:\n- cluster:\n    certificate-authority-data: DATA+OMITTED\n    server: https://k8s-cluster:6443\n  // highlight-next-line\n  name: kubernetes\ncontexts:\n- context:\n    cluster: kubernetes\n    user: kubernetes-admin\n  name: kubernetes-admin@kubernetes\n// highlight-start\n- context:\n    cluster: kubernetes\n    user: pod-viewer\n  name: only-view\n// highlight-end\ncurrent-context: kubernetes-admin@kubernetes\nkind: Config\npreferences: {}\nusers:\n- name: kubernetes-admin\n  user:\n    client-certificate-data: DATA+OMITTED\n    client-key-data: DATA+OMITTED\n// highlight-start\n- name: pod-viewer\n  user:\n    client-certificate-data: DATA+OMITTED\n    client-key-data: DATA+OMITTED\n// highlight-end\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"8",children:["\n",(0,r.jsx)(n.li,{children:"\u65bc\u662f\u6211\u5011\u5c31\u53ef\u4ee5\u5207\u63db Context \u5230 pod-viewer\uff0c\u7576\u6211\u5011\u8a66\u5716\u67e5\u770b pod \u7684\u6642\u5019\u6703\u767c\u73fe\u6c92\u6709\u6b0a\u9650\uff0c\u9019\u662f\u6b63\u5e38\u7684\uff0c\u56e0\u70ba\u9084\u4e0d\u80fd\u901a\u904e Authorization\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl config use-context only-view\n---\n\nSwitched to context "only-view".\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl get pod\n---\n\nError from server (Forbidden): pods is forbidden: User "pod-viewer" cannot list resource "pods" in API group "" in the namespace "default"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u4f7f\u7528-rbac-\u6388\u6b0a\u7d66\u666e\u901a\u4f7f\u7528\u8005",children:"\u4f7f\u7528 RBAC \u6388\u6b0a\u7d66\u666e\u901a\u4f7f\u7528\u8005"}),"\n",(0,r.jsxs)(n.p,{children:["Kubernetes \u81ea v1.8 \u8d77\u5f15\u5165\u4e86 Authorization \u6a5f\u5236\uff0c\u7528\u65bc\u7ba1\u5236\u5c0d Kubernetes API \u7684\u8a2a\u554f\u3002\n\u7ba1\u7406\u8005\u53ef\u900f\u904e ",(0,r.jsx)(n.code,{children:"rbac.authorization.k8s.io"})," API \u7fa4\u7d44\u9032\u884c\u52d5\u614b\u7ba1\u7406\u8a2d\u5b9a\uff0c\u5176\u4e2d RBAC\uff08Role-Based Access Control\uff0c\u57fa\u65bc\u89d2\u8272\u7684\u5b58\u53d6\u63a7\u5236\uff09\u6a5f\u5236\u5141\u8a31\u7ba1\u7406\u54e1\u900f\u904e\u5b9a\u7fa9\u89d2\u8272\uff08Role\uff09\u8207\u89d2\u8272\u7d81\u5b9a\uff08RoleBinding\uff09\uff0c\n\u4f86\u7ba1\u63a7\u7528\u6236\u3001\u7d44\u4ef6\u6216\u670d\u52d9\u5e33\u6236\u7684\u6b0a\u9650\uff0c\u78ba\u4fdd\u8cc7\u6e90\u7684\u5b89\u5168\u6027\u8207\u7ba1\u7406\u6548\u7387\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"RBAC \u4e3b\u8981\u7531\u56db\u500b\u6838\u5fc3\u7269\u4ef6\u7d44\u6210\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Role"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"ClusterRole"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"RoleBinding"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"ClusterRoleBinding"})}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u9996\u5148\u6211\u5011\u5148\u5207\u56de\u4f86\u539f\u672c\u7684 Context\uff0c\u7136\u5f8c\u5efa\u7acb\u4e00\u500b Role \u5b9a\u7fa9\u5728 default \u547d\u540d\u7a7a\u9593\uff0c\u540d\u7a31\u662f pod-viewer\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl config use-context kubernetes-admin@kubernetes\n---\n\nSwitched to context "kubernetes-admin@kubernetes".\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="role.yaml"',children:"kind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  namespace: default # \u5b9a\u7fa9\u5728default\u547d\u540d\u7a7a\u9593\n  name: pod-viewer # Role\u7684\u540d\u7a31\nrules:\n  - apiGroups: [''] # '' \u9810\u8a2d\u4ee3\u8868 apiversion: v1\n    resources: ['pods']\n    verbs: ['get', 'list', 'watch']\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f role.yaml\n---\n\nrole.rbac.authorization.k8s.io/pod-viewer created\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u6211\u5011\u6709\u4e86 user \u540d\u7a31\u53eb\u505a pod-viewer\uff0c\u53e6\u5916\u4e5f\u6709\u4e86 role\uff0c\u4ed6\u5b9a\u7fa9\u9019\u500b role \u53ef\u4ee5\u8b80\u53d6\u90a3\u4e9b\u8cc7\u6e90\u548c\u6b0a\u9650\uff0c\u540d\u7a31\u53eb\u505a pod-viewer\uff0c\u63a5\u4e0b\u4f86\u6211\u5011\u8981\u5b9a\u7fa9 RoleBinding\uff0c\u8b93 user \u548c role \u505a\u7d81\u5b9a\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="role-binding.yaml"',children:"apiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: pod-viewer-rolebinding\n  namespace: default # \u6388\u6b0a\u7684\u547d\u540d\u7a7a\u9593\u70badefault\nsubjects:\n  - kind: User\n    name: pod-viewer # \u9023\u7d50 user\n    apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: Role\n  name: pod-viewer # \u9023\u7d50 role\n  apiGroup: rbac.authorization.k8s.io\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f role-binding.yaml\n---\n\nrolebinding.rbac.authorization.k8s.io/pod-viewer-rolebinding created\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"\u63a5\u4e0b\u4f86\u6211\u5011\u5207\u63db\u5230 only-view \u9019\u500b context\uff0c\u4ed6\u53ef\u4ee5\u6b63\u78ba\u53d6\u5f97 pod \u7684\u8cc7\u8a0a\uff0c\u4f46\u963b\u6b62\u770b\u5230\u5176\u4ed6 namespace \u7684\u8cc7\u6e90\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl config use-context only-view\n---\n\nSwitched to context "only-view".\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n default\n---\n\nNo resources found in default namespace.\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl get pods -n kube-system\n---\n\nError from server (Forbidden): pods is forbidden: User "pod-viewer" cannot list resource "pods" in API group "" in the namespace "kube-system"\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"kubernetes-rbac-example",children:"Kubernetes RBAC Example"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"RBAC-overview",src:s(54090).A+"",width:"1027",height:"881"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"role-\u8207-clusterrole",children:"Role \u8207 ClusterRole"}),"\n",(0,r.jsx)(n.h3,{id:"role",children:"Role"}),"\n",(0,r.jsxs)(n.p,{children:["Role \u662f\u5728 ",(0,r.jsx)(n.strong,{children:"\u547d\u540d\u7a7a\u9593\uff08Namespace\uff09\u7bc4\u570d\u5167"})," \u5b9a\u7fa9\u7684\u6b0a\u9650\u96c6\u5408\u3002\u5b83\u53ea\u5f71\u97ff\u8a72\u547d\u540d\u7a7a\u9593\u5167\u7684\u8cc7\u6e90\uff0c\u7121\u6cd5\u7ba1\u7406\u6574\u500b\u96c6\u7fa4\uff08Cluster\uff09\u7d1a\u5225\u7684\u8cc7\u6e90\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7279\u9ede"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u9650\u5b9a\u5728\u55ae\u4e00\u547d\u540d\u7a7a\u9593\u5167\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u6388\u6b0a\u7d30\u7c92\u5ea6\u7684\u8cc7\u6e90\u5b58\u53d6\uff0c\u4f8b\u5982 Pod\u3001ConfigMap\u3001Secret \u7b49\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u4e0d\u80fd\u76f4\u63a5\u63a7\u5236 Cluster \u7bc4\u570d\u7684\u8cc7\u6e90\uff0c\u5982 Node\u3001PersistentVolume\uff08PV\uff09\u7b49\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u9069\u7528\u5834\u666f"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u9700\u8981\u91dd\u5c0d\u4e0d\u540c\u547d\u540d\u7a7a\u9593\u8a2d\u7f6e\u4e0d\u540c\u6b0a\u9650\u7684\u61c9\u7528\u5834\u666f\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u9650\u5236\u67d0\u4e9b\u4f7f\u7528\u8005\u6216\u670d\u52d9\u5e33\u6236\u50c5\u80fd\u5b58\u53d6\u7279\u5b9a\u547d\u540d\u7a7a\u9593\u5167\u7684\u8cc7\u6e90\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7bc4\u4f8b"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="role.yaml"',children:"kind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  namespace: default # \u5b9a\u7fa9\u5728default\u547d\u540d\u7a7a\u9593\n  name: pod-viewer # Role\u7684\u540d\u7a31\nrules:\n  - apiGroups: [''] # '' \u9810\u8a2d\u4ee3\u8868 apiversion: v1\n    resources: ['pods']\n    verbs: ['get', 'list', 'watch']\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u53c3\u6578"}),":"]}),"\n",(0,r.jsx)(n.h4,{id:"1-apigroups",children:"1. apiGroups"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"apiGroups"})," \u5b9a\u7fa9\u8cc7\u6e90\u6240\u5c6c\u7684 API Group\u3002Kubernetes \u7684\u8cc7\u6e90\u53ef\u4ee5\u5283\u5206\u70ba\u4e0d\u540c\u7684 API Group\u3002Core \u8cc7\u6e90\uff08\u4f8b\u5982 ",(0,r.jsx)(n.code,{children:"pods"}),"\uff09\u5c6c\u65bc\u7a7a\u7684 API Group (",(0,r.jsx)(n.code,{children:"apiGroups: ['']"}),")\uff0c\u800c\u5176\u4ed6\u8cc7\u6e90\uff08\u4f8b\u5982 ",(0,r.jsx)(n.code,{children:"deployments"})," \u6216 ",(0,r.jsx)(n.code,{children:"services"}),"\uff09\u5247\u5c6c\u65bc\u7279\u5b9a\u7684 API Group\uff08\u5982 ",(0,r.jsx)(n.code,{children:"apps"}),"\u3001",(0,r.jsx)(n.code,{children:"batch"})," \u7b49\uff09\u3002"]}),"\n",(0,r.jsx)(n.h4,{id:"2-resources",children:"2. resources"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"resources"})," \u5b9a\u7fa9\u89d2\u8272\u53ef\u4ee5\u64cd\u4f5c\u7684\u5177\u9ad4 Kubernetes \u8cc7\u6e90\u985e\u578b\u3002\u4f8b\u5982\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pods"}),"\uff1a\u8868\u793a Pod \u8cc7\u6e90\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"services"}),"\uff1a\u8868\u793a Service \u8cc7\u6e90\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"deployments"}),"\uff1a\u8868\u793a Deployment \u8cc7\u6e90\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"*"})," \u53ef\u4ee5\u8868\u793a\u6240\u6709\u8cc7\u6e90\u985e\u578b\u3002"]}),"\n",(0,r.jsx)(n.h4,{id:"3-verbs",children:"3. verbs"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"verbs"})," \u5b9a\u7fa9\u4e86\u8a72\u89d2\u8272\u53ef\u4ee5\u5c0d\u6307\u5b9a\u8cc7\u6e90\u57f7\u884c\u7684\u64cd\u4f5c\u3002\u5e38\u898b\u7684\u52d5\u4f5c\u5305\u62ec\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"get"}),"\uff1a\u67e5\u770b\u8cc7\u6e90\u7684\u8a73\u7d30\u8cc7\u6599\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"list"}),"\uff1a\u5217\u51fa\u8cc7\u6e90\u7684\u96c6\u5408\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"create"}),"\uff1a\u5275\u5efa\u65b0\u7684\u8cc7\u6e90\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"update"}),"\uff1a\u66f4\u65b0\u8cc7\u6e90\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"delete"}),"\uff1a\u522a\u9664\u8cc7\u6e90\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"watch"}),"\uff1a\u76e3\u63a7\u8cc7\u6e90\u7684\u8b8a\u5316\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"clusterrole",children:"ClusterRole"}),"\n",(0,r.jsxs)(n.p,{children:["ClusterRole \u8207 Role \u985e\u4f3c\uff0c\u4f46\u5b83\u7684\u6b0a\u9650\u9069\u7528\u65bc ",(0,r.jsx)(n.strong,{children:"\u6574\u500b\u96c6\u7fa4\uff08Cluster\uff09"}),"\uff0c\u800c\u4e0d\u4fb7\u9650\u65bc\u7279\u5b9a\u547d\u540d\u7a7a\u9593\uff0c\u5982\u679c\u7cfb\u7d71\u7ba1\u7406\u54e1\u6c92\u6709 ClusterRole \u7684\u6b0a\u9650\uff0c\u4ee3\u8868\u4ed6\u9700\u8981\u5c07\u6bcf\u500b namespace \u4e00\u4e00\u7d81\u5b9a\u53e2\u96c6\u7b49\u7d1a\u4f7f\u7528\u8005\uff0c\u90a3\u771f\u7684\u662f\u60e1\u5922\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7279\u9ede"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u53ef\u4ee5\u7ba1\u7406 Cluster \u7d1a\u5225\u7684\u8cc7\u6e90\uff0c\u5982 Node\u3001PersistentVolume\u3001Namespace\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u4e5f\u53ef\u4ee5\u7528\u4f86\u6388\u6b0a\u8de8\u6240\u6709\u547d\u540d\u7a7a\u9593\u7684\u6b0a\u9650\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u9069\u7528\u65bc\u5177\u6709\u96c6\u7fa4\u7bc4\u570d\u6b0a\u9650\u7684\u4f7f\u7528\u8005\u6216\u61c9\u7528\u7a0b\u5f0f\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u9069\u7528\u5834\u666f"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u9700\u8981\u7ba1\u7406\u6574\u500b Kubernetes \u96c6\u7fa4\u7684\u8cc7\u6e90\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u76e3\u63a7\u7cfb\u7d71\u3001\u904b\u7dad\u5de5\u5177\u7b49\u9700\u8981\u5b58\u53d6\u6240\u6709\u547d\u540d\u7a7a\u9593\u7684\u8cc7\u6e90\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u6388\u6b0a\u7d66 Kubernetes \u7d44\u5efa\uff08\u5982 kubelet\uff09\u4ee5\u7ba1\u7406 Cluster \u8cc7\u6e90\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7bc4\u4f8b"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="cluster-role.yaml"',children:"kind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  # ClusterRole \u6c92\u6709\u547d\u540d\u7a7a\u9593\u5b57\u6bb5\n  name: cluster-admin\nrules:\n  - apiGroups: ['']\n    resources: ['pods']\n    verbs: ['get', 'list', 'watch']\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"rolebinding-\u8207-clusterrolebinding",children:"RoleBinding \u8207 ClusterRoleBinding"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"RoleBinding.",src:s(83737).A+"",width:"791",height:"321"})}),"\n",(0,r.jsx)(n.h3,{id:"rolebinding",children:"RoleBinding"}),"\n",(0,r.jsxs)(n.p,{children:["RoleBinding \u7528\u65bc ",(0,r.jsx)(n.strong,{children:"\u5c07 Role \u6307\u6d3e\u7d66\u7279\u5b9a\u7684\u4f7f\u7528\u8005\u3001\u7fa4\u7d44\u6216\u670d\u52d9\u5e33\u6236"}),"\uff0c\u4f46\u50c5\u9650\u65bc\u67d0\u500b\u7279\u5b9a\u7684\u547d\u540d\u7a7a\u9593\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7279\u9ede"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7d81\u5b9a\u7684 Role \u53ea\u80fd\u5f71\u97ff\u5176\u6240\u5c6c\u7684\u547d\u540d\u7a7a\u9593\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u53ef\u4ee5\u7d81\u5b9a Kubernetes \u4f7f\u7528\u8005\u3001\u7fa4\u7d44\u6216\u670d\u52d9\u5e33\u6236\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u5141\u8a31\u5c07 ClusterRole \u7d81\u5b9a\u81f3\u7279\u5b9a\u547d\u540d\u7a7a\u9593\u5167\u7684\u4f7f\u7528\u8005\uff0c\u4ee5\u9650\u5236 ClusterRole \u7684\u4f5c\u7528\u7bc4\u570d\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u9069\u7528\u5834\u666f"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u70ba\u4e0d\u540c\u7684\u958b\u767c\u5718\u968a\u6216\u61c9\u7528\u7a0b\u5f0f\u63d0\u4f9b\u547d\u540d\u7a7a\u9593\u7d1a\u5225\u7684\u6b0a\u9650\u7ba1\u7406\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u63a7\u5236\u7279\u5b9a\u670d\u52d9\u5e33\u6236\u5728\u547d\u540d\u7a7a\u9593\u5167\u7684\u64cd\u4f5c\u6b0a\u9650\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7bc4\u4f8b"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="role-binding.yaml"',children:"apiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: pod-viewer-rolebinding\n  namespace: defaul # \u6388\u6b0a\u7684\u547d\u540d\u7a7a\u9593\u70badefault\nsubjects:\n  - kind: User\n    name: pod-viewer # \u9023\u7d50 user\n    apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: Role\n  name: pod-viewer # \u9023\u7d50 role\n  apiGroup: rbac.authorization.k8s.io\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"subject \u53c3\u6578"}),":"]}),"\n",(0,r.jsx)(n.h4,{id:"1-user",children:"1. User"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"User"})," \u6307\u7684\u662f\u4e00\u500b\u5177\u540d\u7684\u4f7f\u7528\u8005\u5e33\u6236\u3002\u9019\u901a\u5e38\u662f\u6307 Kubernetes \u8a8d\u8b49\u7684\u500b\u5225\u4f7f\u7528\u8005\uff0c\u53ef\u4ee5\u662f\u7d93\u7531\u8a8d\u8b49\u7cfb\u7d71\uff08\u5982 LDAP \u6216 OpenID\uff09\u767b\u5165\u7684\u4f7f\u7528\u8005\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u7bc4\u4f8b\uff1a\u9019\u8868\u793a\u6388\u6b0a\u540d\u7a31\u70ba ",(0,r.jsx)(n.code,{children:"pod-viewer"})," \u7684\u4f7f\u7528\u8005\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"subjects:\n  - kind: User\n    name: pod-viewer\n    apiGroup: rbac.authorization.k8s.io\n"})}),"\n",(0,r.jsx)(n.h4,{id:"2-service-account",children:"2. Service Account"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"ServiceAccount"})," \u662f Kubernetes \u4e2d\u7684\u670d\u52d9\u5e33\u6236\uff0c\u901a\u5e38\u7528\u65bc\u6388\u6b0a\u61c9\u7528\u7a0b\u5f0f\u6216\u670d\u52d9\u9032\u884c\u81ea\u52d5\u5316\u64cd\u4f5c\u3002\u670d\u52d9\u5e33\u6236\u6703\u88ab\u7d81\u5b9a\u5230\u7279\u5b9a\u7684\u547d\u540d\u7a7a\u9593\uff0c\u4e26\u4e14\u5b83\u5011\u901a\u5e38\u7528\u4f86\u57f7\u884c\u7279\u5b9a\u7684 Pod \u6216\u8005\u5728\u547d\u540d\u7a7a\u9593\u5167\u57f7\u884c\u7684\u64cd\u4f5c\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u7bc4\u4f8b\uff1a\u9019\u8868\u793a\u6388\u6b0a\u540d\u7a31\u70ba ",(0,r.jsx)(n.code,{children:"default"})," \u7684\u670d\u52d9\u5e33\u6236\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"subjects:\n  - kind: ServiceAccount\n    name: default\n    namespace: default # \u6307\u5b9a\u670d\u52d9\u5e33\u6236\u6240\u5c6c\u547d\u540d\u7a7a\u9593\n"})}),"\n",(0,r.jsx)(n.h4,{id:"3-group",children:"3. Group"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Group"})," \u7528\u4f86\u6307\u5b9a\u4e00\u500b\u7fa4\u7d44\uff0c\u9019\u500b\u7fa4\u7d44\u4e2d\u7684\u6240\u6709\u6210\u54e1\u90fd\u6703\u88ab\u6388\u4e88\u8a72\u89d2\u8272\u7684\u6b0a\u9650\u3002\u7fa4\u7d44\u901a\u5e38\u8207\u7528\u6236\u7ba1\u7406\u7cfb\u7d71\uff08\u4f8b\u5982 LDAP\uff09\u4e2d\u7684\u7fa4\u7d44\u76f8\u95dc\u806f\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u7bc4\u4f8b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# \u5c0d\u65bc"qa"\u547d\u540d\u7a7a\u9593\u4e2d\u7684\u6240\u6709\u670d\u52d9\u5e33\u865f\nsubjects:\n  - kind: Group\n    name: system: serviceaccounts: qa\n    apiGroup: rbac.authorization.k8s.io\n# \u5c0d\u65bc\u6240\u6709\u7528\u6236\nsubjects:\n  - kind: Group\n    name: system: authenticated\n    apiGroup: rbac.authorization.k8s.io\n  - kind: Group\n    name: system: unauthenticated\n    apiGroup: rbac.authorization.k8s.io\n'})}),"\n",(0,r.jsx)(n.h3,{id:"clusterrolebinding",children:"ClusterRoleBinding"}),"\n",(0,r.jsxs)(n.p,{children:["ClusterRoleBinding \u5141\u8a31\u5c07 ClusterRole \u7d81\u5b9a\u81f3 ",(0,r.jsx)(n.strong,{children:"\u6574\u500b\u96c6\u7fa4\u7bc4\u570d\u5167\u7684\u4f7f\u7528\u8005\u3001\u7fa4\u7d44\u6216\u670d\u52d9\u5e33\u6236"}),"\uff0c\u78ba\u4fdd\u9019\u4e9b\u4e3b\u9ad4\u64c1\u6709\u8de8\u547d\u540d\u7a7a\u9593\u7684\u6b0a\u9650\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7279\u9ede"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u53ef\u5c07 ClusterRole \u8ce6\u4e88\u6240\u6709\u547d\u540d\u7a7a\u9593\u5167\u7684\u4e3b\u9ad4\uff0c\u6216\u5c0d\u96c6\u7fa4\u7d1a\u5225\u7684\u8cc7\u6e90\u8ce6\u6b0a\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u9069\u7528\u65bc\u96c6\u7fa4\u7ba1\u7406\u54e1\u3001\u76e3\u63a7\u5de5\u5177\u3001\u57fa\u790e\u8a2d\u65bd\u81ea\u52d5\u5316\u5de5\u5177\u7b49\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u9069\u7528\u5834\u666f"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u9700\u8981\u8de8\u547d\u540d\u7a7a\u9593\u6216\u96c6\u7fa4\u7d1a\u5225\u5b58\u53d6\u6b0a\u9650\u7684\u670d\u52d9\u5e33\u6236\u6216\u61c9\u7528\u7a0b\u5f0f\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u70ba Kubernetes \u6838\u5fc3\u7d44\u4ef6\uff08\u5982 Controller\u3001Scheduler\uff09\u63d0\u4f9b\u7ba1\u7406\u6b0a\u9650\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7bc4\u4f8b"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="role-binding.yaml"',children:"apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: cluster-admin-binding\nsubjects:\n  - kind: User\n    name: admin # \u9023\u7d50 user\n    apiGroup: rbac.authorization.k8s.io\nroleRef:\n  kind: ClusterRole\n  name: cluster-admin # \u9023\u7d50 cluster role\n  apiGroup: rbac.authorization.k8s.io\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{}),(0,r.jsx)(n.th,{children:"Role"}),(0,r.jsx)(n.th,{children:"ClusterRole"}),(0,r.jsx)(n.th,{children:"RoleBinding"}),(0,r.jsx)(n.th,{children:"ClusterRoleBinding"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u4f5c\u7528\u7bc4\u570d"})}),(0,r.jsx)(n.td,{children:"\u55ae\u4e00\u547d\u540d\u7a7a\u9593"}),(0,r.jsx)(n.td,{children:"\u6574\u500b\u96c6\u7fa4"}),(0,r.jsx)(n.td,{children:"\u55ae\u4e00\u547d\u540d\u7a7a\u9593"}),(0,r.jsx)(n.td,{children:"\u6574\u500b\u96c6\u7fa4"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u7ba1\u7406\u5c0d\u8c61"})}),(0,r.jsx)(n.td,{children:"Pod\u3001Secret\u3001ConfigMap \u7b49"}),(0,r.jsx)(n.td,{children:"Node\u3001Namespace\u3001PersistentVolume \u7b49"}),(0,r.jsx)(n.td,{children:"\u4f7f\u7528\u8005\u3001\u7fa4\u7d44\u3001\u670d\u52d9\u5e33\u6236\uff08\u50c5\u5f71\u97ff\u55ae\u4e00\u547d\u540d\u7a7a\u9593\uff09"}),(0,r.jsx)(n.td,{children:"\u4f7f\u7528\u8005\u3001\u7fa4\u7d44\u3001\u670d\u52d9\u5e33\u6236\uff08\u5f71\u97ff\u6240\u6709\u547d\u540d\u7a7a\u9593\uff09"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u9069\u7528\u5834\u666f"})}),(0,r.jsx)(n.td,{children:"\u61c9\u7528\u65bc\u7279\u5b9a\u547d\u540d\u7a7a\u9593\u7684\u6b0a\u9650\u63a7\u5236"}),(0,r.jsx)(n.td,{children:"\u9700\u8de8\u547d\u540d\u7a7a\u9593\u6216\u96c6\u7fa4\u7bc4\u570d\u7684\u6b0a\u9650"}),(0,r.jsx)(n.td,{children:"\u9650\u5236\u7279\u5b9a\u4f7f\u7528\u8005\u6216\u670d\u52d9\u5e33\u6236\u7684\u6b0a\u9650"}),(0,r.jsx)(n.td,{children:"\u9700\u5168\u57df\u5b58\u53d6\u6b0a\u9650\u7684\u61c9\u7528"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},54090:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/RBAC-overview-2855c9eec254f4c07be7acef3ca1eaea.svg"},83737:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/RoleBinding-f5d47dafdc0dea933527ea1f8cb63c8d.svg"},96300:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Triple-A-3dd97ad505c5e7dd05c3bc60486e65e2.svg"},17521:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/create-vm-disk-cdd2067ffb05fc8570f8cf821ebbe7b8.png"},36647:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/create-vm-iso-06c1a52b2d7af388829355d953295dc2.png"},85026:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/create-vm-memory-cpu-8402f37586801ddbfb75afb20d540ea8.png"},2378:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/create-vm-network-host-only-adapter-ae9f3bfdad419c1e5211547d51efec7f.png"},81051:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/create-vm-overview-39fbd3f106a1ca7da02629378ed43e07.png"},27578:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/create-vm-username-password-7e87517f342b8703d1340746d796ac55.png"},6282:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/setting-vm-network-host-only-adapter-618674ba421552a38e604320ef0febe6.png"},48916:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/ubuntu-login-8177e351d9f2e79b523c098b111edca8.png"},63015:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/ubuntu-terminal-login-bc2853af8ab88a5d7e75f8c7f4139025.png"},28453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>c});var r=s(96540);const i={},l=r.createContext(i);function d(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);