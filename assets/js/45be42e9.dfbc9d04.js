"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[7589],{25791:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>o,default:()=>x,frontMatter:()=>l,metadata:()=>c,toc:()=>t});var i=s(74848),r=s(28453);const l={},o="Security - RBAC Authorization",c={id:"notes/kubernetes-basics/security-rbac-authorization",title:"Security - RBAC Authorization",description:"Kubernetes \u7684\u8a8d\u8b49\u3001\u6388\u6b0a\u8207\u51c6\u5165\u63a7\u5236",source:"@site/docs/notes/kubernetes-basics/30-security-rbac-authorization.mdx",sourceDirName:"notes/kubernetes-basics",slug:"/notes/kubernetes-basics/security-rbac-authorization",permalink:"/docs/notes/kubernetes-basics/security-rbac-authorization",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:30,frontMatter:{},sidebar:"notesSidebar",previous:{title:"Security - User Management with Kubernetes Context",permalink:"/docs/notes/kubernetes-basics/security-user-management-with-kubernetes-context"},next:{title:"Outline",permalink:"/docs/notes/design-pattern"}},d={},t=[{value:"Kubernetes \u7684\u8a8d\u8b49\u3001\u6388\u6b0a\u8207\u51c6\u5165\u63a7\u5236",id:"kubernetes-\u7684\u8a8d\u8b49\u6388\u6b0a\u8207\u51c6\u5165\u63a7\u5236",level:2},{value:"\u8a8d\u8b49\uff08Authentication\uff09",id:"\u8a8d\u8b49authentication",level:2},{value:"1. \u666e\u901a\u4f7f\u7528\u8005\uff08User\uff09",id:"1-\u666e\u901a\u4f7f\u7528\u8005user",level:3},{value:"2. \u670d\u52d9\u5e33\u865f\uff08ServiceAccount\uff09",id:"2-\u670d\u52d9\u5e33\u865fserviceaccount",level:3},{value:"\u8eab\u4efd\u9a57\u8b49\u65b9\u5f0f",id:"\u8eab\u4efd\u9a57\u8b49\u65b9\u5f0f",level:3},{value:"\u6388\u6b0a\uff08Authorization\uff09",id:"\u6388\u6b0aauthorization",level:2},{value:"\u6388\u6b0a\u6a5f\u5236",id:"\u6388\u6b0a\u6a5f\u5236",level:3},{value:"\u67e5\u770b\u662f\u5426\u6709\u6b0a\u9650",id:"\u67e5\u770b\u662f\u5426\u6709\u6b0a\u9650",level:3},{value:"\u51c6\u5165\u63a7\u5236\uff08Admission Control\uff09",id:"\u51c6\u5165\u63a7\u5236admission-control",level:2},{value:"\u51c6\u5165\u63a7\u5236\u5668",id:"\u51c6\u5165\u63a7\u5236\u5668",level:3},{value:"<code>ValidatingWebhookConfiguration</code>",id:"validatingwebhookconfiguration",level:3},{value:"<code>MutatingWebhookConfiguration</code>",id:"mutatingwebhookconfiguration",level:3},{value:"\u5be6\u4f5c\u4e00\u500b RBAC",id:"\u5be6\u4f5c\u4e00\u500b-rbac",level:2},{value:"\u5efa\u7acb\u4e00\u500bUbuntu VM",id:"\u5efa\u7acb\u4e00\u500bubuntu-vm",level:3},{value:"\u5efa\u7acb\u4e00\u500b\u4ee5 X.509 \u6191\u8b49\u9a57\u8b49\u7684\u666e\u901a\u4f7f\u7528\u8005",id:"\u5efa\u7acb\u4e00\u500b\u4ee5-x509-\u6191\u8b49\u9a57\u8b49\u7684\u666e\u901a\u4f7f\u7528\u8005",level:3}];function h(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"security---rbac-authorization",children:"Security - RBAC Authorization"})}),"\n",(0,i.jsx)(e.h2,{id:"kubernetes-\u7684\u8a8d\u8b49\u6388\u6b0a\u8207\u51c6\u5165\u63a7\u5236",children:"Kubernetes \u7684\u8a8d\u8b49\u3001\u6388\u6b0a\u8207\u51c6\u5165\u63a7\u5236"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"Triple-A",src:s(96300).A+"",width:"781",height:"161"})}),"\n",(0,i.jsxs)(e.p,{children:["\u5728 Kubernetes \u4e2d\uff0c\u5b89\u5168\u6027\u6a5f\u5236\u7531 ",(0,i.jsx)(e.strong,{children:"\u8a8d\u8b49\uff08Authentication\uff09"}),"\u3001",(0,i.jsx)(e.strong,{children:"\u6388\u6b0a\uff08Authorization\uff09"})," \u548c ",(0,i.jsx)(e.strong,{children:"\u51c6\u5165\u63a7\u5236\uff08Admission Control\uff09"})," \u7d44\u6210\uff0c\u5171\u540c\u78ba\u4fdd\u53e2\u96c6\u7684\u5b89\u5168\u6027\u8207\u53ef\u63a7\u6027\u3002"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u8a8d\u8b49authentication",children:"\u8a8d\u8b49\uff08Authentication\uff09"}),"\n",(0,i.jsxs)(e.p,{children:["\u5728 Kubernetes \u4e2d\uff0c\u8a8d\u8b49\u662f\u4fdd\u969c\u7cfb\u7d71\u5b89\u5168\u7684\u7b2c\u4e00\u9053\u9632\u7dda\uff0c\u78ba\u4fdd\u53ea\u6709\u5408\u6cd5\u7684\u7528\u6236\u548c\u670d\u52d9\u80fd\u5920\u5b58\u53d6 API \u4f3a\u670d\u5668\u3002Kubernetes \u652f\u63f4\u591a\u7a2e\u8a8d\u8b49\u65b9\u5f0f\u4f86\u9a57\u8b49\u8eab\u4efd\uff0c\u5176\u4e2d\u6700\u5e38\u898b\u7684\u662f",(0,i.jsxs)(e.strong,{children:["\u666e\u901a\u4f7f\u7528\u8005\uff08User\uff09",(0,i.jsx)(e.strong,{children:"\u548c"}),"\u670d\u52d9\u5e33\u865f\uff08ServiceAccount\uff09"]}),"\u3002"]}),"\n",(0,i.jsx)(e.h3,{id:"1-\u666e\u901a\u4f7f\u7528\u8005user",children:"1. \u666e\u901a\u4f7f\u7528\u8005\uff08User\uff09"}),"\n",(0,i.jsx)(e.p,{children:"\u666e\u901a\u4f7f\u7528\u8005\u662f\u6307\u76f4\u63a5\u8207 Kubernetes API \u4f3a\u670d\u5668\u4ea4\u4e92\u7684\u7528\u6236\u6216\u61c9\u7528\u7a0b\u5f0f\u3002\u9019\u4e9b\u4f7f\u7528\u8005\u901a\u5e38\u6703\u4f7f\u7528 X.509 \u6191\u8b49\u3001Token \u6216 OpenID Connect\uff08OIDC\uff09\u7b49\u65b9\u5f0f\u9032\u884c\u8eab\u4efd\u8a8d\u8b49\u3002"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8eab\u4efd\u8a8d\u8b49\u65b9\u5f0f"}),"\uff1a\u666e\u901a\u4f7f\u7528\u8005\u53ef\u4f7f\u7528 X.509 \u5ba2\u6236\u7aef\u6191\u8b49\u6216 Token \u4f86\u9032\u884c\u8eab\u4efd\u9a57\u8b49\u3002\u4e5f\u53ef\u4ee5\u900f\u904e OIDC \u8207\u5916\u90e8\u8eab\u4efd\u63d0\u4f9b\u8005\uff08\u5982 Google\u3001Azure AD\uff09\u9032\u884c\u6574\u5408\uff0c\u5be6\u73fe\u55ae\u4e00\u767b\u5165\uff08SSO\uff09\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7528\u9014"}),"\uff1a\u666e\u901a\u4f7f\u7528\u8005\u4e00\u822c\u662f\u7ba1\u7406 Kubernetes \u53e2\u96c6\u7684\u64cd\u4f5c\u4eba\u54e1\u6216\u958b\u767c\u8005\uff0c\u4ed6\u5011\u6703\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"kubectl"})," \u7b49\u5de5\u5177\u4f86\u90e8\u7f72\u61c9\u7528\u3001\u7ba1\u7406\u8cc7\u6e90\u3001\u57f7\u884c\u65e5\u5e38\u64cd\u4f5c\u7b49\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6388\u6b0a\u6a5f\u5236"}),"\uff1a\u666e\u901a\u4f7f\u7528\u8005\u7684\u6b0a\u9650\u901a\u5e38\u900f\u904e\u89d2\u8272\u57fa\u65bc\u5b58\u53d6\u63a7\u5236\uff08RBAC\uff09\u4f86\u7ba1\u7406\u3002\u7ba1\u7406\u54e1\u53ef\u6839\u64da\u4f7f\u7528\u8005\u7684\u89d2\u8272\u4f86\u8a2d\u5b9a\u5176\u5c0d\u4e0d\u540c\u8cc7\u6e90\u7684\u8a2a\u554f\u6b0a\u9650\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7bc4\u4f8b"}),"\uff1a\n\u5047\u8a2d\u6709\u4e00\u540d\u958b\u767c\u8005\u900f\u904e X.509 \u6191\u8b49\u767b\u9304 Kubernetes\uff0c\u9019\u4f4d\u958b\u767c\u8005\u4fbf\u53ef\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"kubectl"})," \u6307\u4ee4\u57f7\u884c\u5404\u7a2e\u64cd\u4f5c\uff0c\u4f46\u6b0a\u9650\u6703\u53d7\u5230 RBAC \u914d\u7f6e\u7684\u9650\u5236\u3002"]}),"\n",(0,i.jsx)(e.h3,{id:"2-\u670d\u52d9\u5e33\u865fserviceaccount",children:"2. \u670d\u52d9\u5e33\u865f\uff08ServiceAccount\uff09"}),"\n",(0,i.jsxs)(e.p,{children:["\u670d\u52d9\u5e33\u865f\u662f Kubernetes \u7528\u4f86\u70ba Pod \u63d0\u4f9b\u8eab\u4efd\u8a8d\u8b49\u7684\u6a5f\u5236\uff0c\u4f7f\u5f97 Pod \u80fd\u5920\u5b89\u5168\u5730\u8207 Kubernetes API \u4e92\u52d5\u3002\u6bcf\u500b\u547d\u540d\u7a7a\u9593\u5728\u5efa\u7acb\u6642\u6703\u81ea\u52d5\u5275\u5efa\u4e00\u500b\u540d\u70ba ",(0,i.jsx)(e.code,{children:"default"})," \u7684\u670d\u52d9\u5e33\u865f\uff0c\u4e26\u70ba\u8a72\u547d\u540d\u7a7a\u9593\u5167\u7684 Pod \u63d0\u4f9b\u4e00\u500b Token\uff0c\u7528\u65bc\u8eab\u4efd\u9a57\u8b49\u3002"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8eab\u4efd\u8a8d\u8b49"}),"\uff1a\u670d\u52d9\u5e33\u865f\u6703\u81ea\u52d5\u8207\u4e00\u7d44\u6191\u8b49\uff08\u5982 JSON Web Token\uff09\u95dc\u806f\uff0c\u9019\u4e9b\u6191\u8b49\u88ab Pod \u4f7f\u7528\u4f86\u8207 API \u4f3a\u670d\u5668\u9032\u884c\u4ea4\u4e92\uff0c\u7121\u9700\u624b\u52d5\u914d\u7f6e\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4f5c\u7528\u7bc4\u570d"}),"\uff1a\u670d\u52d9\u5e33\u865f\u7684\u4f5c\u7528\u7bc4\u570d\u662f\u57fa\u65bc\u547d\u540d\u7a7a\u9593\u3002\u6bcf\u500b\u547d\u540d\u7a7a\u9593\u6703\u81ea\u52d5\u5275\u5efa ",(0,i.jsx)(e.code,{children:"default"})," \u670d\u52d9\u5e33\u865f\uff0c\u4e26\u5c07\u5c0d\u61c9\u7684 Token \u63d0\u4f9b\u7d66\u8a72\u547d\u540d\u7a7a\u9593\u4e2d\u7684 Pod \u4f7f\u7528\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7528\u9014"}),"\uff1a\u670d\u52d9\u5e33\u865f\u4e3b\u8981\u7528\u65bc Pod \u5167\u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u7576\u61c9\u7528\u7a0b\u5f0f\u9700\u8981\u5b58\u53d6 Kubernetes API\uff08\u4f8b\u5982\u8b80\u53d6 ConfigMap \u6216\u5275\u5efa\u8cc7\u6e90\uff09\u6642\uff0c\u6703\u4f7f\u7528\u670d\u52d9\u5e33\u865f\u4f86\u9032\u884c\u8eab\u4efd\u9a57\u8b49\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6388\u6b0a\u6a5f\u5236"}),"\uff1a\u670d\u52d9\u5e33\u865f\u7684\u6b0a\u9650\u900f\u904e\u89d2\u8272\uff08Role\uff09\u548c\u89d2\u8272\u7d81\u5b9a\uff08RoleBinding\uff09\u9032\u884c\u63a7\u5236\u3002\u6bcf\u500b\u670d\u52d9\u5e33\u865f\u53ef\u4ee5\u88ab\u8ce6\u4e88\u4e0d\u540c\u7684\u89d2\u8272\uff0c\u9650\u5236\u5176\u53ef\u64cd\u4f5c\u7684\u8cc7\u6e90\u7bc4\u570d\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7bc4\u4f8b"}),"\uff1a\n\u7576 Pod \u9700\u8981\u5f9e Kubernetes API \u7372\u53d6\u4e00\u500b ConfigMap \u6642\uff0c\u5b83\u6703\u81ea\u52d5\u4f7f\u7528\u8a72\u547d\u540d\u7a7a\u9593\u7684 ",(0,i.jsx)(e.code,{children:"default"})," \u670d\u52d9\u5e33\u865f\u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u4e26\u6839\u64da\u6240\u914d\u7f6e\u7684\u89d2\u8272\u548c\u89d2\u8272\u7d81\u5b9a\u6388\u4e88\u76f8\u61c9\u7684\u6b0a\u9650\u3002"]}),"\n",(0,i.jsx)(e.h3,{id:"\u8eab\u4efd\u9a57\u8b49\u65b9\u5f0f",children:"\u8eab\u4efd\u9a57\u8b49\u65b9\u5f0f"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"X.509 \u5ba2\u6236\u7aef\u6191\u8b49"}),"\uff1a\u9019\u662f\u6700\u5e38\u898b\u7684\u65b9\u6cd5\uff0c\u7cfb\u7d71\u7ba1\u7406\u54e1\u53ef\u4ee5\u4f7f\u7528 CA \u7c3d\u7f72\u7684\u6191\u8b49\u4f86\u9a57\u8b49\u7528\u6236\u8eab\u4efd\u3002\u6bcf\u500b\u7528\u6236\u6703\u6709\u7368\u7acb\u7684\u6191\u8b49\u8207\u79c1\u9470\uff0c\u4e26\u900f\u904e ",(0,i.jsx)(e.code,{children:"kubectl"})," \u8a2d\u5b9a\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u975c\u614b Token \u6587\u4ef6"}),"\uff1aKubernetes \u5141\u8a31\u900f\u904e Token \u6587\u4ef6\u4f86\u9032\u884c\u8eab\u4efd\u9a57\u8b49\uff0c\u9069\u7528\u65bc\u7c21\u55ae\u7684\u6e2c\u8a66\u74b0\u5883\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"OpenID Connect\uff08OIDC\uff09"}),"\uff1a\u652f\u63f4\u8207\u5916\u90e8\u8eab\u4efd\u63d0\u4f9b\u8005\uff08\u5982 Google\u3001Azure AD\u3001Keycloak\uff09\u6574\u5408\uff0c\u9069\u7528\u65bc\u4f01\u696d\u7d1a SSO\uff08\u55ae\u4e00\u767b\u5165\uff09\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Webhook \u8eab\u4efd\u9a57\u8b49"}),"\uff1aAPI \u4f3a\u670d\u5668\u53ef\u900f\u904e Webhook \u65b9\u5f0f\uff0c\u5c07\u8eab\u4efd\u9a57\u8b49\u8acb\u6c42\u8f49\u767c\u81f3\u5916\u90e8\u7684\u8a8d\u8b49\u670d\u52d9\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u670d\u52d9\u5e33\u6236\uff08ServiceAccount\uff09"}),"\uff1a\u5c08\u70ba Pod \u5167\u7684\u61c9\u7528\u7a0b\u5f0f\u63d0\u4f9b\u7684\u8eab\u4efd\u9a57\u8b49\u6a5f\u5236\uff0c\u4f7f\u5176\u80fd\u5920\u5b58\u53d6 Kubernetes API\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u6388\u6b0aauthorization",children:"\u6388\u6b0a\uff08Authorization\uff09"}),"\n",(0,i.jsx)(e.p,{children:"\u8eab\u4efd\u9a57\u8b49\u901a\u904e\u5f8c\uff0c\u50c5\u80fd\u4ee3\u8868\u7576\u524d\u7684\u4f7f\u7528\u8005\u5141\u8a31\u8207 Kubernetes API Server \u6e9d\u901a\uff0c\u4f46\u8a72\u4f7f\u7528\u8005\u662f\u5426\u6709\u6b0a\u9650\u8acb\u6c42\u4ec0\u9ebc\u8cc7\u6e90\uff0c\u5c31\u662f\u7531\u6388\u6b0a\u6c7a\u5b9a\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"\u6388\u6b0a\u6a5f\u5236",children:"\u6388\u6b0a\u6a5f\u5236"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"RBAC\uff08Role-Based Access Control\uff0c\u57fa\u65bc\u89d2\u8272\u7684\u5b58\u53d6\u63a7\u5236\uff09"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u900f\u904e ",(0,i.jsx)(e.strong,{children:"Role"}),"\uff08\u89d2\u8272\uff09\u548c ",(0,i.jsx)(e.strong,{children:"RoleBinding"}),"\uff08\u89d2\u8272\u7d81\u5b9a\uff09\u4f86\u7ba1\u7406\u6b0a\u9650\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"ClusterRole"})," \u8207 ",(0,i.jsx)(e.strong,{children:"ClusterRoleBinding"})," \u9069\u7528\u65bc\u5168\u57df\u7bc4\u570d\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Role"})," \u8207 ",(0,i.jsx)(e.strong,{children:"RoleBinding"})," \u9650\u5236\u5728\u7279\u5b9a\u547d\u540d\u7a7a\u9593\u5167\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"ABAC\uff08Attribute-Based Access Control\uff0c\u57fa\u65bc\u5c6c\u6027\u7684\u5b58\u53d6\u63a7\u5236\uff09"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u63a1\u7528\u7b56\u7565\u6587\u4ef6\u4f86\u5b9a\u7fa9\u5b58\u53d6\u898f\u5247\u3002"}),"\n",(0,i.jsxs)(e.li,{children:["\u9700\u8981\u555f\u7528 ",(0,i.jsx)(e.code,{children:"--authorization-policy-file"})," \u53c3\u6578\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Webhook \u6388\u6b0a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u900f\u904e Webhook \u5c07\u6388\u6b0a\u6c7a\u7b56\u59d4\u6d3e\u7d66\u5916\u90e8\u7cfb\u7d71\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Node \u6388\u6b0a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7528\u65bc\u63a7\u5236\u7bc0\u9ede\uff08Node\uff09\u5c64\u7d1a\u7684\u8a2a\u554f\u6b0a\u9650\uff0c\u78ba\u4fdd\u7bc0\u9ede\u53ea\u80fd\u57f7\u884c\u6388\u6b0a\u7684\u64cd\u4f5c\u3002"}),"\n",(0,i.jsxs)(e.li,{children:["\u4e3b\u8981\u4f9d\u8cf4\u65bc ",(0,i.jsx)(e.strong,{children:"NodeRestriction"}),"\uff0c\u78ba\u4fdd\u53ea\u5141\u8a31\u7bc0\u9ede\u672c\u8eab\u5c0d\u7279\u5b9a\u8cc7\u6e90\uff08\u4f8b\u5982\uff0cPod\uff09\u9032\u884c\u64cd\u4f5c\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u67e5\u770b\u662f\u5426\u6709\u6b0a\u9650",children:"\u67e5\u770b\u662f\u5426\u6709\u6b0a\u9650"}),"\n",(0,i.jsxs)(e.p,{children:["\u6211\u5011\u53ef\u4ee5\u901a\u904e",(0,i.jsx)(e.code,{children:"auth can-i"}),"\u6307\u4ee4\uff0c\u4f86\u5feb\u901f\u67e5\u770b API \u662f\u5426\u6709\u6b0a\u9650\u57f7\u884c\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"kubectl.exe auth can-i create deployments --namespace default\n---\n\nyes\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u51c6\u5165\u63a7\u5236admission-control",children:"\u51c6\u5165\u63a7\u5236\uff08Admission Control\uff09"}),"\n",(0,i.jsx)(e.p,{children:"\u51c6\u5165\u63a7\u5236\uff08Admission Control\uff09\u662f\u5728\u8eab\u4efd\u9a57\u8b49\u8207\u6388\u6b0a\u5f8c\u7684\u984d\u5916\u5b89\u5168\u6a5f\u5236\uff0c\u80fd\u5920\u6514\u622a\u3001\u4fee\u6539\u6216\u62d2\u7d55 API \u8acb\u6c42\uff0c\u78ba\u4fdd\u53e2\u96c6\u7684\u904b\u884c\u7b26\u5408\u5b89\u5168\u7b56\u7565\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"\u51c6\u5165\u63a7\u5236\u5668",children:"\u51c6\u5165\u63a7\u5236\u5668"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"NamespaceLifecycle"}),"\uff1a\u9650\u5236\u8acb\u6c42\u50c5\u80fd\u4f5c\u7528\u65bc\u73fe\u6709\u7684\u547d\u540d\u7a7a\u9593\uff0c\u907f\u514d\u4f7f\u7528\u672a\u7d93\u6388\u6b0a\u7684\u547d\u540d\u7a7a\u9593\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"LimitRanger"}),"\uff1a\u78ba\u4fdd Pod\u3001Container\u3001PersistentVolumeClaim \u7b49\u8cc7\u6e90\u4e0d\u8d85\u51fa\u8a2d\u5b9a\u7684\u9650\u5236\u7bc4\u570d\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"ResourceQuota"}),"\uff1a\u9650\u5236\u547d\u540d\u7a7a\u9593\u5167\u53ef\u7528\u7684\u8cc7\u6e90\u6578\u91cf\uff0c\u4f8b\u5982 CPU\u3001\u8a18\u61b6\u9ad4\u8207\u5132\u5b58\u7a7a\u9593\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"PodSecurityAdmission"}),"\uff08\u53d6\u4ee3\u820a\u7248 PSP\uff09\uff1a\u6839\u64da Pod Security Standards\uff08PSS\uff09\u898f\u5247\u4f86\u9650\u5236 Pod \u4f48\u7f72\u7684\u5b89\u5168\u6027\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"ValidatingAdmissionWebhook & MutatingAdmissionWebhook"}),"\uff1a\u5141\u8a31\u900f\u904e Webhook \u4f86\u9a57\u8b49\u8207\u4fee\u6539\u8acb\u6c42\uff0c\u4f8b\u5982\u5f37\u5236\u57f7\u884c\u516c\u53f8\u5b89\u5168\u7b56\u7565\u6216\u81ea\u52d5\u88dc\u5145\u9810\u8a2d\u8a2d\u5b9a\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h3,{id:"validatingwebhookconfiguration",children:(0,i.jsx)(e.code,{children:"ValidatingWebhookConfiguration"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7528\u9014"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7528\u65bc",(0,i.jsx)(e.strong,{children:"\u9a57\u8b49"})," API \u8acb\u6c42\uff0c\u78ba\u4fdd\u8acb\u6c42\u7684\u5167\u5bb9\u7b26\u5408\u6307\u5b9a\u7684\u5b89\u5168\u898f\u7bc4\u6216\u914d\u7f6e\u8981\u6c42\u3002"]}),"\n",(0,i.jsx)(e.li,{children:"\u9019\u4e9b Webhook \u53ef\u4ee5\u6514\u622a\u4e26\u62d2\u7d55\u4e0d\u7b26\u5408\u689d\u4ef6\u7684 API \u8acb\u6c42\uff0c\u78ba\u4fdd\u53e2\u96c6\u4e2d\u7684\u8cc7\u6e90\u7b26\u5408\u9810\u671f\u7684\u6a19\u6e96\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4f5c\u7528"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u6703\u5728 ",(0,i.jsx)(e.strong,{children:"API \u8acb\u6c42"})," \u9032\u5165 Kubernetes API Server \u4e4b\u524d\u9032\u884c\u9a57\u8b49\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5982\u679c\u8acb\u6c42\u672a\u901a\u904e\u9a57\u8b49\uff0c\u6703 ",(0,i.jsx)(e.strong,{children:"\u62d2\u7d55\u8a72\u8acb\u6c42"}),"\uff0c\u4e26\u8fd4\u56de\u932f\u8aa4\u8a0a\u606f\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7bc4\u4f8b"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u9a57\u8b49\u662f\u5426\u90e8\u7f72\u7684 Pod \u7b26\u5408 ",(0,i.jsx)(e.strong,{children:"\u5b89\u5168\u6027\u898f\u7bc4"}),"\uff0c\u4f8b\u5982\u78ba\u4fdd\u5bb9\u5668\u93e1\u50cf\u4f86\u81ea\u53d7\u4fe1\u4efb\u7684\u4f86\u6e90\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5f37\u5236\u898f\u5b9a ",(0,i.jsx)(e.strong,{children:"Pod \u5fc5\u9808\u5305\u542b\u7279\u5b9a\u6a19\u7c64"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6307\u4ee4"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"kubectl.exe get validatingwebhookconfigurations\n---\n\nNAME                      WEBHOOKS   AGE\ningress-nginx-admission   1          15d\nkeda-admission            3          14h\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"mutatingwebhookconfiguration",children:(0,i.jsx)(e.code,{children:"MutatingWebhookConfiguration"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7528\u9014"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u7528\u65bc",(0,i.jsx)(e.strong,{children:"\u4fee\u6539"})," API \u8acb\u6c42\u7684\u5167\u5bb9\u3002\u7576\u8acb\u6c42\u9032\u5165 Kubernetes API Server \u4e4b\u524d\uff0cWebhook \u6703\u81ea\u52d5\u4fee\u6539\u6216\u589e\u52a0\u8cc7\u6e90\u7684\u67d0\u4e9b\u5c6c\u6027\u3002"]}),"\n",(0,i.jsx)(e.li,{children:"\u9019\u7a2e\u65b9\u5f0f\u53ef\u7528\u65bc\u81ea\u52d5\u88dc\u5145\u6216\u8abf\u6574\u8acb\u6c42\u4e2d\u7684\u8cc7\u6e90\u914d\u7f6e\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4f5c\u7528"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6703\u5728 API \u8acb\u6c42\u9032\u5165 Kubernetes API Server \u4e4b\u524d\u9032\u884c\u4fee\u6539\u3002"}),"\n",(0,i.jsx)(e.li,{children:"\u80fd\u5920\u81ea\u52d5\u5c07\u67d0\u4e9b\u9810\u8a2d\u914d\u7f6e\u6dfb\u52a0\u5230 Pod \u6216\u5176\u4ed6\u8cc7\u6e90\u4e2d\uff0c\u5f9e\u800c\u6e1b\u5c11\u4eba\u5de5\u5e72\u9810\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7bc4\u4f8b"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u81ea\u52d5\u70ba ",(0,i.jsx)(e.strong,{children:"Pod \u52a0\u4e0a\u9810\u8a2d\u6a19\u7c64"})," \u6216 ",(0,i.jsx)(e.strong,{children:"\u9810\u8a2d\u7684\u8cc7\u6e90\u9650\u5236"}),"\uff08\u5982 CPU\u3001\u8a18\u61b6\u9ad4\uff09\u3002"]}),"\n",(0,i.jsxs)(e.li,{children:["\u6ce8\u5165 ",(0,i.jsx)(e.strong,{children:"Sidecar \u5bb9\u5668"}),"\uff08\u4f8b\u5982\uff0cIstio \u6216\u76e3\u63a7\u4ee3\u7406\uff09\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6307\u4ee4"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"kubectl.exe get mutatingwebhookconfigurations\n---\n\nNAME                 WEBHOOKS   AGE\nvpa-webhook-config   1          14h\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u5be6\u4f5c\u4e00\u500b-rbac",children:"\u5be6\u4f5c\u4e00\u500b RBAC"}),"\n",(0,i.jsxs)(e.p,{children:["\u6211\u5011\u60f3\u8981\u57fa\u65bc Role \u7684\u6982\u5ff5\u4f86\u5efa\u7acb\u8a2a\u554f\u6b0a\u9650\uff0c\u7528\u4f86\u8abf\u7bc0\u4f7f\u7528\u8005\u5c0d kubernetes API Server \u7684\u8a2a\u554f\u65b9\u6cd5\uff0c\n\u4ee5\u8d85\u7d1a\u7ba1\u7406\u8005\u70ba\u4f8b\uff0c\u9019\u500b\u89d2\u8272\u8207\u700f\u89bd\u8005\u6709\u8457\u6975\u5927\u7684\u6b0a\u9650\u5dee\u8ddd\uff0c\u70ba\u4e86\u4fdd\u8b77\u5167\u90e8\u7684\u91cd\u8981\u57fa\u790e\u5efa\u8a2d\uff0c\u4e0d\u5e0c\u671b\u6bcf\u500b\u4f7f\u7528\u8457\u90fd\u53ef\u4ee5",(0,i.jsx)(e.strong,{children:"\u5efa\u7acb\u6216\u522a\u9664\u8cc7\u6e90"}),"\uff0c\n\u56e0\u6b64\u6211\u5011\u5be6\u73fe\u5c07 ",(0,i.jsx)(e.strong,{children:"\u6b0a\u9650(Permission)"})," \u7d81\u5b9a\u5728\u666e\u901a\u4f7f\u7528\u8457\u4ee5\u53ca\u670d\u52d9\u5e33\u865f\u7684\u6982\u5ff5\u4e0a\uff0c\u5c07\u8907\u96dc\u7684\u696d\u52d9\u6b0a\u9650\u505a\u8f15\u91cf\u5316\uff0c\u4e26\u9075\u5f9e\u6b0a\u9650\u6700\u5c0f\u5316\u539f\u5247\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"::: note"}),"\n",(0,i.jsx)(e.p,{children:"\u56e0\u70badocker-desktop\u6c92\u6709\u8fa6\u6cd5\u53d6\u5f97\u5167\u90e8\u7684ca\u6191\u8b49\uff0c\u56e0\u6b64\u4ee5\u4e0b\u6703\u5229\u7528VM\u5f9e\u982d\u5b89\u88dd\u4e00\u6b21kubernetes cluster\u3002"}),"\n",(0,i.jsx)(e.p,{children:":::"}),"\n",(0,i.jsx)(e.h3,{id:"\u5efa\u7acb\u4e00\u500bubuntu-vm",children:"\u5efa\u7acb\u4e00\u500bUbuntu VM"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u9996\u5148\u6211\u5011\u4f7f\u7528"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u5efa\u7acb\u4e00\u500b\u4ee5-x509-\u6191\u8b49\u9a57\u8b49\u7684\u666e\u901a\u4f7f\u7528\u8005",children:"\u5efa\u7acb\u4e00\u500b\u4ee5 X.509 \u6191\u8b49\u9a57\u8b49\u7684\u666e\u901a\u4f7f\u7528\u8005"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u9996\u5148\u6211\u5011\u9700\u8981\u4ee5\u81ea\u8eab\u7684 kubernetes \u4f5c\u70ba CA \u767c\u9001\u65b9\uff0c\u4f86\u767c\u9001\u4e00\u500b CA \u6191\u8b49\uff0c\u4e26\u7522\u751f\u4e00\u7d44\u79c1\u9470\uff0c\u540d\u7a31\u53eb\u505a pod-viewer.key\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"openssl.exe genrsa -out pod-viewer.key 2048\n---\n\nGenerating RSA private key, 2048 bit long modulus (2 primes)\n...................................................+++++\n...............................................................................................+++++\ne is 65537 (0x010001)\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsxs)(e.li,{children:["\u6211\u5011\u900f\u904e pod-viewer.key \u53bb\u7522\u751f CSR (\u6191\u8b49\u7c3d\u540d\u8acb\u6c42)\uff0c\u6a94\u6848\u540d\u7a31\u53eb\u505a pod-viewer.csr\uff0ckubernetes \u6703\u4f7f\u7528\u6191\u8b49\u4e2d\u7684 ",(0,i.jsx)(e.strong,{children:"subject"})," \u7684\u901a\u7528\u540d\u7a31(Common Name)\u6b04\u4f4d\u4f86\u78ba\u5b9a\u4f7f\u7528\u8005\u540d\u7a31\u3002"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'openssl.exe req -new -key pod-viewer.key -out pod-viewer.csr -subj "/CN=pod-viewer/O=app" -config "C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\Common7\\IDE\\CommonExtensions\\Microsoft\\TeamFoundation\\Team Explorer\\Git\\mingw32\\ssl\\openssl.cnf"\n'})}),"\n",(0,i.jsxs)(e.ol,{start:"3",children:["\n",(0,i.jsx)(e.li,{children:"\u6709\u4e86 CSR\uff0c\u6211\u5011\u5c31\u53ef\u4ee5\u628a\u5b83\u4ea4\u7d66\u53e2\u96c6\u7ba1\u7406\u8005(\u9019\u88e1\u4e5f\u662f\u6211\u5011)\u900f\u904e\u53e2\u96c6 CA \u7c3d\u7f72\u5ba2\u6236\u7aef\u6191\u8b49\u3002\u56e0\u6b64\u6211\u5011\u5230 docker-desktop \u7684\u7bc0\u9ede\u4e2d\uff0c\u5c07 CA \u6839\u6191\u8b49\u53d6\u51fa\u4f86\uff0c\u70ba\u4e86\u4f86\u7c3d\u5c6c\u6240\u6709\u9700\u8981\u901a\u8a0a\u7684\u6191\u8b49\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash"})})]})}function x(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(h,{...n})}):h(n)}},96300:(n,e,s)=>{s.d(e,{A:()=>i});const i=s.p+"assets/images/Triple-A-3dd97ad505c5e7dd05c3bc60486e65e2.svg"},28453:(n,e,s)=>{s.d(e,{R:()=>o,x:()=>c});var i=s(96540);const r={},l=i.createContext(r);function o(n){const e=i.useContext(l);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:o(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);