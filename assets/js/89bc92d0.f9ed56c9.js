"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[7854],{19684:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>o,contentTitle:()=>d,default:()=>a,frontMatter:()=>r,metadata:()=>t,toc:()=>c});var s=i(74848),l=i(28453);const r={},d="Advanced - Pod Lifecycle",t={id:"notes/kubernetes-basics/advanced-pod-lifecycle",title:"Advanced - Pod Lifecycle",description:"\u5728 Kubernetes \u4e2d\uff0cPod \u662f\u6700\u5c0f\u7684\u53ef\u90e8\u7f72\u55ae\u4f4d\uff0c\u5b83\u4ee3\u8868\u4e00\u7d44\u5bb9\u5668\u7684\u96c6\u5408\u3002",source:"@site/docs/notes/kubernetes-basics/11-advanced-pod-lifecycle.mdx",sourceDirName:"notes/kubernetes-basics",slug:"/notes/kubernetes-basics/advanced-pod-lifecycle",permalink:"/docs/notes/kubernetes-basics/advanced-pod-lifecycle",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:11,frontMatter:{},sidebar:"notesSidebar",previous:{title:"Advanced - Ingress",permalink:"/docs/notes/kubernetes-basics/advanced-ingress"},next:{title:"Advanced - Kubectl",permalink:"/docs/notes/kubernetes-basics/advanced-kubectl"}},o={},c=[{value:"Pod Lifecycle",id:"pod-lifecycle",level:2},{value:"Pod Phase (\u968e\u6bb5)",id:"pod-phase-\u968e\u6bb5",level:2},{value:"Restart Policies",id:"restart-policies",level:2},{value:"\u63a7\u5236\u5668\u8207\u91cd\u555f\u7b56\u7565",id:"\u63a7\u5236\u5668\u8207\u91cd\u555f\u7b56\u7565",level:3},{value:"\u7bc4\u4f8b",id:"\u7bc4\u4f8b",level:3},{value:"Container Types",id:"container-types",level:2},{value:"Main Container",id:"main-container",level:3},{value:"Init Container",id:"init-container",level:3},{value:"\u7bc4\u4f8b",id:"\u7bc4\u4f8b-1",level:3},{value:"Hooks: Post Start &amp; Pre Stop",id:"hooks-post-start--pre-stop",level:2},{value:"Post Start Hook",id:"post-start-hook",level:3},{value:"Pre Stop Hook",id:"pre-stop-hook",level:3},{value:"\u7bc4\u4f8b",id:"\u7bc4\u4f8b-2",level:3},{value:"Probes \uff08\u63a2\u91dd\uff09",id:"probes-\u63a2\u91dd",level:2},{value:"\u5e38\u898b\u7684\u6aa2\u67e5\u65b9\u5f0f",id:"\u5e38\u898b\u7684\u6aa2\u67e5\u65b9\u5f0f",level:3},{value:"Liveness Probe",id:"liveness-probe",level:3},{value:"Readiness Probe",id:"readiness-probe",level:3},{value:"Startup Probe",id:"startup-probe",level:3},{value:"\u63a2\u91dd\u6bd4\u8f03",id:"\u63a2\u91dd\u6bd4\u8f03",level:3},{value:"\u7bc4\u4f8b",id:"\u7bc4\u4f8b-3",level:3},{value:"\u7e3d\u7d50",id:"\u7e3d\u7d50",level:2}];function h(n){const e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"advanced---pod-lifecycle",children:"Advanced - Pod Lifecycle"})}),"\n",(0,s.jsx)(e.p,{children:"\u5728 Kubernetes \u4e2d\uff0cPod \u662f\u6700\u5c0f\u7684\u53ef\u90e8\u7f72\u55ae\u4f4d\uff0c\u5b83\u4ee3\u8868\u4e00\u7d44\u5bb9\u5668\u7684\u96c6\u5408\u3002\nPod \u7684\u751f\u547d\u9031\u671f\u5305\u542b\u591a\u500b\u968e\u6bb5\uff0c\u6bcf\u500b\u968e\u6bb5\u90fd\u53cd\u6620\u4e86 Pod \u7684\u72c0\u614b\u548c\u884c\u70ba\u3002\n\u4ee5\u4e0b\u5c07\u4ecb\u7d39 Pod \u7684\u751f\u547d\u9031\u671f\u3001\u4e3b\u8981\u7684\u5bb9\u5668\u985e\u578b\u4ee5\u53ca\u76f8\u95dc\u7684\u63a2\u91dd\uff08Probes\uff09\u3002"}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"pod-lifecycle",children:"Pod Lifecycle"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"pod_lifecycle_1",src:i(4658).A+"",width:"511",height:"391"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"pod_lifecycle_2",src:i(70049).A+"",width:"737",height:"401"})}),"\n",(0,s.jsx)(e.p,{children:"Pod \u7684\u751f\u547d\u9031\u671f\u4e2d\u6709\u4ee5\u4e0b\u91cd\u8981\u7684\u90e8\u5206\uff1a"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Init Container (\u521d\u59cb\u5316\u5bb9\u5668)"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Init Container \u662f\u5728 Main Container \u555f\u52d5\u4e4b\u524d\u57f7\u884c\u7684\u7279\u6b8a\u5bb9\u5668\uff0c\u8ca0\u8cac\u5b8c\u6210\u521d\u59cb\u5316\u4efb\u52d9\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u9019\u4e9b\u4efb\u52d9\u5305\u62ec\u6aa2\u67e5\u689d\u4ef6\u662f\u5426\u6eff\u8db3\u3001\u6e96\u5099\u5fc5\u8981\u7684\u8cc7\u6e90\uff08\u5982\u914d\u7f6e\u6587\u4ef6\u6216\u6578\u64da\u521d\u59cb\u5316\uff09\u3002"}),"\n",(0,s.jsx)(e.li,{children:"Init Container \u5fc5\u9808\u57f7\u884c\u6210\u529f\uff0c\u624d\u80fd\u555f\u52d5\u5f8c\u7e8c\u7684 Main Container\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Main Container (\u4e3b\u5bb9\u5668)"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Main Container \u662f Pod \u7684\u6838\u5fc3\uff0c\u57f7\u884c\u61c9\u7528\u7a0b\u5e8f\u7684\u4e3b\u8981\u5de5\u4f5c\u8ca0\u8f09\u3002"}),"\n",(0,s.jsx)(e.li,{children:"Pod \u901a\u5e38\u81f3\u5c11\u5305\u542b\u4e00\u500b Main Container\uff0c\u8ca0\u8cac\u63d0\u4f9b\u4e3b\u8981\u7684\u670d\u52d9\u6216\u57f7\u884c\u4efb\u52d9\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Post Start / Pre Stop Hook (\u751f\u547d\u9031\u671f\u9264)"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Kubernetes \u63d0\u4f9b\u4e86\u5bb9\u5668\u7d1a\u5225\u7684\u9264\u5b50\uff0c\u7528\u65bc\u5728\u5bb9\u5668\u555f\u52d5\u5f8c\u6216\u7d42\u6b62\u524d\u57f7\u884c\u4e00\u4e9b\u4efb\u52d9\u3002"}),"\n",(0,s.jsxs)(e.li,{children:["Post Start Hook:","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5728\u5bb9\u5668\u555f\u52d5\u5f8c\u7acb\u5373\u57f7\u884c\uff0c\u7528\u65bc\u57f7\u884c\u521d\u59cb\u5316\u64cd\u4f5c\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Pre Stop Hook:","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5728\u5bb9\u5668\u7d42\u6b62\u524d\u57f7\u884c\uff0c\u7528\u65bc\u6e05\u7406\u8cc7\u6e90\u6216\u57f7\u884c\u512a\u96c5\u95dc\u9589\u64cd\u4f5c\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Liveness / Readiness Probe (\u5065\u5eb7\u6aa2\u67e5\u6a5f\u5236)"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u63a2\u91dd\u662f\u7528\u65bc\u76e3\u63a7\u5bb9\u5668\u5065\u5eb7\u72c0\u614b\u7684\u6a5f\u5236\uff0c\u78ba\u4fdd\u61c9\u7528\u7a69\u5b9a\u6027\u548c\u9ad8\u53ef\u7528\u6027\u3002"}),"\n",(0,s.jsxs)(e.li,{children:["Liveness Probe","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7528\u65bc\u6aa2\u67e5\u5bb9\u5668\u662f\u5426\u4ecd\u7136\u5b58\u6d3b\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u5982\u679c\u6aa2\u67e5\u5931\u6557\uff0cKubernetes \u6703\u81ea\u52d5\u91cd\u555f\u8a72\u5bb9\u5668\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Readiness Probe","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7528\u65bc\u6aa2\u67e5\u5bb9\u5668\u662f\u5426\u6e96\u5099\u597d\u63a5\u53d7\u6d41\u91cf\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u5982\u679c\u6aa2\u67e5\u5931\u6557\uff0cKubernetes \u6703\u5f9e\u8a72\u5bb9\u5668\u7684\u670d\u52d9\u7aef\u9ede\u4e2d\u79fb\u9664\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"pod-phase-\u968e\u6bb5",children:"Pod Phase (\u968e\u6bb5)"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"pod_phase",src:i(17947).A+"",width:"971",height:"235"})}),"\n",(0,s.jsx)(e.p,{children:"Pod \u53ef\u4ee5\u5206\u70ba\u4ee5\u4e0b\u4e3b\u8981\u968e\u6bb5\uff1a"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Pending"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7576 Pod \u88ab\u5275\u5efa\u5f8c\uff0c\u9032\u5165 Pending \u72c0\u614b\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u5728\u9019\u500b\u968e\u6bb5\uff0cKubernetes \u6b63\u5728\u5c0b\u627e\u9069\u5408\u7684\u7bc0\u9ede\uff08Node\uff09\u4f86\u8abf\u5ea6 Pod\uff0c\u4e26\u62c9\u53d6\u6240\u9700\u7684\u5bb9\u5668\u6620\u50cf\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Running"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7576 Pod \u5df2\u88ab\u8abf\u5ea6\u5230\u67d0\u500b\u7bc0\u9ede\uff0c\u4e14\u6240\u6709\u7684\u5bb9\u5668\u90fd\u6210\u529f\u555f\u52d5\u6642\uff0cPod \u9032\u5165 Running \u72c0\u614b\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u6b64\u6642\uff0cPod \u958b\u59cb\u57f7\u884c\u5176\u5b9a\u7fa9\u7684\u5de5\u4f5c\u8ca0\u8f09\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Succeeded"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7576 Pod \u4e2d\u6240\u6709\u7684\u5bb9\u5668\u90fd\u6b63\u5e38\u57f7\u884c\u5b8c\u7562\u4e26\u6210\u529f\u9000\u51fa\uff0cPod \u9032\u5165 Succeeded \u72c0\u614b\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u9019\u901a\u5e38\u767c\u751f\u65bc\u57f7\u884c\u4e00\u6b21\u6027\u4efb\u52d9\u7684 Pod\uff0c\u4f8b\u5982\u6279\u6b21\u4f5c\u696d\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Failed"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5982\u679c Pod \u4e2d\u4efb\u4f55\u5bb9\u5668\u7570\u5e38\u9000\u51fa\u4e14\u672a\u88ab\u91cd\u555f\u7b56\u7565\u6062\u5fa9\uff0cPod \u9032\u5165 Failed \u72c0\u614b\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Unknown"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7576 Kubernetes \u7121\u6cd5\u8207\u57f7\u884c Pod \u7684\u7bc0\u9ede\u901a\u8a0a\u6642\uff0cPod \u9032\u5165 Unknown \u72c0\u614b\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"restart-policies",children:"Restart Policies"}),"\n",(0,s.jsx)(e.p,{children:"Pod \u652f\u63f4\u4e09\u7a2e\u91cd\u555f\u7b56\u7565\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Always"}),": \u7121\u8ad6\u9000\u51fa\u72c0\u614b\u5982\u4f55\uff0c\u7e3d\u662f\u91cd\u555f\u5bb9\u5668\uff08\u9810\u8a2d\u503c\uff09\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"OnFailure"}),": \u53ea\u6709\u5728\u5bb9\u5668\u7570\u5e38\u9000\u51fa\u6642\u624d\u91cd\u555f\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Never"}),": \u5bb9\u5668\u9000\u51fa\u5f8c\u4e0d\u91cd\u555f\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"restartPolicy"})," \u50c5\u9069\u7528\u65bc kubelet \u5728\u540c\u4e00\u7bc0\u9ede\u4e0a\u91cd\u65b0\u555f\u52d5\u5bb9\u5668\u3002\nKubelet \u5c07\u6839\u64da\u6307\u6578\u589e\u52a0\u7684\u5ef6\u9072(10s, 20s, 40s)\u91cd\u65b0\u555f\u52d5\u4e0d\u5065\u5eb7\u7684\u5bb9\u5668\uff0c\u5ef6\u9072\u4e0a\u9650\u70ba 5 \u5206\u9418\uff0c\u4e26\u5728\u5bb9\u5668\u6210\u529f\u57f7\u884c 10 \u5206\u9418\u5f8c\u91cd\u7f6e\u5ef6\u9072\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u63a7\u5236\u5668\u8207\u91cd\u555f\u7b56\u7565",children:"\u63a7\u5236\u5668\u8207\u91cd\u555f\u7b56\u7565"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Job"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u7528\u65bc\u4e00\u6b21\u6027\u4efb\u52d9\uff0c\u4f8b\u5982\u6279\u91cf\u8a08\u7b97\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u4efb\u52d9\u7d50\u675f\u5f8c\uff0cPod \u6703\u88ab\u6b64\u985e\u63a7\u5236\u5668\u6e05\u9664\u3002"}),"\n",(0,s.jsxs)(e.li,{children:["\u652f\u63f4\u7684\u91cd\u555f\u7b56\u7565\u70ba ",(0,s.jsx)(e.code,{children:"OnFailure"})," \u6216 ",(0,s.jsx)(e.code,{children:"Never"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Replication Controller / ReplicaSet / Deployment"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u9019\u4e9b\u63a7\u5236\u5668\u65e8\u5728\u78ba\u4fdd Pod \u6301\u7e8c\u904b\u884c\u3002"}),"\n",(0,s.jsxs)(e.li,{children:["\u50c5\u652f\u63f4 ",(0,s.jsx)(e.code,{children:"Always"})," \u4f5c\u70ba\u91cd\u555f\u7b56\u7565\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"DaemonSet"}),":","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5728\u6bcf\u500b\u7bc0\u9ede\u4e0a\u53ea\u6703\u904b\u884c\u4e00\u500b Pod\u3002"}),"\n",(0,s.jsxs)(e.li,{children:["\u91cd\u555f\u7b56\u7565\u5fc5\u9808\u662f ",(0,s.jsx)(e.code,{children:"Always"}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u7bc4\u4f8b",children:"\u7bc4\u4f8b"}),"\n",(0,s.jsx)(e.p,{children:"\u5c31\u50cf\u6211\u5011\u4e4b\u524d\u5efa\u7acb Deployment \u4e00\u6a23\uff0c\u4e3b\u8981\u662f\u70ba\u4e86\u78ba\u4fdd Pod \u6301\u7e8c\u904b\u884c\uff0c\u6240\u4ee5\u91cd\u555f\u7b56\u7565\u8a2d\u5b9a\u70ba Always\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",metastring:'title="always_deployment.yaml"',children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: v1-deployment\n  labels:\n    type: demo-v1\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      type: demo-v1\n  template:\n    metadata:\n      labels:\n        type: demo-v1\n    spec:\n      // highlight-next-line\n      restartPolicy: Always\n      containers:\n        - name: v1\n          image: hello-world:v1.0.0\n          // highlight-next-line\n          imagePullPolicy: Always\n          ports:\n            - containerPort: 8080\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"container-types",children:"Container Types"}),"\n",(0,s.jsx)(e.p,{children:"\u5728 Pod \u4e2d\uff0c\u53ef\u4ee5\u5305\u542b\u591a\u7a2e\u985e\u578b\u7684\u5bb9\u5668\uff0c\u6bcf\u7a2e\u985e\u578b\u90fd\u6709\u5176\u7279\u5b9a\u7684\u7528\u9014\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"main-container",children:"Main Container"}),"\n",(0,s.jsx)(e.p,{children:"Main Container \u662f Pod \u7684\u6838\u5fc3\uff0c\u8ca0\u8cac\u57f7\u884c\u61c9\u7528\u7a0b\u5e8f\u7684\u4e3b\u8981\u5de5\u4f5c\u8ca0\u8f09\u3002\u901a\u5e38\uff0cPod \u81f3\u5c11\u5305\u542b\u4e00\u500b Main Container\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"init-container",children:"Init Container"}),"\n",(0,s.jsx)(e.p,{children:"Init Container \u662f\u5728 Main Container \u555f\u52d5\u4e4b\u524d\u57f7\u884c\u7684\u7279\u6b8a\u5bb9\u5668\u3002\u5b83\u5011\u7684\u4f5c\u7528\u5305\u62ec\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u7b49\u5f85\u5176\u4ed6\u670d\u52d9\u6e96\u5099\u597d"}),"\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u9019\u7a2e\u4f5c\u6cd5\u7279\u5225\u9069\u7528\u65bc",(0,s.jsx)(e.strong,{children:"\u89e3\u6c7a\u670d\u52d9\u5668\u4e4b\u9593\u7684\u4f9d\u8cf4"}),"\uff0c\u4f8b\u5982\u6709\u4e00\u500b\u61c9\u7528\u9700\u8981\u8cc7\u6599\u5eab\u7684\u670d\u52d9\uff0c\u4f46\u555f\u52d5\u4e3b\u670d\u52d9\u7684\u6642\u5019\u4e26\u4e0d\u80fd\u4fdd\u8b49\u88ab\u4f9d\u8cf4\u7684\u8cc7\u6599\u5eab\u662f\u5426\u5c31\u7dd2\uff0c\n\u9019\u500b\u6642\u5019\u6211\u5011\u53ef\u4ee5\u7c21\u55ae\u4f7f\u7528\u4e00\u500b Init Container\uff0c\u4f86\u76e3\u6e2c\u8cc7\u6599\u5eab\u670d\u52d9\u662f\u5426 OK\uff0c\u78ba\u8a8d OK \u5c31\u53ef\u4ee5\u9000\u51fa\uff0c\u4e26\u4ea4\u7531\u4e3b\u670d\u52d9\u958b\u59cb\u555f\u52d5\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u57f7\u884c\u521d\u59cb\u5316\u4efb\u52d9"}),"\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u6bd4\u5982\u53e2\u96c6\u6aa2\u6e2c\u6240\u6709\u5df2\u7d93\u5b58\u5728\u7684\u6210\u54e1\u7bc0\u9ede\uff0c\u70ba\u4e3b\u5bb9\u5668\u6e96\u5099\u597d\u53e2\u96c6\u7684\u8a2d\u5b9a\u8cc7\u8a0a\uff0c\u9019\u6a23\u4e3b\u5bb9\u5668\u555f\u52d5\u5f8c\u5c31\u80fd\u7528\u9019\u4e9b\u8a2d\u5b9a\u52a0\u5165\u53e2\u96c6\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.admonition,{type:"tip",children:(0,s.jsx)(e.p,{children:"Init Container \u5fc5\u9808\u57f7\u884c\u6210\u529f\uff0c\u624d\u80fd\u555f\u52d5 Main Container\u3002"})}),"\n",(0,s.jsx)(e.h3,{id:"\u7bc4\u4f8b-1",children:"\u7bc4\u4f8b"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"\u9996\u5148\u6211\u5011\u60f3\u5be6\u73fe\u4e00\u500b google \u9996\u9801\u7684\u670d\u52d9\uff0c\u6211\u5011\u53ef\u4ee5\u900f\u904e InitContainers \u4f86\u6293\u53d6\u9996\u9801\u7576\u6210\u6211\u5011\u7684\u9996\u9801\uff0c\n\u7576\u4ed6\u6210\u529f\u6293\u53d6\u4e4b\u5f8c\u4e26\u7522\u51fa index.html \u5f8c\u6703\u96a8\u5373\u9000\u51fa\uff0c\u518d\u900f\u904e volume \u5c07\u8cc7\u6599\u593e\u639b\u8f09\u5230\u4e3b\u5bb9\u5668\uff0c\u5be6\u73fe\u521d\u59cb\u5316\u4e26\u5171\u4eab\u8cc7\u6e90\uff0c\u6700\u5f8c\u8b93 nginx \u670d\u52d9\u555f\u52d5\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",metastring:'title="init-container.yaml"',children:'apiVersion: v1\nkind: Pod\nmetadata:\n  name: init-demo\nspec:\n  volumes:\n  - name: workdir\n    emptyDir: {}\n\n  // highlight-start\n  initContainers:\n  - name: install\n    image: busybox\n    command: # \u6293\u53d6google\u9996\u9801\u7576\u4f5cindex.html\n    - wget\n    - "-O"\n    - "/work-dir/index.html"\n    - https://www.google.com\n    volumeMounts: # \u900f\u904evolume\u639b\u8f09\u5230\u4e3b\u5bb9\u5668\u4e0a\n    - name: workdir\n      mountPath: /work-dir\n  // highlight-end\n\n  containers:\n  - name: nginx\n    image: nginx\n    ports:\n    - containerPort: 80\n    volumeMounts: # \u900f\u904evolume\u6211\u5011\u53ef\u4ee5\u8b80\u5230init container\u6293\u5230\u7684\u6771\u897f\n    - name: workdir\n      mountPath: /usr/share/nginx/html\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"hooks-post-start--pre-stop",children:"Hooks: Post Start & Pre Stop"}),"\n",(0,s.jsx)(e.p,{children:"Pod \u652f\u63f4\u5169\u7a2e\u5bb9\u5668\u7d1a\u5225\u7684\u9264\u5b50\uff08Hooks\uff09\uff0c\u4ed6\u5011\u662f\u5728\u521d\u59cb\u5316\u5bb9\u5668\u57f7\u884c\u5b8c\u7562\u5f8c\u7531 kubelet \u767c\u8d77\uff0c\u7528\u65bc\u5728\u5bb9\u5668\u555f\u52d5\u6216\u505c\u6b62\u6642\u57f7\u884c\u4efb\u52d9\u3002"}),"\n",(0,s.jsx)(e.h3,{id:"post-start-hook",children:"Post Start Hook"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u9019\u500b\u9264\u5b50\u5728\u5bb9\u5668\u5efa\u7acb\u5f8c\u7acb\u523b\u57f7\u884c\u3002\u4f46\u662f\u4e26\u4e0d\u80fd\u4fdd\u8b49\u9264\u5b50\u5c07\u5728\u5bb9\u5668 Enterpoint(\u5165\u53e3\u9ede)\u4e4b\u524d\u904b\u884c\uff0c\u56e0\u70ba\u4ed6\u4e0d\u6703\u50b3\u905e\u4efb\u4f55\u53c3\u6578\u7d66\u4f5c\u696d\u7a0b\u5e8f\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u4e3b\u8981\u7528\u65bc\u8cc7\u6e90\u90e8\u5c6c\u3001\u74b0\u5883\u6e96\u5099\u7b49\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u4e0d\u904e\u9700\u8981\u6ce8\u610f\u5982\u679c\u9264\u5b50\u82b1\u8cbb\u592a\u591a\u6642\u9593\uff0c\u4ee5\u81f3\u65bc\u4e0d\u80fd\u904b\u884c\u6216\u8005\u9047\u5230\u554f\u984c\uff0c\u5bb9\u5668\u5c07\u4e0d\u80fd\u9054\u5230 Running \u72c0\u614b\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"pre-stop-hook",children:"Pre Stop Hook"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u662f\u4e00\u500b\u5728\u5bb9\u5668\u7d50\u675f\u904b\u884c\u524d\u7acb\u523b\u88ab\u547c\u53eb\u7684\u9264\u5b50\u3002\u4ed6\u662f\u540c\u6b65\u7684\uff0c\u53ef\u4ee5\u5ef6\u9072\u7d42\u6b62\u904e\u7a0b\uff0c\u5fc5\u9808\u5728\u5bb9\u5668\u88ab\u6b63\u5f0f\u7d42\u6b62\u524d\u5b8c\u6210\u57f7\u884c\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u4e3b\u8981\u7528\u65bc\u512a\u96c5\u7684\u95dc\u9589\u61c9\u7528\u3001\u901a\u77e5\u5176\u4ed6\u7cfb\u7d71\u7b49\u3002"}),"\n",(0,s.jsx)(e.li,{children:"\u5982\u679c\u9264\u5b50\u5728\u57f7\u884c\u671f\u9593\u639b\u8d77\uff0cPod \u968e\u6bb5\u5c07\u505c\u7559\u5728 Running \u72c0\u614b\uff0c\u4e26\u4e14\u6c38\u9060\u4e0d\u6703\u9054\u5230 Failed \u72c0\u614b\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"\u7bc4\u4f8b-2",children:"\u7bc4\u4f8b"}),"\n",(0,s.jsx)(e.p,{children:"\u4ee5\u4e0b\u7684\u4f8b\u5b50\u5c31\u662f\u5728 Pod \u5275\u7acb\u548c\u522a\u9664\u6642\u6703 echo \u51fa\u4f86\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",metastring:'title=""',children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: lifecycle-demo\nspec:\n  containers:\n  - name: lifecycle-demo-container\n    image: nginx\n    // highlight-start\n    lifecycle:\n      postStart:\n        exec:\n          command: ['/bin/sh', '-c', 'echo Container started']\n      preStop:\n        exec:\n          command: ['/bin/sh', '-c', 'echo Container stopping']\n    // highlight-end\n"})}),"\n",(0,s.jsx)(e.h2,{id:"probes-\u63a2\u91dd",children:"Probes \uff08\u63a2\u91dd\uff09"}),"\n",(0,s.jsxs)(e.p,{children:["\u70ba\u4e86\u78ba\u4fdd\u61c9\u7528\u7684\u7a69\u5b9a\u6027\uff0cKubernetes \u63d0\u4f9b\u4e86 ",(0,s.jsx)(e.strong,{children:"Liveness Probe"}),"\u3001",(0,s.jsx)(e.strong,{children:"Readiness Probe"})," \u548c ",(0,s.jsx)(e.strong,{children:"Startup Probe"}),"\uff0c\u7528\u65bc\u76e3\u63a7\u548c\u7ba1\u7406 Pod \u4e2d\u7684\u5bb9\u5668\u72c0\u614b\uff0c\u5982\u679c\u51fa\u73fe\u7570\u5e38\u5c07\u900f\u904e\u81ea\u6211\u6aa2\u6e2c\u548c\u4fee\u5fa9\u4f86\u907f\u514d\u628a\u6d41\u91cf\u5c0e\u5230\u4e0d\u5065\u5eb7\u7684 Pod\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u5e38\u898b\u7684\u6aa2\u67e5\u65b9\u5f0f",children:"\u5e38\u898b\u7684\u6aa2\u67e5\u65b9\u5f0f"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Exec \u6aa2\u67e5"}),"\uff1a\u57f7\u884c\u5bb9\u5668\u5167\u7684\u4e00\u500b\u547d\u4ee4\uff0c\u4e26\u6aa2\u67e5\u8fd4\u56de\u503c\uff0c\u56de\u50b3 0 \u4ee3\u8868\u6210\u529f\uff0c\u5176\u9918\u7686\u70ba\u5931\u6557\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"TCP \u6aa2\u67e5"}),"\uff1a\u5617\u8a66\u9023\u63a5\u5230\u5bb9\u5668\u7684\u67d0\u500b TCP \u57e0\uff0c\u9023\u63a5\u57e0\u958b\u555f\u4ee3\u8868\u6210\u529f\uff0c\u5426\u5247\u4ee3\u8868\u5931\u6557\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"HTTP \u6aa2\u67e5"}),"\uff1a\u767c\u9001 HTTP \u8acb\u6c42\u5230\u5bb9\u5668\u5167\u7684\u6307\u5b9a\u7aef\u9ede\uff0c\u72c0\u614b\u5927\u65bc\u7b49\u65bc 200 \u4e14\u5c0f\u65bc 400 \u7686\u70ba\u6210\u529f\uff0c\u5176\u9918\u7686\u5931\u6557\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"gRPC \u6aa2\u67e5"}),"\uff1a\u53ef\u4ee5\u900f\u904e\u5c0d\u5bb9\u5668 IP \u70ba\u7d19\u4e0a\u7684\u6307\u5b9a\u9023\u63a5\u57e0\u767c\u8d77 gRPC \u8acb\u6c42\uff0c\u9019\u88e1\u9700\u8981\u6ce8\u610f\u7684\u662f\u4f7f\u7528 gRPC \u4f5c\u70ba action \u6642\u9700\u8981\u7279\u5225\u6307\u5b9a\u9023\u63a5\u57e0\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"liveness-probe",children:"Liveness Probe"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Liveness Probe"})," \u7528\u65bc\u6aa2\u67e5\u5bb9\u5668\u662f\u5426\u4ecd\u7136\u5b58\u6d3b\u3002\u5982\u679c\u6aa2\u67e5\u5931\u6557\uff0cKubernetes \u5c07\u91cd\u555f\u8a72\u5bb9\u5668\uff0c\u907f\u514d\u56e0\u61c9\u7528\u505c\u6eef\u800c\u5c0e\u81f4\u670d\u52d9\u4e0d\u53ef\u7528\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"readiness-probe",children:"Readiness Probe"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Readiness Probe"})," \u7528\u65bc\u6aa2\u67e5\u5bb9\u5668\u662f\u5426\u5df2\u6e96\u5099\u597d\u63a5\u53d7\u6d41\u91cf\u3002\u5982\u679c\u6aa2\u67e5\u5931\u6557\uff0cKubernetes \u5c07\u5f9e\u8a72\u5bb9\u5668\u7684\u670d\u52d9\u7aef\u9ede\u4e2d\u79fb\u9664\uff0c\u78ba\u4fdd\u6d41\u91cf\u53ea\u5206\u914d\u7d66\u53ef\u7528\u7684\u5bb9\u5668\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"startup-probe",children:"Startup Probe"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Startup Probe"})," \u7528\u65bc\u6aa2\u67e5\u5bb9\u5668\u7684\u555f\u52d5\u72c0\u614b\uff0c\u9069\u7528\u65bc\u9700\u8981\u8f03\u9577\u6642\u9593\u555f\u52d5\u7684\u61c9\u7528\u7a0b\u5f0f\u3002\u8a72\u63a2\u91dd\u5141\u8a31 Kubernetes \u5728\u555f\u52d5\u671f\u9593\u7d66\u4e88\u5bb9\u5668\u66f4\u591a\u6642\u9593\uff0c\u907f\u514d\u904e\u65e9\u5224\u5b9a\u70ba\u5931\u6557\u4e26\u9032\u884c\u91cd\u555f\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"\u63a2\u91dd\u6bd4\u8f03",children:"\u63a2\u91dd\u6bd4\u8f03"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:(0,s.jsx)(e.strong,{children:"\u63a2\u91dd\u985e\u578b"})}),(0,s.jsx)(e.th,{children:(0,s.jsx)(e.strong,{children:"\u529f\u80fd"})}),(0,s.jsx)(e.th,{children:(0,s.jsx)(e.strong,{children:"\u5931\u6557\u5f8c\u884c\u70ba"})})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"Liveness Probe"})}),(0,s.jsx)(e.td,{children:"\u6aa2\u67e5\u5bb9\u5668\u662f\u5426\u5b58\u6d3b\uff0c\u82e5\u5931\u6557\u8868\u660e\u61c9\u7528\u5df2\u9677\u5165\u7121\u6cd5\u6062\u5fa9\u7684\u72c0\u614b\u3002"}),(0,s.jsx)(e.td,{children:"Kubernetes \u91cd\u555f\u5bb9\u5668\u3002"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"Readiness Probe"})}),(0,s.jsx)(e.td,{children:"\u6aa2\u67e5\u5bb9\u5668\u662f\u5426\u6e96\u5099\u597d\u63a5\u53d7\u6d41\u91cf\uff0c\u82e5\u5931\u6557\u8868\u660e\u61c9\u7528\u66ab\u6642\u7121\u6cd5\u8655\u7406\u8acb\u6c42\u3002"}),(0,s.jsx)(e.td,{children:"Kubernetes \u5f9e\u670d\u52d9\u7aef\u9ede\u4e2d\u79fb\u9664\u5bb9\u5668\uff0c\u66ab\u505c\u6d41\u91cf\u5206\u914d\u3002"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"Startup Probe"})}),(0,s.jsx)(e.td,{children:"\u6aa2\u67e5\u5bb9\u5668\u7684\u555f\u52d5\u904e\u7a0b\u662f\u5426\u5b8c\u6210\uff0c\u9069\u7528\u65bc\u555f\u52d5\u6642\u9593\u8f03\u9577\u7684\u61c9\u7528\u7a0b\u5f0f\u3002"}),(0,s.jsx)(e.td,{children:"\u5728\u8d85\u904e\u5931\u6557\u95be\u503c\u524d\uff0cKubernetes \u4e0d\u6703\u8a8d\u5b9a\u5bb9\u5668\u5931\u6557\u6216\u91cd\u555f\u3002"})]})]})]}),"\n",(0,s.jsx)(e.h3,{id:"\u7bc4\u4f8b-3",children:"\u7bc4\u4f8b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",metastring:'title=""',children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: goproxy\n  labels:\n    app: goproxy\nspec:\n  containers:\n  - name: goproxy\n    image: k8s.gcr.io/goproxy:0.1\n    ports:\n    - containerPort: 8080\n    // highlight-start\n    readinessProbe: # \u6aa2\u67e5\u5bb9\u5668\u662f\u5426\u6e96\u5099\u597d\u63a5\u53d7\u6d41\u91cf\u7684\u63a2\u91dd\n      tcpSocket: # \u4f7f\u7528 TCP \u6aa2\u67e5\u7684\u65b9\u5f0f\n        port: 8080 # \u6aa2\u67e5\u7684\u76ee\u6a19 TCP \u57e0\n      initialDelaySeconds: 5 # \u63a2\u91dd\u6aa2\u67e5\u7684\u521d\u59cb\u5ef6\u9072\u6642\u9593\uff08\u55ae\u4f4d\uff1a\u79d2\uff09\uff0c\u5bb9\u5668\u555f\u52d5\u5f8c 5 \u79d2\u958b\u59cb\u9032\u884c\u6aa2\u67e5\n      periodSeconds: 10 # \u6bcf\u6b21\u63a2\u91dd\u6aa2\u67e5\u7684\u9593\u9694\u6642\u9593\uff08\u55ae\u4f4d\uff1a\u79d2\uff09\n    livenessProbe: # \u6aa2\u67e5\u5bb9\u5668\u662f\u5426\u4ecd\u7136\u5b58\u6d3b\u7684\u63a2\u91dd\n      tcpSocket: # \u4f7f\u7528 TCP \u6aa2\u67e5\u7684\u65b9\u5f0f\n        port: 8080 # \u6aa2\u67e5\u7684\u76ee\u6a19 TCP \u57e0\n      initialDelaySeconds: 15 # \u63a2\u91dd\u6aa2\u67e5\u7684\u521d\u59cb\u5ef6\u9072\u6642\u9593\uff08\u55ae\u4f4d\uff1a\u79d2\uff09\uff0c\u5bb9\u5668\u555f\u52d5\u5f8c 15 \u79d2\u958b\u59cb\u9032\u884c\u6aa2\u67e5\n      periodSeconds: 20 # \u6bcf\u6b21\u63a2\u91dd\u6aa2\u67e5\u7684\u9593\u9694\u6642\u9593\uff08\u55ae\u4f4d\uff1a\u79d2\uff09\n    // highlight-end\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u7e3d\u7d50",children:"\u7e3d\u7d50"}),"\n",(0,s.jsx)(e.p,{children:"Pod \u7684\u751f\u547d\u9031\u671f\u3001\u5bb9\u5668\u985e\u578b\u3001\u9264\u5b50\u4ee5\u53ca\u63a2\u91dd\u8a2d\u5b9a\u662f Kubernetes \u4e2d\u975e\u5e38\u91cd\u8981\u7684\u6982\u5ff5\uff0c\u5b83\u5011\u5e6b\u52a9\u6211\u5011\u66f4\u597d\u5730\u76e3\u63a7\u548c\u7ba1\u7406\u61c9\u7528\u7684\u5065\u5eb7\u72c0\u614b\u3002\u901a\u904e\u6b63\u78ba\u5730\u4f7f\u7528 liveness \u548c readiness \u548c startup \u63a2\u91dd\uff0c\u4ee5\u53ca\u9069\u7576\u8a2d\u7f6e Init Container \u548c\u9264\u5b50\uff0c\u6211\u5011\u53ef\u4ee5\u63d0\u5347\u61c9\u7528\u7684\u7a69\u5b9a\u6027\u548c\u53ef\u9760\u6027\u3002"})]})}function a(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(h,{...n})}):h(n)}},4658:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/pod_lifecycle_1-64b8724e6af7a98c8d73f3c7d7a9ccd3.svg"},70049:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/pod_lifecycle_2-c25b2d7ad384efddcbe146c2fe54816a.svg"},17947:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/pod_phase-e1e6bd66571544c7929d387aadbdbdc4.svg"},28453:(n,e,i)=>{i.d(e,{R:()=>d,x:()=>t});var s=i(96540);const l={},r=s.createContext(l);function d(n){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:d(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);