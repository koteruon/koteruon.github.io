"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[4774],{79183:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>o});var r=s(74848),t=s(28453);const a={},l="A03: SQL \u6ce8\u5165\u8207\u5176\u4ed6\u6ce8\u5165\u6f0f\u6d1e\uff08Injection\uff09",i={id:"notes/owasp-top10-2021/sql-injection",title:"A03: SQL \u6ce8\u5165\u8207\u5176\u4ed6\u6ce8\u5165\u6f0f\u6d1e\uff08Injection\uff09",description:"SQL \u6ce8\u5165\uff08SQLi\uff09\u662f\u4e00\u7a2e\u5e38\u898b\u7684\u7db2\u8def\u653b\u64ca\uff0c\u653b\u64ca\u8005\u5229\u7528\u61c9\u7528\u7a0b\u5f0f\u672a\u7d93\u9a57\u8b49\u7684 SQL \u67e5\u8a62\u4f86\u57f7\u884c\u60e1\u610f SQL \u8a9e\u53e5\uff0c\u53ef\u80fd\u5c0e\u81f4\u8cc7\u6599\u5eab\u6d29\u6f0f\u3001\u8cc7\u6599\u522a\u9664\uff0c\u751a\u81f3\u53d6\u5f97\u5b8c\u6574\u7ba1\u7406\u6b0a\u9650\u3002",source:"@site/docs/notes/owasp-top10-2021/05-sql-injection.mdx",sourceDirName:"notes/owasp-top10-2021",slug:"/notes/owasp-top10-2021/sql-injection",permalink:"/docs/notes/owasp-top10-2021/sql-injection",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{},sidebar:"notesSidebar",previous:{title:"A02: \u52a0\u5bc6\u5931\u6557\uff08Cryptographic Failures\uff09",permalink:"/docs/notes/owasp-top10-2021/cryptographic-failures"},next:{title:"Outline",permalink:"/docs/notes/design-pattern"}},d={},o=[{value:"\u6709 SQL \u6ce8\u5165\u6f0f\u6d1e\u7684\u670d\u52d9",id:"\u6709-sql-\u6ce8\u5165\u6f0f\u6d1e\u7684\u670d\u52d9",level:2},{value:"\u274c \u6709\u6f0f\u6d1e\u7684\u7a0b\u5f0f",id:"-\u6709\u6f0f\u6d1e\u7684\u7a0b\u5f0f",level:3},{value:"\u274c \u6f0f\u6d1e\u5206\u6790",id:"-\u6f0f\u6d1e\u5206\u6790",level:3},{value:"\u4f7f\u7528 SQLMAP \u6aa2\u6e2c SQL \u6ce8\u5165",id:"\u4f7f\u7528-sqlmap-\u6aa2\u6e2c-sql-\u6ce8\u5165",level:2},{value:"\ud83d\udd0d SQLMAP \u6e2c\u8a66\u6f0f\u6d1e",id:"-sqlmap-\u6e2c\u8a66\u6f0f\u6d1e",level:3},{value:"\u4fee\u88dc\u65b9\u5f0f",id:"\u4fee\u88dc\u65b9\u5f0f",level:2},{value:"\u2705 \u65b9\u6cd5 1\uff1a\u4f7f\u7528\u53c3\u6578\u5316\u67e5\u8a62\uff08Prepared Statement\uff09",id:"-\u65b9\u6cd5-1\u4f7f\u7528\u53c3\u6578\u5316\u67e5\u8a62prepared-statement",level:3},{value:"\u2705 \u65b9\u6cd5 2\uff1a\u5bc6\u78bc\u61c9\u8a72\u52a0\u5bc6\u5132\u5b58",id:"-\u65b9\u6cd5-2\u5bc6\u78bc\u61c9\u8a72\u52a0\u5bc6\u5132\u5b58",level:3},{value:"\u7e3d\u7d50",id:"\u7e3d\u7d50",level:2},{value:"\ud83d\udee0\ufe0f \u4fee\u88dc\u5f8c\u7684\u5b89\u5168\u7684\u7248\u672c",id:"\ufe0f-\u4fee\u88dc\u5f8c\u7684\u5b89\u5168\u7684\u7248\u672c",level:3}];function c(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"a03-sql-\u6ce8\u5165\u8207\u5176\u4ed6\u6ce8\u5165\u6f0f\u6d1einjection",children:"A03: SQL \u6ce8\u5165\u8207\u5176\u4ed6\u6ce8\u5165\u6f0f\u6d1e\uff08Injection\uff09"})}),"\n",(0,r.jsx)(e.p,{children:"SQL \u6ce8\u5165\uff08SQLi\uff09\u662f\u4e00\u7a2e\u5e38\u898b\u7684\u7db2\u8def\u653b\u64ca\uff0c\u653b\u64ca\u8005\u5229\u7528\u61c9\u7528\u7a0b\u5f0f\u672a\u7d93\u9a57\u8b49\u7684 SQL \u67e5\u8a62\u4f86\u57f7\u884c\u60e1\u610f SQL \u8a9e\u53e5\uff0c\u53ef\u80fd\u5c0e\u81f4\u8cc7\u6599\u5eab\u6d29\u6f0f\u3001\u8cc7\u6599\u522a\u9664\uff0c\u751a\u81f3\u53d6\u5f97\u5b8c\u6574\u7ba1\u7406\u6b0a\u9650\u3002"}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u6709-sql-\u6ce8\u5165\u6f0f\u6d1e\u7684\u670d\u52d9",children:"\u6709 SQL \u6ce8\u5165\u6f0f\u6d1e\u7684\u670d\u52d9"}),"\n",(0,r.jsxs)(e.p,{children:["\u6211\u5011\u4f86\u5efa\u7acb\u4e00\u500b ",(0,r.jsx)(e.strong,{children:"Go \u8a9e\u8a00\u7684 Web \u670d\u52d9"}),"\uff0c\u9019\u500b\u670d\u52d9\u6709\u4e00\u500b SQL \u6ce8\u5165\u6f0f\u6d1e\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u9019\u500b\u7a0b\u5f0f\u5305\u542b"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4f7f\u7528 SQLite"})," \u505a\u70ba\u8cc7\u6599\u5eab"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5b58\u5728 SQL \u6ce8\u5165\u6f0f\u6d1e"}),"\uff0c\u56e0\u70ba\u5b83\u76f4\u63a5\u62fc\u63a5 ",(0,r.jsx)(e.code,{children:"userInput"})," \u5230 SQL \u67e5\u8a62\u4e2d"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"-\u6709\u6f0f\u6d1e\u7684\u7a0b\u5f0f",children:"\u274c \u6709\u6f0f\u6d1e\u7684\u7a0b\u5f0f"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"database/sql"\n\t"fmt"\n\t"log"\n\t"net/http"\n\n\t_ "github.com/mattn/go-sqlite3"\n)\n\nfunc main() {\n\tdb, err := sql.Open("sqlite3", "./test.db")\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tdefer db.Close()\n\n\t// \u5efa\u7acb users \u8cc7\u6599\u8868\n\tcreateTable := `CREATE TABLE IF NOT EXISTS users (\n\t\tid INTEGER PRIMARY KEY AUTOINCREMENT,\n\t\tusername TEXT NOT NULL,\n\t\tpassword TEXT NOT NULL\n\t);`\n\t_, err = db.Exec(createTable)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\t// \u63d2\u5165\u6e2c\u8a66\u5e33\u865f\n\tdb.Exec("INSERT INTO users (username, password) VALUES (\'admin\', \'admin123\')")\n\tdb.Exec("INSERT INTO users (username, password) VALUES (\'user\', \'password\')")\n\n\t// \u767b\u5165\u7cfb\u7d71\n\thttp.HandleFunc("/login", func(w http.ResponseWriter, r *http.Request) {\n\t\tr.ParseForm()\n\t\tusername := r.FormValue("username")\n\t\tpassword := r.FormValue("password")\n\n\t\t// \u274c **\u6f0f\u6d1e\uff1a\u76f4\u63a5\u62fc\u63a5 SQL \u8a9e\u53e5\uff0c\u5c0e\u81f4 SQL \u6ce8\u5165\uff01**\n\t\tquery := fmt.Sprintf("SELECT username FROM users WHERE username=\'%s\' AND password=\'%s\'", username, password)\n\t\tfmt.Println("\u57f7\u884c\u67e5\u8a62:", query) // \u89c0\u5bdf SQL \u8a9e\u53e5\n\n\t\trow := db.QueryRow(query)\n\t\tvar foundUsername string\n\t\terr := row.Scan(&foundUsername)\n\n\t\tif err == sql.ErrNoRows {\n\t\t\tfmt.Fprintf(w, "\u767b\u5165\u5931\u6557")\n\t\t} else {\n\t\t\tfmt.Fprintf(w, "\u767b\u5165\u6210\u529f\uff0c\u6b61\u8fce %s\uff01", foundUsername)\n\t\t}\n\t})\n\n\tfmt.Println("\u4f3a\u670d\u5668\u555f\u52d5\u65bc http://localhost:8080")\n\thttp.ListenAndServe(":8080", nil)\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"-\u6f0f\u6d1e\u5206\u6790",children:"\u274c \u6f0f\u6d1e\u5206\u6790"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u9019\u88e1\u7684 SQL \u67e5\u8a62\uff1a","\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"SELECT * FROM users WHERE username='\u4f7f\u7528\u8005\u8f38\u5165' AND password='\u4f7f\u7528\u8005\u8f38\u5165'\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u9019\u6a23\u7684\u5beb\u6cd5\u4f7f\u5f97\u653b\u64ca\u8005\u53ef\u4ee5\u900f\u904e ",(0,r.jsx)(e.strong,{children:(0,r.jsx)(e.code,{children:"' OR '1'='1"})})," \u9019\u985e\u8f38\u5165\u4f86\u7e5e\u904e\u8eab\u4efd\u9a57\u8b49\uff1a","\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"username: ' OR '1'='1\npassword: \u4efb\u610f\u5167\u5bb9\n"})}),"\n","\u9019\u6703\u8b93 SQL \u8b8a\u6210\uff1a","\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sql",children:"SELECT * FROM users WHERE username='' OR '1'='1' AND password='\u4efb\u610f\u5167\u5bb9'\n"})}),"\n","\u56e0\u70ba ",(0,r.jsx)(e.code,{children:"'1'='1'"})," \u6c38\u9060\u70ba\u771f\uff0c\u653b\u64ca\u8005\u5c31\u80fd\u6210\u529f\u767b\u5165\uff01"]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u4f7f\u7528-sqlmap-\u6aa2\u6e2c-sql-\u6ce8\u5165",children:"\u4f7f\u7528 SQLMAP \u6aa2\u6e2c SQL \u6ce8\u5165"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"SQLMAP"})," \u662f\u4e00\u500b\u5f37\u5927\u7684\u958b\u6e90\u5de5\u5177\uff0c\u53ef\u4ee5\u81ea\u52d5\u5075\u6e2c\u548c\u5229\u7528 SQLi \u6f0f\u6d1e\u3002"]}),"\n",(0,r.jsx)(e.h3,{id:"-sqlmap-\u6e2c\u8a66\u6f0f\u6d1e",children:"\ud83d\udd0d SQLMAP \u6e2c\u8a66\u6f0f\u6d1e"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u6211\u5011\u9996\u5148\u5229\u7528 WSL \u7576\u4f5c\u6211\u5011\u7684\u6e2c\u8a66\u74b0\u5883\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"wsl -d Ubuntu\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"2",children:["\n",(0,r.jsx)(e.li,{children:"\u900f\u904e git \u4f86\u5b89\u88dd sqlmap\uff0capt-get \u7684\u7248\u672c\u592a\u820a\u4e86\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git sqlmap-dev\ncd sqlmap-dev/\npython3 sqlmap.py -h\npython3 sqlmap.py -hh\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"3",children:["\n",(0,r.jsx)(e.li,{children:"SQLite3 \u9700\u8981 CGO\uff0c\u900f\u679c\u6307\u4ee4\u4f86\u958b\u555f\u4ed6\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"go env -w CGO_ENABLED=1\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"4",children:["\n",(0,r.jsx)(e.li,{children:"\u555f\u52d5 Go \u670d\u52d9\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"go run main.go\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"3",children:["\n",(0,r.jsxs)(e.li,{children:["\u4f7f\u7528 SQLMAP \u6383\u63cf\uff0c",(0,r.jsx)(e.strong,{children:"SQLMAP \u6703\u5617\u8a66\u4e0d\u540c\u7684 SQL \u6ce8\u5165\u653b\u64ca\u4f86\u6e2c\u8a66\u6f0f\u6d1e"}),"\uff0c\u5982\u679c\u6210\u529f\uff0c\u4f60\u6703\u770b\u5230\u6f0f\u6d1e\uff0c\u751a\u81f3\u53ef\u4ee5\u628a\u8868\u683c\u8b80\u51fa\u4f86\u3002"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'sqlmap -u "http://localhost:8080/login" --data "username=admin&password=1234" --batch --tables\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-powershell",children:"[*] starting @ 02:13:05 /2025-02-13/\n\n[02:13:06] [INFO] resuming back-end DBMS 'sqlite'\n[02:13:06] [INFO] testing connection to the target URL\nsqlmap resumed the following injection point(s) from stored session:\n// highlight-start\n---\nParameter: password (POST)\n    Type: UNION query\n    Title: Generic UNION query (NULL) - 1 column\n    Payload: username=admin&password=1234' UNION ALL SELECT CONCAT(CONCAT('qkzkq','gEgaYmSFQvVuvcghJHRNIKmxeBVAWmRRoDfLBYBE'),'qjvkq')-- TUfO\n---\n// highlight-end\n[02:13:06] [INFO] the back-end DBMS is SQLite\nback-end DBMS: SQLite\n[02:13:06] [INFO] fetching tables for database: 'SQLite_masterdb'\n// highlight-start\n<current>\n[2 tables]\n+-----------------+\n| sqlite_sequence |\n| users           |\n+-----------------+\n// highlight-end\n\n[02:13:06] [INFO] fetched data logged to text files under '/home/calvin/.local/share/sqlmap/output/localhost'\n\n[*] ending @ 02:13:06 /2025-02-13/\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"4",children:["\n",(0,r.jsx)(e.li,{children:"\u6709\u4e86\u8868\u683c\u5c31\u53ef\u4ee5\u6307\u5b9a\u8868\u683c\u53d6\u5f97 cloumn\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'python3 sqlmap.py -u "http://localhost:8080/login" --data "username=admin&password=1234" --batch -T users --columns\n---\n\n[02:15:56] [INFO] fetching columns for table \'users\'\nDatabase: <current>\nTable: users\n[3 columns]\n+----------+---------+\n| Column   | Type    |\n+----------+---------+\n| id       | INTEGER |\n| password | TEXT    |\n| username | TEXT    |\n+----------+---------+\n'})}),"\n",(0,r.jsxs)(e.ol,{start:"5",children:["\n",(0,r.jsx)(e.li,{children:"\u540c\u6642\u4e5f\u80fd\u628a\u6574\u500b table \u5168\u90e8\u90fd\u6488\u53d6\u51fa\u4f86\uff0c\u975e\u5e38\u53ef\u6015\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'python3 sqlmap.py -u "http://localhost:8080/login" --data "username=admin&password=1234" --batch -T users --dump\n---\n\n[02:18:51] [INFO] fetching entries for table \'users\'\nDatabase: <current>\nTable: users\n[14 entries]\n+----+----------+----------+\n| id | password | username |\n+----+----------+----------+\n| 1  | admin123 | admin    |\n| 2  | password | user     |\n| 3  | admin123 | admin    |\n| 4  | password | user     |\n| 5  | admin123 | admin    |\n| 6  | password | user     |\n| 7  | admin123 | admin    |\n| 8  | password | user     |\n| 9  | admin123 | admin    |\n| 10 | password | user     |\n| 11 | admin123 | admin    |\n| 12 | password | user     |\n| 13 | admin123 | admin    |\n| 14 | password | user     |\n+----+----------+----------+\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u9019\u8868\u793a SQL \u6ce8\u5165\u6210\u529f\uff01\u653b\u64ca\u8005\u53ef\u4ee5\u7e5e\u904e\u767b\u5165\u9a57\u8b49\uff01"})," \ud83d\udc80"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u4fee\u88dc\u65b9\u5f0f",children:"\u4fee\u88dc\u65b9\u5f0f"}),"\n",(0,r.jsx)(e.h3,{id:"-\u65b9\u6cd5-1\u4f7f\u7528\u53c3\u6578\u5316\u67e5\u8a62prepared-statement",children:"\u2705 \u65b9\u6cd5 1\uff1a\u4f7f\u7528\u53c3\u6578\u5316\u67e5\u8a62\uff08Prepared Statement\uff09"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u274c \u932f\u8aa4\uff1a"})," ",(0,r.jsx)(e.code,{children:"query := fmt.Sprintf(\"SELECT * FROM users WHERE username='%s' AND password='%s'\", username, password)"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u2705 \u6b63\u78ba\uff1a"})," \u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"?"})," \u4f86\u5b89\u5168\u5730\u50b3\u5165\u53c3\u6578"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'stmt, err := db.Prepare("SELECT * FROM users WHERE username=? AND password=?")\nif err != nil {\n    http.Error(w, "\u4f3a\u670d\u5668\u932f\u8aa4", http.StatusInternalServerError)\n    return\n}\nrow := stmt.QueryRow(username, password)\n'})}),"\n",(0,r.jsx)(e.h3,{id:"-\u65b9\u6cd5-2\u5bc6\u78bc\u61c9\u8a72\u52a0\u5bc6\u5132\u5b58",children:"\u2705 \u65b9\u6cd5 2\uff1a\u5bc6\u78bc\u61c9\u8a72\u52a0\u5bc6\u5132\u5b58"}),"\n",(0,r.jsxs)(e.p,{children:["\u76ee\u524d\u7684\u7a0b\u5f0f\u76f4\u63a5\u5b58\u660e\u6587\u5bc6\u78bc\uff0c\u61c9\u8a72\u7528 ",(0,r.jsx)(e.strong,{children:"bcrypt"})," \u4f86\u52a0\u5bc6\u5bc6\u78bc\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'import "golang.org/x/crypto/bcrypt"\n\n// \u52a0\u5bc6\u5bc6\u78bc\nfunc hashPassword(password string) (string, error) {\n    hashed, err := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)\n    return string(hashed), err\n}\n\n// \u9a57\u8b49\u5bc6\u78bc\nfunc checkPassword(hashedPassword, password string) error {\n    return bcrypt.CompareHashAndPassword([]byte(hashedPassword), []byte(password))\n}\n'})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u7e3d\u7d50",children:"\u7e3d\u7d50"}),"\n",(0,r.jsx)(e.h3,{id:"\ufe0f-\u4fee\u88dc\u5f8c\u7684\u5b89\u5168\u7684\u7248\u672c",children:"\ud83d\udee0\ufe0f \u4fee\u88dc\u5f8c\u7684\u5b89\u5168\u7684\u7248\u672c"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u900f\u904e bcrypt \u5c07\u5bc6\u78bc\u52a0\u5bc6\uff0c\u540c\u6642\u4f7f\u7528 Prepared Statement \u9632\u6b62 SQL \u6ce8\u5165\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"database/sql"\n\t"fmt"\n\t"log"\n\t"net/http"\n\n\t"golang.org/x/crypto/bcrypt"\n\n\t_ "github.com/mattn/go-sqlite3"\n)\n\n// hashPassword \u5c07\u5bc6\u78bc\u52a0\u5bc6\nfunc hashPassword(password string) (string, error) {\n\tbytes, err := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)\n\treturn string(bytes), err\n}\n\n// insertUser \u5c07\u5e33\u865f\u548c\u52a0\u5bc6\u5f8c\u7684\u5bc6\u78bc\u5b58\u5165 DB\nfunc insertUser(db *sql.DB, username, password string) error {\n\thashedPassword, err := hashPassword(password)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = db.Exec("INSERT INTO users (username, password) VALUES (?, ?)", username, hashedPassword)\n\treturn err\n}\n\nfunc main() {\n\tdb, err := sql.Open("sqlite3", "./test.db")\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tdefer db.Close()\n\n\t// \u5efa\u7acb users \u8cc7\u6599\u8868\n\tcreateTable := `CREATE TABLE IF NOT EXISTS users (\n\t\tid INTEGER PRIMARY KEY AUTOINCREMENT,\n\t\tusername TEXT NOT NULL UNIQUE,\n\t\tpassword TEXT NOT NULL\n\t);`\n\t_, err = db.Exec(createTable)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\t// \u63d2\u5165\u6e2c\u8a66\u5e33\u865f\uff08\u5982\u679c\u5e33\u865f\u4e0d\u5b58\u5728\uff09\n\tvar count int\n\tdb.QueryRow("SELECT COUNT(*) FROM users WHERE username=\'admin\'").Scan(&count)\n\tif count == 0 {\n\t\tinsertUser(db, "admin", "admin123")\n\t\tinsertUser(db, "user", "password")\n\t\tfmt.Println("\u5df2\u5efa\u7acb\u6e2c\u8a66\u5e33\u865f")\n\t}\n\n\t// \u767b\u5165\u7cfb\u7d71\n\thttp.HandleFunc("/login", func(w http.ResponseWriter, r *http.Request) {\n\t\tr.ParseForm()\n\t\tusername := r.FormValue("username")\n\t\tpassword := r.FormValue("password")\n\n\t\t// \u2705 \u4f7f\u7528 Prepared Statement \u9632\u6b62 SQL \u6ce8\u5165\n\t\tquery := "SELECT password FROM users WHERE username=?"\n\t\trow := db.QueryRow(query, username)\n\n\t\tvar hashedPassword string\n\t\terr := row.Scan(&hashedPassword)\n\t\tif err != nil {\n\t\t\thttp.Error(w, "\u767b\u5165\u5931\u6557", http.StatusUnauthorized)\n\t\t\treturn\n\t\t}\n\n\t\t// \u2705 \u6aa2\u67e5\u5bc6\u78bc\u662f\u5426\u6b63\u78ba\n\t\tif err := bcrypt.CompareHashAndPassword([]byte(hashedPassword), []byte(password)); err != nil {\n\t\t\thttp.Error(w, "\u767b\u5165\u5931\u6557", http.StatusUnauthorized)\n\t\t\treturn\n\t\t}\n\n\t\tfmt.Fprintf(w, "\u767b\u5165\u6210\u529f\uff01\u6b61\u8fce, %s", username)\n\t})\n\n\tfmt.Println("\u4f3a\u670d\u5668\u555f\u52d5\u65bc http://localhost:8080")\n\thttp.ListenAndServe(":8080", nil)\n}\n'})}),"\n",(0,r.jsxs)(e.ol,{start:"2",children:["\n",(0,r.jsx)(e.li,{children:"\u65b0\u589e go \u7684\u6a21\u7d44\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"go get golang.org/x/crypto/bcrypt\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"3",children:["\n",(0,r.jsx)(e.li,{children:"\u5c07 test.db \u522a\u6389\u4e4b\u5f8c\uff0c\u91cd\u65b0\u57f7\u884c\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"go run main.go\n---\n\n\u5df2\u5efa\u7acb\u6e2c\u8a66\u5e33\u865f\n\u4f3a\u670d\u5668\u555f\u52d5\u65bc http://localhost:8080\n"})}),"\n",(0,r.jsxs)(e.ol,{start:"4",children:["\n",(0,r.jsx)(e.li,{children:"\u6e2c\u8a66\u53ef\u4ee5\u767b\u5165\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'curl -X POST http://127.0.0.1:8080/login -d "username=admin" -d "password=admin123"\n---\n\n\u767b\u5165\u6210\u529f\uff01\u6b61\u8fce, admin\n'})}),"\n",(0,r.jsxs)(e.ol,{start:"5",children:["\n",(0,r.jsx)(e.li,{children:"\u4f7f\u7528 sqlmap \u6aa2\u6e2c\uff0c\u56e0\u70ba lavel \u548c risk \u90fd\u8abf\u5230\u6700\u9ad8\uff0c\u9700\u8981\u4e00\u4e9b\u6642\u9593\uff0c\u6c92\u6709\u986f\u793a injection point\uff0c\u5c31\u4ee3\u8868\u6c92\u6709\u88ab\u6383\u51fa\u6f0f\u6d1e\u56c9\uff01"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'python3 sqlmap.py -u "http://localhost:8080/login" --data "username=admin&password=admin123" --ignore-code=401 --batch --flush-session --level=5 --risk=3 --dbms=sqlite\n'})})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(c,{...n})}):c(n)}},28453:(n,e,s)=>{s.d(e,{R:()=>l,x:()=>i});var r=s(96540);const t={},a=r.createContext(t);function l(n){const e=r.useContext(a);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:l(n.components),r.createElement(a.Provider,{value:e},n.children)}}}]);