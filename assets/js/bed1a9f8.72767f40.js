"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[7077],{6002:(e,n,l)=>{l.d(n,{A:()=>t});const t=l.p+"assets/images/hello-world-deployments-eab69355bfeb9b9ce76e06d169db922b.png"},19165:(e,n,l)=>{l.d(n,{A:()=>t});const t=l.p+"assets/images/hello-world-v1-deployments-scale-472dab74c1ab560552eefafd827b77c0.png"},26131:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>i,contentTitle:()=>d,default:()=>c,frontMatter:()=>a,metadata:()=>t,toc:()=>r});const t=JSON.parse('{"id":"notes/kubernetes-basics/basic-creating-a-deployment","title":"Basic - Creating a Deployment","description":"\u4ec0\u9ebc\u662f Deployment","source":"@site/docs/notes/kubernetes-basics/07-basic-creating-a-deployment.mdx","sourceDirName":"notes/kubernetes-basics","slug":"/notes/kubernetes-basics/basic-creating-a-deployment","permalink":"/docs/notes/kubernetes-basics/basic-creating-a-deployment","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{},"sidebar":"notesSidebar","previous":{"title":"Basic - Creating a Service","permalink":"/docs/notes/kubernetes-basics/basic-creating-a-service"},"next":{"title":"Basic - Creating a StatefulSet","permalink":"/docs/notes/kubernetes-basics/basic-creating-a-statefulset"}}');var s=l(74848),o=l(28453);const a={},d="Basic - Creating a Deployment",i={},r=[{value:"\u4ec0\u9ebc\u662f Deployment",id:"\u4ec0\u9ebc\u662f-deployment",level:2},{value:"Deployment \u7684\u6838\u5fc3\u529f\u80fd",id:"deployment-\u7684\u6838\u5fc3\u529f\u80fd",level:2},{value:"\u5be6\u4f5c\u4e00\u500b Deployment",id:"\u5be6\u4f5c\u4e00\u500b-deployment",level:2},{value:"\u5b9a\u7fa9\u4e26\u88fd\u4f5c\u4e00\u500b Deployment",id:"\u5b9a\u7fa9\u4e26\u88fd\u4f5c\u4e00\u500b-deployment",level:3},{value:"\u66f4\u65b0 Deployment \u5be6\u73fe\u6c34\u5e73\u64f4\u5c55",id:"\u66f4\u65b0-deployment-\u5be6\u73fe\u6c34\u5e73\u64f4\u5c55",level:3},{value:"\u4f7f\u7528 Rollout \u4f86\u67e5\u770b\u88e1\u4f7f\u7248\u672c\u4e26\u56de\u6efe",id:"\u4f7f\u7528-rollout-\u4f86\u67e5\u770b\u88e1\u4f7f\u7248\u672c\u4e26\u56de\u6efe",level:3}];function p(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"basic---creating-a-deployment",children:"Basic - Creating a Deployment"})}),"\n",(0,s.jsx)(n.h2,{id:"\u4ec0\u9ebc\u662f-deployment",children:"\u4ec0\u9ebc\u662f Deployment"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728 Kubernetes \u4e2d\uff0c",(0,s.jsx)(n.code,{children:"Deployment"})," \u662f\u4e00\u7a2e\u9ad8\u5c64\u6b21\u7684 API \u8cc7\u6e90\uff0c\u7528\u65bc\u7ba1\u7406\u61c9\u7528\u7a0b\u5f0f\u7684\u90e8\u7f72\u548c\u64f4\u5c55\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u7a2e\u8072\u660e\u5f0f\u7684\u65b9\u6cd5\u4f86\u5b9a\u7fa9\u61c9\u7528\u7a0b\u5f0f\u7684\u6240\u9700\u72c0\u614b\uff0c\u4e26\u7531 Kubernetes \u63a7\u5236\u5e73\u9762\u81ea\u52d5\u57f7\u884c\u6240\u9700\u7684\u66f4\u6539\uff0c\u78ba\u4fdd\u96c6\u7fa4\u4e2d\u7684\u5be6\u969b\u72c0\u614b\u5339\u914d\u6240\u9700\u72c0\u614b\u3002"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"deployment-\u7684\u6838\u5fc3\u529f\u80fd",children:"Deployment \u7684\u6838\u5fc3\u529f\u80fd"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u7ba1\u7406 Pod \u7684\u751f\u547d\u9031\u671f"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Deployment \u6703\u7ba1\u7406\u57fa\u65bc Pod \u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u78ba\u4fdd\u6307\u5b9a\u6578\u91cf\u7684 Pod \u526f\u672c\u904b\u884c\uff0c\u4e26\u76e3\u63a7\u5176\u5065\u5eb7\u72c0\u614b\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u6efe\u52d5\u66f4\u65b0\u8207\u56de\u6efe"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u6efe\u52d5\u66f4\u65b0\uff1a\u5141\u8a31\u9010\u6b65\u66f4\u65b0\u61c9\u7528\u7a0b\u5f0f\uff0c\u7121\u9700\u505c\u6a5f\u3002"}),"\n",(0,s.jsx)(n.li,{children:"\u56de\u6efe\uff1a\u5982\u679c\u66f4\u65b0\u5931\u6557\uff0c\u53ef\u4ee5\u5feb\u901f\u6062\u5fa9\u5230\u4e4b\u524d\u7684\u7a69\u5b9a\u7248\u672c\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u81ea\u52d5\u5316\u64f4\u5c55\u8207\u7e2e\u6e1b"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Deployment \u652f\u63f4\u900f\u904e Horizontal Pod Autoscaler (HPA) \u81ea\u52d5\u8abf\u6574 Pod \u7684\u6578\u91cf\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5bb9\u932f\u6062\u5fa9"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5982\u679c\u67d0\u4e9b Pod \u767c\u751f\u6545\u969c\uff0cDeployment \u6703\u81ea\u52d5\u91cd\u65b0\u5275\u5efa\u6216\u66ff\u63db\uff0c\u78ba\u4fdd\u61c9\u7528\u7a0b\u5f0f\u7684\u7a69\u5b9a\u904b\u884c\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u5be6\u4f5c\u4e00\u500b-deployment",children:"\u5be6\u4f5c\u4e00\u500b Deployment"}),"\n",(0,s.jsx)(n.h3,{id:"\u5b9a\u7fa9\u4e26\u88fd\u4f5c\u4e00\u500b-deployment",children:"\u5b9a\u7fa9\u4e26\u88fd\u4f5c\u4e00\u500b Deployment"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u6211\u5011\u5b9a\u7fa9\u5169\u500b deployment\uff0c\u70ba\u4e86\u8981\u8b93\u9019\u5169\u500b Pod \u7684\u7248\u672c\u500b\u5225\u64c1\u6709\u4e00\u500b Replica Set\uff0c\u9019\u4e00\u5c31\u80fd\u81ea\u7531\u5be6\u73fe\u81ea\u52d5\u7e2e\u653e"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="deployment.yaml"',children:'# \u5b9a\u7fa9\u7b2c\u4e00\u500b Deployment\uff0c\u7528\u65bc\u7ba1\u7406\u7248\u672c v1 \u7684\u61c9\u7528\n// highlight-next-line\napiVersion: apps/v1 # API \u7248\u672c\uff0cDeployment \u4f7f\u7528\u7684\u662f apps/v1 \u7248\u672c\u3002\n// highlight-next-line\nkind: Deployment # \u8cc7\u6e90\u985e\u578b\u70ba Deployment\uff0c\u7528\u65bc\u90e8\u7f72\u548c\u7ba1\u7406 Pod\u3002\nmetadata:\n  name: v1-deployment # Deployment \u7684\u540d\u7a31\uff0c\u552f\u4e00\u6a19\u8b58\u8a72\u8cc7\u6e90\u3002\n  labels:\n    type: demo-v1 # \u81ea\u5b9a\u7fa9\u6a19\u7c64\uff0c\u7528\u65bc\u6a19\u8b58\u6b64 Deployment \u70ba demo-v1 \u985e\u578b\u3002\nspec:\n  // highlight-next-line\n  replicas: 3 # \u9700\u8981\u904b\u884c\u7684 Pod \u526f\u672c\u6578\u91cf\uff0c\u8a2d\u70ba 3\u3002\n  selector: # \u5b9a\u7fa9 Deployment \u5982\u4f55\u9078\u64c7\u7ba1\u7406\u7684 Pod\u3002\n    matchLabels:\n      type: demo-v1 # \u5339\u914d\u5177\u6709 `type: demo-v1` \u6a19\u7c64\u7684 Pod\u3002\n  template: # Pod \u7684\u6a21\u677f\uff0c\u7528\u65bc\u5275\u5efa Pod\u3002\n    metadata:\n      labels:\n        type: demo-v1 # Pod \u7684\u6a19\u7c64\uff0c\u9700\u8207 selector \u7684\u689d\u4ef6\u4e00\u81f4\u3002\n    spec:\n      containers: # \u5b9a\u7fa9 Pod \u4e2d\u7684\u5bb9\u5668\u3002\n        - name: v1 # \u5bb9\u5668\u540d\u7a31\uff0c\u6a19\u8b58\u70ba "v1"\u3002\n          // highlight-next-line\n          image: hello-world:v1.0.0 # \u5bb9\u5668\u4f7f\u7528\u7684\u6620\u50cf\uff0c\u7248\u672c\u70ba v1.0.0\u3002\n          ports:\n            - containerPort: 8080 # \u5b9a\u7fa9\u5bb9\u5668\u5167\u90e8\u958b\u653e\u7684\u670d\u52d9\u7aef\u53e3\u3002\n---\n# \u5b9a\u7fa9\u7b2c\u4e8c\u500b Deployment\uff0c\u7528\u65bc\u7ba1\u7406\u7248\u672c v2 \u7684\u61c9\u7528\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: v2-deployment # Deployment \u7684\u540d\u7a31\uff0c\u552f\u4e00\u6a19\u8b58\u8a72\u8cc7\u6e90\u3002\n  labels:\n    type: demo-v2 # \u81ea\u5b9a\u7fa9\u6a19\u7c64\uff0c\u7528\u65bc\u6a19\u8b58\u6b64 Deployment \u70ba demo-v2 \u985e\u578b\u3002\nspec:\n  // highlight-next-line\n  replicas: 2 # \u9700\u8981\u904b\u884c\u7684 Pod \u526f\u672c\u6578\u91cf\uff0c\u8a2d\u70ba 2\u3002\n  selector:\n    matchLabels:\n      type: demo-v2 # \u5339\u914d\u5177\u6709 `type: demo-v2` \u6a19\u7c64\u7684 Pod\u3002\n  template:\n    metadata:\n      labels:\n        type: demo-v2 # Pod \u7684\u6a19\u7c64\uff0c\u9700\u8207 selector \u7684\u689d\u4ef6\u4e00\u81f4\u3002\n    spec:\n      containers:\n        - name: v2 # \u5bb9\u5668\u540d\u7a31\uff0c\u6a19\u8b58\u70ba "v2"\u3002\n          // highlight-next-line\n          image: hello-world:v2.0.0 # \u5bb9\u5668\u4f7f\u7528\u7684\u6620\u50cf\uff0c\u7248\u672c\u70ba v2.0.0\u3002\n          ports:\n            - containerPort: 8080\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"\u900f\u904e kubectl \u4f86\u57f7\u884c\u4ed6"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl.exe apply -f deployment.yaml\n---\n\ndeployment.apps/v1-deployment created\ndeployment.apps/v2-deployment created\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"\u6211\u5011\u53ef\u4ee5\u900f\u904e\u6307\u4ee4\u6216\u662f dashboard \u770b\u898b\u4ed6\u5011\u6210\u529f\u88ab\u5275\u7acb\uff0c\u800c\u4e14 pod \u6578\u91cf v1 \u662f 3 \u500b\uff0cv2 \u662f 2 \u500b"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"kubectl.exe get all\n---\n\nNAME                                 READY   STATUS    RESTARTS   AGE\npod/v1-deployment-76f7b58999-544kx   1/1     Running   0          39s\npod/v1-deployment-76f7b58999-plxqm   1/1     Running   0          39s\npod/v1-deployment-76f7b58999-w9qsf   1/1     Running   0          39s\npod/v2-deployment-96fc9cb46-7h4f7    1/1     Running   0          39s\npod/v2-deployment-96fc9cb46-jjzpw    1/1     Running   0          39s\n\nNAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE\nservice/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   86d\n\nNAME                            READY   UP-TO-DATE   AVAILABLE   AGE\n// highlight-start\ndeployment.apps/v1-deployment   3/3     3            3           39s\ndeployment.apps/v2-deployment   2/2     2            2           39s\n// highlight-end\n\nNAME                                       DESIRED   CURRENT   READY   AGE\nreplicaset.apps/v1-deployment-76f7b58999   3         3         3       39s\nreplicaset.apps/v2-deployment-96fc9cb46    2         2         2       39s\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"hello-world-deployments",src:l(6002).A+"",width:"1920",height:"776"})}),"\n",(0,s.jsx)(n.h3,{id:"\u66f4\u65b0-deployment-\u5be6\u73fe\u6c34\u5e73\u64f4\u5c55",children:"\u66f4\u65b0 Deployment \u5be6\u73fe\u6c34\u5e73\u64f4\u5c55"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u6211\u5011\u53ef\u4ee5\u900f\u904e\u66f4\u6539 yaml \u6a94\u88e1\u9762\u7684 replicas \u6578\u91cf\u4f86\u5be6\u73fe\u64f4\u5c55\uff0ckubenetes \u6703\u81ea\u52d5\u5e6b\u6211\u5011\u8abf\u6574"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="deployment.yaml"',children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: v1-deployment\n  labels:\n    type: demo-v1\nspec:\n  # \u6211\u5011\u53ef\u4ee5\u5c07Pod Replicas\u8a2d\u5b9a\u70ba2\n  // highlight-next-line\n  replicas: 2\n  selector:\n    matchLabels:\n      type: demo-v1\n  template:\n    metadata:\n      labels:\n        type: demo-v1\n    spec:\n      containers:\n      - name: v1\n        image: hello-world:v1.0.0\n        ports:\n        - containerPort: 8080\n---\n...V2\u6c92\u6709\u66f4\u52d5\u7701\u7565...\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"\u900f\u904e\u6307\u4ee4\u57f7\u884c\u4ed6\uff0c\u6211\u5011\u53ef\u4ee5\u89c0\u5bdf\u5230\u53ea\u6709 v1 \u6709\u6539\u8b8a"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl.exe apply -f deployment.yaml\n---\n\ndeployment.apps/v1-deployment configured\ndeployment.apps/v2-deployment unchanged\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"\u900f\u904e rollout status \u6211\u5011\u53ef\u4ee5\u67e5\u770b deployment \u8cc7\u6e90\u7ba1\u7406\u7684\u72c0\u614b\uff0c\u5982\u679c\u8a2d\u5b9a\u932f\u8aa4\u6216\u662f\u66f4\u65b0\u5931\u6557\uff0c\u72c0\u614b\u5c07\u6703\u7b49\u5f85\u76f4\u5230 timeout"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'kubectl.exe rollout status deployment v1-deployment\n---\n\ndeployment "v1-deployment" successfully rolled out\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsx)(n.li,{children:"\u53e6\u5916\u6211\u5011\u4e5f\u53ef\u4ee5\u900f\u904e\u6307\u4ee4\u4f86\u4fee\u6539 replicas \u7684\u6578\u91cf"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl.exe scale deployment v1-deployment --replicas 2\n---\n\ndeployment.apps/v1-deployment scaled\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsx)(n.li,{children:"\u5f9e\u6307\u4ee4\u548c dashboard \u90fd\u53ef\u4ee5\u770b\u51fa v1 \u53ea\u5269\u4e0b\u5169\u500b pod"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"kubectl.exe get all\n---\n\nNAME                                 READY   STATUS    RESTARTS   AGE\npod/v1-deployment-76f7b58999-544kx   1/1     Running   0          20m\npod/v1-deployment-76f7b58999-plxqm   1/1     Running   0          20m\npod/v2-deployment-96fc9cb46-7h4f7    1/1     Running   0          20m\npod/v2-deployment-96fc9cb46-jjzpw    1/1     Running   0          20m\n\nNAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE\nservice/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   86d\n\nNAME                            READY   UP-TO-DATE   AVAILABLE   AGE\n// highlight-next-line\ndeployment.apps/v1-deployment   2/2     2            2           20m\ndeployment.apps/v2-deployment   2/2     2            2           20m\n\nNAME                                       DESIRED   CURRENT   READY   AGE\nreplicaset.apps/v1-deployment-76f7b58999   2         2         2       20m\nreplicaset.apps/v2-deployment-96fc9cb46    2         2         2       20m\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"hello-world-v1-deployments-scale",src:l(19165).A+"",width:"1920",height:"370"})}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528-rollout-\u4f86\u67e5\u770b\u88e1\u4f7f\u7248\u672c\u4e26\u56de\u6efe",children:"\u4f7f\u7528 Rollout \u4f86\u67e5\u770b\u88e1\u4f7f\u7248\u672c\u4e26\u56de\u6efe"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u9996\u5148\uff0c\u53ea\u6709\u5728 spec.template \u66f4\u6539\u6642\u624d\u80fd\u88ab\u8a18\u4f4f\uff0c\u6211\u5011\u53ef\u4ee5\u5728 yaml \u4e2d\u589e\u52a0 annotations \u4f86\u8aaa\u660e\u9019\u6b21\u4fee\u6539\u7684\u539f\u56e0\uff0c\u6216\u662f\u4e8b\u5f8c\u900f\u904e\u6307\u4ee4\u589e\u52a0 annotation"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="deployment.yaml"',children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: v1-deployment\n  labels:\n    type: demo-v1\n  # \u624b\u52d5\u6dfb\u52a0\u63cf\u8ff0\u672c\u6b21\u8b8a\u66f4\u7684\u539f\u56e0\n  // highlight-start\n  annotations:\n    kubernetes.io/change-cause: "Scaled replicas to 2"\n  // highlight-end\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      type: demo-v1\n  template:\n    metadata:\n      labels:\n        type: demo-v1\n    spec:\n      containers:\n      - name: v1\n        image: hello-world:v1.0.0\n        ports:\n        - containerPort: 8080\n---\n...V2\u6c92\u6709\u66f4\u52d5\u7701\u7565...\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'kubectl annotate deployment v1-deployment kubernetes.io/change-cause="Scaled replicas to 2"\n---\n\ndeployment.apps/v1-deployment\nREVISION  CHANGE-CAUSE\n1         Scaled replicas to 2\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"\u900f\u904e\u6307\u4ee4\u67e5\u770b\u7d00\u9304\u7684\u539f\u56e0"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl.exe rollout history deployment v1-deployment\n---\n\ndeployment.apps/v1-deployment\nREVISION  CHANGE-CAUSE\n1         Scaled replicas to 2\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"\u5728\u4e0a\u4e00\u7bc7\u7684 pod \u4e4b\u4e2d\u518d\u591a\u5305\u7248\u4e00\u500b image\uff0c\u53eb\u505a V1.0.1\uff0c\u5167\u5bb9\u4e0d\u7528\u66f4\u6539"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker build -t hello-world:v1.0.1 --build-arg VERSION=v1 .\n---\n\n[+] Building 2.8s (15/15) FINISHED\n => [internal] load build definition from dockerfile                                                                                                                      0.0s\n ...\u4e2d\u9593\u7701\u7565...\n => => naming to docker.io/library/hello-world:v1.0.1\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsx)(n.li,{children:"\u4fee\u6539 yaml\uff0c\u8b93\u7248\u672c\u5f9e v1.0.0 \u5347\u7248\u5230 v1.0.1"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="deployment.yaml"',children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: v1-deployment\n  labels:\n    type: demo-v1\n  annotations:\n    # \u4fee\u6539\u8a3b\u89e3\n    // highlight-next-line\n    kubernetes.io/change-cause: "Updated image to hello-world:v1.0.1"\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      type: demo-v1\n  template:\n    metadata:\n      labels:\n        type: demo-v1\n    spec:\n      containers:\n      - name: v1\n        # \u5347\u7248\u5230v1.0.1\n         // highlight-next-line\n        image: hello-world:v1.0.1\n        ports:\n        - containerPort: 8080\n---\n...V2\u6c92\u6709\u66f4\u52d5\u7701\u7565...\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsx)(n.li,{children:"\u57f7\u884c kubectl \u6307\u4ee4\u4f86\u57f7\u884c\u4ed6"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl.exe apply -f deployment.yaml\n---\n\ndeployment.apps/v1-deployment configured\ndeployment.apps/v2-deployment unchanged\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"6",children:["\n",(0,s.jsx)(n.li,{children:"\u67e5\u770b\u6b77\u53f2\u7d00\u9304\u5c31\u80fd\u770b\u5230\u4e0d\u540c\u7684\u7248\u672c\u7522\u751f\u51fa\u4f86"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"kubectl.exe rollout history deployment v1-deployment\n---\n\ndeployment.apps/v1-deployment\nREVISION  CHANGE-CAUSE\n1         Scaled replicas to 2\n// highlight-next-line\n2         Updated image to hello-world:v1.0.1\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"7",children:["\n",(0,s.jsx)(n.li,{children:"\u6211\u5011\u4e5f\u80fd\u900f\u904e\u6307\u4ee4\u67e5\u770b\u7248\u672c\u865f\u7684\u8a73\u7d30\u8cc7\u8a0a\uff0c\u900f\u904e--revision=\u8981\u67e5\u770b\u7684\u7248\u672c\u865f"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"kubectl.exe rollout history deployment v1-deployment --revision=2\n---\n\ndeployment.apps/v1-deployment with revision #2\nPod Template:\n  Labels:       pod-template-hash=c79c7bdd6\n        type=demo-v1\n  // highlight-next-line\n  Annotations:  kubernetes.io/change-cause: Updated image to hello-world:v1.0.1\n  Containers:\n   v1:\n    // highlight-next-line\n    Image:      hello-world:v1.0.1\n    Port:       8080/TCP\n    Host Port:  0/TCP\n    Environment:        <none>\n    Mounts:     <none>\n  Volumes:      <none>\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"8",children:["\n",(0,s.jsx)(n.li,{children:"\u6b64\u6642\u6211\u5011\u60f3\u8981\u56de\u6efe\u5230 v1.0.0 \u9019\u500b\u7248\u672c\uff0c\u6211\u5011\u53ef\u4ee5\u900f\u904e\u6307\u4ee4\u76f4\u63a5\u56de\u53bb\uff0c\u52a0\u4e0a--to-revision=\u7248\u672c\u865f\uff0c\u53ef\u4ee5\u6307\u5b9a\u56de\u6efe\u7684\u7248\u672c\u865f\uff0c\u6c92\u6709\u52a0\u5c31\u56de\u4e0a\u4e00\u500b"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl.exe rollout undo deployment v1-deployment\n---\n\ndeployment.apps/v1-deployment rolled back\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"9",children:["\n",(0,s.jsx)(n.li,{children:"\u67e5\u770b\u7248\u672c\u865f\u662f\u4e0d\u662f\u56de\u5230 V1.0.0\uff0c\u5982\u679c\u662f\u7684\u8a71\u5c31\u606d\u559c\u4f60\u6210\u529f\u56c9~"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"kubectl.exe describe deployments.apps v1-deployment\n---\n\nName:                   v1-deployment\n...\u4e2d\u9593\u7701\u7565...\nPod Template:\n  Labels:  type=demo-v1\n  Containers:\n   v1:\n    // highlight-next-line\n    Image:        hello-world:v1.0.0\n    Port:         8080/TCP\n    Host Port:    0/TCP\n    Environment:  <none>\n    Mounts:       <none>\n  Volumes:        <none>\n...\u5f8c\u9762\u7701\u7565...\n"})})]})}function c(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},28453:(e,n,l)=>{l.d(n,{R:()=>a,x:()=>d});var t=l(96540);const s={},o=t.createContext(s);function a(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);