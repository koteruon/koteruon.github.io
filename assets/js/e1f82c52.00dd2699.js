"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[4031],{23660:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>l,toc:()=>o});var s=r(74848),t=r(28453);const d={},i="A02: \u52a0\u5bc6\u5931\u6557\uff08Cryptographic Failures\uff09",l={id:"notes/owasp-top10-2021/cryptographic-failures",title:"A02: \u52a0\u5bc6\u5931\u6557\uff08Cryptographic Failures\uff09",description:"\u4ee5\u4e0b\u5c55\u793a\u5c55\u793a\u5982\u4f55\u5229\u7528 Hydra \u6e2c\u8a66\u66b4\u529b\u7834\u89e3\u4e00\u500b \u4e0d\u5b89\u5168\u7684\u767b\u5165 API\uff0c\u7136\u5f8c\u518d\u63d0\u4f9b\u4fee\u88dc\u65b9\u5f0f\u3002",source:"@site/docs/notes/owasp-top10-2021/05-cryptographic-failures.mdx",sourceDirName:"notes/owasp-top10-2021",slug:"/notes/owasp-top10-2021/cryptographic-failures",permalink:"/docs/notes/owasp-top10-2021/cryptographic-failures",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{},sidebar:"notesSidebar",previous:{title:"A01: \u6b0a\u9650\u63a7\u5236\u5931\u6548\uff08Broken Access Control\uff09",permalink:"/docs/notes/owasp-top10-2021/broken-access-control"},next:{title:"A03: SQL \u6ce8\u5165\u8207\u5176\u4ed6\u6ce8\u5165\u6f0f\u6d1e\uff08Injection\uff09",permalink:"/docs/notes/owasp-top10-2021/sql-injection"}},a={},o=[{value:"\u6709\u6f0f\u6d1e\u7684\u767b\u5165\u670d\u52d9\uff08\u5141\u8a31\u66b4\u529b\u7834\u89e3\uff09",id:"\u6709\u6f0f\u6d1e\u7684\u767b\u5165\u670d\u52d9\u5141\u8a31\u66b4\u529b\u7834\u89e3",level:2},{value:"\u274c \u6f0f\u6d1e\u7a0b\u5f0f\u78bc",id:"-\u6f0f\u6d1e\u7a0b\u5f0f\u78bc",level:3},{value:"\u5229\u7528 Hydra \u9032\u884c\u66b4\u529b\u7834\u89e3",id:"\u5229\u7528-hydra-\u9032\u884c\u66b4\u529b\u7834\u89e3",level:2},{value:"\ud83d\udd0d \u4f7f\u7528 Hydra \u4f86\u7834\u89e3\u5bc6\u78bc",id:"-\u4f7f\u7528-hydra-\u4f86\u7834\u89e3\u5bc6\u78bc",level:3},{value:"\ud83d\udd0d \u7834\u89e3\u6210\u529f\u7bc4\u4f8b",id:"-\u7834\u89e3\u6210\u529f\u7bc4\u4f8b",level:3},{value:"\u4fee\u88dc\u65b9\u5f0f",id:"\u4fee\u88dc\u65b9\u5f0f",level:2},{value:"\u2705 \u4fee\u6b63\u65b9\u5f0f 1\uff1a\u4f7f\u7528 bcrypt \u5132\u5b58\u5bc6\u78bc",id:"-\u4fee\u6b63\u65b9\u5f0f-1\u4f7f\u7528-bcrypt-\u5132\u5b58\u5bc6\u78bc",level:3},{value:"\u2705 \u4fee\u6b63\u65b9\u5f0f 2\uff1a\u52a0\u5165\u5931\u6557\u6b21\u6578\u9650\u5236",id:"-\u4fee\u6b63\u65b9\u5f0f-2\u52a0\u5165\u5931\u6557\u6b21\u6578\u9650\u5236",level:3},{value:"\u2705 \u4fee\u6b63\u65b9\u5f0f 3\uff1a\u52a0\u5165 CAPTCHA",id:"-\u4fee\u6b63\u65b9\u5f0f-3\u52a0\u5165-captcha",level:3},{value:"\u4fee\u88dc\u5f8c\u7684\u5b89\u5168\u6027\u63d0\u5347",id:"\u4fee\u88dc\u5f8c\u7684\u5b89\u5168\u6027\u63d0\u5347",level:2}];function c(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"a02-\u52a0\u5bc6\u5931\u6557cryptographic-failures",children:"A02: \u52a0\u5bc6\u5931\u6557\uff08Cryptographic Failures\uff09"})}),"\n",(0,s.jsxs)(e.p,{children:["\u4ee5\u4e0b\u5c55\u793a\u5c55\u793a\u5982\u4f55\u5229\u7528 ",(0,s.jsx)(e.strong,{children:"Hydra"})," \u6e2c\u8a66\u66b4\u529b\u7834\u89e3\u4e00\u500b ",(0,s.jsx)(e.strong,{children:"\u4e0d\u5b89\u5168\u7684\u767b\u5165 API"}),"\uff0c\u7136\u5f8c\u518d\u63d0\u4f9b\u4fee\u88dc\u65b9\u5f0f\u3002"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u6709\u6f0f\u6d1e\u7684\u767b\u5165\u670d\u52d9\u5141\u8a31\u66b4\u529b\u7834\u89e3",children:"\u6709\u6f0f\u6d1e\u7684\u767b\u5165\u670d\u52d9\uff08\u5141\u8a31\u66b4\u529b\u7834\u89e3\uff09"}),"\n",(0,s.jsxs)(e.p,{children:["\u9019\u500b\u670d\u52d9\u5b58\u5728\u4ee5\u4e0b",(0,s.jsx)(e.strong,{children:"\u56b4\u91cd\u6f0f\u6d1e"}),"\uff1a"]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u4f7f\u7528\u7c21\u55ae\u7684 MD5 \u5b58\u5132\u5bc6\u78bc"}),"\uff08\u5bc6\u78bc\u96dc\u6e4a\u904e\u65bc\u8106\u5f31\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u767b\u5165 API \u6c92\u6709\u4efb\u4f55\u9650\u5236"}),"\uff08\u53ef\u7121\u9650\u6b21\u5617\u8a66\u767b\u5165\uff09"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u6c92\u6709 CAPTCHA \u6216 IP \u9650\u5236"}),"\uff08\u53ef\u4ee5\u8f15\u6613\u7528\u5de5\u5177\u66b4\u529b\u7834\u89e3\uff09"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"-\u6f0f\u6d1e\u7a0b\u5f0f\u78bc",children:"\u274c \u6f0f\u6d1e\u7a0b\u5f0f\u78bc"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'package main\n\nimport (\n\t"crypto/md5"\n\t"encoding/hex"\n\t"encoding/json"\n\t"fmt"\n\t"log"\n\t"net/http"\n)\n\nvar users = map[string]string{\n\t"admin": hashPassword("password123"), // \u274c \u4f7f\u7528\u5f31\u5bc6\u78bc\n}\n\n// \u274c \u4f7f\u7528 MD5 \u5b58\u5132\u5bc6\u78bc\uff08\u975e\u5e38\u4e0d\u5b89\u5168\uff09\nfunc hashPassword(password string) string {\n\thash := md5.Sum([]byte(password))\n\treturn hex.EncodeToString(hash[:])\n}\n\n// \u274c \u767b\u5165 API\uff0c\u6c92\u6709\u9632\u66b4\u529b\u7834\u89e3\u4fdd\u8b77\nfunc loginHandler(w http.ResponseWriter, r *http.Request) {\n\tif err := r.ParseForm(); err != nil {\n\t\thttp.Error(w, "Invalid form data", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\tusername := r.FormValue("username")\n\tpassword := r.FormValue("password")\n\n\tif hashedPwd, exists := users[username]; exists && hashedPwd == hashPassword(password) {\n\t\tfmt.Fprintf(w, "Welcome, %s!", username)\n\t} else {\n\t\thttp.Error(w, "Invalid credentials", http.StatusUnauthorized)\n\t}\n}\n\nfunc main() {\n\thttp.HandleFunc("/login", loginHandler)\n\n\tfmt.Println("Server running on :8080")\n\tlog.Fatal(http.ListenAndServe(":8080", nil))\n}\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u5229\u7528-hydra-\u9032\u884c\u66b4\u529b\u7834\u89e3",children:"\u5229\u7528 Hydra \u9032\u884c\u66b4\u529b\u7834\u89e3"}),"\n",(0,s.jsxs)(e.p,{children:["Hydra \u662f\u4e00\u6b3e\u5c08\u9580\u7528\u4f86",(0,s.jsx)(e.strong,{children:"\u6e2c\u8a66\u5f31\u5bc6\u78bc\u7684\u66b4\u529b\u7834\u89e3\u5de5\u5177"}),"\uff0c\u53ef\u4ee5\u91dd\u5c0d Web \u61c9\u7528\u3001SSH\u3001FTP \u7b49\u591a\u7a2e\u5354\u8b70\u9032\u884c\u5bc6\u78bc\u731c\u6e2c\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"-\u4f7f\u7528-hydra-\u4f86\u7834\u89e3\u5bc6\u78bc",children:"\ud83d\udd0d \u4f7f\u7528 Hydra \u4f86\u7834\u89e3\u5bc6\u78bc"}),"\n",(0,s.jsx)(e.p,{children:"\u5047\u8a2d\u6211\u5011\u7684\u76ee\u6a19 API \u662f\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"http://localhost:8080/login\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u4f7f\u7528 Hydra \u9032\u884c\u66b4\u529b\u7834\u89e3\uff0c\u7c21\u55ae\u5275\u7acb\u4e00\u500b\u5bc6\u78bc\u5b57\u5178 password.txt\uff0c\u6211\u5011\u5c31\u53ef\u4ee5\u767c\u73fe\u4ed6\u88ab\u7834\u89e3\u51fa\u4f86\u4e86\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'hydra -l admin -P password.txt 127.0.0.1 -s 8080 http-post-form "/login:username=^USER^&password=^PASS^:1=:F=Invalid credentials"\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u8aaa\u660e\uff1a"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"-l admin"})}),"\uff1a\u6307\u5b9a\u5e33\u865f\u70ba ",(0,s.jsx)(e.code,{children:"admin"}),"\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"-P password.txt"})}),"\uff1a\u4f7f\u7528 ",(0,s.jsx)(e.code,{children:"password.txt"})," \u9032\u884c\u5bc6\u78bc\u66b4\u529b\u7834\u89e3\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"127.0.0.1"})}),"\uff1a\u76ee\u6a19\u4e3b\u6a5f\u70ba\u672c\u6a5f IP\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"-s 8080"})}),"\uff1a\u6307\u5b9a\u4f7f\u7528\u7684\u7aef\u53e3\u70ba 8080\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"http-post-form"})}),"\uff1a\u4f7f\u7528 HTTP POST \u8868\u55ae\u65b9\u5f0f\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:'"/login:username=^USER^&password=^PASS^:1=:F=Invalid credentials"'})}),"\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"/login"})}),"\uff1a\u767b\u5165\u9801\u9762\u8def\u5f91\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"username=^USER^&password=^PASS^"})}),"\uff1a\u8868\u55ae\u6578\u64da\uff0c\u66ff\u63db\u7528\u6236\u540d\u8207\u5bc6\u78bc\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"1="})}),"\uff1a\u6aa2\u67e5\u662f\u5426\u6709\u932f\u8aa4\u56de\u61c9\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"F=Invalid credentials"})}),'\uff1a\u4f3a\u670d\u5668\u56de\u61c9 "Invalid credentials" \u8868\u793a\u5bc6\u78bc\u932f\u8aa4\u3002']}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"-\u7834\u89e3\u6210\u529f\u7bc4\u4f8b",children:"\ud83d\udd0d \u7834\u89e3\u6210\u529f\u7bc4\u4f8b"}),"\n",(0,s.jsxs)(e.p,{children:["Hydra \u6703\u544a\u8a34\u6211\u5011\uff0c\u4ed6\u7834\u89e3\u7684\u5bc6\u78bc\u70ba",(0,s.jsx)(e.code,{children:"password123"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"Hydra v9.6dev (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).\n\nHydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-02-12 23:01:10\n[DATA] max 2 tasks per 1 server, overall 2 tasks, 2 login tries (l:1/p:2), ~1 try per task\n[DATA] attacking http-post-form://127.0.0.1:8080/login:username=^USER^&password=^PASS^:1=:F=Invalid credentials\n[8080][http-post-form] host: 127.0.0.1   login: admin   password: password123\n1 of 1 target successfully completed, 1 valid password found\nHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-02-12 23:01:11\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u9019\u4ee3\u8868\u6211\u5011\u6210\u529f\u66b4\u529b\u7834\u89e3\u4e86 ",(0,s.jsx)(e.strong,{children:"admin"})," \u5e33\u865f\u7684\u5bc6\u78bc\uff01\ud83d\udc80"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u4fee\u88dc\u65b9\u5f0f",children:"\u4fee\u88dc\u65b9\u5f0f"}),"\n",(0,s.jsx)(e.h3,{id:"-\u4fee\u6b63\u65b9\u5f0f-1\u4f7f\u7528-bcrypt-\u5132\u5b58\u5bc6\u78bc",children:"\u2705 \u4fee\u6b63\u65b9\u5f0f 1\uff1a\u4f7f\u7528 bcrypt \u5132\u5b58\u5bc6\u78bc"}),"\n",(0,s.jsxs)(e.p,{children:["\u53d6\u4ee3 ",(0,s.jsx)(e.strong,{children:"MD5"}),"\uff0c\u6539\u7528 ",(0,s.jsx)(e.strong,{children:"bcrypt"}),"\uff08\u9632\u6b62\u5bc6\u78bc\u5f69\u8679\u8868\u653b\u64ca\uff09\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'import "golang.org/x/crypto/bcrypt"\n\nfunc hashPassword(password string) (string, error) {\n\thashedPwd, err := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)\n\tif err != nil {\n\t\treturn "", err\n\t}\n\treturn string(hashedPwd), nil\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"-\u4fee\u6b63\u65b9\u5f0f-2\u52a0\u5165\u5931\u6557\u6b21\u6578\u9650\u5236",children:"\u2705 \u4fee\u6b63\u65b9\u5f0f 2\uff1a\u52a0\u5165\u5931\u6557\u6b21\u6578\u9650\u5236"}),"\n",(0,s.jsx)(e.p,{children:"\u9632\u6b62 Hydra \u7121\u9650\u6b21\u66b4\u529b\u7834\u89e3\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'var loginAttempts = make(map[string]int)\n\nfunc loginHandler(w http.ResponseWriter, r *http.Request) {\n\tif err := r.ParseForm(); err != nil {\n\t\thttp.Error(w, "Invalid form data", http.StatusBadRequest)\n\t\treturn\n\t}\n\n\tusername := r.FormValue("username")\n\tpassword := r.FormValue("password")\n\n\t// \u2705 \u9650\u5236\u6700\u591a 5 \u6b21\u5617\u8a66\n\tif loginAttempts[username] >= 5 {\n\t\thttp.Error(w, "Too many failed attempts, please try again later.", http.StatusTooManyRequests)\n\t\treturn\n\t}\n\n\tif hashedPwd, exists := users[username]; exists && hashedPwd == hashPassword(password) {\n\t\tfmt.Fprintf(w, "Welcome, %s!", username)\n\t\tloginAttempts[username] = 0 // \u91cd\u7f6e\u5931\u6557\u6b21\u6578\n\t\treturn\n\t}\n\n\t// \u5931\u6557\u6b21\u6578\u589e\u52a0\n\tloginAttempts[username]++\n\thttp.Error(w, "Invalid credentials", http.StatusUnauthorized)\n}\n'})}),"\n",(0,s.jsx)(e.h3,{id:"-\u4fee\u6b63\u65b9\u5f0f-3\u52a0\u5165-captcha",children:"\u2705 \u4fee\u6b63\u65b9\u5f0f 3\uff1a\u52a0\u5165 CAPTCHA"}),"\n",(0,s.jsx)(e.p,{children:"\u6bcf\u6b21\u767b\u5165\u932f\u8aa4 3 \u6b21\u5f8c\uff0c\u8981\u6c42\u7528\u6236\u8f38\u5165 CAPTCHA\uff0c\u963b\u6b62\u81ea\u52d5\u5316\u653b\u64ca\u3002"}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u4fee\u88dc\u5f8c\u7684\u5b89\u5168\u6027\u63d0\u5347",children:"\u4fee\u88dc\u5f8c\u7684\u5b89\u5168\u6027\u63d0\u5347"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u4fee\u88dc\u9805\u76ee"}),(0,s.jsx)(e.th,{children:"\u5177\u9ad4\u6539\u5584"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"\u4f7f\u7528 bcrypt"})}),(0,s.jsx)(e.td,{children:"\u9632\u6b62\u5f69\u8679\u8868\u653b\u64ca\uff0c\u8b93\u5bc6\u78bc\u66f4\u96e3\u7834\u89e3"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"\u5931\u6557\u6b21\u6578\u9650\u5236"})}),(0,s.jsx)(e.td,{children:"\u963b\u6b62\u66b4\u529b\u7834\u89e3\uff08Hydra \u5931\u6548\uff09"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"CAPTCHA"})}),(0,s.jsx)(e.td,{children:"\u9632\u6b62\u81ea\u52d5\u5316\u5de5\u5177\u653b\u64ca"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"HTTPS"})}),(0,s.jsx)(e.td,{children:"\u907f\u514d\u5bc6\u78bc\u5728\u50b3\u8f38\u6642\u88ab\u6514\u622a"})]})]})]})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(c,{...n})}):c(n)}},28453:(n,e,r)=>{r.d(e,{R:()=>i,x:()=>l});var s=r(96540);const t={},d=s.createContext(t);function i(n){const e=s.useContext(d);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:i(n.components),s.createElement(d.Provider,{value:e},n.children)}}}]);