"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[9649],{98893:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>o,frontMatter:()=>d,metadata:()=>i,toc:()=>h});var l=s(74848),r=s(28453);const d={},c="AutoScaling - Custom Pod AutoScaler",i={id:"notes/kubernetes-basics/autoscaling-custom-pod-autoscaler",title:"AutoScaling - Custom Pod AutoScaler",description:"\u5728 Kubernetes \u4e2d\uff0c\u539f\u751f\u7684\u6c34\u5e73 Pod \u81ea\u52d5\u64f4\u5c55\uff08HPA\uff09\u529f\u80fd\u901a\u5e38\u4f9d\u8cf4\u65bc CPU \u548c\u8a18\u61b6\u9ad4\u7684\u5e73\u5747\u4f7f\u7528\u91cf\u6216\u4f7f\u7528\u7387\u4f5c\u70ba\u81ea\u52d5\u64f4\u5c55\u7684\u89f8\u767c\u6307\u6a19\u3002",source:"@site/docs/notes/kubernetes-basics/28-autoscaling-custom-pod-autoscaler.mdx",sourceDirName:"notes/kubernetes-basics",slug:"/notes/kubernetes-basics/autoscaling-custom-pod-autoscaler",permalink:"/docs/notes/kubernetes-basics/autoscaling-custom-pod-autoscaler",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:28,frontMatter:{},sidebar:"notesSidebar",previous:{title:"AutoScaling - Vertical Pod AutoScaler",permalink:"/docs/notes/kubernetes-basics/autoscaling-vertical-pod-autoscaler"},next:{title:"Outline",permalink:"/docs/notes/design-pattern"}},t={},h=[{value:"Kubernetes Event-Driven Autoscaling (KEDA)",id:"kubernetes-event-driven-autoscaling-keda",level:2},{value:"KEDA \u7684\u6838\u5fc3\u7279\u9ede",id:"keda-\u7684\u6838\u5fc3\u7279\u9ede",level:2},{value:"KEDA \u7684\u61c9\u7528\u5834\u666f",id:"keda-\u7684\u61c9\u7528\u5834\u666f",level:2},{value:"KEDA \u8207 HPA \u7684\u6bd4\u8f03",id:"keda-\u8207-hpa-\u7684\u6bd4\u8f03",level:2},{value:"KEDA CRD\uff1aScaledObject \u8207 ScaledJob",id:"keda-crdscaledobject-\u8207-scaledjob",level:2},{value:"ScaledObject",id:"scaledobject",level:3},{value:"ScaledObject \u4e3b\u8981\u529f\u80fd",id:"scaledobject-\u4e3b\u8981\u529f\u80fd",level:3},{value:"ScaledObject YAML \u7bc4\u4f8b",id:"scaledobject-yaml-\u7bc4\u4f8b",level:3},{value:"ScaledObject \u91cd\u8981\u53c3\u6578",id:"scaledobject-\u91cd\u8981\u53c3\u6578",level:3},{value:"ScaledObject \u53ef\u9078\u53c3\u6578",id:"scaledobject-\u53ef\u9078\u53c3\u6578",level:3},{value:"ScaledJob",id:"scaledjob",level:3},{value:"ScaledJob \u4e3b\u8981\u529f\u80fd",id:"scaledjob-\u4e3b\u8981\u529f\u80fd",level:3},{value:"ScaledJob YAML \u7bc4\u4f8b",id:"scaledjob-yaml-\u7bc4\u4f8b",level:3},{value:"ScaledJob \u91cd\u8981\u53c3\u6578",id:"scaledjob-\u91cd\u8981\u53c3\u6578",level:3},{value:"ScaledJob \u53ef\u9078\u53c3\u6578",id:"scaledjob-\u53ef\u9078\u53c3\u6578",level:3},{value:"ScaledObject vs ScaledJob",id:"scaledobject-vs-scaledjob",level:3},{value:"KEDA Triggers \u4ecb\u7d39",id:"keda-triggers-\u4ecb\u7d39",level:2},{value:"1. Prometheus Trigger",id:"1-prometheus-trigger",level:3},{value:"YAML \u7bc4\u4f8b",id:"yaml-\u7bc4\u4f8b",level:4},{value:"\u53c3\u6578\u8aaa\u660e",id:"\u53c3\u6578\u8aaa\u660e",level:4},{value:"\u9069\u7528\u5834\u666f",id:"\u9069\u7528\u5834\u666f",level:4},{value:"2. Kafka Trigger",id:"2-kafka-trigger",level:3},{value:"YAML \u7bc4\u4f8b",id:"yaml-\u7bc4\u4f8b-1",level:4},{value:"\u53c3\u6578\u8aaa\u660e",id:"\u53c3\u6578\u8aaa\u660e-1",level:4},{value:"\u9069\u7528\u5834\u666f",id:"\u9069\u7528\u5834\u666f-1",level:4},{value:"3. PostgreSQL Trigger",id:"3-postgresql-trigger",level:3},{value:"YAML \u7bc4\u4f8b",id:"yaml-\u7bc4\u4f8b-2",level:4},{value:"\u53c3\u6578\u8aaa\u660e",id:"\u53c3\u6578\u8aaa\u660e-2",level:4},{value:"\u9069\u7528\u5834\u666f",id:"\u9069\u7528\u5834\u666f-2",level:4},{value:"4. Google Cloud Platform Storage (GCS) Trigger",id:"4-google-cloud-platform-storage-gcs-trigger",level:3},{value:"YAML \u7bc4\u4f8b",id:"yaml-\u7bc4\u4f8b-3",level:4},{value:"\u53c3\u6578\u8aaa\u660e",id:"\u53c3\u6578\u8aaa\u660e-3",level:4},{value:"\u9069\u7528\u5834\u666f",id:"\u9069\u7528\u5834\u666f-3",level:4},{value:"5. Elasticsearch Trigger",id:"5-elasticsearch-trigger",level:3},{value:"YAML \u7bc4\u4f8b",id:"yaml-\u7bc4\u4f8b-4",level:4},{value:"\u53c3\u6578\u8aaa\u660e",id:"\u53c3\u6578\u8aaa\u660e-4",level:4},{value:"\u9069\u7528\u5834\u666f",id:"\u9069\u7528\u5834\u666f-4",level:4},{value:"\u5be6\u4f5c\u4e00\u500b KEDA",id:"\u5be6\u4f5c\u4e00\u500b-keda",level:2},{value:"\u5b89\u88dd KEDA",id:"\u5b89\u88dd-keda",level:3},{value:"<strong>\u7d50\u8ad6</strong>",id:"\u7d50\u8ad6",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"autoscaling---custom-pod-autoscaler",children:"AutoScaling - Custom Pod AutoScaler"})}),"\n",(0,l.jsx)(n.p,{children:"\u5728 Kubernetes \u4e2d\uff0c\u539f\u751f\u7684\u6c34\u5e73 Pod \u81ea\u52d5\u64f4\u5c55\uff08HPA\uff09\u529f\u80fd\u901a\u5e38\u4f9d\u8cf4\u65bc CPU \u548c\u8a18\u61b6\u9ad4\u7684\u5e73\u5747\u4f7f\u7528\u91cf\u6216\u4f7f\u7528\u7387\u4f5c\u70ba\u81ea\u52d5\u64f4\u5c55\u7684\u89f8\u767c\u6307\u6a19\u3002\n\u7136\u800c\uff0c\u5c0d\u65bc\u4f7f\u7528 partition \u5206\u914d\u6a5f\u5236\u7684\u61c9\u7528\u7a0b\u5f0f\uff08\u5982 Kafka\uff09\u4f86\u8aaa\uff0c\u9019\u6a23\u7684\u8a2d\u5b9a\u53ef\u80fd\u6703\u5c0e\u81f4\u5de5\u4f5c\u8ca0\u8f09\u5206\u5e03\u4e0d\u5747\uff0c\u5f9e\u800c\u7121\u6cd5\u6709\u6548\u5730\u64f4\u5c55\u8cc7\u6e90\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u4f8b\u5982\uff0c\u67d0\u4e9b Pod \u53ef\u80fd\u9054\u5230\u5176\u8ca0\u8f09\u4e0a\u9650\uff0c\u4f46\u7531\u65bc\u6574\u9ad4\u7684\u5e73\u5747\u8cc7\u6e90\u4f7f\u7528\u7387\u5c1a\u672a\u9054\u5230\u95a5\u503c\uff0cHPA \u53ef\u80fd\u7121\u6cd5\u53ca\u6642\u89f8\u767c\u64f4\u5c55\u3002"}),"\n",(0,l.jsxs)(n.p,{children:["\u70ba\u4e86\u89e3\u6c7a\u9019\u500b\u554f\u984c\uff0c\u4e00\u500b\u6709\u6548\u7684\u7b56\u7565\u662f\u4f7f\u7528 ",(0,l.jsx)(n.strong,{children:"KEDA"}),"\uff08Kubernetes Event-Driven Autoscaling\uff09\u3002\nKEDA \u900f\u904e\u76e3\u63a7\u6bcf\u500b Pod \u7684\u4e8b\u4ef6\u8655\u7406\u901f\u5ea6\uff08\u4f8b\u5982 Kafka \u8a0a\u606f\u7684\u6d88\u8cbb\u901f\u5ea6\uff09\u4f86\u9032\u884c\u81ea\u52d5\u64f4\u5c55\uff0c\u800c\u4e0d\u50c5\u50c5\u4f9d\u8cf4\u65bc Pod \u7684\u5e73\u5747\u8cc7\u6e90\u4f7f\u7528\u60c5\u6cc1\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"\u9019\u7a2e\u65b9\u6cd5\u80fd\u7cbe\u78ba\u5730\u8abf\u6574 Pod \u6578\u91cf\uff0c\u6709\u6548\u89e3\u6c7a\u5de5\u4f5c\u8ca0\u8f09\u4e0d\u5747\u7684\u554f\u984c\uff0c\u4e26\u512a\u5316\u8cc7\u6e90\u4f7f\u7528\uff0c\u63d0\u5347\u6574\u9ad4\u61c9\u7528\u7a0b\u5f0f\u7684\u6027\u80fd\u8207\u53ef\u64f4\u5c55\u6027\u3002"}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"kubernetes-event-driven-autoscaling-keda",children:"Kubernetes Event-Driven Autoscaling (KEDA)"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Kubernetes Event-Driven Autoscaling (KEDA)"})," \u662f\u4e00\u7a2e ",(0,l.jsx)(n.strong,{children:"\u57fa\u65bc\u4e8b\u4ef6\u7684\u81ea\u52d5\u64f4\u5c55"})," \u89e3\u6c7a\u65b9\u6848\uff0c\n\u4e3b\u8981\u7528\u65bc ",(0,l.jsx)(n.strong,{children:"\u81ea\u52d5\u8abf\u6574 Kubernetes \u5de5\u4f5c\u8ca0\u8f09\u7684\u526f\u672c\u6578\u91cf"}),"\uff0c\u6839\u64da ",(0,l.jsx)(n.strong,{children:"\u4e8b\u4ef6\u9a45\u52d5"})," \u4f86\u52d5\u614b\u8abf\u6574\u61c9\u7528\u7a0b\u5f0f\u7684\u8cc7\u6e90\u5206\u914d\uff0c\n\u800c\u4e0d\u662f\u50c5\u4f9d\u8cf4 CPU \u6216\u8a18\u61b6\u9ad4\u4f7f\u7528\u7387\uff08\u5982 Horizontal Pod Autoscaler, HPA\uff09\u3002"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"keda-\u7684\u6838\u5fc3\u7279\u9ede",children:"KEDA \u7684\u6838\u5fc3\u7279\u9ede"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u4e8b\u4ef6\u9a45\u52d5\u7684\u81ea\u52d5\u7e2e\u653e"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"KEDA \u5141\u8a31\u61c9\u7528\u7a0b\u5f0f\u6839\u64da\u7279\u5b9a\u4e8b\u4ef6\u4f86\u6e90\uff08\u5982 Kafka\u3001RabbitMQ\u3001Azure Service Bus\u3001Prometheus \u7b49\uff09\u4f86\u6c7a\u5b9a\u4f55\u6642\u64f4\u5c55\u6216\u7e2e\u6e1b Pod \u6578\u91cf\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u8207 HPA\uff08Horizontal Pod Autoscaler\uff09\u6574\u5408"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"KEDA \u6703\u5c07\u4e8b\u4ef6\u4f86\u6e90\u7684\u6578\u64da\u8f49\u63db\u70ba Kubernetes \u7684 HPA \u6307\u6a19\uff0c\u4f7f HPA \u80fd\u5920\u6839\u64da\u9019\u4e9b\u4e8b\u4ef6\u4f86\u89f8\u767c Pod \u64f4\u5c55\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u7cbe\u7d30\u63a7\u5236 Pod \u7684\u64f4\u5c55"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u7576\u6c92\u6709\u8ca0\u8f09\u6642\uff0cKEDA \u53ef\u4ee5\u5c07 Pod \u7e2e\u6e1b\u70ba\u96f6\uff0c\u4ee5\u7bc0\u7701\u8cc7\u6e90\uff1b\u7576\u4e8b\u4ef6\u51fa\u73fe\u6642\uff0c\u5247\u80fd\u5920\u8fc5\u901f\u64f4\u5c55 Pod\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u652f\u63f4\u591a\u7a2e Scalers\uff08\u4e8b\u4ef6\u4f86\u6e90\uff09"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["KEDA \u5167\u5efa\u652f\u63f4 50 \u591a\u7a2e Scaler\uff0c\u4f8b\u5982\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u8a0a\u606f\u4f47\u5217\uff1aKafka\u3001RabbitMQ\u3001Azure Queue Storage"}),"\n",(0,l.jsx)(n.li,{children:"\u76e3\u63a7\u7cfb\u7d71\uff1aPrometheus\u3001Datadog"}),"\n",(0,l.jsx)(n.li,{children:"\u96f2\u7aef\u670d\u52d9\uff1aAWS SQS\u3001Google Pub/Sub"}),"\n",(0,l.jsx)(n.li,{children:"\u8cc7\u6599\u5eab\uff1aPostgreSQL\u3001MySQL"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"keda-\u7684\u61c9\u7528\u5834\u666f",children:"KEDA \u7684\u61c9\u7528\u5834\u666f"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u7121\u4f3a\u670d\u5668\u67b6\u69cb\uff08Serverless\uff09"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u8b93 Kubernetes \u4e0a\u7684\u61c9\u7528\u7a0b\u5f0f\u5177\u5099\u7121\u4f3a\u670d\u5668\u80fd\u529b\uff0c\u7576\u6c92\u6709\u8ca0\u8f09\u6642\uff0cPod \u6578\u91cf\u53ef\u4ee5\u964d\u5230\u96f6\uff0c\u907f\u514d\u8cc7\u6e90\u6d6a\u8cbb\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u8a0a\u606f\u4f47\u5217\u8655\u7406"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u900f\u904e KEDA\uff0c\u7cfb\u7d71\u80fd\u5920\u6839\u64da Kafka\u3001RabbitMQ\u3001SQS \u7b49\u8a0a\u606f\u4f47\u5217\u4e2d\u7684\u8ca0\u8f09\u52d5\u614b\u64f4\u5c55 Pod\uff0c\u78ba\u4fdd\u5373\u6642\u8655\u7406\u80fd\u529b\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u8cc7\u6599\u5eab\u89f8\u767c\u81ea\u52d5\u64f4\u5c55"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4f8b\u5982\uff0c\u6839\u64da PostgreSQL \u7684\u8cc7\u6599\u8b8a\u66f4\u4f86\u89f8\u767c Pod \u64f4\u5c55\uff0c\u9069\u7528\u65bc\u9ad8\u6d41\u91cf\u7684\u61c9\u7528\u7a0b\u5f0f\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u96f2\u7aef\u76e3\u63a7\u8207\u7570\u5e38\u97ff\u61c9"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4f7f\u7528 Prometheus \u6216 Datadog \u4f5c\u70ba\u4e8b\u4ef6\u4f86\u6e90\uff0c\u7576\u7cfb\u7d71\u76e3\u6e2c\u5230\u7570\u5e38\u6642\uff0c\u52d5\u614b\u64f4\u5c55\u61c9\u7528\u7a0b\u5f0f\u4ee5\u61c9\u5c0d\u7a81\u767c\u6d41\u91cf\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"keda-\u8207-hpa-\u7684\u6bd4\u8f03",children:"KEDA \u8207 HPA \u7684\u6bd4\u8f03"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{}),(0,l.jsx)(n.th,{children:(0,l.jsx)(n.strong,{children:"HPA\uff08\u6c34\u5e73\u81ea\u52d5\u64f4\u5c55\uff09"})}),(0,l.jsx)(n.th,{children:(0,l.jsx)(n.strong,{children:"KEDA\uff08\u4e8b\u4ef6\u9a45\u52d5\u81ea\u52d5\u64f4\u5c55\uff09"})})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u89f8\u767c\u689d\u4ef6"})}),(0,l.jsxs)(n.td,{children:["\u4e3b\u8981\u4f9d\u8cf4 ",(0,l.jsx)(n.strong,{children:"CPU / Memory"})]}),(0,l.jsxs)(n.td,{children:["\u4f9d\u8cf4 ",(0,l.jsx)(n.strong,{children:"\u4e8b\u4ef6\u4f86\u6e90\uff08Kafka, RabbitMQ, HTTP \u4f47\u5217...\uff09"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u6700\u4f4e Pod \u6578\u91cf"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"1"}),"\uff08\u7121\u6cd5\u6b78\u96f6\uff09"]}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"0"}),"\uff08\u5b8c\u5168\u91cb\u653e\u8cc7\u6e90\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u9069\u7528\u5834\u666f"})}),(0,l.jsx)(n.td,{children:"\u9577\u6642\u9593\u904b\u884c\u7684\u61c9\u7528\uff08\u5982 Web \u4f3a\u670d\u5668\uff09"}),(0,l.jsx)(n.td,{children:"\u9700\u6839\u64da\u8ca0\u8f09\u52d5\u614b\u555f\u52d5\u7684\u61c9\u7528\uff08\u5982\u80cc\u666f\u8655\u7406\u3001\u6279\u6b21\u4efb\u52d9\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u64f4\u5c55\u901f\u5ea6"})}),(0,l.jsx)(n.td,{children:"\u53d7 HPA \u5167\u90e8\u8a08\u7b97\u5f71\u97ff"}),(0,l.jsx)(n.td,{children:"\u5373\u6642\u4e8b\u4ef6\u9a45\u52d5"})]})]})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"keda-crdscaledobject-\u8207-scaledjob",children:"KEDA CRD\uff1aScaledObject \u8207 ScaledJob"}),"\n",(0,l.jsxs)(n.p,{children:["\u5728 ",(0,l.jsx)(n.strong,{children:"KEDA"})," \u7684\u6846\u67b6\u4e2d\uff0c",(0,l.jsx)(n.code,{children:"ScaledObject"})," \u548c ",(0,l.jsx)(n.code,{children:"ScaledJob"})," \u662f\u5169\u7a2e\u6838\u5fc3\u7684 ",(0,l.jsx)(n.strong,{children:"\u81ea\u5b9a\u7fa9\u8cc7\u6e90\uff08Custom Resource Definitions, CRDs\uff09"}),"\uff0c\n\u7528\u4f86\u5b9a\u7fa9\u5982\u4f55\u6839\u64da\u4e8b\u4ef6\u4f86 ",(0,l.jsx)(n.strong,{children:"\u81ea\u52d5\u64f4\u5c55\uff08Scaling\uff09Pod"})," \u6216 ",(0,l.jsx)(n.strong,{children:"\u5efa\u7acb\u77ed\u66ab\u7684\u6279\u6b21\u5de5\u4f5c\uff08Job\uff09"}),"\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:["\u9019\u5169\u7a2e CRD \u63d0\u4f9b\u4e86\u4e00\u7a2e\u9748\u6d3b\u7684\u65b9\u5f0f\u4f86\u7ba1\u7406 Kubernetes \u61c9\u7528\u7684 ",(0,l.jsx)(n.strong,{children:"\u4e8b\u4ef6\u9a45\u52d5\u64f4\u5c55"}),"\uff0c\u9069\u7528\u65bc\u5404\u7a2e\u61c9\u7528\u5834\u666f\uff0c\u5982 ",(0,l.jsx)(n.strong,{children:"\u4f47\u5217\u8655\u7406\u3001\u6279\u6b21\u4efb\u52d9\u3001\u8cc7\u6599\u5eab\u76e3\u63a7"})," \u7b49\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"scaledobject",children:"ScaledObject"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ScaledObject"})," \u7528\u65bc ",(0,l.jsx)(n.strong,{children:"\u7ba1\u7406\u9577\u671f\u57f7\u884c\u7684 Pod\uff08Deployment\u3001StatefulSet\u3001ReplicaSet\uff09"}),"\uff0c\u4e26\u6839\u64da\u4e8b\u4ef6\u4f86\u6e90\u4f86 ",(0,l.jsx)(n.strong,{children:"\u52d5\u614b\u64f4\u5c55\u6216\u7e2e\u6e1b"})," Pod \u7684\u526f\u672c\u6578\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"scaledobject-\u4e3b\u8981\u529f\u80fd",children:"ScaledObject \u4e3b\u8981\u529f\u80fd"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u91dd\u5c0d Kubernetes \u90e8\u7f72\uff08Deployment, StatefulSet, ReplicaSet\uff09\u9032\u884c\u64f4\u5c55"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u7576\u6c92\u6709\u4e8b\u4ef6\u6642\uff0c\u53ef\u4ee5\u5c07 Pod \u7e2e\u6e1b\u81f3 0\uff08\u7701\u8cc7\u6e90\uff09"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u53ef\u8207 HPA\uff08Horizontal Pod Autoscaler\uff09\u6574\u5408"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u652f\u63f4\u591a\u7a2e\u4e8b\u4ef6\u4f86\u6e90\uff0c\u5982 Kafka\u3001RabbitMQ\u3001Prometheus\u3001AWS SQS \u7b49"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"scaledobject-yaml-\u7bc4\u4f8b",children:"ScaledObject YAML \u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7bc4\u4f8b\uff1a\u6839\u64da Kafka \u8a0a\u606f\u6578\u91cf\u52d5\u614b\u8abf\u6574 Pod"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: kafka-scaler\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: my-kafka-consumer # \u6307\u5b9a\u8981\u64f4\u5c55\u7684 Deployment\n  minReplicaCount: 0 # \u6700\u5c0f Pod \u6578\u91cf\n  maxReplicaCount: 10 # \u6700\u5927 Pod \u6578\u91cf\n  idleReplicaCount: 1 # \u7576\u7121\u8ca0\u8f09\u6642\uff0c\u4ecd\u4fdd\u7559 1 \u500b Pod \u907f\u514d\u51b7\u555f\u52d5\n  cooldownPeriod: 30 # \u7121\u8ca0\u8f09\u5f8c 30 \u79d2\u5167\u7e2e\u6e1b\n  pollingInterval: 5 # \u6bcf 5 \u79d2\u6aa2\u67e5\u4e00\u6b21\u8ca0\u8f09\n\n  # \u53ef\u9078\uff1a\u7576 KEDA \u7121\u6cd5\u5b58\u53d6\u4e8b\u4ef6\u4f86\u6e90\u6642\u7684\u56de\u9000\u6a5f\u5236\n  fallback:\n    failureThreshold: 5 # \u9023\u7e8c 5 \u6b21\u5931\u6557\u8996\u70ba\u7121\u6cd5\u5b58\u53d6\u4e8b\u4ef6\u4f86\u6e90\n    replicas: 3 # \u7121\u6cd5\u5b58\u53d6\u4e8b\u4ef6\u4f86\u6e90\u6642\uff0c\u5f37\u5236\u7dad\u6301 3 \u500b Pod\n\n  # \u53ef\u9078\uff1a\u9032\u968e\u64f4\u5c55\u884c\u70ba\u63a7\u5236\n  advanced:\n    restoreToOriginalReplicaCount: true # \u505c\u7528 KEDA \u6642\u6062\u5fa9\u539f\u672c\u7684 ReplicaCount\n    horizontalPodAutoscalerConfig:\n      behavior:\n        scaleDown:\n          stabilizationWindowSeconds: 60 # 60 \u79d2\u5167\u4e0d\u9032\u884c\u7e2e\u6e1b\n          policies:\n            - type: Percent\n              value: 50\n              periodSeconds: 15\n        scaleUp:\n          stabilizationWindowSeconds: 0\n          policies:\n            - type: Percent\n              value: 100\n              periodSeconds: 5\n\n  triggers:\n    - type: kafka\n      metadata:\n        bootstrapServers: my-kafka-broker:9092\n        topic: my-topic\n        consumerGroup: my-group\n        lagThreshold: '100' # \u7576 Kafka \u8a0a\u606f\u7a4d\u58d3\u8d85\u904e 100 \u5247\u89f8\u767c\u64f4\u5c55\n"})}),"\n",(0,l.jsx)(n.h3,{id:"scaledobject-\u91cd\u8981\u53c3\u6578",children:"ScaledObject \u91cd\u8981\u53c3\u6578"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"scaleTargetRef.name"})}),(0,l.jsxs)(n.td,{children:["\u6307\u5b9a\u8981\u64f4\u5c55\u7684 ",(0,l.jsx)(n.strong,{children:"Pod\uff08Deployment, StatefulSet, ReplicaSet\uff09"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"minReplicaCount"})}),(0,l.jsx)(n.td,{children:"\u8a2d\u5b9a Pod \u7684\u6700\u5c0f\u6578\u91cf\uff0c\u53ef\u70ba 0"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"maxReplicaCount"})}),(0,l.jsx)(n.td,{children:"\u8a2d\u5b9a Pod \u7684\u6700\u5927\u6578\u91cf"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"idleReplicaCount"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u7576\u7121\u8ca0\u8f09\u6642\uff0c\u4ecd\u7136\u4fdd\u7559\u7684 Pod \u6578\u91cf"}),"\uff0c\u907f\u514d\u51b7\u555f\u52d5\uff08\u4f8b\u5982 ",(0,l.jsx)(n.code,{children:"1"})," \u8868\u793a\u5373\u4f7f\u7121\u8ca0\u8f09\u4ecd\u4fdd\u7559 1 \u500b Pod\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"cooldownPeriod"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u7121\u8ca0\u8f09\u6642\u7b49\u5f85\u591a\u4e45\u518d\u7e2e\u6e1b Pod"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"pollingInterval"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u591a\u4e45\u6aa2\u67e5\u4e00\u6b21\u4e8b\u4ef6\u4f86\u6e90"}),"\uff08\u9810\u8a2d 30 \u79d2\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"triggers"})}),(0,l.jsxs)(n.td,{children:["\u5b9a\u7fa9 ",(0,l.jsx)(n.strong,{children:"\u4e8b\u4ef6\u4f86\u6e90"}),"\uff08Kafka, RabbitMQ, SQS, Prometheus...\uff09"]})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"scaledobject-\u53ef\u9078\u53c3\u6578",children:"ScaledObject \u53ef\u9078\u53c3\u6578"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"fallback"})," (\u53ef\u9078)"]}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u7576 KEDA \u7121\u6cd5\u5b58\u53d6\u4e8b\u4ef6\u4f86\u6e90\u6642\uff0c\u56de\u9000\u5230\u9810\u8a2d\u526f\u672c\u6578"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"fallback.failureThreshold"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"KEDA \u5931\u6557\u591a\u5c11\u6b21\u5f8c\uff0c\u555f\u7528\u56de\u9000\u6a5f\u5236"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"fallback.replicas"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u56de\u9000\u6a5f\u5236\u555f\u52d5\u5f8c\uff0c\u5f37\u5236\u7dad\u6301\u7684 Pod \u6578\u91cf"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"advanced"})," (\u53ef\u9078)"]}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u9032\u968e\u81ea\u52d5\u64f4\u5c55\u8a2d\u5b9a"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"advanced.restoreToOriginalReplicaCount"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u505c\u7528 KEDA \u6642\uff0c\u662f\u5426\u6062\u5fa9\u539f\u672c\u7684 ReplicaCount"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"advanced.horizontalPodAutoscalerConfig"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u81ea\u8a02 HPA\uff08\u6c34\u5e73 Pod \u81ea\u52d5\u64f4\u5c55\uff09\u7684\u884c\u70ba"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"advanced.horizontalPodAutoscalerConfig.behavior"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u64f4\u5c55\u8207\u7e2e\u6e1b\u7684\u884c\u70ba\u63a7\u5236"})})]})]})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"scaledjob",children:"ScaledJob"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ScaledJob"})," \u7528\u65bc ",(0,l.jsx)(n.strong,{children:"\u7ba1\u7406\u77ed\u66ab\u57f7\u884c\u7684\u6279\u6b21\u5de5\u4f5c\uff08Jobs\uff09"}),"\uff0c\u9069\u5408\u4e00\u6b21\u6027\u6216\u81e8\u6642\u6027\u7684\u8a08\u7b97\u5de5\u4f5c\uff0c\u7576\u4e8b\u4ef6\u767c\u751f\u6642\uff0cKEDA \u6703 ",(0,l.jsx)(n.strong,{children:"\u52d5\u614b\u555f\u52d5 Kubernetes Job"}),"\uff0c\u4e26\u5728\u5de5\u4f5c\u5b8c\u6210\u5f8c\u81ea\u52d5\u91cb\u653e\u8cc7\u6e90\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"scaledjob-\u4e3b\u8981\u529f\u80fd",children:"ScaledJob \u4e3b\u8981\u529f\u80fd"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u9069\u7528\u65bc\u6279\u6b21\u4efb\u52d9\uff08Batch Jobs\uff09\uff0c\u5982\u5f71\u50cf\u8655\u7406\u3001\u8cc7\u6599\u5206\u6790"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u7576\u8ca0\u8f09\u589e\u52a0\u6642\uff0c\u81ea\u52d5\u555f\u52d5\u591a\u500b Job \u8655\u7406"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u7121\u8ca0\u8f09\u6642\uff0c\u4e0d\u6703\u7522\u751f\u591a\u9918\u7684 Pod\uff08\u964d\u4f4e\u8cc7\u6e90\u6d88\u8017\uff09"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u81ea\u52d5\u7ba1\u7406 Job \u7684\u522a\u9664\u8207\u932f\u8aa4\u8655\u7406"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"scaledjob-yaml-\u7bc4\u4f8b",children:"ScaledJob YAML \u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7bc4\u4f8b\uff1a\u6839\u64da RabbitMQ \u8a0a\u606f\u6578\u91cf\u89f8\u767c Job\uff0c\u4e26\u52a0\u5165\u9032\u968e\u63a7\u5236\u53c3\u6578"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'apiVersion: keda.sh/v1alpha1\nkind: ScaledJob\nmetadata:\n  name: rabbitmq-job-scaler\n  namespace: default\nspec:\n  jobTargetRef:\n    parallelism: 2 # \u5141\u8a31\u6700\u591a 2 \u500b Job \u540c\u6642\u904b\u884c\n    completions: 1 # \u6bcf\u500b Job \u53ea\u9700\u6210\u529f\u57f7\u884c 1 \u6b21\n    activeDeadlineSeconds: 300 # Job \u6700\u9577\u904b\u884c\u6642\u9593\u70ba 300 \u79d2\uff0c\u8d85\u6642\u5247\u7d42\u6b62\n    backoffLimit: 3 # Job \u5931\u6557\u5f8c\u6700\u591a\u91cd\u8a66 3 \u6b21\n    template:\n      spec:\n        containers:\n          - name: rabbitmq-client\n            image: rabbitmq-client:latest\n            command:\n              - receive\n            args:\n              - \'$(RABBITMQ_QUEUE)\'\n        restartPolicy: Never # Job \u7d50\u675f\u5f8c\u4e0d\u81ea\u52d5\u91cd\u555f\n\n  minReplicaCount: 0 # \u7576\u7121\u8ca0\u8f09\u6642\uff0c\u4e0d\u7522\u751f Job\n  maxReplicaCount: 20 # \u6700\u591a\u5141\u8a31 20 \u500b Job \u4f75\u767c\n  successfulJobsHistoryLimit: 5 # \u4fdd\u7559 5 \u500b\u6210\u529f Job \u8a18\u9304\n  failedJobsHistoryLimit: 5 # \u4fdd\u7559 5 \u500b\u5931\u6557 Job \u8a18\u9304\n  pollingInterval: 10 # \u6bcf 10 \u79d2\u6aa2\u67e5\u4e00\u6b21\u8ca0\u8f09\n\n  # \u53ef\u9078\uff1a\u5f9e\u6307\u5b9a Container \u8b80\u53d6\u74b0\u5883\u8b8a\u6578\n  envSourceContainerName: rabbitmq-client\n\n  # \u53ef\u9078\uff1a\u63a7\u5236 Job \u6efe\u52d5\u66f4\u65b0\u884c\u70ba\n  rollout:\n    strategy: gradual # \u9010\u6b65\u6efe\u52d5\u66f4\u65b0\uff08\u53ef\u9078 "immediate" \u6216 "gradual"\uff09\n\n  # \u53ef\u9078\uff1a\u81ea\u8a02 Job \u7684\u64f4\u5c55\u7b56\u7565\n  scalingStrategy:\n    strategy: custom # \u53ef\u9078 "default"\u3001"custom" \u6216 "accurate"\n    customScalingQueueLengthDeduction: 5 # \u6bcf\u6b21\u64f4\u5c55\u6642\uff0c\u984d\u5916\u6263\u9664 5 \u500b\u8a0a\u606f\u6578\n    customScalingRunningJobPercentage: 50 # \u7576 50% Job \u904b\u884c\u6642\uff0c\u505c\u6b62\u64f4\u5c55\n\n  triggers:\n    - type: rabbitmq\n      metadata:\n        queueName: my-queue\n        hostFromEnv: RABBITMQ_HOST\n        mode: QueueLength\n        value: \'50\' # \u7576\u4f47\u5217\u8a0a\u606f\u8d85\u904e 50 \u6642\u89f8\u767c Job\n'})}),"\n",(0,l.jsx)(n.h3,{id:"scaledjob-\u91cd\u8981\u53c3\u6578",children:"ScaledJob \u91cd\u8981\u53c3\u6578"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"jobTargetRef.template.spec.containers"})}),(0,l.jsx)(n.td,{children:"\u5b9a\u7fa9\u57f7\u884c\u7684 Job \u5167\u5bb9\uff08\u6620\u50cf\u540d\u7a31\u7b49\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"parallelism"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u63a7\u5236 Job \u5167\u90e8\u7684\u4f75\u767c\u6578\u91cf"}),"\uff08\u4f8b\u5982 ",(0,l.jsx)(n.code,{children:"2"})," \u8868\u793a\u540c\u6642\u6700\u591a 2 \u500b Pod \u57f7\u884c\u8a72 Job\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"completions"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u6bcf\u500b Job \u9700\u8981\u6210\u529f\u57f7\u884c\u7684\u6b21\u6578"}),"\uff08\u901a\u5e38\u70ba ",(0,l.jsx)(n.code,{children:"1"}),"\uff0c\u4f46\u53ef\u4ee5\u8a2d\u70ba\u66f4\u9ad8\u4f86\u78ba\u4fdd\u591a\u6b21\u6210\u529f\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"activeDeadlineSeconds"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"Job \u6700\u9577\u5141\u8a31\u57f7\u884c\u6642\u9593"}),"\uff0c\u8d85\u6642\u5247\u7d42\u6b62"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"backoffLimit"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"Job \u5931\u6557\u5f8c\u5141\u8a31\u7684\u91cd\u8a66\u6b21\u6578"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"minReplicaCount"})}),(0,l.jsx)(n.td,{children:"\u6700\u5c0f Job \u6578\u91cf\uff0c\u53ef\u70ba 0\uff08\u8868\u793a\u7121\u8ca0\u8f09\u6642\u4e0d\u7522\u751f Job\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"maxReplicaCount"})}),(0,l.jsx)(n.td,{children:"\u6700\u5927\u53ef\u540c\u6642\u57f7\u884c\u7684 Job \u6578\u91cf"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"successfulJobsHistoryLimit"})}),(0,l.jsx)(n.td,{children:"\u4fdd\u7559\u7684\u6210\u529f Job \u8a18\u9304\u6578\u91cf"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"failedJobsHistoryLimit"})}),(0,l.jsx)(n.td,{children:"\u4fdd\u7559\u7684\u5931\u6557 Job \u8a18\u9304\u6578\u91cf"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"pollingInterval"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u591a\u4e45\u6aa2\u67e5\u4e00\u6b21\u4e8b\u4ef6\u4f86\u6e90"}),"\uff08\u9810\u8a2d 30 \u79d2\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"triggers"})}),(0,l.jsxs)(n.td,{children:["\u5b9a\u7fa9 ",(0,l.jsx)(n.strong,{children:"\u4e8b\u4ef6\u4f86\u6e90"}),"\uff08Kafka, RabbitMQ, SQS, Prometheus...\uff09"]})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"scaledjob-\u53ef\u9078\u53c3\u6578",children:"ScaledJob \u53ef\u9078\u53c3\u6578"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"envSourceContainerName"})," (\u53ef\u9078)"]}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u6307\u5b9a\u5f9e\u54ea\u500b Container \u8b80\u53d6\u74b0\u5883\u8b8a\u6578"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"rollout"})," (\u53ef\u9078)"]}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u63a7\u5236 Job \u7684\u6efe\u52d5\u66f4\u65b0\u7b56\u7565"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"rollout.strategy"})}),(0,l.jsx)(n.td,{children:(0,l.jsxs)(n.strong,{children:[(0,l.jsx)(n.code,{children:"gradual"})," \u8868\u793a\u9010\u6b65\u6efe\u52d5\uff0c",(0,l.jsx)(n.code,{children:"immediate"})," \u8868\u793a\u7acb\u5373\u66f4\u65b0"]})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"scalingStrategy"})," (\u53ef\u9078)"]}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u81ea\u8a02 KEDA \u7684 Job \u64f4\u5c55\u884c\u70ba"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"scalingStrategy.strategy"})}),(0,l.jsx)(n.td,{children:(0,l.jsxs)(n.strong,{children:[(0,l.jsx)(n.code,{children:"default"})," \u4f7f\u7528 KEDA \u9810\u8a2d\u7b56\u7565\uff0c\u6216\u53ef\u4f7f\u7528",(0,l.jsx)(n.code,{children:"custom"}),"\u81ea\u8a02\u908f\u8f2f\uff0c",(0,l.jsx)(n.code,{children:"accurate"}),"\u5247\u63d0\u4f9b\u66f4\u7cbe\u78ba\u7684\u64f4\u5c55"]})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"scalingStrategy.customScalingQueueLengthDeduction"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u6bcf\u6b21\u64f4\u5c55\u6642\uff0c\u5f9e\u4f47\u5217\u9577\u5ea6\u984d\u5916\u6263\u9664\u591a\u5c11\u6d88\u606f\u6578\u91cf"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"scalingStrategy.customScalingRunningJobPercentage"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u7576\u904b\u884c\u4e2d\u7684 Job \u8d85\u904e\u67d0\u767e\u5206\u6bd4\u6642\uff0c\u505c\u6b62\u64f4\u5c55"})})]})]})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"scaledobject-vs-scaledjob",children:"ScaledObject vs ScaledJob"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{}),(0,l.jsx)(n.th,{children:(0,l.jsx)(n.strong,{children:"ScaledObject"})}),(0,l.jsx)(n.th,{children:(0,l.jsx)(n.strong,{children:"ScaledJob"})})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u9069\u7528\u5c0d\u8c61"})}),(0,l.jsx)(n.td,{children:"\u9577\u671f\u904b\u884c\u7684\u61c9\u7528\uff08Deployment, StatefulSet, ReplicaSet\uff09"}),(0,l.jsx)(n.td,{children:"\u77ed\u671f\u6279\u6b21\u5de5\u4f5c\uff08Job\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u6700\u5c0f\u526f\u672c\u6578"})}),(0,l.jsxs)(n.td,{children:["\u53ef\u7e2e\u6e1b\u81f3 ",(0,l.jsx)(n.code,{children:"0"})]}),(0,l.jsx)(n.td,{children:"\u7121\u8ca0\u8f09\u6642\u4e0d\u7522\u751f Job"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u6700\u5927\u526f\u672c\u6578"})}),(0,l.jsxs)(n.td,{children:["\u8a2d\u5b9a\u6700\u5927 ",(0,l.jsx)(n.code,{children:"Pod"})," \u6578"]}),(0,l.jsxs)(n.td,{children:["\u8a2d\u5b9a\u6700\u5927 ",(0,l.jsx)(n.code,{children:"Job"})," \u6578"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u662f\u5426\u6703\u81ea\u52d5\u522a\u9664"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"Pod \u6703\u6301\u7e8c\u904b\u884c"}),"\uff08\u9664\u975e\u624b\u52d5\u522a\u9664\uff09"]}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"Job \u5b8c\u6210\u5f8c\u81ea\u52d5\u522a\u9664"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u9069\u7528\u5834\u666f"})}),(0,l.jsx)(n.td,{children:"API \u4f3a\u670d\u5668\u3001\u5fae\u670d\u52d9\u3001\u81ea\u52d5\u64f4\u5c55\u6d88\u8cbb\u8005"}),(0,l.jsx)(n.td,{children:"\u6279\u6b21\u4efb\u52d9\u3001\u5f71\u50cf\u8655\u7406\u3001\u8cc7\u6599\u8f49\u63db"})]})]})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"keda-triggers-\u4ecb\u7d39",children:"KEDA Triggers \u4ecb\u7d39"}),"\n",(0,l.jsxs)(n.p,{children:["\u9019\u88e1\u6211\u5011\u6703\u4ecb\u7d39\u4ee5\u4e0b ",(0,l.jsx)(n.strong,{children:"5 \u7a2e KEDA Triggers"}),"\uff1a"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Prometheus"})," \u2192 \u900f\u904e Prometheus \u76e3\u63a7\u6307\u6a19\u4f86\u89f8\u767c\u64f4\u5c55"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Kafka"})," \u2192 \u6839\u64da Kafka \u4f47\u5217\u7a4d\u58d3\uff08lag\uff09\u52d5\u614b\u64f4\u5c55"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"PostgreSQL"})," \u2192 \u6839\u64da SQL \u67e5\u8a62\u7d50\u679c\u6c7a\u5b9a\u64f4\u5c55"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Google Cloud Platform Storage (GCS)"})," \u2192 \u4f9d\u64da GCS \u5132\u5b58\u6876\u7684\u7269\u4ef6\u6578\u89f8\u767c\u64f4\u5c55"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Elasticsearch"})," \u2192 \u6839\u64da\u65e5\u8a8c\u6578\u91cf\u3001\u641c\u5c0b\u8acb\u6c42\u6216\u5f85\u8655\u7406\u8a02\u55ae\u89f8\u767c\u64f4\u5c55"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"1-prometheus-trigger",children:"1. Prometheus Trigger"}),"\n",(0,l.jsxs)(n.p,{children:["Prometheus \u662f\u4e00\u500b\u958b\u6e90\u7684\u76e3\u63a7\u8207\u8b66\u5831\u5de5\u5177\uff0c\u5c08\u9580\u8655\u7406\u6307\u6a19\u8cc7\u6599\u800c\u8a2d\u8a08\uff0c\u6211\u5011\u53ef\u4ee5\u4f7f\u7528 Prometheus Scaler \u4f86\u5075\u6e2c\u55ae\u4e00 Pod \u7684\u4f7f\u7528\u7387\uff0c\u6839\u64da\u8cc7\u6599\u900f\u904e ",(0,l.jsx)(n.strong,{children:"\u81ea\u8a02\u6307\u6a19\uff08metrics\uff09"})," \u4f86\u89f8\u767c KEDA \u64f4\u5c55\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"yaml-\u7bc4\u4f8b",children:"YAML \u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: prometheus-scaler\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: my-deployment # \u8981\u64f4\u5c55\u7684 Deployment \u540d\u7a31\n  minReplicaCount: 1\n  maxReplicaCount: 10\n  pollingInterval: 10 # \u6bcf 10 \u79d2\u6aa2\u67e5\u4e00\u6b21\u6307\u6a19\n  triggers:\n    - type: prometheus\n      metadata:\n        serverAddress: http://prometheus.default.svc:9090\n        metricName: http_requests_total\n        query: sum(rate(http_requests_total{deployment=\"my-deployment\"}[2m])) # \u53d6 2 \u5206\u9418\u5167\u8acb\u6c42\u901f\u7387\n        threshold: '100' # \u7576\u8acb\u6c42\u901f\u7387\u8d85\u904e 100 \u6b21/\u79d2\u6642\u64f4\u5c55\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u53c3\u6578\u8aaa\u660e",children:"\u53c3\u6578\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"serverAddress"})}),(0,l.jsxs)(n.td,{children:["Prometheus \u4f3a\u670d\u5668\u4f4d\u5740\uff08\u901a\u5e38\u662f ",(0,l.jsx)(n.code,{children:"http://prometheus.default.svc:9090"}),"\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"metricName"})}),(0,l.jsxs)(n.td,{children:["\u6307\u6a19\u540d\u7a31\uff0c\u4f8b\u5982 ",(0,l.jsx)(n.code,{children:"http_requests_total"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"query"})}),(0,l.jsx)(n.td,{children:"PromQL \u67e5\u8a62\u8a9e\u6cd5\uff0c\u6c7a\u5b9a\u5982\u4f55\u8a08\u7b97\u64f4\u5c55\u689d\u4ef6"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"threshold"})}),(0,l.jsx)(n.td,{children:"\u7576\u67e5\u8a62\u7d50\u679c\u8d85\u904e\u6b64\u503c\u6642\u89f8\u767c\u64f4\u5c55"})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"\u9069\u7528\u5834\u666f",children:"\u9069\u7528\u5834\u666f"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"HTTP \u8acb\u6c42\u6d41\u91cf\u8b8a\u5316\u5927\u6642\uff0c\u81ea\u52d5\u64f4\u5c55\u670d\u52d9"}),"\n",(0,l.jsx)(n.li,{children:"\u6839\u64da CPU\u3001\u8a18\u61b6\u9ad4\u3001\u4f7f\u7528\u8005\u6578\u91cf\u7b49\u6307\u6a19\u4f86\u8abf\u6574 Pod \u6578\u91cf"}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"2-kafka-trigger",children:"2. Kafka Trigger"}),"\n",(0,l.jsxs)(n.p,{children:["Kafka \u662f\u4e00\u500b\u5206\u6563\u5f0f\u7684\u8cc7\u6599\u4e32\u6d41\u5e73\u53f0\uff0c\u53ef\u4ee5\u8655\u7406\u5be6\u6642\u8cc7\u6599\u4e32\u6d41\uff0cKEDA \u53ef\u4ee5\u6839\u64da ",(0,l.jsx)(n.strong,{children:"Kafka topic \u7684\u7a4d\u58d3\u6578\u91cf\uff08lag\uff09"})," \u4f86\u6c7a\u5b9a\u662f\u5426\u64f4\u5c55 Consumer\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"yaml-\u7bc4\u4f8b-1",children:"YAML \u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: kafka-scaler\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: kafka-consumer\n  minReplicaCount: 1\n  maxReplicaCount: 10\n  pollingInterval: 5\n  triggers:\n    - type: kafka\n      metadata:\n        bootstrapServers: my-kafka-broker:9092\n        topic: my-topic\n        consumerGroup: my-group\n        # Optional\n        lagThreshold: '100' # \u7576\u7a4d\u58d3\u8d85\u904e 100 \u5247\u8a0a\u606f\u6642\u89f8\u767c\u64f4\u5c55\n        offsetResetPolicy: latest # \u8a2d\u5b9a Kafka \u6d88\u8cbb\u8005\u5f9e\u6700\u65b0\u7684\u8a0a\u606f\u958b\u59cb\u8b80\u53d6\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u53c3\u6578\u8aaa\u660e-1",children:"\u53c3\u6578\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"bootstrapServers"})}),(0,l.jsx)(n.td,{children:"Kafka \u4ee3\u7406\u4f3a\u670d\u5668\u7684\u4f4d\u5740"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"topic"})}),(0,l.jsx)(n.td,{children:"\u8981\u76e3\u807d\u7684 Kafka topic"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"consumerGroup"})}),(0,l.jsx)(n.td,{children:"\u76e3\u807d\u7684\u6d88\u8cbb\u8005\u7fa4\u7d44\uff08Consumer Group\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"lagThreshold"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u7576 Kafka topic \u7a4d\u58d3\u6578\u91cf\u8d85\u904e\u8a72\u503c\u6642\u89f8\u767c\u64f4\u5c55"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"offsetResetPolicy"})}),(0,l.jsx)(n.td,{children:"\u8a2d\u5b9a Kafka \u6d88\u8cbb\u8005\u5f9e\u6700\u65b0\u7684\u8a0a\u606f\u958b\u59cb\u8b80\u53d6"})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"\u9069\u7528\u5834\u666f-1",children:"\u9069\u7528\u5834\u666f"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Kafka Consumer \u9700\u8981\u6839\u64da\u8ca0\u8f09\u52d5\u614b\u64f4\u5c55"}),"\n",(0,l.jsx)(n.li,{children:"\u78ba\u4fdd\u8a0a\u606f\u8655\u7406\u901f\u5ea6\u4e0d\u6703\u843d\u5f8c"}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"3-postgresql-trigger",children:"3. PostgreSQL Trigger"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"PostgreSQL Trigger"})," \u53ef\u4ee5\u6839\u64da ",(0,l.jsx)(n.strong,{children:"PostgreSQL \u67e5\u8a62\u7d50\u679c"}),"\uff08\u4f8b\u5982\u7576\u524d\u6b63\u5728\u8655\u7406\u7684\u4efb\u52d9\u6578\u91cf\uff09\u4f86\u6c7a\u5b9a\u662f\u5426\u9700\u8981\u8abf\u6574\u8cc7\u6e90\uff0c\u4e26\u6839\u64da\u8ca0\u8f09\u60c5\u6cc1\u81ea\u52d5\u64f4\u5c55\u6216\u7e2e\u6e1b Pod \u6578\u91cf\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"yaml-\u7bc4\u4f8b-2",children:"YAML \u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: airflow-worker\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: airflow-worker\n  minReplicaCount: 1\n  maxReplicaCount: 10 # Optional. Default: 100\n  pollingInterval: 10 # Optional. Default: 30 seconds\n  cooldownPeriod: 30 # Optional. Default: 300 seconds\n  triggers:\n    - type: postgresql\n      metadata:\n        connectionFromEnv: AIRFLOW_CONN_AIRFLOW_DB # \u5f9e\u74b0\u5883\u8b8a\u6578\u4e2d\u53d6\u5f97 PostgreSQL \u9023\u7dda\u5b57\u4e32\n        query: \"SELECT ceil(COUNT(*): : decimal / 16) FROM task_instance WHERE state='running' OR state='queued'\" # SQL \u67e5\u8a62\u8a9e\u6cd5\uff0c\u67e5\u8a62\u7576\u524d\u6b63\u5728\u904b\u884c\u6216\u6392\u968a\u7684\u4efb\u52d9\u6578\u91cf\uff0c\u4e26\u5c07\u5176\u9664\u4ee5 16 \u4f86\u78ba\u5b9a\u6240\u9700\u7684\u5de5\u4f5c\u8005\u6578\u91cf\n        targetQueryValue: 1 # \u7576\u67e5\u8a62\u7d50\u679c\u5927\u65bc 1 \u6642\u89f8\u767c\u64f4\u5c55\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u53c3\u6578\u8aaa\u660e-2",children:"\u53c3\u6578\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"connectionFromEnv"})}),(0,l.jsxs)(n.td,{children:["\u900f\u904e\u74b0\u5883\u8b8a\u6578\u8a2d\u5b9a PostgreSQL \u9023\u7dda\u5b57\u4e32\uff0c\u8a72\u5b57\u4e32\u4e2d\u5305\u542b\u8cc7\u6599\u5eab\u7684\u9023\u7dda\u8cc7\u8a0a\uff08\u5982\u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"AIRFLOW_CONN_AIRFLOW_DB"})," \u4f86\u53d6\u5f97\u9023\u7dda\u5b57\u4e32\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"query"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"SQL \u67e5\u8a62\u8a9e\u6cd5"}),"\uff0c\u9019\u500b\u67e5\u8a62\u6703\u57f7\u884c\u5f8c\u8fd4\u56de\u4e00\u500b\u6578\u503c\uff0cKEDA \u6703\u5c07\u5176\u8207 ",(0,l.jsx)(n.code,{children:"targetQueryValue"})," \u9032\u884c\u6bd4\u8f03\u3002\u6b64\u67e5\u8a62\u7684\u76ee\u7684\u662f\u8a08\u7b97\u7576\u524d\u6b63\u5728\u8655\u7406\u6216\u6392\u968a\u7684\u4efb\u52d9\u6578\u91cf"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"targetQueryValue"})}),(0,l.jsx)(n.td,{children:"\u7576\u67e5\u8a62\u7d50\u679c\u8d85\u904e\u8a72\u503c\u6642\uff0c\u89f8\u767c Pod \u64f4\u5c55\u3002\u9019\u8868\u793a\u7576\u76ee\u524d\u7684\u4efb\u52d9\u6578\u91cf\u9054\u5230\u6216\u8d85\u904e\u6b64\u503c\u6642\uff0c\u5c31\u6703\u555f\u52d5\u64f4\u5c55\u52d5\u4f5c"})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"\u9069\u7528\u5834\u666f-2",children:"\u9069\u7528\u5834\u666f"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u6279\u6b21\u8655\u7406\u7cfb\u7d71"}),"\uff08\u5982\uff1a\u8cc7\u6599\u532f\u5165\u3001\u5831\u8868\u751f\u6210\uff09"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u6839\u64da\u672a\u8655\u7406\u7684\u8a02\u55ae\u6216\u8acb\u6c42\u6578\u91cf\u81ea\u52d5\u64f4\u5c55 API \u4f3a\u670d\u5668"})}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"4-google-cloud-platform-storage-gcs-trigger",children:"4. Google Cloud Platform Storage (GCS) Trigger"}),"\n",(0,l.jsx)(n.p,{children:"KEDA \u4e5f\u53ef\u4ee5\u76e3\u807d Google Cloud Storage\uff08GCS\uff09\u5132\u5b58\u6876\uff0c\u7576\u6876\u5167\u7684\u6a94\u6848\u6578\u91cf\u8d85\u904e\u6307\u5b9a\u503c\u6642\uff0c\u81ea\u52d5\u64f4\u5c55\u8655\u7406\u9019\u4e9b\u6a94\u6848\u7684 Pod\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"yaml-\u7bc4\u4f8b-3",children:"YAML \u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: gcs-scaler\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: gcs-processor\n  minReplicaCount: 1\n  maxReplicaCount: 10\n  pollingInterval: 15\n  triggers:\n    - type: gcp-storage\n      metadata:\n        bucketName: my-storage-bucket\n        targetObjectCount: '100' # \u7576\u6876\u5167\u7269\u4ef6\u8d85\u904e 100 \u500b\u6642\u64f4\u5c55\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u53c3\u6578\u8aaa\u660e-3",children:"\u53c3\u6578\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"bucketName"})}),(0,l.jsx)(n.td,{children:"\u76e3\u807d\u7684 GCS \u5132\u5b58\u6876\u540d\u7a31"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"targetObjectCount"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u7576\u6876\u5167\u7269\u4ef6\u8d85\u904e\u6b64\u6578\u91cf\u6642\u89f8\u767c\u64f4\u5c55"})})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"\u9069\u7528\u5834\u666f-3",children:"\u9069\u7528\u5834\u666f"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u6839\u64da GCS \u4e2d\u7684\u6a94\u6848\u6578\u91cf\u64f4\u5c55\u5f71\u50cf\u8655\u7406\u3001\u8cc7\u6599\u8f49\u63db\u670d\u52d9"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u9069\u7528\u65bc\u5f71\u7247\u7de8\u78bc\u3001\u65e5\u8a8c\u5206\u6790\u3001\u6a5f\u5668\u5b78\u7fd2\u8cc7\u6599\u8655\u7406\u7b49\u61c9\u7528"})}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"5-elasticsearch-trigger",children:"5. Elasticsearch Trigger"}),"\n",(0,l.jsxs)(n.p,{children:["Elasticsearch \u662f\u4e00\u500b\u5f37\u5927\u7684\u5168\u6587\u641c\u5c0b\u8207\u5206\u6790\u5f15\u64ce\uff0c\u5e38\u7528\u65bc\u65e5\u8a8c\u5206\u6790\u3001\u641c\u5c0b\u5f15\u64ce\u3001\u6307\u6a19\u76e3\u63a7\u7b49\u5834\u666f\u3002KEDA \u53ef\u4ee5\u6839\u64da ",(0,l.jsx)(n.strong,{children:"Elasticsearch \u67e5\u8a62\u7d50\u679c"})," \u4f86\u6c7a\u5b9a\u662f\u5426\u64f4\u5c55 Kubernetes \u7684 Pod\uff0c\u4f8b\u5982\u6839\u64da\u7d22\u5f15\u4e2d\u7684\u6587\u4ef6\u6578\u91cf\u3001\u67e5\u8a62\u547d\u4e2d\u6578\u91cf\u3001\u641c\u5c0b\u983b\u7387\u7b49\u689d\u4ef6\u89f8\u767c\u81ea\u52d5\u64f4\u5c55\u3002"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h4,{id:"yaml-\u7bc4\u4f8b-4",children:"YAML \u7bc4\u4f8b"}),"\n",(0,l.jsxs)(n.p,{children:["\u9019\u500b\u7bc4\u4f8b\u793a\u7bc4\u5982\u4f55\u6839\u64da ",(0,l.jsx)(n.strong,{children:"\u7d22\u5f15\u4e2d\u7684\u672a\u8655\u7406\u65e5\u8a8c\u6578\u91cf"})," \u4f86\u89f8\u767c\u64f4\u5c55\u61c9\u7528\u7a0b\u5f0f\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: elasticsearch-scaler\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: log-processor # \u8981\u64f4\u5c55\u7684 Deployment\n  minReplicaCount: 1\n  maxReplicaCount: 15\n  pollingInterval: 10 # \u6bcf 10 \u79d2\u6aa2\u67e5\u4e00\u6b21 Elasticsearch\n  triggers:\n    - type: elasticsearch\n      metadata:\n        addresses: http://elasticsearch.default.svc:9200\n        index: logs\n        query: \'{"query": {"match": {"status": "pending"}}}\'\n        threshold: \'1000\' # \u7576\u67e5\u8a62\u7d50\u679c\u8d85\u904e 1000 \u5247\u6642\u89f8\u767c\u64f4\u5c55\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h4,{id:"\u53c3\u6578\u8aaa\u660e-4",children:"\u53c3\u6578\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"addresses"})}),(0,l.jsxs)(n.td,{children:["Elasticsearch \u4f3a\u670d\u5668\u4f4d\u5740\uff08\u901a\u5e38\u662f ",(0,l.jsx)(n.code,{children:"http://elasticsearch.default.svc:9200"}),"\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"index"})}),(0,l.jsxs)(n.td,{children:["\u76e3\u807d\u7684 ",(0,l.jsx)(n.strong,{children:"Elasticsearch \u7d22\u5f15"}),"\uff08\u5982 ",(0,l.jsx)(n.code,{children:"logs"}),"\u3001",(0,l.jsx)(n.code,{children:"orders"}),"\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"query"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"Elasticsearch JSON \u67e5\u8a62\u8a9e\u6cd5"}),"\uff0c\u53ef\u4ee5\u81ea\u8a02\u67e5\u8a62\u689d\u4ef6"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"threshold"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u7576\u67e5\u8a62\u7d50\u679c\u6578\u91cf\u8d85\u904e\u8a72\u503c\u6642\u89f8\u767c\u64f4\u5c55"})})]})]})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h4,{id:"\u9069\u7528\u5834\u666f-4",children:"\u9069\u7528\u5834\u666f"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u65e5\u8a8c\u5206\u6790\u8207\u8655\u7406"}),"\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6839\u64da ",(0,l.jsx)(n.strong,{children:"Elasticsearch \u4e2d\u5f85\u8655\u7406\u7684\u65e5\u8a8c\u6578\u91cf"})," \u64f4\u5c55\u65e5\u8a8c\u5206\u6790\u670d\u52d9"]}),"\n",(0,l.jsx)(n.li,{children:"\u907f\u514d\u65e5\u8a8c\u7a4d\u58d3\uff0c\u78ba\u4fdd\u65e5\u8a8c\u8655\u7406\u901f\u5ea6\u8ddf\u4e0a\u6d41\u91cf"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u641c\u5c0b\u8acb\u6c42\u76e3\u63a7"}),"\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6839\u64da\u641c\u5c0b\u8acb\u6c42\u7684 ",(0,l.jsx)(n.strong,{children:"\u547d\u4e2d\u6578\u91cf\u6216\u983b\u7387"})," \u4f86\u8abf\u6574\u641c\u5c0b API \u7684 Pod \u6578\u91cf"]}),"\n",(0,l.jsx)(n.li,{children:"\u78ba\u4fdd\u9ad8\u641c\u5c0b\u6d41\u91cf\u6642\u63d0\u4f9b\u7a69\u5b9a\u6548\u80fd"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u8a02\u55ae\u6216\u4ea4\u6613\u8655\u7406"}),"\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u76e3\u63a7 ",(0,l.jsx)(n.strong,{children:"Elasticsearch \u4e2d\u7684\u5f85\u8655\u7406\u8a02\u55ae"}),"\uff0c\u6839\u64da\u7a4d\u58d3\u6578\u91cf\u64f4\u5c55 API \u6216\u80cc\u666f\u5de5\u4f5c\u8005"]}),"\n",(0,l.jsx)(n.li,{children:"\u78ba\u4fdd\u7cfb\u7d71\u80fd\u61c9\u5c0d\u7a81\u767c\u7684\u5927\u91cf\u4ea4\u6613\u8acb\u6c42"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"\u5be6\u4f5c\u4e00\u500b-keda",children:"\u5be6\u4f5c\u4e00\u500b KEDA"}),"\n",(0,l.jsx)(n.h3,{id:"\u5b89\u88dd-keda",children:"\u5b89\u88dd KEDA"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u5b89\u88dd KEDA"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u53ef\u4ee5\u900f\u904e Helm \u6216 kubectl \u5b89\u88dd KEDA\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"helm repo add kedacore https://kedacore.github.io/charts\nhelm install keda kedacore/keda --namespace keda --create-namespace\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u5b9a\u7fa9 ScaledObject\uff08\u7e2e\u653e\u898f\u5247\uff09"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4f8b\u5982\uff0c\u4ee5\u4e0b\u662f\u4f7f\u7528 Azure Service Bus \u4f47\u5217\u4f5c\u70ba\u4e8b\u4ef6\u4f86\u6e90\u7684 ",(0,l.jsx)(n.code,{children:"ScaledObject"}),"\uff1a","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: azure-queue-scaler\nspec:\n  scaleTargetRef:\n    name: my-app # \u9700\u8981\u7e2e\u653e\u7684 Deployment\n  minReplicaCount: 0\n  maxReplicaCount: 10\n  triggers:\n    - type: azure-servicebus\n      metadata:\n        queueName: my-queue\n        connectionFromEnv: SERVICEBUS_CONNECTIONSTRING\n        messageCount: '5' # \u7576\u8a0a\u606f\u6578\u8d85\u904e 5\uff0c\u958b\u59cb\u64f4\u5c55 Pod\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u7576 ",(0,l.jsx)(n.code,{children:"my-queue"})," \u4e2d\u7684\u8a0a\u606f\u6578\u91cf\u8d85\u904e 5\uff0cKEDA \u6703\u89f8\u767c Kubernetes HPA\uff0c\u81ea\u52d5\u64f4\u5c55 ",(0,l.jsx)(n.code,{children:"my-app"})," \u7684 Pod\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Pod \u81ea\u52d5\u7e2e\u653e"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u82e5\u4e8b\u4ef6\u4f86\u6e90\uff08\u5982\u4f47\u5217\uff09\u4e2d\u6709\u7d2f\u7a4d\u7684\u8a0a\u606f\uff0cKEDA \u6703\u89f8\u767c Pod \u64f4\u5c55\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u82e5\u8a0a\u606f\u8655\u7406\u5b8c\u7562\uff0cPod \u6703\u9010\u6f38\u7e2e\u6e1b\uff0c\u751a\u81f3\u6b78\u96f6\uff0c\u7bc0\u7701\u8cc7\u6e90\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u7d50\u8ad6",children:(0,l.jsx)(n.strong,{children:"\u7d50\u8ad6"})}),"\n",(0,l.jsx)(n.p,{children:"KEDA \u8b93 Kubernetes \u80fd\u5920\u4ee5\u4e8b\u4ef6\u70ba\u9a45\u52d5\uff0c\u52d5\u614b\u8abf\u6574\u61c9\u7528\u7a0b\u5f0f\u7684\u8cc7\u6e90\u914d\u7f6e\uff0c\u7279\u5225\u9069\u5408\u8655\u7406\u975e\u6301\u7e8c\u6027\u7684\u8ca0\u8f09\uff0c\u5982\u8a0a\u606f\u4f47\u5217\u3001\u76e3\u63a7\u8b66\u5831\u7b49\u3002\u900f\u904e\u8207 HPA \u7684\u7121\u7e2b\u6574\u5408\uff0c\u5b83\u70ba\u958b\u767c\u8005\u63d0\u4f9b\u4e86\u4e00\u7a2e\u9748\u6d3b\u4e14\u9ad8\u6548\u7684\u81ea\u52d5\u64f4\u5c55\u65b9\u6848\uff0c\u4f7f Kubernetes \u61c9\u7528\u66f4\u5177\u5f48\u6027\u8207\u53ef\u64f4\u5c55\u6027\u3002"})]})}function o(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>i});var l=s(96540);const r={},d=l.createContext(r);function c(e){const n=l.useContext(d);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),l.createElement(d.Provider,{value:n},e.children)}}}]);