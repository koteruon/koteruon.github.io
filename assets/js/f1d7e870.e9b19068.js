"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[9649],{4512:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"notes/kubernetes-basics/autoscaling-custom-pod-autoscaler","title":"AutoScaling - Custom Pod AutoScaler","description":"\u5728 Kubernetes \u4e2d\uff0c\u539f\u751f\u7684\u6c34\u5e73 Pod \u81ea\u52d5\u64f4\u5c55\uff08HPA\uff09\u529f\u80fd\u901a\u5e38\u4f9d\u8cf4\u65bc CPU \u548c\u8a18\u61b6\u9ad4\u7684\u5e73\u5747\u4f7f\u7528\u91cf\u6216\u4f7f\u7528\u7387\u4f5c\u70ba\u81ea\u52d5\u64f4\u5c55\u7684\u89f8\u767c\u6307\u6a19\u3002","source":"@site/docs/notes/kubernetes-basics/28-autoscaling-custom-pod-autoscaler.mdx","sourceDirName":"notes/kubernetes-basics","slug":"/notes/kubernetes-basics/autoscaling-custom-pod-autoscaler","permalink":"/docs/notes/kubernetes-basics/autoscaling-custom-pod-autoscaler","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":28,"frontMatter":{},"sidebar":"notesSidebar","previous":{"title":"AutoScaling - Vertical Pod AutoScaler","permalink":"/docs/notes/kubernetes-basics/autoscaling-vertical-pod-autoscaler"},"next":{"title":"Security - User Management with Kubernetes Context","permalink":"/docs/notes/kubernetes-basics/security-user-management-with-kubernetes-context"}}');var l=s(74848),d=s(28453);const i={},c="AutoScaling - Custom Pod AutoScaler",t={},a=[{value:"Kubernetes Event-Driven Autoscaling (KEDA)",id:"kubernetes-event-driven-autoscaling-keda",level:2},{value:"KEDA \u7684\u6838\u5fc3\u7279\u9ede",id:"keda-\u7684\u6838\u5fc3\u7279\u9ede",level:2},{value:"KEDA \u7684\u61c9\u7528\u5834\u666f",id:"keda-\u7684\u61c9\u7528\u5834\u666f",level:2},{value:"KEDA \u8207 HPA \u7684\u6bd4\u8f03",id:"keda-\u8207-hpa-\u7684\u6bd4\u8f03",level:2},{value:"KEDA CRD\uff1aScaledObject \u8207 ScaledJob",id:"keda-crdscaledobject-\u8207-scaledjob",level:2},{value:"ScaledObject",id:"scaledobject",level:3},{value:"ScaledObject \u4e3b\u8981\u529f\u80fd",id:"scaledobject-\u4e3b\u8981\u529f\u80fd",level:3},{value:"ScaledObject YAML \u7bc4\u4f8b",id:"scaledobject-yaml-\u7bc4\u4f8b",level:3},{value:"ScaledObject \u91cd\u8981\u53c3\u6578",id:"scaledobject-\u91cd\u8981\u53c3\u6578",level:3},{value:"ScaledObject \u53ef\u9078\u53c3\u6578",id:"scaledobject-\u53ef\u9078\u53c3\u6578",level:3},{value:"ScaledJob",id:"scaledjob",level:3},{value:"ScaledJob \u4e3b\u8981\u529f\u80fd",id:"scaledjob-\u4e3b\u8981\u529f\u80fd",level:3},{value:"ScaledJob YAML \u7bc4\u4f8b",id:"scaledjob-yaml-\u7bc4\u4f8b",level:3},{value:"ScaledJob \u91cd\u8981\u53c3\u6578",id:"scaledjob-\u91cd\u8981\u53c3\u6578",level:3},{value:"ScaledJob \u53ef\u9078\u53c3\u6578",id:"scaledjob-\u53ef\u9078\u53c3\u6578",level:3},{value:"ScaledObject vs ScaledJob",id:"scaledobject-vs-scaledjob",level:3},{value:"KEDA Triggers \u4ecb\u7d39",id:"keda-triggers-\u4ecb\u7d39",level:2},{value:"1. Prometheus Trigger",id:"1-prometheus-trigger",level:3},{value:"YAML \u7bc4\u4f8b",id:"yaml-\u7bc4\u4f8b",level:4},{value:"\u53c3\u6578\u8aaa\u660e",id:"\u53c3\u6578\u8aaa\u660e",level:4},{value:"\u9069\u7528\u5834\u666f",id:"\u9069\u7528\u5834\u666f",level:4},{value:"2. Kafka Trigger",id:"2-kafka-trigger",level:3},{value:"YAML \u7bc4\u4f8b",id:"yaml-\u7bc4\u4f8b-1",level:4},{value:"\u53c3\u6578\u8aaa\u660e",id:"\u53c3\u6578\u8aaa\u660e-1",level:4},{value:"\u9069\u7528\u5834\u666f",id:"\u9069\u7528\u5834\u666f-1",level:4},{value:"3. PostgreSQL Trigger",id:"3-postgresql-trigger",level:3},{value:"YAML \u7bc4\u4f8b",id:"yaml-\u7bc4\u4f8b-2",level:4},{value:"\u53c3\u6578\u8aaa\u660e",id:"\u53c3\u6578\u8aaa\u660e-2",level:4},{value:"\u9069\u7528\u5834\u666f",id:"\u9069\u7528\u5834\u666f-2",level:4},{value:"4. Google Cloud Platform Storage (GCS) Trigger",id:"4-google-cloud-platform-storage-gcs-trigger",level:3},{value:"YAML \u7bc4\u4f8b",id:"yaml-\u7bc4\u4f8b-3",level:4},{value:"\u53c3\u6578\u8aaa\u660e",id:"\u53c3\u6578\u8aaa\u660e-3",level:4},{value:"\u9069\u7528\u5834\u666f",id:"\u9069\u7528\u5834\u666f-3",level:4},{value:"5. Elasticsearch Trigger",id:"5-elasticsearch-trigger",level:3},{value:"YAML \u7bc4\u4f8b",id:"yaml-\u7bc4\u4f8b-4",level:4},{value:"\u53c3\u6578\u8aaa\u660e",id:"\u53c3\u6578\u8aaa\u660e-4",level:4},{value:"\u9069\u7528\u5834\u666f",id:"\u9069\u7528\u5834\u666f-4",level:4},{value:"KEDA \u7684\u5f48\u6027\u4f38\u7e2e\uff1a0\u21921 \u53ca 1\u21920 \u7e2e\u653e\u89e3\u6790",id:"keda-\u7684\u5f48\u6027\u4f38\u7e2e01-\u53ca-10-\u7e2e\u653e\u89e3\u6790",level:2},{value:"0 \u2192 1\uff1a\u5f9e 0 \u555f\u52d5 Pod",id:"0--1\u5f9e-0-\u555f\u52d5-pod",level:3},{value:"\u6b65\u9a5f\u89e3\u6790",id:"\u6b65\u9a5f\u89e3\u6790",level:4},{value:"\u95dc\u9375\u5f71\u97ff\u56e0\u7d20",id:"\u95dc\u9375\u5f71\u97ff\u56e0\u7d20",level:4},{value:"1 \u2192 0\uff1a\u5f9e 1 \u7e2e\u6e1b\u81f3 0",id:"1--0\u5f9e-1-\u7e2e\u6e1b\u81f3-0",level:3},{value:"\u6b65\u9a5f\u89e3\u6790",id:"\u6b65\u9a5f\u89e3\u6790-1",level:4},{value:"\u95dc\u9375\u5f71\u97ff\u56e0\u7d20",id:"\u95dc\u9375\u5f71\u97ff\u56e0\u7d20-1",level:4},{value:"KEDA \u7684\u6fc0\u6d3b\u968e\u6bb5\u8207\u7e2e\u653e\u968e\u6bb5\u89e3\u6790",id:"keda-\u7684\u6fc0\u6d3b\u968e\u6bb5\u8207\u7e2e\u653e\u968e\u6bb5\u89e3\u6790",level:2},{value:"\u6fc0\u6d3b\u968e\u6bb5\uff08Activation Phase\uff09",id:"\u6fc0\u6d3b\u968e\u6bb5activation-phase",level:3},{value:"\u95dc\u9375\u9ede",id:"\u95dc\u9375\u9ede",level:4},{value:"\u5f71\u97ff\u56e0\u7d20",id:"\u5f71\u97ff\u56e0\u7d20",level:4},{value:"\u7e2e\u653e\u968e\u6bb5\uff08Scaling Phase\uff09",id:"\u7e2e\u653e\u968e\u6bb5scaling-phase",level:3},{value:"\u95dc\u9375\u9ede",id:"\u95dc\u9375\u9ede-1",level:4},{value:"\u5f71\u97ff\u56e0\u7d20",id:"\u5f71\u97ff\u56e0\u7d20-1",level:4},{value:"minReplicaCount \u7684\u5f71\u97ff",id:"minreplicacount-\u7684\u5f71\u97ff",level:3},{value:"\u5be6\u4f5c\u4e00\u500b KEDA",id:"\u5be6\u4f5c\u4e00\u500b-keda",level:2},{value:"\u5b89\u88dd KEDA",id:"\u5b89\u88dd-keda",level:3},{value:"\u90e8\u5c6c Redis",id:"\u90e8\u5c6c-redis",level:3},{value:"\u90e8\u5c6c Worker \u548c ScaledObject",id:"\u90e8\u5c6c-worker-\u548c-scaledobject",level:3},{value:"\u6e2c\u8a66 KEDA \u81ea\u52d5\u7e2e\u653e",id:"\u6e2c\u8a66-keda-\u81ea\u52d5\u7e2e\u653e",level:3},{value:"\u7d50\u8ad6",id:"\u7d50\u8ad6",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"autoscaling---custom-pod-autoscaler",children:"AutoScaling - Custom Pod AutoScaler"})}),"\n",(0,l.jsx)(n.p,{children:"\u5728 Kubernetes \u4e2d\uff0c\u539f\u751f\u7684\u6c34\u5e73 Pod \u81ea\u52d5\u64f4\u5c55\uff08HPA\uff09\u529f\u80fd\u901a\u5e38\u4f9d\u8cf4\u65bc CPU \u548c\u8a18\u61b6\u9ad4\u7684\u5e73\u5747\u4f7f\u7528\u91cf\u6216\u4f7f\u7528\u7387\u4f5c\u70ba\u81ea\u52d5\u64f4\u5c55\u7684\u89f8\u767c\u6307\u6a19\u3002\n\u7136\u800c\uff0c\u5c0d\u65bc\u4f7f\u7528 partition \u5206\u914d\u6a5f\u5236\u7684\u61c9\u7528\u7a0b\u5f0f\uff08\u5982 Kafka\uff09\u4f86\u8aaa\uff0c\u9019\u6a23\u7684\u8a2d\u5b9a\u53ef\u80fd\u6703\u5c0e\u81f4\u5de5\u4f5c\u8ca0\u8f09\u5206\u5e03\u4e0d\u5747\uff0c\u5f9e\u800c\u7121\u6cd5\u6709\u6548\u5730\u64f4\u5c55\u8cc7\u6e90\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u4f8b\u5982\uff0c\u67d0\u4e9b Pod \u53ef\u80fd\u9054\u5230\u5176\u8ca0\u8f09\u4e0a\u9650\uff0c\u4f46\u7531\u65bc\u6574\u9ad4\u7684\u5e73\u5747\u8cc7\u6e90\u4f7f\u7528\u7387\u5c1a\u672a\u9054\u5230\u95a5\u503c\uff0cHPA \u53ef\u80fd\u7121\u6cd5\u53ca\u6642\u89f8\u767c\u64f4\u5c55\u3002"}),"\n",(0,l.jsxs)(n.p,{children:["\u70ba\u4e86\u89e3\u6c7a\u9019\u500b\u554f\u984c\uff0c\u4e00\u500b\u6709\u6548\u7684\u7b56\u7565\u662f\u4f7f\u7528 ",(0,l.jsx)(n.strong,{children:"KEDA"}),"\uff08Kubernetes Event-Driven Autoscaling\uff09\u3002\nKEDA \u900f\u904e\u76e3\u63a7\u6bcf\u500b Pod \u7684\u4e8b\u4ef6\u8655\u7406\u901f\u5ea6\uff08\u4f8b\u5982 Kafka \u8a0a\u606f\u7684\u6d88\u8cbb\u901f\u5ea6\uff09\u4f86\u9032\u884c\u81ea\u52d5\u64f4\u5c55\uff0c\u800c\u4e0d\u50c5\u50c5\u4f9d\u8cf4\u65bc Pod \u7684\u5e73\u5747\u8cc7\u6e90\u4f7f\u7528\u60c5\u6cc1\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"\u9019\u7a2e\u65b9\u6cd5\u80fd\u7cbe\u78ba\u5730\u8abf\u6574 Pod \u6578\u91cf\uff0c\u6709\u6548\u89e3\u6c7a\u5de5\u4f5c\u8ca0\u8f09\u4e0d\u5747\u7684\u554f\u984c\uff0c\u4e26\u512a\u5316\u8cc7\u6e90\u4f7f\u7528\uff0c\u63d0\u5347\u6574\u9ad4\u61c9\u7528\u7a0b\u5f0f\u7684\u6027\u80fd\u8207\u53ef\u64f4\u5c55\u6027\u3002"}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"kubernetes-event-driven-autoscaling-keda",children:"Kubernetes Event-Driven Autoscaling (KEDA)"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"KEDA-architecture",src:s(59784).A+"",width:"591",height:"621"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Kubernetes Event-Driven Autoscaling (KEDA)"})," \u662f\u4e00\u7a2e ",(0,l.jsx)(n.strong,{children:"\u57fa\u65bc\u4e8b\u4ef6\u7684\u81ea\u52d5\u64f4\u5c55"})," \u89e3\u6c7a\u65b9\u6848\uff0c\n\u4e3b\u8981\u7528\u65bc ",(0,l.jsx)(n.strong,{children:"\u81ea\u52d5\u8abf\u6574 Kubernetes \u5de5\u4f5c\u8ca0\u8f09\u7684\u526f\u672c\u6578\u91cf"}),"\uff0c\u6839\u64da ",(0,l.jsx)(n.strong,{children:"\u4e8b\u4ef6\u9a45\u52d5"})," \u4f86\u52d5\u614b\u8abf\u6574\u61c9\u7528\u7a0b\u5f0f\u7684\u8cc7\u6e90\u5206\u914d\uff0c\n\u800c\u4e0d\u662f\u50c5\u4f9d\u8cf4 CPU \u6216\u8a18\u61b6\u9ad4\u4f7f\u7528\u7387\uff08\u5982 Horizontal Pod Autoscaler, HPA\uff09\u3002"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"keda-\u7684\u6838\u5fc3\u7279\u9ede",children:"KEDA \u7684\u6838\u5fc3\u7279\u9ede"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u4e8b\u4ef6\u9a45\u52d5\u7684\u81ea\u52d5\u7e2e\u653e"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"KEDA \u5141\u8a31\u61c9\u7528\u7a0b\u5f0f\u6839\u64da\u7279\u5b9a\u4e8b\u4ef6\u4f86\u6e90\uff08\u5982 Kafka\u3001RabbitMQ\u3001Azure Service Bus\u3001Prometheus \u7b49\uff09\u4f86\u6c7a\u5b9a\u4f55\u6642\u64f4\u5c55\u6216\u7e2e\u6e1b Pod \u6578\u91cf\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u8207 HPA\uff08Horizontal Pod Autoscaler\uff09\u6574\u5408"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"KEDA \u6703\u5c07\u4e8b\u4ef6\u4f86\u6e90\u7684\u6578\u64da\u8f49\u63db\u70ba Kubernetes \u7684 HPA \u6307\u6a19\uff0c\u4f7f HPA \u80fd\u5920\u6839\u64da\u9019\u4e9b\u4e8b\u4ef6\u4f86\u89f8\u767c Pod \u64f4\u5c55\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u7cbe\u7d30\u63a7\u5236 Pod \u7684\u64f4\u5c55"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u7576\u6c92\u6709\u8ca0\u8f09\u6642\uff0cKEDA \u53ef\u4ee5\u5c07 Pod \u7e2e\u6e1b\u70ba\u96f6\uff0c\u4ee5\u7bc0\u7701\u8cc7\u6e90\uff1b\u7576\u4e8b\u4ef6\u51fa\u73fe\u6642\uff0c\u5247\u80fd\u5920\u8fc5\u901f\u64f4\u5c55 Pod\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u652f\u63f4\u591a\u7a2e Scalers\uff08\u4e8b\u4ef6\u4f86\u6e90\uff09"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["KEDA \u5167\u5efa\u652f\u63f4 50 \u591a\u7a2e Scaler\uff0c\u4f8b\u5982\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u8a0a\u606f\u4f47\u5217\uff1aKafka\u3001RabbitMQ\u3001Azure Queue Storage"}),"\n",(0,l.jsx)(n.li,{children:"\u76e3\u63a7\u7cfb\u7d71\uff1aPrometheus\u3001Datadog"}),"\n",(0,l.jsx)(n.li,{children:"\u96f2\u7aef\u670d\u52d9\uff1aAWS SQS\u3001Google Pub/Sub"}),"\n",(0,l.jsx)(n.li,{children:"\u8cc7\u6599\u5eab\uff1aPostgreSQL\u3001MySQL"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"keda-\u7684\u61c9\u7528\u5834\u666f",children:"KEDA \u7684\u61c9\u7528\u5834\u666f"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u7121\u4f3a\u670d\u5668\u67b6\u69cb\uff08Serverless\uff09"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u8b93 Kubernetes \u4e0a\u7684\u61c9\u7528\u7a0b\u5f0f\u5177\u5099\u7121\u4f3a\u670d\u5668\u80fd\u529b\uff0c\u7576\u6c92\u6709\u8ca0\u8f09\u6642\uff0cPod \u6578\u91cf\u53ef\u4ee5\u964d\u5230\u96f6\uff0c\u907f\u514d\u8cc7\u6e90\u6d6a\u8cbb\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u8a0a\u606f\u4f47\u5217\u8655\u7406"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u900f\u904e KEDA\uff0c\u7cfb\u7d71\u80fd\u5920\u6839\u64da Kafka\u3001RabbitMQ\u3001SQS \u7b49\u8a0a\u606f\u4f47\u5217\u4e2d\u7684\u8ca0\u8f09\u52d5\u614b\u64f4\u5c55 Pod\uff0c\u78ba\u4fdd\u5373\u6642\u8655\u7406\u80fd\u529b\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u8cc7\u6599\u5eab\u89f8\u767c\u81ea\u52d5\u64f4\u5c55"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4f8b\u5982\uff0c\u6839\u64da PostgreSQL \u7684\u8cc7\u6599\u8b8a\u66f4\u4f86\u89f8\u767c Pod \u64f4\u5c55\uff0c\u9069\u7528\u65bc\u9ad8\u6d41\u91cf\u7684\u61c9\u7528\u7a0b\u5f0f\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u96f2\u7aef\u76e3\u63a7\u8207\u7570\u5e38\u97ff\u61c9"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4f7f\u7528 Prometheus \u6216 Datadog \u4f5c\u70ba\u4e8b\u4ef6\u4f86\u6e90\uff0c\u7576\u7cfb\u7d71\u76e3\u6e2c\u5230\u7570\u5e38\u6642\uff0c\u52d5\u614b\u64f4\u5c55\u61c9\u7528\u7a0b\u5f0f\u4ee5\u61c9\u5c0d\u7a81\u767c\u6d41\u91cf\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"keda-\u8207-hpa-\u7684\u6bd4\u8f03",children:"KEDA \u8207 HPA \u7684\u6bd4\u8f03"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{}),(0,l.jsx)(n.th,{children:(0,l.jsx)(n.strong,{children:"HPA\uff08\u6c34\u5e73\u81ea\u52d5\u64f4\u5c55\uff09"})}),(0,l.jsx)(n.th,{children:(0,l.jsx)(n.strong,{children:"KEDA\uff08\u4e8b\u4ef6\u9a45\u52d5\u81ea\u52d5\u64f4\u5c55\uff09"})})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u89f8\u767c\u689d\u4ef6"})}),(0,l.jsxs)(n.td,{children:["\u4e3b\u8981\u4f9d\u8cf4 ",(0,l.jsx)(n.strong,{children:"CPU / Memory"})]}),(0,l.jsxs)(n.td,{children:["\u4f9d\u8cf4 ",(0,l.jsx)(n.strong,{children:"\u4e8b\u4ef6\u4f86\u6e90\uff08Kafka, RabbitMQ, HTTP \u4f47\u5217...\uff09"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u6700\u4f4e Pod \u6578\u91cf"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"1"}),"\uff08\u7121\u6cd5\u6b78\u96f6\uff09"]}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"0"}),"\uff08\u5b8c\u5168\u91cb\u653e\u8cc7\u6e90\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u9069\u7528\u5834\u666f"})}),(0,l.jsx)(n.td,{children:"\u9577\u6642\u9593\u904b\u884c\u7684\u61c9\u7528\uff08\u5982 Web \u4f3a\u670d\u5668\uff09"}),(0,l.jsx)(n.td,{children:"\u9700\u6839\u64da\u8ca0\u8f09\u52d5\u614b\u555f\u52d5\u7684\u61c9\u7528\uff08\u5982\u80cc\u666f\u8655\u7406\u3001\u6279\u6b21\u4efb\u52d9\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u64f4\u5c55\u901f\u5ea6"})}),(0,l.jsx)(n.td,{children:"\u53d7 HPA \u5167\u90e8\u8a08\u7b97\u5f71\u97ff"}),(0,l.jsx)(n.td,{children:"\u5373\u6642\u4e8b\u4ef6\u9a45\u52d5"})]})]})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"keda-crdscaledobject-\u8207-scaledjob",children:"KEDA CRD\uff1aScaledObject \u8207 ScaledJob"}),"\n",(0,l.jsxs)(n.p,{children:["\u5728 ",(0,l.jsx)(n.strong,{children:"KEDA"})," \u7684\u6846\u67b6\u4e2d\uff0c",(0,l.jsx)(n.code,{children:"ScaledObject"})," \u548c ",(0,l.jsx)(n.code,{children:"ScaledJob"})," \u662f\u5169\u7a2e\u6838\u5fc3\u7684 ",(0,l.jsx)(n.strong,{children:"\u81ea\u5b9a\u7fa9\u8cc7\u6e90\uff08Custom Resource Definitions, CRDs\uff09"}),"\uff0c\n\u7528\u4f86\u5b9a\u7fa9\u5982\u4f55\u6839\u64da\u4e8b\u4ef6\u4f86 ",(0,l.jsx)(n.strong,{children:"\u81ea\u52d5\u64f4\u5c55\uff08Scaling\uff09Pod"})," \u6216 ",(0,l.jsx)(n.strong,{children:"\u5efa\u7acb\u77ed\u66ab\u7684\u6279\u6b21\u5de5\u4f5c\uff08Job\uff09"}),"\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:["\u9019\u5169\u7a2e CRD \u63d0\u4f9b\u4e86\u4e00\u7a2e\u9748\u6d3b\u7684\u65b9\u5f0f\u4f86\u7ba1\u7406 Kubernetes \u61c9\u7528\u7684 ",(0,l.jsx)(n.strong,{children:"\u4e8b\u4ef6\u9a45\u52d5\u64f4\u5c55"}),"\uff0c\u9069\u7528\u65bc\u5404\u7a2e\u61c9\u7528\u5834\u666f\uff0c\u5982 ",(0,l.jsx)(n.strong,{children:"\u4f47\u5217\u8655\u7406\u3001\u6279\u6b21\u4efb\u52d9\u3001\u8cc7\u6599\u5eab\u76e3\u63a7"})," \u7b49\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"scaledobject",children:"ScaledObject"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ScaledObject"})," \u7528\u65bc ",(0,l.jsx)(n.strong,{children:"\u7ba1\u7406\u9577\u671f\u57f7\u884c\u7684 Pod\uff08Deployment\u3001StatefulSet\u3001ReplicaSet\uff09"}),"\uff0c\u4e26\u6839\u64da\u4e8b\u4ef6\u4f86\u6e90\u4f86 ",(0,l.jsx)(n.strong,{children:"\u52d5\u614b\u64f4\u5c55\u6216\u7e2e\u6e1b"})," Pod \u7684\u526f\u672c\u6578\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"scaledobject-\u4e3b\u8981\u529f\u80fd",children:"ScaledObject \u4e3b\u8981\u529f\u80fd"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u91dd\u5c0d Kubernetes \u90e8\u7f72\uff08Deployment, StatefulSet, ReplicaSet\uff09\u9032\u884c\u64f4\u5c55"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u7576\u6c92\u6709\u4e8b\u4ef6\u6642\uff0c\u53ef\u4ee5\u5c07 Pod \u7e2e\u6e1b\u81f3 0\uff08\u7701\u8cc7\u6e90\uff09"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u53ef\u8207 HPA\uff08Horizontal Pod Autoscaler\uff09\u6574\u5408"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u652f\u63f4\u591a\u7a2e\u4e8b\u4ef6\u4f86\u6e90\uff0c\u5982 Kafka\u3001RabbitMQ\u3001Prometheus\u3001AWS SQS \u7b49"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"scaledobject-yaml-\u7bc4\u4f8b",children:"ScaledObject YAML \u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7bc4\u4f8b\uff1a\u6839\u64da Kafka \u8a0a\u606f\u6578\u91cf\u52d5\u614b\u8abf\u6574 Pod"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: kafka-scaler\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: my-kafka-consumer # \u6307\u5b9a\u8981\u64f4\u5c55\u7684 Deployment\n  minReplicaCount: 0 # \u6700\u5c0f Pod \u6578\u91cf\n  maxReplicaCount: 10 # \u6700\u5927 Pod \u6578\u91cf\n  idleReplicaCount: 1 # \u7576\u7121\u8ca0\u8f09\u6642\uff0c\u4ecd\u4fdd\u7559 1 \u500b Pod \u907f\u514d\u51b7\u555f\u52d5\n  cooldownPeriod: 30 # \u7121\u8ca0\u8f09\u5f8c 30 \u79d2\u5167\u7e2e\u6e1b\n  pollingInterval: 5 # \u6bcf 5 \u79d2\u6aa2\u67e5\u4e00\u6b21\u8ca0\u8f09\n\n  # \u53ef\u9078\uff1a\u7576 KEDA \u7121\u6cd5\u5b58\u53d6\u4e8b\u4ef6\u4f86\u6e90\u6642\u7684\u56de\u9000\u6a5f\u5236\n  fallback:\n    failureThreshold: 5 # \u9023\u7e8c 5 \u6b21\u5931\u6557\u8996\u70ba\u7121\u6cd5\u5b58\u53d6\u4e8b\u4ef6\u4f86\u6e90\n    replicas: 3 # \u7121\u6cd5\u5b58\u53d6\u4e8b\u4ef6\u4f86\u6e90\u6642\uff0c\u5f37\u5236\u7dad\u6301 3 \u500b Pod\n\n  # \u53ef\u9078\uff1a\u9032\u968e\u64f4\u5c55\u884c\u70ba\u63a7\u5236\n  advanced:\n    restoreToOriginalReplicaCount: true # \u505c\u7528 KEDA \u6642\u6062\u5fa9\u539f\u672c\u7684 ReplicaCount\n    horizontalPodAutoscalerConfig:\n      behavior:\n        scaleDown:\n          stabilizationWindowSeconds: 60 # 60 \u79d2\u5167\u4e0d\u9032\u884c\u7e2e\u6e1b\n          policies:\n            - type: Percent\n              value: 50\n              periodSeconds: 15\n        scaleUp:\n          stabilizationWindowSeconds: 0\n          policies:\n            - type: Percent\n              value: 100\n              periodSeconds: 5\n\n  triggers:\n    - type: kafka\n      metadata:\n        bootstrapServers: my-kafka-broker:9092\n        topic: my-topic\n        consumerGroup: my-group\n        lagThreshold: '100' # \u7576 Kafka \u8a0a\u606f\u7a4d\u58d3\u8d85\u904e 100 \u5247\u89f8\u767c\u64f4\u5c55\n"})}),"\n",(0,l.jsx)(n.h3,{id:"scaledobject-\u91cd\u8981\u53c3\u6578",children:"ScaledObject \u91cd\u8981\u53c3\u6578"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"scaleTargetRef.name"})}),(0,l.jsxs)(n.td,{children:["\u6307\u5b9a\u8981\u64f4\u5c55\u7684 ",(0,l.jsx)(n.strong,{children:"Pod\uff08Deployment, StatefulSet, ReplicaSet\uff09"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"minReplicaCount"})}),(0,l.jsx)(n.td,{children:"\u8a2d\u5b9a Pod \u7684\u6700\u5c0f\u6578\u91cf\uff0c\u53ef\u70ba 0"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"maxReplicaCount"})}),(0,l.jsx)(n.td,{children:"\u8a2d\u5b9a Pod \u7684\u6700\u5927\u6578\u91cf"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"idleReplicaCount"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u7576\u7121\u8ca0\u8f09\u6642\uff0c\u4ecd\u7136\u4fdd\u7559\u7684 Pod \u6578\u91cf"}),"\uff0c\u907f\u514d\u51b7\u555f\u52d5\uff08\u4f8b\u5982 ",(0,l.jsx)(n.code,{children:"1"})," \u8868\u793a\u5373\u4f7f\u7121\u8ca0\u8f09\u4ecd\u4fdd\u7559 1 \u500b Pod\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"cooldownPeriod"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u7121\u8ca0\u8f09\u6642\u7b49\u5f85\u591a\u4e45\u518d\u7e2e\u6e1b Pod"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"pollingInterval"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u591a\u4e45\u6aa2\u67e5\u4e00\u6b21\u4e8b\u4ef6\u4f86\u6e90"}),"\uff08\u9810\u8a2d 30 \u79d2\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"triggers"})}),(0,l.jsxs)(n.td,{children:["\u5b9a\u7fa9 ",(0,l.jsx)(n.strong,{children:"\u4e8b\u4ef6\u4f86\u6e90"}),"\uff08Kafka, RabbitMQ, SQS, Prometheus...\uff09"]})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"scaledobject-\u53ef\u9078\u53c3\u6578",children:"ScaledObject \u53ef\u9078\u53c3\u6578"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"fallback"})," (\u53ef\u9078)"]}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u7576 KEDA \u7121\u6cd5\u5b58\u53d6\u4e8b\u4ef6\u4f86\u6e90\u6642\uff0c\u56de\u9000\u5230\u9810\u8a2d\u526f\u672c\u6578"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"fallback.failureThreshold"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"KEDA \u5931\u6557\u591a\u5c11\u6b21\u5f8c\uff0c\u555f\u7528\u56de\u9000\u6a5f\u5236"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"fallback.replicas"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u56de\u9000\u6a5f\u5236\u555f\u52d5\u5f8c\uff0c\u5f37\u5236\u7dad\u6301\u7684 Pod \u6578\u91cf"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"advanced"})," (\u53ef\u9078)"]}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u9032\u968e\u81ea\u52d5\u64f4\u5c55\u8a2d\u5b9a"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"advanced.restoreToOriginalReplicaCount"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u505c\u7528 KEDA \u6642\uff0c\u662f\u5426\u6062\u5fa9\u539f\u672c\u7684 ReplicaCount"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"advanced.horizontalPodAutoscalerConfig"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u81ea\u8a02 HPA\uff08\u6c34\u5e73 Pod \u81ea\u52d5\u64f4\u5c55\uff09\u7684\u884c\u70ba"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"advanced.horizontalPodAutoscalerConfig.behavior"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u64f4\u5c55\u8207\u7e2e\u6e1b\u7684\u884c\u70ba\u63a7\u5236"})})]})]})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"scaledjob",children:"ScaledJob"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ScaledJob"})," \u7528\u65bc ",(0,l.jsx)(n.strong,{children:"\u7ba1\u7406\u77ed\u66ab\u57f7\u884c\u7684\u6279\u6b21\u5de5\u4f5c\uff08Jobs\uff09"}),"\uff0c\u9069\u5408\u4e00\u6b21\u6027\u6216\u81e8\u6642\u6027\u7684\u8a08\u7b97\u5de5\u4f5c\uff0c\u7576\u4e8b\u4ef6\u767c\u751f\u6642\uff0cKEDA \u6703 ",(0,l.jsx)(n.strong,{children:"\u52d5\u614b\u555f\u52d5 Kubernetes Job"}),"\uff0c\u4e26\u5728\u5de5\u4f5c\u5b8c\u6210\u5f8c\u81ea\u52d5\u91cb\u653e\u8cc7\u6e90\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"scaledjob-\u4e3b\u8981\u529f\u80fd",children:"ScaledJob \u4e3b\u8981\u529f\u80fd"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u9069\u7528\u65bc\u6279\u6b21\u4efb\u52d9\uff08Batch Jobs\uff09\uff0c\u5982\u5f71\u50cf\u8655\u7406\u3001\u8cc7\u6599\u5206\u6790"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u7576\u8ca0\u8f09\u589e\u52a0\u6642\uff0c\u81ea\u52d5\u555f\u52d5\u591a\u500b Job \u8655\u7406"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u7121\u8ca0\u8f09\u6642\uff0c\u4e0d\u6703\u7522\u751f\u591a\u9918\u7684 Pod\uff08\u964d\u4f4e\u8cc7\u6e90\u6d88\u8017\uff09"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u81ea\u52d5\u7ba1\u7406 Job \u7684\u522a\u9664\u8207\u932f\u8aa4\u8655\u7406"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"scaledjob-yaml-\u7bc4\u4f8b",children:"ScaledJob YAML \u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u7bc4\u4f8b\uff1a\u6839\u64da RabbitMQ \u8a0a\u606f\u6578\u91cf\u89f8\u767c Job\uff0c\u4e26\u52a0\u5165\u9032\u968e\u63a7\u5236\u53c3\u6578"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'apiVersion: keda.sh/v1alpha1\nkind: ScaledJob\nmetadata:\n  name: rabbitmq-job-scaler\n  namespace: default\nspec:\n  jobTargetRef:\n    parallelism: 2 # \u5141\u8a31\u6700\u591a 2 \u500b Job \u540c\u6642\u904b\u884c\n    completions: 1 # \u6bcf\u500b Job \u53ea\u9700\u6210\u529f\u57f7\u884c 1 \u6b21\n    activeDeadlineSeconds: 300 # Job \u6700\u9577\u904b\u884c\u6642\u9593\u70ba 300 \u79d2\uff0c\u8d85\u6642\u5247\u7d42\u6b62\n    backoffLimit: 3 # Job \u5931\u6557\u5f8c\u6700\u591a\u91cd\u8a66 3 \u6b21\n    template:\n      spec:\n        containers:\n          - name: rabbitmq-client\n            image: rabbitmq-client:latest\n            command:\n              - receive\n            args:\n              - \'$(RABBITMQ_QUEUE)\'\n        restartPolicy: Never # Job \u7d50\u675f\u5f8c\u4e0d\u81ea\u52d5\u91cd\u555f\n\n  minReplicaCount: 0 # \u7576\u7121\u8ca0\u8f09\u6642\uff0c\u4e0d\u7522\u751f Job\n  maxReplicaCount: 20 # \u6700\u591a\u5141\u8a31 20 \u500b Job \u4f75\u767c\n  successfulJobsHistoryLimit: 5 # \u4fdd\u7559 5 \u500b\u6210\u529f Job \u8a18\u9304\n  failedJobsHistoryLimit: 5 # \u4fdd\u7559 5 \u500b\u5931\u6557 Job \u8a18\u9304\n  pollingInterval: 10 # \u6bcf 10 \u79d2\u6aa2\u67e5\u4e00\u6b21\u8ca0\u8f09\n\n  # \u53ef\u9078\uff1a\u5f9e\u6307\u5b9a Container \u8b80\u53d6\u74b0\u5883\u8b8a\u6578\n  envSourceContainerName: rabbitmq-client\n\n  # \u53ef\u9078\uff1a\u63a7\u5236 Job \u6efe\u52d5\u66f4\u65b0\u884c\u70ba\n  rollout:\n    strategy: gradual # \u9010\u6b65\u6efe\u52d5\u66f4\u65b0\uff08\u53ef\u9078 "immediate" \u6216 "gradual"\uff09\n\n  # \u53ef\u9078\uff1a\u81ea\u8a02 Job \u7684\u64f4\u5c55\u7b56\u7565\n  scalingStrategy:\n    strategy: custom # \u53ef\u9078 "default"\u3001"custom" \u6216 "accurate"\n    customScalingQueueLengthDeduction: 5 # \u6bcf\u6b21\u64f4\u5c55\u6642\uff0c\u984d\u5916\u6263\u9664 5 \u500b\u8a0a\u606f\u6578\n    customScalingRunningJobPercentage: 50 # \u7576 50% Job \u904b\u884c\u6642\uff0c\u505c\u6b62\u64f4\u5c55\n\n  triggers:\n    - type: rabbitmq\n      metadata:\n        queueName: my-queue\n        hostFromEnv: RABBITMQ_HOST\n        mode: QueueLength\n        value: \'50\' # \u7576\u4f47\u5217\u8a0a\u606f\u8d85\u904e 50 \u6642\u89f8\u767c Job\n'})}),"\n",(0,l.jsx)(n.h3,{id:"scaledjob-\u91cd\u8981\u53c3\u6578",children:"ScaledJob \u91cd\u8981\u53c3\u6578"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"jobTargetRef.template.spec.containers"})}),(0,l.jsx)(n.td,{children:"\u5b9a\u7fa9\u57f7\u884c\u7684 Job \u5167\u5bb9\uff08\u6620\u50cf\u540d\u7a31\u7b49\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"parallelism"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u63a7\u5236 Job \u5167\u90e8\u7684\u4f75\u767c\u6578\u91cf"}),"\uff08\u4f8b\u5982 ",(0,l.jsx)(n.code,{children:"2"})," \u8868\u793a\u540c\u6642\u6700\u591a 2 \u500b Pod \u57f7\u884c\u8a72 Job\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"completions"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u6bcf\u500b Job \u9700\u8981\u6210\u529f\u57f7\u884c\u7684\u6b21\u6578"}),"\uff08\u901a\u5e38\u70ba ",(0,l.jsx)(n.code,{children:"1"}),"\uff0c\u4f46\u53ef\u4ee5\u8a2d\u70ba\u66f4\u9ad8\u4f86\u78ba\u4fdd\u591a\u6b21\u6210\u529f\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"activeDeadlineSeconds"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"Job \u6700\u9577\u5141\u8a31\u57f7\u884c\u6642\u9593"}),"\uff0c\u8d85\u6642\u5247\u7d42\u6b62"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"backoffLimit"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"Job \u5931\u6557\u5f8c\u5141\u8a31\u7684\u91cd\u8a66\u6b21\u6578"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"minReplicaCount"})}),(0,l.jsx)(n.td,{children:"\u6700\u5c0f Job \u6578\u91cf\uff0c\u53ef\u70ba 0\uff08\u8868\u793a\u7121\u8ca0\u8f09\u6642\u4e0d\u7522\u751f Job\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"maxReplicaCount"})}),(0,l.jsx)(n.td,{children:"\u6700\u5927\u53ef\u540c\u6642\u57f7\u884c\u7684 Job \u6578\u91cf"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"successfulJobsHistoryLimit"})}),(0,l.jsx)(n.td,{children:"\u4fdd\u7559\u7684\u6210\u529f Job \u8a18\u9304\u6578\u91cf"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"failedJobsHistoryLimit"})}),(0,l.jsx)(n.td,{children:"\u4fdd\u7559\u7684\u5931\u6557 Job \u8a18\u9304\u6578\u91cf"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"pollingInterval"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u591a\u4e45\u6aa2\u67e5\u4e00\u6b21\u4e8b\u4ef6\u4f86\u6e90"}),"\uff08\u9810\u8a2d 30 \u79d2\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"triggers"})}),(0,l.jsxs)(n.td,{children:["\u5b9a\u7fa9 ",(0,l.jsx)(n.strong,{children:"\u4e8b\u4ef6\u4f86\u6e90"}),"\uff08Kafka, RabbitMQ, SQS, Prometheus...\uff09"]})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"scaledjob-\u53ef\u9078\u53c3\u6578",children:"ScaledJob \u53ef\u9078\u53c3\u6578"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"envSourceContainerName"})," (\u53ef\u9078)"]}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u6307\u5b9a\u5f9e\u54ea\u500b Container \u8b80\u53d6\u74b0\u5883\u8b8a\u6578"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"rollout"})," (\u53ef\u9078)"]}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u63a7\u5236 Job \u7684\u6efe\u52d5\u66f4\u65b0\u7b56\u7565"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"rollout.strategy"})}),(0,l.jsx)(n.td,{children:(0,l.jsxs)(n.strong,{children:[(0,l.jsx)(n.code,{children:"gradual"})," \u8868\u793a\u9010\u6b65\u6efe\u52d5\uff0c",(0,l.jsx)(n.code,{children:"immediate"})," \u8868\u793a\u7acb\u5373\u66f4\u65b0"]})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"scalingStrategy"})," (\u53ef\u9078)"]}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u81ea\u8a02 KEDA \u7684 Job \u64f4\u5c55\u884c\u70ba"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"scalingStrategy.strategy"})}),(0,l.jsx)(n.td,{children:(0,l.jsxs)(n.strong,{children:[(0,l.jsx)(n.code,{children:"default"})," \u4f7f\u7528 KEDA \u9810\u8a2d\u7b56\u7565\uff0c\u6216\u53ef\u4f7f\u7528",(0,l.jsx)(n.code,{children:"custom"}),"\u81ea\u8a02\u908f\u8f2f\uff0c",(0,l.jsx)(n.code,{children:"accurate"}),"\u5247\u63d0\u4f9b\u66f4\u7cbe\u78ba\u7684\u64f4\u5c55"]})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"scalingStrategy.customScalingQueueLengthDeduction"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u6bcf\u6b21\u64f4\u5c55\u6642\uff0c\u5f9e\u4f47\u5217\u9577\u5ea6\u984d\u5916\u6263\u9664\u591a\u5c11\u6d88\u606f\u6578\u91cf"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"scalingStrategy.customScalingRunningJobPercentage"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u7576\u904b\u884c\u4e2d\u7684 Job \u8d85\u904e\u67d0\u767e\u5206\u6bd4\u6642\uff0c\u505c\u6b62\u64f4\u5c55"})})]})]})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"scaledobject-vs-scaledjob",children:"ScaledObject vs ScaledJob"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{}),(0,l.jsx)(n.th,{children:(0,l.jsx)(n.strong,{children:"ScaledObject"})}),(0,l.jsx)(n.th,{children:(0,l.jsx)(n.strong,{children:"ScaledJob"})})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u9069\u7528\u5c0d\u8c61"})}),(0,l.jsx)(n.td,{children:"\u9577\u671f\u904b\u884c\u7684\u61c9\u7528\uff08Deployment, StatefulSet, ReplicaSet\uff09"}),(0,l.jsx)(n.td,{children:"\u77ed\u671f\u6279\u6b21\u5de5\u4f5c\uff08Job\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u6700\u5c0f\u526f\u672c\u6578"})}),(0,l.jsxs)(n.td,{children:["\u53ef\u7e2e\u6e1b\u81f3 ",(0,l.jsx)(n.code,{children:"0"})]}),(0,l.jsx)(n.td,{children:"\u7121\u8ca0\u8f09\u6642\u4e0d\u7522\u751f Job"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u6700\u5927\u526f\u672c\u6578"})}),(0,l.jsxs)(n.td,{children:["\u8a2d\u5b9a\u6700\u5927 ",(0,l.jsx)(n.code,{children:"Pod"})," \u6578"]}),(0,l.jsxs)(n.td,{children:["\u8a2d\u5b9a\u6700\u5927 ",(0,l.jsx)(n.code,{children:"Job"})," \u6578"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u662f\u5426\u6703\u81ea\u52d5\u522a\u9664"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"Pod \u6703\u6301\u7e8c\u904b\u884c"}),"\uff08\u9664\u975e\u624b\u52d5\u522a\u9664\uff09"]}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"Job \u5b8c\u6210\u5f8c\u81ea\u52d5\u522a\u9664"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u9069\u7528\u5834\u666f"})}),(0,l.jsx)(n.td,{children:"API \u4f3a\u670d\u5668\u3001\u5fae\u670d\u52d9\u3001\u81ea\u52d5\u64f4\u5c55\u6d88\u8cbb\u8005"}),(0,l.jsx)(n.td,{children:"\u6279\u6b21\u4efb\u52d9\u3001\u5f71\u50cf\u8655\u7406\u3001\u8cc7\u6599\u8f49\u63db"})]})]})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"keda-triggers-\u4ecb\u7d39",children:"KEDA Triggers \u4ecb\u7d39"}),"\n",(0,l.jsxs)(n.p,{children:["\u9019\u88e1\u6211\u5011\u6703\u4ecb\u7d39\u4ee5\u4e0b ",(0,l.jsx)(n.strong,{children:"5 \u7a2e KEDA Triggers"}),"\uff1a"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Prometheus"})," \u2192 \u900f\u904e Prometheus \u76e3\u63a7\u6307\u6a19\u4f86\u89f8\u767c\u64f4\u5c55"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Kafka"})," \u2192 \u6839\u64da Kafka \u4f47\u5217\u7a4d\u58d3\uff08lag\uff09\u52d5\u614b\u64f4\u5c55"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"PostgreSQL"})," \u2192 \u6839\u64da SQL \u67e5\u8a62\u7d50\u679c\u6c7a\u5b9a\u64f4\u5c55"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Google Cloud Platform Storage (GCS)"})," \u2192 \u4f9d\u64da GCS \u5132\u5b58\u6876\u7684\u7269\u4ef6\u6578\u89f8\u767c\u64f4\u5c55"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Elasticsearch"})," \u2192 \u6839\u64da\u65e5\u8a8c\u6578\u91cf\u3001\u641c\u5c0b\u8acb\u6c42\u6216\u5f85\u8655\u7406\u8a02\u55ae\u89f8\u767c\u64f4\u5c55"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"1-prometheus-trigger",children:"1. Prometheus Trigger"}),"\n",(0,l.jsxs)(n.p,{children:["Prometheus \u662f\u4e00\u500b\u958b\u6e90\u7684\u76e3\u63a7\u8207\u8b66\u5831\u5de5\u5177\uff0c\u5c08\u9580\u8655\u7406\u6307\u6a19\u8cc7\u6599\u800c\u8a2d\u8a08\uff0c\u6211\u5011\u53ef\u4ee5\u4f7f\u7528 Prometheus Scaler \u4f86\u5075\u6e2c\u55ae\u4e00 Pod \u7684\u4f7f\u7528\u7387\uff0c\u6839\u64da\u8cc7\u6599\u900f\u904e ",(0,l.jsx)(n.strong,{children:"\u81ea\u8a02\u6307\u6a19\uff08metrics\uff09"})," \u4f86\u89f8\u767c KEDA \u64f4\u5c55\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"yaml-\u7bc4\u4f8b",children:"YAML \u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: prometheus-scaler\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: my-deployment # \u8981\u64f4\u5c55\u7684 Deployment \u540d\u7a31\n  minReplicaCount: 1\n  maxReplicaCount: 10\n  pollingInterval: 10 # \u6bcf 10 \u79d2\u6aa2\u67e5\u4e00\u6b21\u6307\u6a19\n  triggers:\n    - type: prometheus\n      metadata:\n        serverAddress: http://prometheus.default.svc:9090\n        metricName: http_requests_total\n        query: sum(rate(http_requests_total{deployment=\"my-deployment\"}[2m])) # \u53d6 2 \u5206\u9418\u5167\u8acb\u6c42\u901f\u7387\n        threshold: '100' # \u7576\u8acb\u6c42\u901f\u7387\u8d85\u904e 100 \u6b21/\u79d2\u6642\u64f4\u5c55\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u53c3\u6578\u8aaa\u660e",children:"\u53c3\u6578\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"serverAddress"})}),(0,l.jsxs)(n.td,{children:["Prometheus \u4f3a\u670d\u5668\u4f4d\u5740\uff08\u901a\u5e38\u662f ",(0,l.jsx)(n.code,{children:"http://prometheus.default.svc:9090"}),"\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"metricName"})}),(0,l.jsxs)(n.td,{children:["\u6307\u6a19\u540d\u7a31\uff0c\u4f8b\u5982 ",(0,l.jsx)(n.code,{children:"http_requests_total"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"query"})}),(0,l.jsx)(n.td,{children:"PromQL \u67e5\u8a62\u8a9e\u6cd5\uff0c\u6c7a\u5b9a\u5982\u4f55\u8a08\u7b97\u64f4\u5c55\u689d\u4ef6"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"threshold"})}),(0,l.jsx)(n.td,{children:"\u7576\u67e5\u8a62\u7d50\u679c\u8d85\u904e\u6b64\u503c\u6642\u89f8\u767c\u64f4\u5c55"})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"\u9069\u7528\u5834\u666f",children:"\u9069\u7528\u5834\u666f"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"HTTP \u8acb\u6c42\u6d41\u91cf\u8b8a\u5316\u5927\u6642\uff0c\u81ea\u52d5\u64f4\u5c55\u670d\u52d9"}),"\n",(0,l.jsx)(n.li,{children:"\u6839\u64da CPU\u3001\u8a18\u61b6\u9ad4\u3001\u4f7f\u7528\u8005\u6578\u91cf\u7b49\u6307\u6a19\u4f86\u8abf\u6574 Pod \u6578\u91cf"}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"2-kafka-trigger",children:"2. Kafka Trigger"}),"\n",(0,l.jsxs)(n.p,{children:["Kafka \u662f\u4e00\u500b\u5206\u6563\u5f0f\u7684\u8cc7\u6599\u4e32\u6d41\u5e73\u53f0\uff0c\u53ef\u4ee5\u8655\u7406\u5be6\u6642\u8cc7\u6599\u4e32\u6d41\uff0cKEDA \u53ef\u4ee5\u6839\u64da ",(0,l.jsx)(n.strong,{children:"Kafka topic \u7684\u7a4d\u58d3\u6578\u91cf\uff08lag\uff09"})," \u4f86\u6c7a\u5b9a\u662f\u5426\u64f4\u5c55 Consumer\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"yaml-\u7bc4\u4f8b-1",children:"YAML \u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: kafka-scaler\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: kafka-consumer\n  minReplicaCount: 1\n  maxReplicaCount: 10\n  pollingInterval: 5\n  triggers:\n    - type: kafka\n      metadata:\n        bootstrapServers: my-kafka-broker:9092\n        topic: my-topic\n        consumerGroup: my-group\n        # Optional\n        lagThreshold: '100' # \u7576\u7a4d\u58d3\u8d85\u904e 100 \u5247\u8a0a\u606f\u6642\u89f8\u767c\u64f4\u5c55\n        offsetResetPolicy: latest # \u8a2d\u5b9a Kafka \u6d88\u8cbb\u8005\u5f9e\u6700\u65b0\u7684\u8a0a\u606f\u958b\u59cb\u8b80\u53d6\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u53c3\u6578\u8aaa\u660e-1",children:"\u53c3\u6578\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"bootstrapServers"})}),(0,l.jsx)(n.td,{children:"Kafka \u4ee3\u7406\u4f3a\u670d\u5668\u7684\u4f4d\u5740"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"topic"})}),(0,l.jsx)(n.td,{children:"\u8981\u76e3\u807d\u7684 Kafka topic"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"consumerGroup"})}),(0,l.jsx)(n.td,{children:"\u76e3\u807d\u7684\u6d88\u8cbb\u8005\u7fa4\u7d44\uff08Consumer Group\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"lagThreshold"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u7576 Kafka topic \u7a4d\u58d3\u6578\u91cf\u8d85\u904e\u8a72\u503c\u6642\u89f8\u767c\u64f4\u5c55"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"offsetResetPolicy"})}),(0,l.jsx)(n.td,{children:"\u8a2d\u5b9a Kafka \u6d88\u8cbb\u8005\u5f9e\u6700\u65b0\u7684\u8a0a\u606f\u958b\u59cb\u8b80\u53d6"})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"\u9069\u7528\u5834\u666f-1",children:"\u9069\u7528\u5834\u666f"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Kafka Consumer \u9700\u8981\u6839\u64da\u8ca0\u8f09\u52d5\u614b\u64f4\u5c55"}),"\n",(0,l.jsx)(n.li,{children:"\u78ba\u4fdd\u8a0a\u606f\u8655\u7406\u901f\u5ea6\u4e0d\u6703\u843d\u5f8c"}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"3-postgresql-trigger",children:"3. PostgreSQL Trigger"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"PostgreSQL Trigger"})," \u53ef\u4ee5\u6839\u64da ",(0,l.jsx)(n.strong,{children:"PostgreSQL \u67e5\u8a62\u7d50\u679c"}),"\uff08\u4f8b\u5982\u7576\u524d\u6b63\u5728\u8655\u7406\u7684\u4efb\u52d9\u6578\u91cf\uff09\u4f86\u6c7a\u5b9a\u662f\u5426\u9700\u8981\u8abf\u6574\u8cc7\u6e90\uff0c\u4e26\u6839\u64da\u8ca0\u8f09\u60c5\u6cc1\u81ea\u52d5\u64f4\u5c55\u6216\u7e2e\u6e1b Pod \u6578\u91cf\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"yaml-\u7bc4\u4f8b-2",children:"YAML \u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: airflow-worker\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: airflow-worker\n  minReplicaCount: 1\n  maxReplicaCount: 10 # Optional. Default: 100\n  pollingInterval: 10 # Optional. Default: 30 seconds\n  cooldownPeriod: 30 # Optional. Default: 300 seconds\n  triggers:\n    - type: postgresql\n      metadata:\n        connectionFromEnv: AIRFLOW_CONN_AIRFLOW_DB # \u5f9e\u74b0\u5883\u8b8a\u6578\u4e2d\u53d6\u5f97 PostgreSQL \u9023\u7dda\u5b57\u4e32\n        query: \"SELECT ceil(COUNT(*): : decimal / 16) FROM task_instance WHERE state='running' OR state='queued'\" # SQL \u67e5\u8a62\u8a9e\u6cd5\uff0c\u67e5\u8a62\u7576\u524d\u6b63\u5728\u904b\u884c\u6216\u6392\u968a\u7684\u4efb\u52d9\u6578\u91cf\uff0c\u4e26\u5c07\u5176\u9664\u4ee5 16 \u4f86\u78ba\u5b9a\u6240\u9700\u7684\u5de5\u4f5c\u8005\u6578\u91cf\n        targetQueryValue: 1 # \u7576\u67e5\u8a62\u7d50\u679c\u5927\u65bc 1 \u6642\u89f8\u767c\u64f4\u5c55\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u53c3\u6578\u8aaa\u660e-2",children:"\u53c3\u6578\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"connectionFromEnv"})}),(0,l.jsxs)(n.td,{children:["\u900f\u904e\u74b0\u5883\u8b8a\u6578\u8a2d\u5b9a PostgreSQL \u9023\u7dda\u5b57\u4e32\uff0c\u8a72\u5b57\u4e32\u4e2d\u5305\u542b\u8cc7\u6599\u5eab\u7684\u9023\u7dda\u8cc7\u8a0a\uff08\u5982\u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"AIRFLOW_CONN_AIRFLOW_DB"})," \u4f86\u53d6\u5f97\u9023\u7dda\u5b57\u4e32\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"query"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"SQL \u67e5\u8a62\u8a9e\u6cd5"}),"\uff0c\u9019\u500b\u67e5\u8a62\u6703\u57f7\u884c\u5f8c\u8fd4\u56de\u4e00\u500b\u6578\u503c\uff0cKEDA \u6703\u5c07\u5176\u8207 ",(0,l.jsx)(n.code,{children:"targetQueryValue"})," \u9032\u884c\u6bd4\u8f03\u3002\u6b64\u67e5\u8a62\u7684\u76ee\u7684\u662f\u8a08\u7b97\u7576\u524d\u6b63\u5728\u8655\u7406\u6216\u6392\u968a\u7684\u4efb\u52d9\u6578\u91cf"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"targetQueryValue"})}),(0,l.jsx)(n.td,{children:"\u7576\u67e5\u8a62\u7d50\u679c\u8d85\u904e\u8a72\u503c\u6642\uff0c\u89f8\u767c Pod \u64f4\u5c55\u3002\u9019\u8868\u793a\u7576\u76ee\u524d\u7684\u4efb\u52d9\u6578\u91cf\u9054\u5230\u6216\u8d85\u904e\u6b64\u503c\u6642\uff0c\u5c31\u6703\u555f\u52d5\u64f4\u5c55\u52d5\u4f5c"})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"\u9069\u7528\u5834\u666f-2",children:"\u9069\u7528\u5834\u666f"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u6279\u6b21\u8655\u7406\u7cfb\u7d71"}),"\uff08\u5982\uff1a\u8cc7\u6599\u532f\u5165\u3001\u5831\u8868\u751f\u6210\uff09"]}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u6839\u64da\u672a\u8655\u7406\u7684\u8a02\u55ae\u6216\u8acb\u6c42\u6578\u91cf\u81ea\u52d5\u64f4\u5c55 API \u4f3a\u670d\u5668"})}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"4-google-cloud-platform-storage-gcs-trigger",children:"4. Google Cloud Platform Storage (GCS) Trigger"}),"\n",(0,l.jsx)(n.p,{children:"KEDA \u4e5f\u53ef\u4ee5\u76e3\u807d Google Cloud Storage\uff08GCS\uff09\u5132\u5b58\u6876\uff0c\u7576\u6876\u5167\u7684\u6a94\u6848\u6578\u91cf\u8d85\u904e\u6307\u5b9a\u503c\u6642\uff0c\u81ea\u52d5\u64f4\u5c55\u8655\u7406\u9019\u4e9b\u6a94\u6848\u7684 Pod\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"yaml-\u7bc4\u4f8b-3",children:"YAML \u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: keda.sh/v1alpha1\nkind: TriggerAuthentication\nmetadata:\n  name: keda-trigger-auth-gcp-credentials\nspec:\n  secretTargetRef:\n    - parameter: GoogleApplicationCredentails\n      name: gcp-storage-secret # Required. Refers to the name of the secret\n      key: GOOGLE_APPLICATION_CREDENTAILS_JSON # Required.\n---\napiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: gcp-storage-scaledobject\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: keda-gcp-storage-go\n  minReplicaCount: 1\n  maxReplicaCount: 10\n  pollingInterval: 15\n  triggers:\n    - type: gcp-storage\n      authenticationRef:\n        name: keda-trigger-auth-gcp-credentails\n      metadata:\n        bucketName: 'Transactions'\n        targetObjectCount: '100' # \u7576\u6876\u5167\u7269\u4ef6\u8d85\u904e 100 \u500b\u6642\u64f4\u5c55\n        blobPrefix: blobsubpath # Default: \"\" \u53ea\u8a08\u7b97\u540d\u7a31\u4ee5\u6b64\u5b57\u4e32\u958b\u982d\u7684\u7269\u4ef6\n        blobDelimiter: '/' # \u7576\u555f\u7528\u6642\uff0cKEDA \u53ea\u6703\u76e3\u807d\u6307\u5b9a\u300c\u8cc7\u6599\u593e\u300d\u5167\u7684\u7269\u4ef6\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u53c3\u6578\u8aaa\u660e-3",children:"\u53c3\u6578\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"bucketName"})}),(0,l.jsx)(n.td,{children:"\u76e3\u807d\u7684 GCS \u5132\u5b58\u6876\u540d\u7a31"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"targetObjectCount"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u7576\u6876\u5167\u7269\u4ef6\u8d85\u904e\u6b64\u6578\u91cf\u6642\u89f8\u767c\u64f4\u5c55"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"blobPrefix"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u53ea\u8a08\u7b97\u540d\u7a31\u4ee5\u6b64\u5b57\u4e32\u958b\u982d\u7684\u7269\u4ef6"}),"\uff0c\u9069\u7528\u65bc\u76e3\u807d\u7279\u5b9a\u985e\u578b\u7684\u6a94\u6848\uff0c\u4f8b\u5982 ",(0,l.jsx)(n.code,{children:'"logs/"'})," \u53ea\u8a08\u7b97 ",(0,l.jsx)(n.code,{children:"logs/"})," \u958b\u982d\u7684\u6a94\u6848\u3002"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"blobDelimiter"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u5c07 GCS \u5b58\u5132\u6876\u8996\u70ba\u985e\u4f3c\u76ee\u9304\u7d50\u69cb\u6642\u4f7f\u7528"}),"\uff0c\u4f8b\u5982\u8a2d\u5b9a ",(0,l.jsx)(n.code,{children:"/"})," \u4ee3\u8868 GCS\u300c\u8cc7\u6599\u593e\u300d\uff0c\u82e5 ",(0,l.jsx)(n.code,{children:'blobPrefix: "logs/"'})," \u4e14 ",(0,l.jsx)(n.code,{children:'blobDelimiter: "/"'}),"\uff0c\u5247 KEDA \u53ea\u6703\u8a08\u7b97 ",(0,l.jsx)(n.code,{children:"logs/"})," \u5167\u7684\u7269\u4ef6\uff0c\u4e0d\u6703\u5305\u542b\u5b50\u76ee\u9304\u5167\u7684\u6a94\u6848\u3002"]})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"\u9069\u7528\u5834\u666f-3",children:"\u9069\u7528\u5834\u666f"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u6839\u64da GCS \u4e2d\u7684\u6a94\u6848\u6578\u91cf\u64f4\u5c55\u5f71\u50cf\u8655\u7406\u3001\u8cc7\u6599\u8f49\u63db\u670d\u52d9"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u9069\u7528\u65bc\u5f71\u7247\u7de8\u78bc\u3001\u65e5\u8a8c\u5206\u6790\u3001\u6a5f\u5668\u5b78\u7fd2\u8cc7\u6599\u8655\u7406\u7b49\u61c9\u7528"})}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"5-elasticsearch-trigger",children:"5. Elasticsearch Trigger"}),"\n",(0,l.jsxs)(n.p,{children:["Elasticsearch \u662f\u4e00\u500b\u5f37\u5927\u7684\u5168\u6587\u641c\u5c0b\u8207\u5206\u6790\u5f15\u64ce\uff0c\u5e38\u7528\u65bc\u65e5\u8a8c\u5206\u6790\u3001\u641c\u5c0b\u5f15\u64ce\u3001\u6307\u6a19\u76e3\u63a7\u7b49\u5834\u666f\u3002KEDA \u53ef\u4ee5\u6839\u64da ",(0,l.jsx)(n.strong,{children:"Elasticsearch \u67e5\u8a62\u7d50\u679c"})," \u4f86\u6c7a\u5b9a\u662f\u5426\u64f4\u5c55 Kubernetes \u7684 Pod\uff0c\u4f8b\u5982\u6839\u64da\u7d22\u5f15\u4e2d\u7684\u6587\u4ef6\u6578\u91cf\u3001\u67e5\u8a62\u547d\u4e2d\u6578\u91cf\u3001\u641c\u5c0b\u983b\u7387\u7b49\u689d\u4ef6\u89f8\u767c\u81ea\u52d5\u64f4\u5c55\u3002"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h4,{id:"yaml-\u7bc4\u4f8b-4",children:"YAML \u7bc4\u4f8b"}),"\n",(0,l.jsxs)(n.p,{children:["\u9019\u500b\u7bc4\u4f8b\u793a\u7bc4\u5982\u4f55\u6839\u64da ",(0,l.jsx)(n.strong,{children:"\u7d22\u5f15\u4e2d\u7684\u672a\u8655\u7406\u65e5\u8a8c\u6578\u91cf"})," \u4f86\u89f8\u767c\u64f4\u5c55\u61c9\u7528\u7a0b\u5f0f\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: elasticsearch-secrets\ntype: Opaque\ndata:\n  password: XXXXXXXX # Elasticsearch \u767b\u5165\u5bc6\u78bc\uff08Base64 \u7de8\u78bc\uff09\n---\napiVersion: keda.sh/v1alpha1\nkind: TriggerAuthentication\nmetadata:\n  name: keda-trigger-auth-elasticsearch-secret\nspec:\n  secretTargetRef:\n    - parameter: password\n      name: elasticsearch-secrets\n      key: password\n---\napiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: elasticsearch-scaledobject\n  namespace: default\nspec:\n  scaleTargetRef:\n    name: log-processor # \u8981\u64f4\u5c55\u7684 Deployment\n  minReplicaCount: 1\n  maxReplicaCount: 15\n  pollingInterval: 10 # \u6bcf 10 \u79d2\u6aa2\u67e5\u4e00\u6b21 Elasticsearch\n  triggers:\n    - type: elasticsearch\n      authenticationRef:\n        name: keda-trigger-auth-elasticsearch-secret\n      metadata:\n        addresses: http://elasticsearch.default.svc:9200\n        username: my_user # \u76f4\u63a5\u5728 metadata \u8a2d\u5b9a Elasticsearch \u4f7f\u7528\u8005\u540d\u7a31\n        index: logs\n        searchTemplateName: my_search_template # Elasticsearch Search Template \u540d\u7a31\n        valueLocation: 'hits.total.value' # \u7d50\u679c\u4e2d\u8981\u6bd4\u5c0d\u7684\u6b04\u4f4d\n        threshold: '1000' # \u7576\u67e5\u8a62\u7d50\u679c\u8d85\u904e 1000 \u5247\u6642\u89f8\u767c\u64f4\u5c55\n        params: '{\"status\": \"pending\"}' # \u7d66 Search Template \u7684\u53c3\u6578\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h4,{id:"\u53c3\u6578\u8aaa\u660e-4",children:"\u53c3\u6578\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578"}),(0,l.jsx)(n.th,{children:"\u4f5c\u7528"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"addresses"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"Elasticsearch \u4f3a\u670d\u5668\u4f4d\u5740"}),"\uff08\u901a\u5e38\u662f ",(0,l.jsx)(n.code,{children:"http://elasticsearch.default.svc:9200"}),"\uff09\u3002"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"username"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"Elasticsearch \u767b\u5165\u4f7f\u7528\u8005\u540d\u7a31"}),"\uff0c\u9019\u88e1\u76f4\u63a5\u5beb\u5728 metadata\uff0c\u800c\u4e0d\u662f\u5b58\u5165 Secret\u3002"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"index"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u76e3\u807d\u7684 Elasticsearch \u7d22\u5f15"}),"\uff08\u5982 ",(0,l.jsx)(n.code,{children:"logs"}),"\u3001",(0,l.jsx)(n.code,{children:"orders"}),"\uff09\u3002"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"searchTemplateName"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"Elasticsearch Search Template \u540d\u7a31"}),"\uff0c\u7528\u65bc\u9810\u5b9a\u7fa9\u67e5\u8a62\u6a21\u677f\uff0c\u6e1b\u5c11\u67e5\u8a62\u8907\u96dc\u5ea6\u3002"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"valueLocation"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u8981\u6bd4\u5c0d\u7684\u67e5\u8a62\u7d50\u679c\u6b04\u4f4d"}),"\uff0c\u4f8b\u5982 ",(0,l.jsx)(n.code,{children:'"hits.total.value"'})," \u6307\u7684\u662f\u5339\u914d\u7684\u6587\u4ef6\u6578\u91cf\u3002"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"threshold"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u7576\u67e5\u8a62\u7d50\u679c\u6578\u91cf\u8d85\u904e\u8a72\u503c\u6642\u89f8\u767c\u64f4\u5c55"}),"\u3002"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"params"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.strong,{children:"\u63d0\u4f9b\u7d66 Search Template \u7684\u53c3\u6578"}),"\uff0c\u4f8b\u5982 ",(0,l.jsx)(n.code,{children:'\'{"status": "pending"}\''}),"\u3002"]})]})]})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h4,{id:"\u9069\u7528\u5834\u666f-4",children:"\u9069\u7528\u5834\u666f"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u65e5\u8a8c\u5206\u6790\u8207\u8655\u7406"}),"\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6839\u64da ",(0,l.jsx)(n.strong,{children:"Elasticsearch \u4e2d\u5f85\u8655\u7406\u7684\u65e5\u8a8c\u6578\u91cf"})," \u64f4\u5c55\u65e5\u8a8c\u5206\u6790\u670d\u52d9"]}),"\n",(0,l.jsx)(n.li,{children:"\u907f\u514d\u65e5\u8a8c\u7a4d\u58d3\uff0c\u78ba\u4fdd\u65e5\u8a8c\u8655\u7406\u901f\u5ea6\u8ddf\u4e0a\u6d41\u91cf"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u641c\u5c0b\u8acb\u6c42\u76e3\u63a7"}),"\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6839\u64da\u641c\u5c0b\u8acb\u6c42\u7684 ",(0,l.jsx)(n.strong,{children:"\u547d\u4e2d\u6578\u91cf\u6216\u983b\u7387"})," \u4f86\u8abf\u6574\u641c\u5c0b API \u7684 Pod \u6578\u91cf"]}),"\n",(0,l.jsx)(n.li,{children:"\u78ba\u4fdd\u9ad8\u641c\u5c0b\u6d41\u91cf\u6642\u63d0\u4f9b\u7a69\u5b9a\u6548\u80fd"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u8a02\u55ae\u6216\u4ea4\u6613\u8655\u7406"}),"\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u76e3\u63a7 ",(0,l.jsx)(n.strong,{children:"Elasticsearch \u4e2d\u7684\u5f85\u8655\u7406\u8a02\u55ae"}),"\uff0c\u6839\u64da\u7a4d\u58d3\u6578\u91cf\u64f4\u5c55 API \u6216\u80cc\u666f\u5de5\u4f5c\u8005"]}),"\n",(0,l.jsx)(n.li,{children:"\u78ba\u4fdd\u7cfb\u7d71\u80fd\u61c9\u5c0d\u7a81\u767c\u7684\u5927\u91cf\u4ea4\u6613\u8acb\u6c42"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"keda-\u7684\u5f48\u6027\u4f38\u7e2e01-\u53ca-10-\u7e2e\u653e\u89e3\u6790",children:"KEDA \u7684\u5f48\u6027\u4f38\u7e2e\uff1a0\u21921 \u53ca 1\u21920 \u7e2e\u653e\u89e3\u6790"}),"\n",(0,l.jsxs)(n.p,{children:["KEDA\uff08Kubernetes Event-Driven Autoscaling\uff09\u662f\u4e00\u7a2e\u57fa\u65bc\u4e8b\u4ef6\u9a45\u52d5\u7684\u81ea\u52d5\u4f38\u7e2e\u6a5f\u5236\uff0c\u80fd\u5920\u6839\u64da\u7279\u5b9a\u6307\u6a19\u81ea\u52d5\u8abf\u6574 Pod \u7684\u6578\u91cf\u3002\n\u8207 HPA\uff08Horizontal Pod Autoscaler\uff09\u4e0d\u540c\uff0cKEDA ",(0,l.jsx)(n.strong,{children:"\u53ef\u4ee5\u5c07 Deployment \u5b8c\u5168\u7e2e\u6e1b\u81f3 0"}),"\uff0c\u4e26\u5728\u8ca0\u8f09\u5230\u9054\u9580\u6abb\u6642 ",(0,l.jsx)(n.strong,{children:"\u5f9e 0 \u555f\u52d5 Pod"}),"\uff0c\u5be6\u73fe\u771f\u6b63\u7684\u52d5\u614b\u8cc7\u6e90\u8abf\u914d\u3002"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"0--1\u5f9e-0-\u555f\u52d5-pod",children:"0 \u2192 1\uff1a\u5f9e 0 \u555f\u52d5 Pod"}),"\n",(0,l.jsxs)(n.p,{children:["\u9019\u500b\u904e\u7a0b\u901a\u5e38\u767c\u751f\u5728\u7cfb\u7d71\u7a7a\u9592\u4e00\u6bb5\u6642\u9593\u5f8c\uff0c\u7576\u89f8\u767c\u689d\u4ef6\u9054\u5230\u6307\u5b9a\u9580\u6abb\u6642\uff0cKEDA \u6703\u5f9e ",(0,l.jsx)(n.strong,{children:"0 \u500b Pod \u555f\u52d5 1 \u500b Pod"}),"\uff0c\u4f7f\u61c9\u7528\u7a0b\u5f0f\u958b\u59cb\u8655\u7406\u8acb\u6c42\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"\u6b65\u9a5f\u89e3\u6790",children:"\u6b65\u9a5f\u89e3\u6790"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"KEDA \u76e3\u807d Scaler \u6307\u6a19"}),"\uff08\u5982 Kafka \u8a0a\u606f\u6578\u3001Elasticsearch \u67e5\u8a62\u7d50\u679c\u3001RabbitMQ \u4f47\u5217\u9577\u5ea6\u7b49\uff09\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsxs)(n.strong,{children:["\u7576\u6307\u6a19\u8d85\u904e ",(0,l.jsx)(n.code,{children:"threshold"})," \u503c\u6642\uff0cKEDA \u555f\u52d5 ScaledObject"]}),"\uff0c\u4e26\u901a\u77e5 Kubernetes \u589e\u52a0 ",(0,l.jsx)(n.code,{children:"scaleTargetRef"}),"\uff08\u76ee\u6a19 Deployment\uff09\u7684\u526f\u672c\u6578\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Kubernetes \u555f\u52d5\u7b2c\u4e00\u500b Pod"}),"\uff0c\u62c9\u53d6\u6240\u9700\u7684\u61c9\u7528\u7a0b\u5f0f\u6620\u50cf\u4e26\u958b\u59cb\u57f7\u884c\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Pod \u958b\u59cb\u8655\u7406\u8ca0\u8f09"}),"\uff0c\u540c\u6642 KEDA \u7e7c\u7e8c\u76e3\u6e2c\u6307\u6a19\u6578\u64da\uff0c\u4ee5\u6c7a\u5b9a\u662f\u5426\u9700\u8981\u9032\u4e00\u6b65\u64f4\u5c55\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u95dc\u9375\u5f71\u97ff\u56e0\u7d20",children:"\u95dc\u9375\u5f71\u97ff\u56e0\u7d20"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u51b7\u555f\u52d5\u6642\u9593\uff08Cold Start\uff09"}),"\uff1a\u5f9e 0 \u555f\u52d5\u4e00\u500b Pod \u9700\u8981\u6642\u9593\uff0c\u5305\u542b**\u5bb9\u5668\u62c9\u53d6\u6620\u50cf\uff08image pull\uff09\u3001\u521d\u59cb\u5316\uff08init\uff09\u3001\u5065\u5eb7\u6aa2\u67e5\uff08readiness probe\uff09**\u7b49\uff0c\u56e0\u6b64\u61c9\u7528\u7a0b\u5f0f\u61c9\u512a\u5316\u555f\u52d5\u901f\u5ea6\uff0c\u4f8b\u5982\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,l.jsx)(n.strong,{children:"\u8f15\u91cf\u7d1a\u6620\u50cf\uff08\u5982 Alpine\uff09"})," \u6e1b\u5c11\u62c9\u53d6\u6642\u9593\u3002"]}),"\n",(0,l.jsx)(n.li,{children:"\u9810\u71b1\u61c9\u7528\u7a0b\u5f0f\uff08Warm-Up Strategy\uff09\u3002"}),"\n",(0,l.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"readinessProbe"})," \u907f\u514d\u670d\u52d9\u672a\u5c31\u7dd2\u6642\u6536\u5230\u8acb\u6c42\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Polling \u9593\u9694\u5f71\u97ff\u555f\u52d5\u6642\u6a5f"}),"\uff1aKEDA \u9810\u8a2d ",(0,l.jsx)(n.code,{children:"pollingInterval"})," \u70ba ",(0,l.jsx)(n.strong,{children:"30 \u79d2"}),"\uff08\u53ef\u8abf\u6574\uff09\uff0c\u9019\u4ee3\u8868 KEDA ",(0,l.jsx)(n.strong,{children:"\u6700\u591a\u53ef\u80fd\u8981\u7b49\u5f85 30 \u79d2\u624d\u6703\u5075\u6e2c\u5230\u8ca0\u8f09"}),"\uff0c\u9019\u9ede\u5728\u5373\u6642\u6027\u61c9\u7528\uff08\u5982 Webhook \u6216\u4e8b\u4ef6\u8655\u7406\u7cfb\u7d71\uff09\u4e2d\u9700\u8981\u7279\u5225\u7559\u610f\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"1--0\u5f9e-1-\u7e2e\u6e1b\u81f3-0",children:"1 \u2192 0\uff1a\u5f9e 1 \u7e2e\u6e1b\u81f3 0"}),"\n",(0,l.jsxs)(n.p,{children:["\u7576\u8ca0\u8f09\u4e0b\u964d\u6642\uff0cKEDA \u6703\u5c07 Pod \u6578\u91cf\u964d\u81f3 ",(0,l.jsx)(n.strong,{children:"0"}),"\uff0c\u91cb\u653e\u8cc7\u6e90\uff0c\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u8a08\u7b97\u6210\u672c\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"\u6b65\u9a5f\u89e3\u6790-1",children:"\u6b65\u9a5f\u89e3\u6790"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"KEDA \u6301\u7e8c\u76e3\u6e2c Scaler \u6307\u6a19"}),"\uff0c\u5982\u679c\u6578\u503c\u4f4e\u65bc ",(0,l.jsx)(n.code,{children:"threshold"}),"\uff08\u901a\u5e38\u662f 0 \u6216\u6975\u4f4e\u503c\uff09\uff0c\u5247\u9032\u884c\u7e2e\u6e1b\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsxs)(n.strong,{children:["\u7b49\u5f85 ",(0,l.jsx)(n.code,{children:"cooldownPeriod"})," \u904e\u5f8c\uff08\u9810\u8a2d 5 \u5206\u9418\uff09"]}),"\uff0cKEDA \u89f8\u767c ",(0,l.jsx)(n.code,{children:"scaleTargetRef"}),"\uff0c\u5c07 Deployment \u526f\u672c\u6578\u964d\u81f3 0\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Kubernetes \u505c\u6b62\u6240\u6709 Pod"}),"\uff0c\u91cb\u653e CPU\u3001\u8a18\u61b6\u9ad4\u7b49\u8cc7\u6e90\uff0c\u7bc0\u7701\u6210\u672c\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u95dc\u9375\u5f71\u97ff\u56e0\u7d20-1",children:"\u95dc\u9375\u5f71\u97ff\u56e0\u7d20"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsxs)(n.strong,{children:[(0,l.jsx)(n.code,{children:"cooldownPeriod"})," \u63a7\u5236\u4f55\u6642\u7e2e\u6e1b"]}),"\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u9810\u8a2d\u503c\u70ba ",(0,l.jsx)(n.strong,{children:"300 \u79d2\uff085 \u5206\u9418\uff09"}),"\uff0c\u4f46\u53ef\u6839\u64da\u61c9\u7528\u9700\u6c42\u8abf\u6574\u3002"]}),"\n",(0,l.jsx)(n.li,{children:"\u8a2d\u5b9a\u904e\u77ed\u53ef\u80fd\u5c0e\u81f4\u983b\u7e41\u7e2e\u653e\uff0c\u5f71\u97ff\u670d\u52d9\u7a69\u5b9a\u6027\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u61c9\u7528\u7a0b\u5f0f\u72c0\u614b\u4fdd\u6301"}),"\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5982\u679c\u61c9\u7528\u7a0b\u5f0f\u9700\u8981\u7dad\u6301\u6301\u7e8c\u6027\u9023\u7dda\uff08\u5982 WebSocket\uff09\uff0c\u7e2e\u6e1b\u81f3 0 \u53ef\u80fd\u6703\u4e2d\u65b7\u9023\u7dda\uff0c\u9019\u6642\u53ef\u4ee5\u8003\u616e\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u8a2d\u5b9a ",(0,l.jsx)(n.code,{children:"minReplicaCount: 1"}),"\uff0c\u907f\u514d\u5b8c\u5168\u95dc\u9589\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["\u914d\u5408 ",(0,l.jsx)(n.strong,{children:"\u5916\u90e8\u5feb\u53d6\uff08\u5982 Redis\uff09"})," \u5b58\u5132\u72c0\u614b\u8cc7\u8a0a\uff0c\u907f\u514d\u5f71\u97ff\u5f8c\u7e8c\u8acb\u6c42\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u8207 HPA \u7684\u885d\u7a81"}),"\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u82e5 HPA \u8a2d\u5b9a\u4e86 ",(0,l.jsx)(n.code,{children:"minReplicas: 1"}),"\uff0c\u5247\u5373\u4f7f KEDA \u5617\u8a66\u7e2e\u6e1b\u5230 0\uff0cHPA \u4ecd\u53ef\u80fd\u7dad\u6301 1 \u500b Pod\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["\u56e0\u6b64\uff0c\u82e5\u5e0c\u671b\u5b8c\u5168\u7e2e\u6e1b\u81f3 0\uff0c\u61c9\u505c\u7528 HPA \u6216\u5c07 ",(0,l.jsx)(n.code,{children:"minReplicas: 0"}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"keda-\u7684\u6fc0\u6d3b\u968e\u6bb5\u8207\u7e2e\u653e\u968e\u6bb5\u89e3\u6790",children:"KEDA \u7684\u6fc0\u6d3b\u968e\u6bb5\u8207\u7e2e\u653e\u968e\u6bb5\u89e3\u6790"}),"\n",(0,l.jsxs)(n.p,{children:["KEDA \u7684\u6838\u5fc3\u904b\u4f5c\u6a5f\u5236\u5305\u542b\u5169\u500b\u4e3b\u8981\u968e\u6bb5\uff1a",(0,l.jsx)(n.strong,{children:"\u6fc0\u6d3b\u968e\u6bb5\uff08Activation Phase\uff09"})," \u548c ",(0,l.jsx)(n.strong,{children:"\u7e2e\u653e\u968e\u6bb5\uff08Scaling Phase\uff09"}),"\uff0c\u9019\u5169\u500b\u968e\u6bb5\u7684\u904b\u4f5c\u6c7a\u5b9a\u4e86 Pod \u4f55\u6642\u61c9\u8a72\u555f\u52d5\u6216\u7e2e\u6e1b\uff0c\u4e26\u4e14\u53ef\u4ee5\u900f\u904e ",(0,l.jsx)(n.strong,{children:"\u6fc0\u6d3b\u95a5\u503c\uff08Activation Thresholds\uff09"})," \u8207 ",(0,l.jsx)(n.strong,{children:"\u7e2e\u653e\u95a5\u503c\uff08Scaling Thresholds\uff09"})," \u4f86\u7cbe\u78ba\u63a7\u5236\u3002"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"\u6fc0\u6d3b\u968e\u6bb5activation-phase",children:"\u6fc0\u6d3b\u968e\u6bb5\uff08Activation Phase\uff09"}),"\n",(0,l.jsxs)(n.p,{children:["\u7576 KEDA \u76e3\u807d\u7684 Scaler \u6307\u6a19 ",(0,l.jsx)(n.strong,{children:"\u8d85\u904e\u6fc0\u6d3b\u95a5\u503c\uff08Activation Threshold\uff09"}),"\uff0c\u4e26\u4e14 ",(0,l.jsx)(n.code,{children:"minReplicaCount = 0"})," \u6642\uff0c\u7cfb\u7d71\u9032\u5165 ",(0,l.jsx)(n.strong,{children:"\u6fc0\u6d3b\u968e\u6bb5"}),"\uff0c\u958b\u59cb\u5f9e ",(0,l.jsx)(n.strong,{children:"0 \u555f\u52d5 Pod"}),"\uff0c\u6e96\u5099\u8655\u7406\u5373\u5c07\u5230\u4f86\u7684\u8ca0\u8f09\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"\u95dc\u9375\u9ede",children:"\u95dc\u9375\u9ede"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"activationThreshold"})}),"\uff1a\u5b9a\u7fa9 Pod ",(0,l.jsx)(n.strong,{children:"\u5f9e 0 \u555f\u52d5\u7684\u8ca0\u8f09\u9580\u6abb"}),"\uff0c\u4f4e\u65bc\u6b64\u503c\u6642 Pod \u4fdd\u6301\u70ba 0\uff0c\u4e0d\u9032\u5165\u6fc0\u6d3b\u968e\u6bb5\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Scaler \u76e3\u807d\u76ee\u6a19\u8ca0\u8f09"}),"\uff08\u5982 RabbitMQ \u4f47\u5217\u9577\u5ea6\u3001Kafka \u8a0a\u606f\u6578\u3001Elasticsearch \u67e5\u8a62\u7d50\u679c\uff09\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsxs)(n.strong,{children:["\u7576\u8ca0\u8f09\u9054\u5230 ",(0,l.jsx)(n.code,{children:"activationThreshold"}),"\uff0cKEDA \u555f\u52d5 Deployment"]}),"\uff0cPod \u6578\u91cf\u8b8a\u70ba 1\uff08\u6216 ",(0,l.jsx)(n.code,{children:"minReplicaCount"}),"\uff09\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u5f71\u97ff\u56e0\u7d20",children:"\u5f71\u97ff\u56e0\u7d20"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u51b7\u555f\u52d5\uff08Cold Start\uff09"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u7531\u65bc Pod \u9700\u8981\u6642\u9593\u555f\u52d5\uff0c\u8a2d\u5b9a ",(0,l.jsx)(n.code,{children:"activationThreshold"})," \u6642\u9700\u8003\u616e\u61c9\u7528\u7a0b\u5e8f\u7684\u51b7\u555f\u52d5\u6642\u9593\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u89e3\u6c7a\u65b9\u6848"}),"\uff1a\u4f7f\u7528\u8f03\u5c0f\u7684 ",(0,l.jsx)(n.code,{children:"activationThreshold"})," \u4ee5\u63d0\u524d\u89f8\u767c\u64f4\u5c55\uff0c\u6216\u8005\u512a\u5316\u61c9\u7528\u555f\u52d5\u901f\u5ea6\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsxs)(n.strong,{children:[(0,l.jsx)(n.code,{children:"minReplicaCount >= 1"})," \u7684\u5f71\u97ff"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsxs)(n.strong,{children:["\u7576 ",(0,l.jsx)(n.code,{children:"minReplicaCount >= 1"})," \u6642\uff0cKEDA Scaler \u5c07"]})," ",(0,l.jsx)(n.strong,{children:"\u6c38\u9060\u8655\u65bc\u6fc0\u6d3b\u72c0\u614b"}),"\uff0c\u6b64\u6642 ",(0,l.jsx)(n.code,{children:"activationThreshold"})," ",(0,l.jsx)(n.strong,{children:"\u5c07\u88ab\u5ffd\u7565"}),"\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["\u9019\u610f\u5473\u8457\u5373\u4f7f\u8ca0\u8f09\u70ba 0\uff0cPod \u4e5f\u4e0d\u6703\u7e2e\u6e1b\u5230 0\uff0c\u800c\u662f\u81f3\u5c11\u4fdd\u6301 ",(0,l.jsx)(n.code,{children:"minReplicaCount"})," \u500b Pod \u5b58\u5728\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"\u7e2e\u653e\u968e\u6bb5scaling-phase",children:"\u7e2e\u653e\u968e\u6bb5\uff08Scaling Phase\uff09"}),"\n",(0,l.jsxs)(n.p,{children:["\u7576\u8ca0\u8f09\u9054\u5230 ",(0,l.jsx)(n.strong,{children:"\u7e2e\u653e\u95a5\u503c\uff08Scaling Threshold\uff09"}),"\uff0cKEDA \u6703\u8abf\u6574 Pod \u6578\u91cf\uff0c\u78ba\u4fdd\u61c9\u7528\u7a0b\u5f0f\u7684\u8cc7\u6e90\u5229\u7528\u6700\u4f73\u5316\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"\u95dc\u9375\u9ede-1",children:"\u95dc\u9375\u9ede"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"scalingThreshold"})}),"\uff1a\u5b9a\u7fa9 ",(0,l.jsx)(n.strong,{children:"Pod \u6578\u91cf\u8b8a\u52d5\u7684\u8ca0\u8f09\u9580\u6abb"}),"\uff0c\u4f4e\u65bc\u8a72\u503c\u6642 Pod \u53ef\u80fd\u7e2e\u6e1b\uff0c\u9ad8\u65bc\u8a72\u503c\u6642 Pod \u53ef\u80fd\u64f4\u5c55\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsxs)(n.strong,{children:["\u6839\u64da ",(0,l.jsx)(n.code,{children:"scalingThreshold"})," \u52d5\u614b\u8abf\u6574 Pod \u6578\u91cf"]}),"\uff0c\u78ba\u4fdd\u61c9\u7528\u7a0b\u5f0f\u64c1\u6709\u8db3\u5920\u7684\u8cc7\u6e90\u4f86\u8655\u7406\u7576\u524d\u8ca0\u8f09\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsxs)(n.strong,{children:["\u7576\u8ca0\u8f09\u4f4e\u65bc ",(0,l.jsx)(n.code,{children:"scalingThreshold"}),"\uff0c\u4e26\u4e14 ",(0,l.jsx)(n.code,{children:"cooldownPeriod"})," \u5230\u671f\u5f8c\uff0cPod \u53ef\u80fd\u88ab\u7e2e\u6e1b\uff08\u4f46\u4e0d\u6703\u5c0f\u65bc ",(0,l.jsx)(n.code,{children:"minReplicaCount"}),"\uff09"]}),"\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u5f71\u97ff\u56e0\u7d20-1",children:"\u5f71\u97ff\u56e0\u7d20"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsxs)(n.strong,{children:[(0,l.jsx)(n.code,{children:"cooldownPeriod"})," \u63a7\u5236 Pod \u4f55\u6642\u7e2e\u6e1b"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u9810\u8a2d ",(0,l.jsx)(n.code,{children:"cooldownPeriod"})," \u70ba ",(0,l.jsx)(n.strong,{children:"5 \u5206\u9418"}),"\uff0c\u5373\u7576\u8ca0\u8f09\u4f4e\u65bc ",(0,l.jsx)(n.code,{children:"scalingThreshold"})," \u4e26\u6301\u7e8c 5 \u5206\u9418\u5f8c\uff0cPod \u624d\u6703\u7e2e\u6e1b\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["\u82e5 ",(0,l.jsx)(n.code,{children:"cooldownPeriod"})," \u8a2d\u5b9a\u904e\u77ed\uff0c\u53ef\u80fd\u5c0e\u81f4 Pod \u983b\u7e41\u7e2e\u653e\uff0c\u5f71\u97ff\u7a69\u5b9a\u6027\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u89e3\u6c7a\u65b9\u6848"}),"\uff1a\u6839\u64da\u8ca0\u8f09\u7279\u6027\u9069\u7576\u8abf\u6574 ",(0,l.jsx)(n.code,{children:"cooldownPeriod"}),"\uff0c\u907f\u514d\u904e\u5ea6\u7e2e\u653e\u5c0e\u81f4\u8cc7\u6e90\u6ce2\u52d5\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Pod \u6578\u91cf\u8b8a\u5316"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Pod \u6578\u91cf\u7684\u8b8a\u52d5\u7bc4\u570d\u5728 ",(0,l.jsx)(n.code,{children:"minReplicaCount"})," \u548c ",(0,l.jsx)(n.code,{children:"maxReplicaCount"})," \u4e4b\u9593\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["\u7576\u8ca0\u8f09\u589e\u52a0\uff0cPod \u6578\u91cf\u53ef\u4ee5\u64f4\u5c55\u5230 ",(0,l.jsx)(n.code,{children:"maxReplicaCount"}),"\uff1b\u7576\u8ca0\u8f09\u4e0b\u964d\uff0cPod \u6578\u91cf\u6700\u5c11\u7e2e\u6e1b\u81f3 ",(0,l.jsx)(n.code,{children:"minReplicaCount"}),"\uff08\u82e5 ",(0,l.jsx)(n.code,{children:"minReplicaCount = 0"}),"\uff0c\u5247\u53ef\u4ee5\u7e2e\u6e1b\u5230 0\uff09\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"minreplicacount-\u7684\u5f71\u97ff",children:"minReplicaCount \u7684\u5f71\u97ff"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"minReplicaCount"})," \u7684\u8a2d\u5b9a\u5f71\u97ff KEDA Scaler \u662f\u5426\u6703\u5b8c\u5168\u9032\u5165\u6fc0\u6d3b\u8207\u7e2e\u653e\u72c0\u614b\uff1a"]}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.th,{children:[(0,l.jsx)(n.code,{children:"minReplicaCount"})," \u8a2d\u5b9a"]}),(0,l.jsx)(n.th,{children:"\u884c\u70ba"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"0"})}),(0,l.jsxs)(n.td,{children:["Scaler \u53ef\u4ee5\u7e2e\u6e1b\u5230 0\uff0c",(0,l.jsx)(n.code,{children:"activationThreshold"})," \u6709\u6548\uff0cPod \u6703\u5728\u8ca0\u8f09\u9054\u5230\u9580\u6abb\u6642\u555f\u52d5\u3002"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"\u2265 1"})}),(0,l.jsxs)(n.td,{children:["Scaler ",(0,l.jsx)(n.strong,{children:"\u6c38\u9060\u8655\u65bc\u6fc0\u6d3b\u72c0\u614b"}),"\uff0cPod \u4e0d\u6703\u7e2e\u6e1b\u81f3 0\uff0c",(0,l.jsx)(n.code,{children:"activationThreshold"})," ",(0,l.jsx)(n.strong,{children:"\u5c07\u88ab\u5ffd\u7565"}),"\u3002"]})]})]})]}),"\n",(0,l.jsx)(n.p,{children:"\u9019\u8868\u793a\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u82e5\u5e0c\u671b Deployment ",(0,l.jsx)(n.strong,{children:"\u5728\u4f4e\u8ca0\u8f09\u6642\u5b8c\u5168\u95dc\u9589"}),"\uff0c\u61c9\u8a2d\u7f6e ",(0,l.jsx)(n.code,{children:"minReplicaCount: 0"}),"\uff0c\u4e26\u6839\u64da ",(0,l.jsx)(n.code,{children:"activationThreshold"})," \u63a7\u5236 Pod \u555f\u52d5\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["\u82e5\u61c9\u7528\u7a0b\u5f0f\u9700\u8981 ",(0,l.jsx)(n.strong,{children:"\u6301\u7e8c\u904b\u884c\u81f3\u5c11 1 \u500b Pod"}),"\uff0c\u5247\u61c9\u8a2d\u7f6e ",(0,l.jsx)(n.code,{children:"minReplicaCount \u2265 1"}),"\uff0c\u4f46\u9019\u6a23 ",(0,l.jsx)(n.code,{children:"activationThreshold"})," \u5c31\u4e0d\u518d\u5f71\u97ff\u7e2e\u653e\u884c\u70ba\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"\u5be6\u4f5c\u4e00\u500b-keda",children:"\u5be6\u4f5c\u4e00\u500b KEDA"}),"\n",(0,l.jsx)(n.h3,{id:"\u5b89\u88dd-keda",children:"\u5b89\u88dd KEDA"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u9996\u5148\u6211\u5011\u900f\u904e helm \u4f86\u5b89\u88dd KEDA\uff0c\u6211\u5011\u589e\u52a0 KEDA \u7684 repo \u4f4d\u7f6e\uff0c\u63a5\u4e0b\u4f86\u8ddf\u65b0 helm \u7684 repo\uff0c\u5c31\u53ef\u4ee5\u4e0b\u8f09 KEDA\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"helm repo add kedacore https://kedacore.github.io/charts\nhelm repo update\nhelm install keda kedacore/keda --namespace keda --create-namespace\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u90e8\u5c6c-redis",children:"\u90e8\u5c6c Redis"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u9996\u5148\uff0c\u6211\u5011\u5efa\u7acb\u4e00\u500b Redis \u4f5c\u70ba\u7c21\u55ae\u7684\u8a0a\u606f\u4f47\u5217\uff0c\u63d0\u4f9b\u4e8b\u4ef6\u9a45\u52d5\u7684\u8cc7\u6599\u4f86\u6e90\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",metastring:'title="redis.yaml"',children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: redis\nspec:\n  ports:\n    - port: 6379\n      targetPort: 6379\n  selector:\n    app: redis\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: redis\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: redis\n  template:\n    metadata:\n      labels:\n        app: redis\n    spec:\n      containers:\n        - name: redis\n          image: redis\n          ports:\n            - containerPort: 6379\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsx)(n.li,{children:"\u900f\u904e\u6307\u4ee4\u4f86\u904b\u884c\u4ed6\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl.exe apply -f redis.yaml\n---\n\nservice/redis created\ndeployment.apps/redis created\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u90e8\u5c6c-worker-\u548c-scaledobject",children:"\u90e8\u5c6c Worker \u548c ScaledObject"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u6211\u5011\u5b9a\u7fa9\u4e00\u500b worker \u7684 Pod\uff0c\u7528\u4f86\u8655\u7406 Redis \u7684\u4efb\u52d9\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",metastring:'title="worker.yaml"',children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: worker\nspec:\n  replicas: 0\n  selector:\n    matchLabels:\n      app: worker\n  template:\n    metadata:\n      labels:\n        app: worker\n    spec:\n      containers:\n        - name: worker\n          image: redis:alpine # \u4f7f\u7528 Redis \u8f15\u91cf\u7d1a Alpine \u7248\u672c\n          command:\n            [\n              \'sh\',\n              \'-c\',\n              \'while true; do job=$(redis-cli -h redis -p 6379 LPOP jobs); if [ "$job" != "" ]; then echo "Processing job: $job"; else echo "No jobs in the queue"; fi; sleep 5; done\',\n            ]\n'})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsx)(n.li,{children:"\u63a5\u4e0b\u4f86\u6211\u5011\u5b9a\u7fa9 ScaledObject\uff0c\u6211\u5e0c\u671b\u8b93 KEDA \u76e3\u807d Redis \u4f47\u5217\u7684\u9577\u5ea6\uff0c\u7576\u8a0a\u606f\u6578\u8d85\u904e 5\uff0cPod \u6703\u64f4\u5c55\uff0c\u5fc5\u4e14\u6c92\u6709\u7528\u5230\u7684\u6642\u5019\u4fdd\u6301 Replica \u6578\u91cf\u70ba 0\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",metastring:'title="scaledobject.yaml"',children:"apiVersion: keda.sh/v1alpha1\nkind: ScaledObject\nmetadata:\n  name: redis-scaledobject\nspec:\n  scaleTargetRef:\n    name: worker # \u9019\u500b\u662f\u8981\u7e2e\u653e\u7684 Deployment \u540d\u7a31\n  minReplicaCount: 0\n  maxReplicaCount: 5\n  pollingInterval: 5\n  cooldownPeriod: 60\n  triggers:\n    - type: redis\n      metadata:\n        address: redis.default.svc.cluster.local:6379\n        listName: jobs # Redis \u76e3\u807d\u7684 key\n        listLength: '5' # \u7576 jobs \u4f47\u5217\u9577\u5ea6\u8d85\u904e 5 \u6642\uff0c\u89f8\u767c\u64f4\u5c55\n        activationListLength: '5' # \u7576 jobs \u4f47\u5217\u9577\u5ea6\u8d85\u904e 5 \u6642\uff0c\u89f8\u767c0\u8b8a\u62101\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsx)(n.li,{children:"\u7136\u5f8c\u900f\u904e\u6307\u4ee4\u57f7\u884c\u9019\u5169\u500b\u7269\u4ef6\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl.exe apply -f worker.yaml,scaledobject.yaml\n---\n\ndeployment.apps/worker created\nscaledobject.keda.sh/redis-scaledobject created\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"4",children:["\n",(0,l.jsx)(n.li,{children:"\u900f\u904e\u6307\u4ee4\u4f86\u89c0\u5bdf pod \u7684\u5efa\u7acb\uff0c\u78ba\u8a8d\u6703\u4e0d\u6703\u5728\u8a0a\u606f\u9577\u5ea6\u5927\u65bc 5 \u7684\u6642\u5019\u555f\u52d5\u4e00\u500b Pod\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl.exe get pods -w\n---\n\nNAME                    READY   STATUS    RESTARTS   AGE\nredis-9cfbb989d-77ffk   1/1     Running   0          43m\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u6e2c\u8a66-keda-\u81ea\u52d5\u7e2e\u653e",children:"\u6e2c\u8a66 KEDA \u81ea\u52d5\u7e2e\u653e"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u9996\u5148\u9032\u5230 Redis \u7684 Pod \u88e1\u9762\uff0c\u6211\u5011\u9700\u8981\u900f\u904e\u6307\u4ee4\u7684\u65b9\u5f0f\u589e\u52a0\u8a0a\u606f\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'kubectl exec -it $(kubectl get pod -l app=redis -o jsonpath="{.items[0].metadata.name}") -- redis-cli\n---\n\n127.0.0.1:6379>\n'})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsx)(n.li,{children:"\u63a5\u4e0b\u4f86\u6211\u5011 LPUSH \u4e09\u500b\u8a0a\u606f\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'127.0.0.1:6379> LPUSH jobs "task1" "task2" "task3"\n\n---\n(integer) 3\n'})}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u6211\u5011\u53ef\u4ee5\u767c\u73fe Pod \u6c92\u6709\u88ab\u5efa\u7acb\uff0c\u56e0\u70ba\u9084\u672a\u8d85\u904e\u898f\u5b9a\u7684\u9577\u5ea6 5\u3002"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u63a5\u4e0b\u4f86\u6211\u5011\u5728 LPUSH \u4e09\u500b\u8a0a\u606f\uff0c\u9019\u500b\u6642\u5019\u8a0a\u606f\u7684\u9577\u5ea6\u5c31\u8d85\u904e 5\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'127.0.0.1:6379> LPUSH jobs "task4" "task5" "task6"\n---\n\n(integer) 6\n'})}),"\n",(0,l.jsxs)(n.ol,{start:"5",children:["\n",(0,l.jsx)(n.li,{children:"\u6211\u5011\u53ef\u4ee5\u770b\u5230\u7576\u9577\u5ea6\u5927\u65bc5\uff0cPod\u5c31\u6703\u88ab\u5efa\u7acb\uff0creplica\u5f9e0\u8b8a\u62101\uff0c\u6bcf60\u79d2\u6703\u6aa2\u67e5\u5982\u679c\u9577\u5ea6\u5c0f\u65bc5\uff0creplica\u5c31\u6703\u5f9e1\u8b8a\u62100\uff0cPod\u4e5f\u90fd\u88ab\u95dc\u9589\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl.exe get pods -w\n---\n\nNAME                      READY   STATUS              RESTARTS   AGE\nredis-9cfbb989d-77ffk     1/1     Running             0          43m\nworker-84d6b8f7bd-5pwmz   0/1     Pending             0          0s\nworker-84d6b8f7bd-5pwmz   0/1     Pending             0          0s\nworker-84d6b8f7bd-5pwmz   0/1     ContainerCreating   0          0s\nworker-84d6b8f7bd-5pwmz   1/1     Running             0          1s\nworker-84d6b8f7bd-5pwmz   1/1     Terminating         0          60s\nworker-84d6b8f7bd-5pwmz   0/1     Terminating         0          91s\nworker-84d6b8f7bd-5pwmz   0/1     Terminating         0          91s\nworker-84d6b8f7bd-5pwmz   0/1     Terminating         0          91s\nworker-84d6b8f7bd-5pwmz   0/1     Terminating         0          91s\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"6",children:["\n",(0,l.jsx)(n.li,{children:"\u6211\u5011\u53ef\u4ee5\u540c\u6642\u89c0\u5bdfpod\u7684\u8f38\u51fa\uff0c\u53ef\u4ee5\u770b\u5230\u4ed6\u5f9etask6\u4e00\u76f4\u6d88\u5316\u9053task1\uff0c\u6700\u5f8c\u6c92\u6709\uff0c\u4e4b\u5f8c\u5c31\u88ab\u522a\u9664\u4e86\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl.exe logs pods/worker-84d6b8f7bd-5pwmz -f\n---\n\nProcessing job: task6\nProcessing job: task5\nProcessing job: task4\nProcessing job: task3\nProcessing job: task2\nProcessing job: task1\nNo jobs in the queue\nNo jobs in the queue\nNo jobs in the queue\nNo jobs in the queue\nNo jobs in the queue\nNo jobs in the queue\nNo jobs in the queue\nNo jobs in the queue\nNo jobs in the queue\nNo jobs in the queue\nNo jobs in the queue\nNo jobs in the queue\nrpc error: code = Unknown desc = Error: No such container: dab99425c4efafbefb39717d0815adfff495049a944c290e65be4e0cd2d6d6ac\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"7",children:["\n",(0,l.jsx)(n.li,{children:"\u63a5\u4e0b\u4f86\u6211\u5011\u4e00\u6b21\u5efa\u7acb100\u500btask\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'kubectl exec -it $(kubectl get pod -l app=redis -o jsonpath="{.items[0].metadata.name}") -- /bin/sh\n---\n\n#\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# redis-cli eval "return redis.call(\'LPUSH\', KEYS[1], unpack(ARGV))" 1 jobs $(seq -f "task%g" 1 100)\n---\n\n(integer) 100\n'})}),"\n",(0,l.jsxs)(n.ol,{start:"8",children:["\n",(0,l.jsx)(n.li,{children:"\u900f\u904e\u89c0\u5bdfdeployment\uff0c\u6211\u5011\u53ef\u4ee5\u770b\u5230Pod\u5f9e0\u500b\u5efa\u7acb\u52305\u500b\uff0c\u76f4\u5230\u6d88\u8017\u5b8c\u7562\u5f8c\u8b8a\u56de0\u500b\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl.exe get deployments worker -w\n---\n\n\nkubectl.exe get deployments worker -w\nNAME     READY   UP-TO-DATE   AVAILABLE   AGE\nworker   0/0     0            0           51m\nworker   0/1     0            0           51m\nworker   0/1     0            0           51m\nworker   0/1     0            0           51m\nworker   0/1     1            0           51m\nworker   1/1     1            1           51m\nworker   1/4     1            1           52m\nworker   1/4     1            1           52m\nworker   1/4     1            1           52m\nworker   1/4     4            1           52m\nworker   2/4     4            2           52m\nworker   3/4     4            3           52m\nworker   4/4     4            4           52m\nworker   4/5     4            4           53m\nworker   4/5     4            4           53m\nworker   4/5     4            4           53m\nworker   4/5     5            4           53m\nworker   5/5     5            5           53m\nworker   5/0     5            5           54m\nworker   5/0     5            5           54m\nworker   0/0     0            0           54m\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"\u7d50\u8ad6",children:"\u7d50\u8ad6"}),"\n",(0,l.jsx)(n.p,{children:"KEDA \u8b93 Kubernetes \u80fd\u5920\u4ee5\u4e8b\u4ef6\u70ba\u9a45\u52d5\uff0c\u52d5\u614b\u8abf\u6574\u61c9\u7528\u7a0b\u5f0f\u7684\u8cc7\u6e90\u914d\u7f6e\uff0c\u7279\u5225\u9069\u5408\u8655\u7406\u975e\u6301\u7e8c\u6027\u7684\u8ca0\u8f09\uff0c\u5982\u8a0a\u606f\u4f47\u5217\u3001\u76e3\u63a7\u8b66\u5831\u7b49\u3002\u900f\u904e\u8207 HPA \u7684\u7121\u7e2b\u6574\u5408\uff0c\u5b83\u70ba\u958b\u767c\u8005\u63d0\u4f9b\u4e86\u4e00\u7a2e\u9748\u6d3b\u4e14\u9ad8\u6548\u7684\u81ea\u52d5\u64f4\u5c55\u65b9\u6848\uff0c\u4f7f Kubernetes \u61c9\u7528\u66f4\u5177\u5f48\u6027\u8207\u53ef\u64f4\u5c55\u6027\u3002"})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var r=s(96540);const l={},d=r.createContext(l);function i(e){const n=r.useContext(d);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),r.createElement(d.Provider,{value:n},e.children)}},59784:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/KEDA-architecture-8451ec3afaac93be065dc796367598db.svg"}}]);