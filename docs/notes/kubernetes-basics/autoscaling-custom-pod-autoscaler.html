<!doctype html>
<html lang="zh-Hant" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-notes/kubernetes-basics/autoscaling-custom-pod-autoscaler" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">AutoScaling - Custom Pod AutoScaler | Chao-En Huang</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://koteruon.github.io/images/icon/chao_en_huang_icon.png"><meta data-rh="true" name="twitter:image" content="https://koteruon.github.io/images/icon/chao_en_huang_icon.png"><meta data-rh="true" property="og:url" content="https://koteruon.github.io/docs/notes/kubernetes-basics/autoscaling-custom-pod-autoscaler"><meta data-rh="true" property="og:locale" content="zh_Hant"><meta data-rh="true" name="docusaurus_locale" content="zh-Hant"><meta data-rh="true" name="docsearch:language" content="zh-Hant"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AutoScaling - Custom Pod AutoScaler | Chao-En Huang"><meta data-rh="true" name="description" content="在 Kubernetes 中，原生的水平 Pod 自動擴展（HPA）功能通常依賴於 CPU 和記憶體的平均使用量或使用率作為自動擴展的觸發指標。"><meta data-rh="true" property="og:description" content="在 Kubernetes 中，原生的水平 Pod 自動擴展（HPA）功能通常依賴於 CPU 和記憶體的平均使用量或使用率作為自動擴展的觸發指標。"><link data-rh="true" rel="icon" href="/images/icon/favicon.ico"><link data-rh="true" rel="canonical" href="https://koteruon.github.io/docs/notes/kubernetes-basics/autoscaling-custom-pod-autoscaler"><link data-rh="true" rel="alternate" href="https://koteruon.github.io/docs/notes/kubernetes-basics/autoscaling-custom-pod-autoscaler" hreflang="zh-Hant"><link data-rh="true" rel="alternate" href="https://koteruon.github.io/docs/notes/kubernetes-basics/autoscaling-custom-pod-autoscaler" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Chao-En Huang RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Chao-En Huang Atom Feed">

<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-5X8N2TCV",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b1704d0b.css">
<script src="/assets/js/runtime~main.87f1d803.js" defer="defer"></script>
<script src="/assets/js/main.6f0864ab.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5X8N2TCV" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳至主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳至主要内容</a></div><nav aria-label="主導航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切換導覽列" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/icon/apple-touch-icon.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/images/icon/apple-touch-icon.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Chao-En</b></a><a class="navbar__item navbar__link" href="/about-me">About Me</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/notes">Notes</a><a class="navbar__item navbar__link" href="/docs/research">Research</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/koteruon" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切換淺色/深色模式（當前為淺色模式）" aria-label="切換淺色/深色模式（當前為淺色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到頂部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文件側邊欄" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/notes">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/notes/design-pattern">Design Patterns</a><button aria-label="展開側邊欄分類 &#x27;Design Patterns&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/notes/docker-basics">Docker Basics</a><button aria-label="展開側邊欄分類 &#x27;Docker Basics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/notes/kubernetes-basics">Kubernetes Basics</a><button aria-label="收起側邊欄分類 &#x27;Kubernetes Basics&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics">Reference Book</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/container-intro">Container Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/kubernetes-intro">Kubernetes Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/environment-setup">Environment Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/dashboard-gui">Dashboard GUI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/basic-creating-a-pod">Basic - Creating a Pod</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/basic-creating-a-service">Basic - Creating a Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/basic-creating-a-deployment">Basic - Creating a Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/basic-creating-a-statefulset">Basic - Creating a StatefulSet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/advanced-kustomize">Advanced - Kustomize</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/advanced-ingress">Advanced - Ingress</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/advanced-pod-lifecycle">Advanced - Pod Lifecycle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/advanced-kubectl">Advanced - Kubectl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/deployment-strategies-common-deployment-strategies">Deployment Strategies - Common Deployment Strategies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/deployment-strategies-recreate-strategy-and-rolling-update-strategy">Deployment Strategies - Recreate Strategy and Rolling Update Strategy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/deployment-strategies-canary-strategy">Deployment Strategies - Canary Strategy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/volume-intro">Volume - Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/volume-emptydir">Volume - EmptyDir</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/volume-configmap">Volume - ConfigMap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/volume-secret">Volume - Secret</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/volume-pv-and-pvc">Volume - PV &amp; PVC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/resources-resource">Resources - Resource</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/resources-namespace">Resources - Namespace</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/resources-resource-management">Resources - Resource Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/resources-metrics-server">Resources - Metrics Server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/autoscaling-intro">AutoScaling - Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/autoscaling-horizontal-pod-autoscaler">AutoScaling - Horizontal Pod AutoScaler</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/autoscaling-vertical-pod-autoscaler">AutoScaling - Vertical Pod AutoScaler</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/notes/kubernetes-basics/autoscaling-custom-pod-autoscaler">AutoScaling - Custom Pod AutoScaler</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/security-user-management-with-kubernetes-context">Security - User Management with Kubernetes Context</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notes/kubernetes-basics/security-rbac-authorization">Security - RBAC Authorization</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/notes/owasp-top10-2021">OWASP Top 10 (2021)</a><button aria-label="展開側邊欄分類 &#x27;OWASP Top 10 (2021)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/notes/table-tennis-rulebot-rag">Table Tennis RuleBot (RAG)</a><button aria-label="展開側邊欄分類 &#x27;Table Tennis RuleBot (RAG)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="頁面路徑"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主頁面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/notes/kubernetes-basics"><span itemprop="name">Kubernetes Basics</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">AutoScaling - Custom Pod AutoScaler</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本頁導覽</button></div><div class="theme-doc-markdown markdown"><header><h1>AutoScaling - Custom Pod AutoScaler</h1></header>
<p>在 Kubernetes 中，原生的水平 Pod 自動擴展（HPA）功能通常依賴於 CPU 和記憶體的平均使用量或使用率作為自動擴展的觸發指標。
然而，對於使用 partition 分配機制的應用程式（如 Kafka）來說，這樣的設定可能會導致工作負載分布不均，從而無法有效地擴展資源。</p>
<p>例如，某些 Pod 可能達到其負載上限，但由於整體的平均資源使用率尚未達到閥值，HPA 可能無法及時觸發擴展。</p>
<p>為了解決這個問題，一個有效的策略是使用 <strong>KEDA</strong>（Kubernetes Event-Driven Autoscaling）。
KEDA 透過監控每個 Pod 的事件處理速度（例如 Kafka 訊息的消費速度）來進行自動擴展，而不僅僅依賴於 Pod 的平均資源使用情況。</p>
<p>這種方法能精確地調整 Pod 數量，有效解決工作負載不均的問題，並優化資源使用，提升整體應用程式的性能與可擴展性。</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-event-driven-autoscaling-keda">Kubernetes Event-Driven Autoscaling (KEDA)<a href="#kubernetes-event-driven-autoscaling-keda" class="hash-link" aria-label="Kubernetes Event-Driven Autoscaling (KEDA)的直接連結" title="Kubernetes Event-Driven Autoscaling (KEDA)的直接連結">​</a></h2>
<p><img decoding="async" loading="lazy" alt="KEDA-architecture" src="/assets/images/KEDA-architecture-8451ec3afaac93be065dc796367598db.svg" width="591" height="621" class="img_ev3q"></p>
<p><strong>Kubernetes Event-Driven Autoscaling (KEDA)</strong> 是一種 <strong>基於事件的自動擴展</strong> 解決方案，
主要用於 <strong>自動調整 Kubernetes 工作負載的副本數量</strong>，根據 <strong>事件驅動</strong> 來動態調整應用程式的資源分配，
而不是僅依賴 CPU 或記憶體使用率（如 Horizontal Pod Autoscaler, HPA）。</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="keda-的核心特點">KEDA 的核心特點<a href="#keda-的核心特點" class="hash-link" aria-label="KEDA 的核心特點的直接連結" title="KEDA 的核心特點的直接連結">​</a></h2>
<ol>
<li><strong>事件驅動的自動縮放</strong>
<ul>
<li>KEDA 允許應用程式根據特定事件來源（如 Kafka、RabbitMQ、Azure Service Bus、Prometheus 等）來決定何時擴展或縮減 Pod 數量。</li>
</ul>
</li>
<li><strong>與 HPA（Horizontal Pod Autoscaler）整合</strong>
<ul>
<li>KEDA 會將事件來源的數據轉換為 Kubernetes 的 HPA 指標，使 HPA 能夠根據這些事件來觸發 Pod 擴展。</li>
</ul>
</li>
<li><strong>精細控制 Pod 的擴展</strong>
<ul>
<li>當沒有負載時，KEDA 可以將 Pod 縮減為零，以節省資源；當事件出現時，則能夠迅速擴展 Pod。</li>
</ul>
</li>
<li><strong>支援多種 Scalers（事件來源）</strong>
<ul>
<li>KEDA 內建支援 50 多種 Scaler，例如：<!-- -->
<ul>
<li>訊息佇列：Kafka、RabbitMQ、Azure Queue Storage</li>
<li>監控系統：Prometheus、Datadog</li>
<li>雲端服務：AWS SQS、Google Pub/Sub</li>
<li>資料庫：PostgreSQL、MySQL</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="keda-的應用場景">KEDA 的應用場景<a href="#keda-的應用場景" class="hash-link" aria-label="KEDA 的應用場景的直接連結" title="KEDA 的應用場景的直接連結">​</a></h2>
<ol>
<li><strong>無伺服器架構（Serverless）</strong>
<ul>
<li>讓 Kubernetes 上的應用程式具備無伺服器能力，當沒有負載時，Pod 數量可以降到零，避免資源浪費。</li>
</ul>
</li>
<li><strong>訊息佇列處理</strong>
<ul>
<li>透過 KEDA，系統能夠根據 Kafka、RabbitMQ、SQS 等訊息佇列中的負載動態擴展 Pod，確保即時處理能力。</li>
</ul>
</li>
<li><strong>資料庫觸發自動擴展</strong>
<ul>
<li>例如，根據 PostgreSQL 的資料變更來觸發 Pod 擴展，適用於高流量的應用程式  。</li>
</ul>
</li>
<li><strong>雲端監控與異常響應</strong>
<ul>
<li>使用 Prometheus 或 Datadog 作為事件來源，當系統監測到異常時，動態擴展應用程式以應對突發流量。</li>
</ul>
</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="keda-與-hpa-的比較">KEDA 與 HPA 的比較<a href="#keda-與-hpa-的比較" class="hash-link" aria-label="KEDA 與 HPA 的比較的直接連結" title="KEDA 與 HPA 的比較的直接連結">​</a></h2>
<table><thead><tr><th></th><th><strong>HPA（水平自動擴展）</strong></th><th><strong>KEDA（事件驅動自動擴展）</strong></th></tr></thead><tbody><tr><td><strong>觸發條件</strong></td><td>主要依賴 <strong>CPU / Memory</strong></td><td>依賴 <strong>事件來源（Kafka, RabbitMQ, HTTP 佇列...）</strong></td></tr><tr><td><strong>最低 Pod 數量</strong></td><td><code>1</code>（無法歸零）</td><td><code>0</code>（完全釋放資源）</td></tr><tr><td><strong>適用場景</strong></td><td>長時間運行的應用（如 Web 伺服器）</td><td>需根據負載動態啟動的應用（如背景處理、批次任務）</td></tr><tr><td><strong>擴展速度</strong></td><td>受 HPA 內部計算影響</td><td>即時事件驅動</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="keda-crdscaledobject-與-scaledjob">KEDA CRD：ScaledObject 與 ScaledJob<a href="#keda-crdscaledobject-與-scaledjob" class="hash-link" aria-label="KEDA CRD：ScaledObject 與 ScaledJob的直接連結" title="KEDA CRD：ScaledObject 與 ScaledJob的直接連結">​</a></h2>
<p>在 <strong>KEDA</strong> 的框架中，<code>ScaledObject</code> 和 <code>ScaledJob</code> 是兩種核心的 <strong>自定義資源（Custom Resource Definitions, CRDs）</strong>，
用來定義如何根據事件來 <strong>自動擴展（Scaling）Pod</strong> 或 <strong>建立短暫的批次工作（Job）</strong>。</p>
<p>這兩種 CRD 提供了一種靈活的方式來管理 Kubernetes 應用的 <strong>事  件驅動擴展</strong>，適用於各種應用場景，如 <strong>佇列處理、批次任務、資料庫監控</strong> 等。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scaledobject">ScaledObject<a href="#scaledobject" class="hash-link" aria-label="ScaledObject的直接連結" title="ScaledObject的直接連結">​</a></h3>
<p><code>ScaledObject</code> 用於 <strong>管理長期執行的 Pod（Deployment、StatefulSet、ReplicaSet）</strong>，並根據事件來源來 <strong>動態擴展或縮減</strong> Pod 的副本數。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scaledobject-主要功能">ScaledObject 主要功能<a href="#scaledobject-主要功能" class="hash-link" aria-label="ScaledObject 主要功能的直接連結" title="ScaledObject 主要功能的直接連結">​</a></h3>
<ul>
<li><strong>針對 Kubernetes 部署（Deployment, StatefulSet, ReplicaSet）進行擴展</strong></li>
<li><strong>當沒有事件時，可以將 Pod 縮減至 0（省資源）</strong></li>
<li><strong>可與 HPA（Horizontal Pod Autoscaler）整合</strong></li>
<li><strong>支援多種事件來源，如 Kafka、RabbitMQ、Prometheus、AWS SQS 等</strong></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scaledobject-yaml-範例">ScaledObject YAML 範例<a href="#scaledobject-yaml-範例" class="hash-link" aria-label="ScaledObject YAML 範例的直接連結" title="ScaledObject YAML 範例的直接連結">​</a></h3>
<p><strong>範例：根據 Kafka 訊息數量動態調整 Pod</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ScaledObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kafka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scaler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scaleTargetRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">consumer </span><span class="token comment" style="color:#999988;font-style:italic"># 指定要擴展的 Deployment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">minReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 最小 Pod 數量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">maxReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 最大 Pod 數量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">idleReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 當無負載時，仍保留 1 個 Pod 避免冷啟動</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cooldownPeriod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 無負載後 30 秒內縮減</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pollingInterval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 每 5 秒檢查一次負載</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 可選：當 KEDA 無法存取事件來源時的回退機制</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">fallback</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">failureThreshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 連續 5 次失敗視為無法存取事件來源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 無法存取事件來源時，強制維持 3 個 Pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 可選：進階擴展行為控制</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">advanced</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restoreToOriginalReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 停用 KEDA 時恢復原本的 ReplicaCount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">horizontalPodAutoscalerConfig</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">behavior</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">scaleDown</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">stabilizationWindowSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 60 秒內不進行縮減</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">policies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Percent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">periodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">scaleUp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">stabilizationWindowSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">policies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Percent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">periodSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">triggers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">bootstrapServers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">broker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">topic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">topic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">consumerGroup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">lagThreshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;100&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 當 Kafka 訊息積壓超過 100 則觸發擴展</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scaledobject-重要參數">ScaledObject 重要參數<a href="#scaledobject-重要參數" class="hash-link" aria-label="ScaledObject 重要參數的直接連結" title="ScaledObject 重要參數的直接連結">​</a></h3>
<table><thead><tr><th>參數</th><th>作用</th></tr></thead><tbody><tr><td><code>scaleTargetRef.name</code></td><td>指定要擴展的 <strong>Pod（Deployment, StatefulSet, ReplicaSet）</strong></td></tr><tr><td><code>minReplicaCount</code></td><td>設定 Pod 的最小數量，可為 0</td></tr><tr><td><code>maxReplicaCount</code></td><td>設定 Pod 的最大數量</td></tr><tr><td><code>idleReplicaCount</code></td><td><strong>當無負載時，仍然保留的 Pod 數量</strong>，避免冷啟動（例如 <code>1</code> 表示即使無負載仍保留 1 個 Pod）</td></tr><tr><td><code>cooldownPeriod</code></td><td><strong>無負載時等待多久再縮減 Pod</strong></td></tr><tr><td><code>pollingInterval</code></td><td><strong>多久檢查一次事件來源</strong>（預設 30 秒）</td></tr><tr><td><code>triggers</code></td><td>定義 <strong>事件來源</strong>（Kafka, RabbitMQ, SQS, Prometheus...）</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scaledobject-可選參數">ScaledObject 可選參數<a href="#scaledobject-可選參數" class="hash-link" aria-label="ScaledObject 可選參數的直接連結" title="ScaledObject 可選參數的直接連結">​</a></h3>
<table><thead><tr><th>參數</th><th>作用</th></tr></thead><tbody><tr><td><code>fallback</code> (可選)</td><td><strong>當 KEDA 無法存取事件來源時，回退到預設副本數</strong></td></tr><tr><td><code>fallback.failureThreshold</code></td><td><strong>KEDA 失敗多少次後，啟用回退機制</strong></td></tr><tr><td><code>fallback.replicas</code></td><td><strong>回退機制啟動後，強制維持的 Pod 數量</strong></td></tr><tr><td><code>advanced</code> (可選)</td><td><strong>進階自動擴展設定</strong></td></tr><tr><td><code>advanced.restoreToOriginalReplicaCount</code></td><td><strong>停用 KEDA 時，是否恢復原本的 ReplicaCount</strong></td></tr><tr><td><code>advanced.horizontalPodAutoscalerConfig</code></td><td><strong>自訂 HPA（水平 Pod 自動擴展）的行為</strong></td></tr><tr><td><code>advanced.horizontalPodAutoscalerConfig.behavior</code></td><td><strong>擴展與縮減的行為控制</strong></td></tr></tbody></table>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scaledjob">ScaledJob<a href="#scaledjob" class="hash-link" aria-label="ScaledJob的直接連結" title="ScaledJob的直接連結">​</a></h3>
<p><code>ScaledJob</code> 用於 <strong>管理短暫執行的批次工作（Jobs）</strong>，適合一次性或臨時性的計算工作，當事件發生時，KEDA 會 <strong>動態啟動 Kubernetes Job</strong>，並在工作完成後自動釋放資源。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scaledjob-主要功能">ScaledJob 主要功能<a href="#scaledjob-主要功能" class="hash-link" aria-label="ScaledJob 主要功能的直接連結" title="ScaledJob 主要功能的直接連結">​</a></h3>
<ul>
<li><strong>適用於批次任務（Batch Jobs），如影像處理、資料分析</strong></li>
<li><strong>當負載增加時，自動啟動多個 Job 處理</strong></li>
<li><strong>無負載時，不會產生多餘的 Pod（降低資源消耗）</strong></li>
<li><strong>自動管理 Job 的刪除與錯誤處理</strong></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scaledjob-yaml-範例">ScaledJob YAML 範例<a href="#scaledjob-yaml-範例" class="hash-link" aria-label="ScaledJob YAML 範例的直接連結" title="ScaledJob YAML 範例的直接連結">​</a></h3>
<p><strong>範例：根據 RabbitMQ 訊息數量觸發 Job，並加入進階控制參數</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ScaledJob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rabbitmq</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">job</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scaler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">jobTargetRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">parallelism</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 允許最多 2 個 Job 同時運行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">completions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 每個 Job 只需成功執行 1 次</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">activeDeadlineSeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Job 最長運行時間為 300 秒，超時則終止</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">backoffLimit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Job 失敗後最多重試 3 次</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rabbitmq</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rabbitmq</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> receive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;$(RABBITMQ_QUEUE)&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">restartPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Never </span><span class="token comment" style="color:#999988;font-style:italic"># Job 結束後不自動重啟</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">minReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 當無負載時，不產生 Job</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">maxReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 最多允許 20 個 Job 併發</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">successfulJobsHistoryLimit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 保留 5 個成功 Job 記錄</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">failedJobsHistoryLimit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 保留 5 個失敗 Job 記錄</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pollingInterval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 每 10 秒檢查一次負載</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 可選：從指定 Container 讀取環境變數</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">envSourceContainerName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rabbitmq</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 可選：控制 Job 滾動更新行為</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rollout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">strategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gradual </span><span class="token comment" style="color:#999988;font-style:italic"># 逐步滾動更新（可選 &quot;immediate&quot; 或 &quot;gradual&quot;）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 可選：自訂 Job 的擴展策略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scalingStrategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">strategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> custom </span><span class="token comment" style="color:#999988;font-style:italic"># 可選 &quot;default&quot;、&quot;custom&quot; 或 &quot;accurate&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">customScalingQueueLengthDeduction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 每次擴展時，額外扣除 5 個訊息數</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">customScalingRunningJobPercentage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 當 50% Job 運行時，停止擴展</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">triggers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rabbitmq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">queueName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">hostFromEnv</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RABBITMQ_HOST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> QueueLength</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;50&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 當佇列訊息超過 50 時觸發 Job</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scaledjob-重要參 數">ScaledJob 重要參數<a href="#scaledjob-重要參數" class="hash-link" aria-label="ScaledJob 重要參數的直接連結" title="ScaledJob 重要參數的直接連結">​</a></h3>
<table><thead><tr><th>參數</th><th>作用</th></tr></thead><tbody><tr><td><code>jobTargetRef.template.spec.containers</code></td><td>定義執行的 Job 內容（映像名稱等）</td></tr><tr><td><code>parallelism</code></td><td><strong>控制 Job 內部的併發數量</strong>（例如 <code>2</code> 表示同時最多 2 個 Pod 執行該 Job）</td></tr><tr><td><code>completions</code></td><td><strong>每個 Job 需要成功執行的次數</strong>（通常為 <code>1</code>，但可以設為更高來確保多次成功）</td></tr><tr><td><code>activeDeadlineSeconds</code></td><td><strong>Job 最長允許執行時間</strong>，超時則終止</td></tr><tr><td><code>backoffLimit</code></td><td><strong>Job 失敗後允許的重試次數</strong></td></tr><tr><td><code>minReplicaCount</code></td><td>最小 Job 數量，可為 0（表示無負載時不產生 Job）</td></tr><tr><td><code>maxReplicaCount</code></td><td>最大可同時執行的 Job 數量</td></tr><tr><td><code>successfulJobsHistoryLimit</code></td><td>保留的成功 Job 記錄數量</td></tr><tr><td><code>failedJobsHistoryLimit</code></td><td>保留的失敗 Job 記錄數量</td></tr><tr><td><code>pollingInterval</code></td><td><strong>多久檢查一次事件來源</strong>（預設 30 秒）</td></tr><tr><td><code>triggers</code></td><td>定義 <strong>事件來源</strong>（Kafka, RabbitMQ, SQS, Prometheus...）</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scaledjob-可選參數">ScaledJob 可選參數<a href="#scaledjob-可選參數" class="hash-link" aria-label="ScaledJob 可選參數的直接連結" title="ScaledJob 可選參數的直接連結">​</a></h3>
<table><thead><tr><th>參數</th><th>作用</th></tr></thead><tbody><tr><td><code>envSourceContainerName</code> (可選)</td><td><strong>指定從哪個 Container   讀取環境變數</strong></td></tr><tr><td><code>rollout</code> (可選)</td><td><strong>控制 Job 的滾動更新策略</strong></td></tr><tr><td><code>rollout.strategy</code></td><td><strong><code>gradual</code> 表示逐步滾動，<code>immediate</code> 表示立即更新</strong></td></tr><tr><td><code>scalingStrategy</code> (可選)</td><td><strong>自訂 KEDA 的 Job 擴展行為</strong></td></tr><tr><td><code>scalingStrategy.strategy</code></td><td><strong><code>default</code> 使用 KEDA 預設策略，或可使用<code>custom</code>自訂邏輯，<code>accurate</code>則提供更精確的擴展</strong></td></tr><tr><td><code>scalingStrategy.customScalingQueueLengthDeduction</code></td><td><strong>每次擴展時，從佇列長度額外扣除多少消息數量</strong></td></tr><tr><td><code>scalingStrategy.customScalingRunningJobPercentage</code></td><td><strong>當運行中的 Job 超過某百分比時，停止擴展</strong></td></tr></tbody></table>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scaledobject-vs-scaledjob">ScaledObject vs ScaledJob<a href="#scaledobject-vs-scaledjob" class="hash-link" aria-label="ScaledObject vs ScaledJob的直接連結" title="ScaledObject vs ScaledJob的直接連結">​</a></h3>
<table><thead><tr><th></th><th><strong>ScaledObject</strong></th><th><strong>ScaledJob</strong></th></tr></thead><tbody><tr><td><strong>適用對象</strong></td><td>長期運行的應用（Deployment, StatefulSet, ReplicaSet）</td><td>短期批次工作（Job）</td></tr><tr><td><strong>最小副本數</strong></td><td>可縮減至 <code>0</code></td><td>無負載時不產生 Job</td></tr><tr><td><strong>最大副本數</strong></td><td>設定最大 <code>Pod</code> 數</td><td>設定最大 <code>Job</code> 數</td></tr><tr><td><strong>是否會自動刪除</strong></td><td><strong>Pod 會持續運行</strong>（除非手動刪除）</td><td><strong>Job 完成後自動刪除</strong></td></tr><tr><td><strong>適用場景</strong></td><td>API 伺服器、微服務、自動  擴展消費者</td><td>批次任務、影像處理、資料轉換</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="keda-triggers-介紹">KEDA Triggers 介紹<a href="#keda-triggers-介紹" class="hash-link" aria-label="KEDA Triggers 介紹的直接連結" title="KEDA Triggers 介紹的直接連結">​</a></h2>
<p>這裡我們會介紹以下 <strong>5 種 KEDA Triggers</strong>：</p>
<ol>
<li><strong>Prometheus</strong> → 透過 Prometheus 監控指標來觸發擴展</li>
<li><strong>Kafka</strong> → 根據 Kafka 佇列積壓（lag）動態擴展</li>
<li><strong>PostgreSQL</strong> → 根據 SQL 查詢結果決定擴展</li>
<li><strong>Google Cloud Platform Storage (GCS)</strong> → 依據 GCS 儲存桶的物件數觸發擴展</li>
<li><strong>Elasticsearch</strong> → 根據日誌數量、搜尋請求或待處理訂單觸發擴展</li>
</ol>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-prometheus-trigger">1. Prometheus Trigger<a href="#1-prometheus-trigger" class="hash-link" aria-label="1. Prometheus Trigger的直接連結" title="1. Prometheus Trigger的直接連結">​</a></h3>
<p>Prometheus 是一個開源的監控與警報工具，專門處理指標資料而設計，我們可以使用 Prometheus Scaler 來偵測單一 Pod 的使用率，根據資料透過 <strong>自訂指標（metrics）</strong> 來觸發 KEDA 擴展。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="yaml-範例">YAML 範例<a href="#yaml-範例" class="hash-link" aria-label="YAML 範例的直接連結" title="YAML 範例的直接連結">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ScaledObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scaler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scaleTargetRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment </span><span class="token comment" style="color:#999988;font-style:italic"># 要擴展的 Deployment 名稱</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">minReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">maxReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pollingInterval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 每 10 秒檢查一次指標</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">triggers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">serverAddress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//prometheus.default.svc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">metricName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http_requests_total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">query</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sum(rate(http_requests_total</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">deployment=&quot;my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">2m</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">)) </span><span class="token comment" style="color:#999988;font-style:italic"># 取 2 分鐘內請求速率</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;100&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 當請求速率超過 100 次/秒時擴展</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="參數說明">參數說明<a href="#參數說明" class="hash-link" aria-label="參數說明的直接連結" title="參數說明的直接連結">​</a></h4>
<table><thead><tr><th>參數</th><th>作用</th></tr></thead><tbody><tr><td><code>serverAddress</code></td><td>Prometheus 伺服器位址（通常是 <code>http://prometheus.default.svc:9090</code>）</td></tr><tr><td><code>metricName</code></td><td>指標名稱，例如 <code>http_requests_total</code></td></tr><tr><td><code>query</code></td><td>PromQL 查詢語法，決定如何計算擴展條件</td></tr><tr><td><code>threshold</code></td><td>當查詢結果超過此值時觸發擴展</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="適用場景">適用場景<a href="#適用場景" class="hash-link" aria-label="適用場景的直接連結" title="適用場景的直接連結">​</a></h4>
<ul>
<li>HTTP 請求流量  變化大時，自動擴展服務</li>
<li>根據 CPU、記憶體、使用者數量等指標來調整 Pod 數量</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-kafka-trigger">2. Kafka Trigger<a href="#2-kafka-trigger" class="hash-link" aria-label="2. Kafka Trigger的直接連結" title="2. Kafka Trigger的直接連結">​</a></h3>
<p>Kafka 是一個分散式的資料串流平台，可以處理實時資料串流，KEDA 可以根據 <strong>Kafka topic 的積壓數量（lag）</strong> 來決定是否擴展 Consumer。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="yaml-範例-1">YAML 範例<a href="#yaml-範例-1" class="hash-link" aria-label="YAML 範例的直接連結" title="YAML 範例的直接連結">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ScaledObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kafka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scaler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scaleTargetRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kafka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">minReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">maxReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pollingInterval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">triggers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">bootstrapServers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kafka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">broker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">topic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">topic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">consumerGroup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">lagThreshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;100&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 當積壓超過 100 則訊息時觸發擴展</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">offsetResetPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> latest </span><span class="token comment" style="color:#999988;font-style:italic"># 設定 Kafka 消費者從最新的訊息開始讀取</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="參數說明-1">參數說明<a href="#參數說明-1" class="hash-link" aria-label="參數說明的直接連結" title="參數說明的直接連結">​</a></h4>
<table><thead><tr><th>參數</th><th>作用</th></tr></thead><tbody><tr><td><code>bootstrapServers</code></td><td>Kafka 代理伺服器的位址</td></tr><tr><td><code>topic</code></td><td>要監聽的 Kafka topic</td></tr><tr><td><code>consumerGroup</code></td><td>監聽的消費者群組（Consumer Group）</td></tr><tr><td><code>lagThreshold</code></td><td><strong>當 Kafka topic 積壓數量超過該值時觸發擴展</strong></td></tr><tr><td><code>offsetResetPolicy</code></td><td>設定 Kafka 消費者從最新的訊息開始讀取</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="適用場景-1">適用場景<a href="#適用場景-1" class="hash-link" aria-label="適用場景的直接連結" title="適用場景的直接連結">​</a></h4>
<ul>
<li>Kafka Consumer 需要根據負載動態擴展</li>
<li>確保訊息處理速度不會落後</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-postgresql-trigger">3. PostgreSQL Trigger<a href="#3-postgresql-trigger" class="hash-link" aria-label="3. PostgreSQL Trigger的直接連結" title="3. PostgreSQL Trigger的直接連結">​</a></h3>
<p><strong>PostgreSQL Trigger</strong> 可以根據 <strong>PostgreSQL 查詢結果</strong>（例如當前正在處理的任務數量）來決定是否需要調整資源，並根據負載情況自動擴展或縮減 Pod 數量。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="yaml-範例-2">YAML 範例<a href="#yaml-範例-2" class="hash-link" aria-label="YAML 範例的直接連結" title="YAML 範例的直接連結">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ScaledObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scaleTargetRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">minReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">maxReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Optional. Default: 100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pollingInterval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Optional. Default: 30 seconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cooldownPeriod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Optional. Default: 300 seconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">triggers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgresql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">connectionFromEnv</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AIRFLOW_CONN_AIRFLOW_DB </span><span class="token comment" style="color:#999988;font-style:italic"># 從環境變數中取得 PostgreSQL 連線字串</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">query</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT ceil(COUNT(*): : decimal / 16) FROM task_instance WHERE state=&#x27;running&#x27; OR state=&#x27;queued&#x27;&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># SQL 查詢語法，查詢當前正在運行或排隊的任務數量，並將其除以 16 來確定所需的工作者數量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">targetQueryValue</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 當查詢結果大於 1 時觸發擴展</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="參數說明-2">參數說明<a href="#參數說明-2" class="hash-link" aria-label="參數說明的直接連結" title="參數說明的直接連結">​</a></h4>
<table><thead><tr><th>參數</th><th>作用</th></tr></thead><tbody><tr><td><code>connectionFromEnv</code></td><td>透過環境變數設定 PostgreSQL 連線字串，該字串中包含資料庫的連線資訊（如使用 <code>AIRFLOW_CONN_AIRFLOW_DB</code> 來取得連線字串）</td></tr><tr><td><code>query</code></td><td><strong>SQL 查詢語法</strong>，這個查詢會執行後返回一個數值，KEDA 會將其與 <code>targetQueryValue</code> 進行比較。此查詢的目的是計算當前正在處理或排隊的任務數量</td></tr><tr><td><code>targetQueryValue</code></td><td>當查詢結果超過該值時，觸發 Pod 擴展。這表示當目前的任務數量達到或超過此值時，就會啟動擴展動作</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="適用場景-2">適用場景<a href="#適用場景-2" class="hash-link" aria-label="適用場景的直接連結" title="適用場景的直接連結">​</a></h4>
<ul>
<li><strong>批次處理系統</strong>（如：資料匯入、報表生成）</li>
<li><strong>根據未處理的訂單或請求數量自動擴展 API 伺服器</strong></li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-google-cloud-platform-storage-gcs-trigger">4. Google Cloud Platform Storage (GCS) Trigger<a href="#4-google-cloud-platform-storage-gcs-trigger" class="hash-link" aria-label="4. Google Cloud Platform Storage (GCS) Trigger的直接連結" title="4. Google Cloud Platform Storage (GCS) Trigger的直接連結">​</a></h3>
<p>KEDA 也可以監聽 Google Cloud Storage（GCS）儲存桶，當桶內的檔案數量超過指定值時，自動擴展處理這些檔案的 Pod。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="yaml-範例-3">YAML 範例<a href="#yaml-範例-3" class="hash-link" aria-label="YAML 範例的直接連結" title="YAML 範例的直接連結">​</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TriggerAuthentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">trigger</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">auth</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gcp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">secretTargetRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">parameter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GoogleApplicationCredentails</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storage</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret </span><span class="token comment" style="color:#999988;font-style:italic"># Required. Refers to the name of the secret</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GOOGLE_APPLICATION_CREDENTAILS_JSON </span><span class="token comment" style="color:#999988;font-style:italic"># Required.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ScaledObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storage</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scaledobject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scaleTargetRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gcp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storage</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">minReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">maxReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pollingInterval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">triggers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">authenticationRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">trigger</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">auth</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">gcp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">credentails</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">bucketName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Transactions&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">targetObjectCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;100&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 當桶內物件超過 100 個時擴展</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">blobPrefix</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> blobsubpath </span><span class="token comment" style="color:#999988;font-style:italic"># Default: &quot;&quot; 只計算名稱以此字串開頭的物件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">blobDelimiter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 當啟用時，KEDA 只會監聽指定「資料夾」內的物件</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="參數說明-3">參數說明<a href="#參數說明-3" class="hash-link" aria-label="參數說明的直接連結" title="參數說明的直接連結">​</a></h4>
<table><thead><tr><th>參數</th><th>作用</th></tr></thead><tbody><tr><td><code>bucketName</code></td><td>監聽的 GCS 儲存桶名稱</td></tr><tr><td><code>targetObjectCount</code></td><td><strong>當桶內物件超過此數量時觸發擴展</strong></td></tr><tr><td><code>blobPrefix</code></td><td><strong>只計算名稱以此字串開頭的物件</strong>，適用於監聽特定類型的檔案，例如 <code>&quot;logs/&quot;</code> 只計算 <code>logs/</code> 開頭的檔案。</td></tr><tr><td><code>blobDelimiter</code></td><td><strong>將 GCS 存儲桶視為類似目錄結構時使用</strong>，例如設定 <code>/</code> 代表 GCS「資料夾」，若 <code>blobPrefix: &quot;logs/&quot;</code> 且 <code>blobDelimiter: &quot;/&quot;</code>，則 KEDA 只會計算 <code>logs/</code> 內的物件，不會包含子目錄內的檔案。</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="適用場景-3">適用場景<a href="#適用場景-3" class="hash-link" aria-label="適用場景的直接連結" title="適用場景的直接連結">​</a></h4>
<ul>
<li><strong>根據 GCS 中的檔案數量擴展影像處理、資料轉換服務</strong></li>
<li><strong>適用於影片編碼、日誌分析、機器學習資料處理等應用</strong></li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-elasticsearch-trigger">5. Elasticsearch Trigger<a href="#5-elasticsearch-trigger" class="hash-link" aria-label="5. Elasticsearch Trigger的直接連結" title="5. Elasticsearch Trigger的直接連結">​</a></h3>
<p>Elasticsearch 是一個強大的全文搜尋與分析引擎，常用於日誌分析、搜尋引擎、指標監控等場景。KEDA 可以根據 <strong>Elasticsearch 查詢結果</strong> 來決定是否擴展 Kubernetes 的 Pod，例如根據索引中的文件數量、查詢命中數量、搜尋頻率等條件觸發自動擴展。</p>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="yaml-範例-4">YAML 範例<a href="#yaml-範例-4" class="hash-link" aria-label="YAML 範例的直接連結" title="YAML 範例的直接連結">​</a></h4>
<p>這個範例示範如何根據 <strong>索引中的未處理日誌數量</strong> 來觸發擴展應用程式：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> elasticsearch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secrets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Opaque</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> XXXXXXXX </span><span class="token comment" style="color:#999988;font-style:italic"># Elasticsearch 登入密碼（Base64 編碼）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TriggerAuthentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">trigger</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">auth</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">elasticsearch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">secretTargetRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">parameter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> elasticsearch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secrets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ScaledObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> elasticsearch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scaledobject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scaleTargetRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> log</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">processor </span><span class="token comment" style="color:#999988;font-style:italic"># 要擴展的 Deployment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">minReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">maxReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pollingInterval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 每 10 秒檢查一次 Elasticsearch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">triggers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> elasticsearch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">authenticationRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">trigger</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">auth</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">elasticsearch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">addresses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//elasticsearch.default.svc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my_user </span><span class="token comment" style="color:#999988;font-style:italic"># 直接在 metadata 設定 Elasticsearch 使用者名稱</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">index</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">searchTemplateName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my_search_template </span><span class="token comment" style="color:#999988;font-style:italic"># Elasticsearch Search Template 名稱</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">valueLocation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;hits.total.value&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 結果中要比對的欄位</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1000&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 當查詢結果超過 1000 則時觸發擴展</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">params</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{&quot;status&quot;: &quot;pending&quot;}&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 給 Search Template 的參數</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="參數說明-4">參數說明<a href="#參數說明-4" class="hash-link" aria-label="參數說明的直接連結" title="參數說明的直接連結">​</a></h4>
<table><thead><tr><th>參數</th><th>作用</th></tr></thead><tbody><tr><td><code>addresses</code></td><td><strong>Elasticsearch 伺服器位址</strong>（通常是 <code>http://elasticsearch.default.svc:9200</code>）。</td></tr><tr><td><code>username</code></td><td><strong>Elasticsearch 登入使用者名稱</strong>，這裡直接寫在 metadata，而不是存入 Secret。</td></tr><tr><td><code>index</code></td><td><strong>監聽的 Elasticsearch 索引</strong>（如 <code>logs</code>、<code>orders</code>）。</td></tr><tr><td><code>searchTemplateName</code></td><td><strong>Elasticsearch Search Template 名稱</strong>，用於預定義查詢模板，減少查詢複雜度。</td></tr><tr><td><code>valueLocation</code></td><td><strong>要比對的查詢結果欄位</strong>，例如 <code>&quot;hits.total.value&quot;</code> 指的是匹配的文件數量。</td></tr><tr><td><code>threshold</code></td><td><strong>當查詢結果數量超過該值時觸發擴展</strong>。</td></tr><tr><td><code>params</code></td><td><strong>提供給 Search Template 的參數</strong>，例如 <code>&#x27;{&quot;status&quot;: &quot;pending&quot;}&#x27;</code>。</td></tr></tbody></table>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="適用場景-4">適用場景<a href="#適用場景-4" class="hash-link" aria-label="適用場景的直接連結" title="適用場景的直接連結">​</a></h4>
<ol>
<li><strong>日誌分析與處理</strong>：<!-- -->
<ul>
<li>根據 <strong>Elasticsearch 中待處理的日誌數量</strong> 擴展日誌分析服務</li>
<li>避免日誌積壓，確保 日誌處理速度跟上流量</li>
</ul>
</li>
<li><strong>搜尋請求監控</strong>：<!-- -->
<ul>
<li>根據搜尋請求的 <strong>命中數量或頻率</strong> 來調整搜尋 API 的 Pod 數量</li>
<li>確保高搜尋流量時提供穩定效能</li>
</ul>
</li>
<li><strong>訂單或交易處理</strong>：<!-- -->
<ul>
<li>監控 <strong>Elasticsearch 中的待處理訂單</strong>，根據積壓數量擴展 API 或背景工作者</li>
<li>確保系統能應對突發的大量交易請求</li>
</ul>
</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="keda-的彈性伸縮01-及-10-縮放解析">KEDA 的彈性伸縮：0→1 及 1→0 縮放解析<a href="#keda-的彈性伸縮01-及-10-縮放解析" class="hash-link" aria-label="KEDA 的彈性伸縮：0→1 及 1→0 縮放解析的直接連結" title="KEDA 的彈性伸縮：0→1 及 1→0 縮放解析的直接連結">​</a></h2>
<p>KEDA（Kubernetes Event-Driven Autoscaling）是一種基於事件驅動的自動伸縮機制，能夠根據特定指標自動調整 Pod 的數量。
與 HPA（Horizontal Pod Autoscaler）不同，KEDA <strong>可以將 Deployment 完全縮減至 0</strong>，並在負載到達門檻時 <strong>從 0 啟動 Pod</strong>，實現真正的動態資源調配。</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="0--1從-0-啟動-pod">0 → 1：從 0 啟動 Pod<a href="#0--1從-0-啟動-pod" class="hash-link" aria-label="0 → 1：從 0 啟動 Pod的直接連結" title="0 → 1：從 0 啟動 Pod的直接連結">​</a></h3>
<p>這個過程通常發生在系統空閒一段時間後，當觸發條件達到指定門檻時，KEDA 會從 <strong>0 個 Pod 啟動 1 個 Pod</strong>，使應用程式開始處理請求。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="步驟解析">步驟解析<a href="#步驟解析" class="hash-link" aria-label="步驟解析的直接連結" title="步驟解析的直接連結">​</a></h4>
<ol>
<li><strong>KEDA 監聽 Scaler 指標</strong>（如 Kafka 訊息數、Elasticsearch 查詢結果、RabbitMQ 佇列長度等）。</li>
<li><strong>當指標超過 <code>threshold</code> 值時，KEDA 啟動 ScaledObject</strong>，並通知 Kubernetes 增加 <code>scaleTargetRef</code>（目標 Deployment）的副本數。</li>
<li><strong>Kubernetes 啟動第一個 Pod</strong>，拉取所需的應用程式映像並開始執行。</li>
<li><strong>Pod 開始處理負載</strong>，同時 KEDA 繼續監測指標數據，以決定是否需要進一步擴展。</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="關鍵影響因素">關鍵影響因素<a href="#關鍵影響因素" class="hash-link" aria-label="關鍵影響因素的直接連結" title="關鍵影響因素的直接連結">​</a></h4>
<ul>
<li><strong>冷啟動時間（Cold Start）</strong>：從 0 啟動一個 Pod 需要時間，包含**容器拉取映像（image pull）、初始化（init）、健康檢查（readiness probe）**等，因此應用程式應優化啟動速度，例如：<!-- -->
<ul>
<li>使用 <strong>輕量級映像（如 Alpine）</strong> 減少拉取時間。</li>
<li>預熱應用程式（Warm-Up Strategy）。</li>
<li>使用 <code>readinessProbe</code> 避免服務未就緒時收到請求。</li>
</ul>
</li>
<li><strong>Polling 間隔影響啟動時機</strong>：KEDA 預設 <code>pollingInterval</code> 為 <strong>30 秒</strong>（可調整），這代表 KEDA <strong>最多可能要等待 30 秒才會偵測到負載</strong>，這點在即時性應用（如 Webhook 或事件處理系統）中需要特別留意。</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1--0從-1-縮減至-0">1 → 0：從 1 縮減至 0<a href="#1--0從-1-縮減至-0" class="hash-link" aria-label="1 → 0：從 1 縮減至 0的直接連結" title="1 → 0：從 1 縮減至 0的直接連結">​</a></h3>
<p>當負載下降時，KEDA 會將 Pod 數量降至 <strong>0</strong>，釋放資源，避免不必要的計算成本。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="步驟解析-1">步驟解析<a href="#步驟解析-1" class="hash-link" aria-label="步驟解析的直接連結" title="步驟解析的直接連結">​</a></h4>
<ol>
<li><strong>KEDA 持續監測 Scaler 指標</strong>，如果數值低於 <code>threshold</code>（通常是 0 或極低值），則進行縮減。</li>
<li><strong>等待 <code>cooldownPeriod</code> 過後（預設 5 分鐘）</strong>，KEDA 觸發 <code>scaleTargetRef</code>，將 Deployment 副本數降至 0。</li>
<li><strong>Kubernetes 停止所有 Pod</strong>，釋放 CPU、記憶體等資源，節省成本。</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="關鍵影響因素-1">關鍵影響因素<a href="#關鍵影響因素-1" class="hash-link" aria-label="關鍵影響因素的直接連結" title="關鍵影響因素的直接連結">​</a></h4>
<ul>
<li><strong><code>cooldownPeriod</code> 控制何時縮減</strong>：<!-- -->
<ul>
<li>預設值為 <strong>300 秒（5 分鐘）</strong>，但可根據應用需求調整。</li>
<li>設定過短可能導致頻繁縮放，影響服務穩定性。</li>
</ul>
</li>
<li><strong>應用程式狀態保持</strong>：<!-- -->
<ul>
<li>如果應用程式需要維持持續性連線（如 WebSocket），縮減至 0 可能會中斷連線，這時可以考慮：<!-- -->
<ul>
<li>設定 <code>minReplicaCount: 1</code>，避免完全關閉。</li>
<li>配合 <strong>外部快取（如 Redis）</strong> 存儲狀態資訊，避免影響後續請求。</li>
</ul>
</li>
</ul>
</li>
<li><strong>與 HPA 的衝突</strong>：<!-- -->
<ul>
<li>若 HPA 設定了 <code>minReplicas: 1</code>，則即使 KEDA 嘗試縮減到 0，HPA 仍可能維持 1 個 Pod。</li>
<li>因此，若希望完全縮減至 0，應停用 HPA 或將 <code>minReplicas: 0</code>。</li>
</ul>
</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="keda-的激活階段與縮放階段解析">KEDA 的激活階段與縮放階段解析<a href="#keda-的激活階段與縮放階段解析" class="hash-link" aria-label="KEDA 的激活階段 與縮放階段解析的直接連結" title="KEDA 的激活階段與縮放階段解析的直接連結">​</a></h2>
<p>KEDA 的核心運作機制包含兩個主要階段：<strong>激活階段（Activation Phase）</strong> 和 <strong>縮放階段（Scaling Phase）</strong>，這兩個階段的運作決定了 Pod 何時應該啟動或縮減，並且可以透過 <strong>激活閥值（Activation Thresholds）</strong> 與 <strong>縮放閥值（Scaling Thresholds）</strong> 來精確控制。</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="激活階段activation-phase">激活階段（Activation Phase）<a href="#激活階段activation-phase" class="hash-link" aria-label="激活階段（Activation Phase）的直接連結" title="激活階段（Activation Phase）的直接連結">​</a></h3>
<p>當 KEDA 監聽的 Scaler 指標 <strong>超過激活閥值（Activation Threshold）</strong>，並且 <code>minReplicaCount = 0</code> 時，系統進入 <strong>激活階段</strong>，開始從 <strong>0 啟動 Pod</strong>，準備處理即將到來的負載。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="關鍵點">關鍵點<a href="#關鍵點" class="hash-link" aria-label="關鍵點的直接連結" title="關鍵點的直接連結">​</a></h4>
<ul>
<li><strong><code>activationThreshold</code></strong>：定義 Pod <strong>從 0 啟動的負載門檻</strong>，低於此值時 Pod 保持為 0，不進入激活階段。</li>
<li><strong>Scaler 監聽目標負載</strong>（如 RabbitMQ 佇列長度、Kafka 訊息數、Elasticsearch 查詢結果）。</li>
<li><strong>當負載達到 <code>activationThreshold</code>，KEDA 啟動 Deployment</strong>，Pod 數量變為 1（或 <code>minReplicaCount</code>）。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="影響因素">影響因素<a href="#影響因素" class="hash-link" aria-label="影響因素的直接連結" title="影響因素的直接連結">​</a></h4>
<ol>
<li><strong>冷啟動（Cold Start）</strong>
<ul>
<li>由於 Pod 需要時間啟動，設定 <code>activationThreshold</code> 時需考慮應用程序的冷啟動時間。</li>
<li><strong>解決方案</strong>：使用較小的 <code>activationThreshold</code> 以提前觸發擴展，或者優化應用啟動速度。</li>
</ul>
</li>
<li><strong><code>minReplicaCount &gt;= 1</code> 的影響</strong>
<ul>
<li><strong>當 <code>minReplicaCount &gt;= 1</code> 時，KEDA Scaler 將</strong> <strong>永遠處於激活狀態</strong>，此時 <code>activationThreshold</code> <strong>將被忽略</strong>。</li>
<li>這意味著即使負載為 0，Pod 也不會縮減到 0，而是至少保持 <code>minReplicaCount</code> 個 Pod 存在。</li>
</ul>
</li>
</ol>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="縮放階段scaling-phase">縮放階段（Scaling Phase）<a href="#縮放階段scaling-phase" class="hash-link" aria-label="縮放階段（Scaling Phase）的直接連結" title="縮放階段（Scaling Phase）的直接連結">​</a></h3>
<p>當負載達到 <strong>縮放閥值（Scaling Threshold）</strong>，KEDA 會調整 Pod 數量，確保應用程式的資源利用最佳化。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="關鍵點-1">關鍵點<a href="#關鍵點-1" class="hash-link" aria-label="關鍵點的直接連結" title="關鍵點的直接連結">​</a></h4>
<ul>
<li><strong><code>scalingThreshold</code></strong>：定義 <strong>Pod 數量變動的負載門檻</strong>，低於該值時 Pod 可能縮減，高於該值時 Pod 可能擴展。</li>
<li><strong>根據 <code>scalingThreshold</code> 動態調整 Pod 數量</strong>，確保應用程式擁有足夠的資源來處理當前負載。</li>
<li><strong>當負載低於 <code>scalingThreshold</code>，並且 <code>cooldownPeriod</code> 到期後，Pod 可能被縮減（但不會小於 <code>minReplicaCount</code>）</strong>。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="影響因素-1">影響因素<a href="#影響因素-1" class="hash-link" aria-label="影響因素的直接連結" title="影響因素的直接連結">​</a></h4>
<ol>
<li><strong><code>cooldownPeriod</code> 控制 Pod 何時縮減</strong>
<ul>
<li>預設 <code>cooldownPeriod</code> 為 <strong>5 分鐘</strong>，即當負載低於 <code>scalingThreshold</code> 並持續 5 分鐘後，Pod 才會縮減。</li>
<li>若 <code>cooldownPeriod</code> 設定過短，可能導致 Pod 頻繁縮放，影響穩定性。</li>
<li><strong>解決方案</strong>：根據負載特性適當調整 <code>cooldownPeriod</code>，避免過度縮放導致資源波動。</li>
</ul>
</li>
<li><strong>Pod 數量變化</strong>
<ul>
<li>Pod 數量的變動範圍在 <code>minReplicaCount</code> 和 <code>maxReplicaCount</code> 之間。</li>
<li>當負載增加，Pod 數量可以擴展到 <code>maxReplicaCount</code>；當負載下降，Pod 數量最少縮減至 <code>minReplicaCount</code>（若 <code>minReplicaCount = 0</code>，則可以縮減到 0）。</li>
</ul>
</li>
</ol>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="minreplicacount-的影響">minReplicaCount 的影響<a href="#minreplicacount-的影響" class="hash-link" aria-label="minReplicaCount 的影響的直接連結" title="minReplicaCount 的影響的直接連結">​</a></h3>
<p><code>minReplicaCount</code> 的設定影響 KEDA Scaler 是否會完全進入激活與縮放狀態：</p>
<table><thead><tr><th><code>minReplicaCount</code> 設定</th><th>行為</th></tr></thead><tbody><tr><td><strong>0</strong></td><td>Scaler 可以縮減到 0，<code>activationThreshold</code> 有效，Pod 會在負載達到門檻時啟動。</td></tr><tr><td><strong>≥ 1</strong></td><td>Scaler <strong>永遠處於激活狀態</strong>，Pod 不會縮減至 0，<code>activationThreshold</code> <strong>將被忽略</strong>。</td></tr></tbody></table>
<p>這表示：</p>
<ul>
<li>若希望 Deployment <strong>在低負載時完全關閉</strong>，應設置 <code>minReplicaCount: 0</code>，並根據 <code>activationThreshold</code> 控制 Pod 啟動。</li>
<li>若應用程式需要 <strong>持續運行至少 1 個 Pod</strong>，則應設置 <code>minReplicaCount ≥ 1</code>，但這樣 <code>activationThreshold</code> 就不再影響縮放行為。</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="實作一個-keda">實作一個 KEDA<a href="#實作一個-keda" class="hash-link" aria-label="實作一個 KEDA的直接連結" title="實作一個 KEDA的直接連結">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="安裝-keda">安裝 KEDA<a href="#安裝-keda" class="hash-link" aria-label="安裝 KEDA的直接連結" title="安裝 KEDA的直接連結">​</a></h3>
<ol>
<li>首先我們透過 helm 來安裝 KEDA，我們增加 KEDA 的 repo 位置，接下來跟新 helm 的 repo，就可以下載 KEDA。</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> kedacore https://kedacore.github.io/charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> keda kedacore/keda </span><span class="token parameter variable" style="color:#36acaa">--namespace</span><span class="token plain"> keda --create-namespace</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="部屬-redis">部屬 Redis<a href="#部屬-redis" class="hash-link" aria-label="部屬 Redis的直接連結" title="部屬 Redis的直接連結">​</a></h3>
<ol>
<li>首先，我們建立一個 Redis 作為簡單的訊息佇列，提供事件驅動的資料來源。</li>
</ol>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">redis.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6379</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>透過指令來運行他。</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl.exe apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> redis.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/redis created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/redis created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="部屬-worker-和-scaledobject">部屬 Worker 和 ScaledObject<a href="#部屬-worker-和-scaledobject" class="hash-link" aria-label="部屬 Worker 和 ScaledObject的直接連結" title="部屬 Worker 和 ScaledObject的直接連結">​</a></h3>
<ol>
<li>我們定義一個 worker 的 Pod，用來處理 Redis 的任務。</li>
</ol>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">worker.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> worker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">alpine </span><span class="token comment" style="color:#999988;font-style:italic"># 使用 Redis 輕量級 Alpine 版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">&#x27;sh&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">&#x27;-c&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">&#x27;while true; do job=$(redis-cli -h redis -p 6379 LPOP jobs); if [ &quot;$job&quot; != &quot;&quot; ]; then echo &quot;Processing job: $job&quot;; else echo &quot;No jobs in the queue&quot;; fi; sleep 5; done&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>接下來我們定義 ScaledObject，我希望讓 KEDA 監聽 Redis 佇列的長度，當訊息數超過 5，Pod 會擴展，必且沒有用到的時候保持 Replica 數量為 0。</li>
</ol>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">scaledobject.yaml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> keda.sh/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ScaledObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">scaledobject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scaleTargetRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> worker </span><span class="token comment" style="color:#999988;font-style:italic"># 這個是要縮放的 Deployment 名稱</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">minReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">maxReplicaCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pollingInterval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cooldownPeriod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">triggers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> redis.default.svc.cluster.local</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">6379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">listName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jobs </span><span class="token comment" style="color:#999988;font-style:italic"># Redis 監聽的 key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">listLength</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;5&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 當 jobs 佇列長度超過 5 時，觸發擴展</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">activationListLength</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;5&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 當 jobs 佇列長度超過 5 時，觸發0變成1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>然後透過指令執行這兩個物件。</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl.exe apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> worker.yaml,scaledobject.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/worker created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scaledobject.keda.sh/redis-scaledobject created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="4">
<li>透過指令來觀察 pod 的建立，確認會不會在訊息長度大於 5 的時候啟動一個 Pod。</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl.exe get pods </span><span class="token parameter variable" style="color:#36acaa">-w</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                    READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis-9cfbb989d-77ffk   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          43m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="測試-keda-自動縮放">測試 KEDA 自動縮放<a href="#測試-keda-自動縮放" class="hash-link" aria-label="測試 KEDA 自動縮放的直接連結" title="測試 KEDA 自動縮放的直接連結">​</a></h3>
<ol>
<li>首先進到 Redis 的 Pod 裡面，我們需要透過指令的方式增加訊息。</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-it</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl get pod </span><span class="token variable parameter variable" style="color:#36acaa">-l</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable assign-left variable" style="color:#36acaa">app</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">redis </span><span class="token variable parameter variable" style="color:#36acaa">-o</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable assign-left variable" style="color:#36acaa">jsonpath</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&quot;{.items[0].metadata.name}&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> -- redis-cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>接下來我們 LPUSH 三個訊息。</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> LPUSH </span><span class="token function" style="color:#d73a49">jobs</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;task1&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;task2&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;task3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>
<p>我們可以發現 Pod 沒有被建立，因為還未超過規定的長度 5。</p>
</li>
<li>
<p>接下來我們在 LPUSH 三個訊息，這個時候訊息的長度就超過 5。</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> LPUSH </span><span class="token function" style="color:#d73a49">jobs</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;task4&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;task5&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;task6&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="5">
<li>我們可以看到當長度大於5，Pod就會被建立，replica從0變成1，每60秒會檢查如果長度小於5，replica就會從1變成0，Pod也都被關閉。</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl.exe get pods </span><span class="token parameter variable" style="color:#36acaa">-w</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                      READY   STATUS              RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis-9cfbb989d-77ffk     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          43m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker-84d6b8f7bd-5pwmz   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Pending             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker-84d6b8f7bd-5pwmz   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Pending             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker-84d6b8f7bd-5pwmz   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     ContainerCreating   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker-84d6b8f7bd-5pwmz   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running             </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          1s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker-84d6b8f7bd-5pwmz   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Terminating         </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker-84d6b8f7bd-5pwmz   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Terminating         </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          91s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker-84d6b8f7bd-5pwmz   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Terminating         </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          91s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker-84d6b8f7bd-5pwmz   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Terminating         </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          91s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker-84d6b8f7bd-5pwmz   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     Terminating         </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          91s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="6">
<li>我們可以同時觀察pod的輸出，可以看到他從task6一直消化道task1，最後沒有，之後就被刪除了。</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl.exe logs pods/worker-84d6b8f7bd-5pwmz </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Processing job: task6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Processing job: task5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Processing job: task4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Processing job: task3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Processing job: task2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Processing job: task1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No </span><span class="token function" style="color:#d73a49">jobs</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No </span><span class="token function" style="color:#d73a49">jobs</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No </span><span class="token function" style="color:#d73a49">jobs</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No </span><span class="token function" style="color:#d73a49">jobs</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No </span><span class="token function" style="color:#d73a49">jobs</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No </span><span class="token function" style="color:#d73a49">jobs</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No </span><span class="token function" style="color:#d73a49">jobs</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No </span><span class="token function" style="color:#d73a49">jobs</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No </span><span class="token function" style="color:#d73a49">jobs</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No </span><span class="token function" style="color:#d73a49">jobs</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No </span><span class="token function" style="color:#d73a49">jobs</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No </span><span class="token function" style="color:#d73a49">jobs</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> the queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpc error: code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Unknown desc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Error: No such container: dab99425c4efafbefb39717d0815adfff495049a944c290e65be4e0cd2d6d6ac</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="7">
<li>接下來我們一次建立100個task。</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-it</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl get pod </span><span class="token variable parameter variable" style="color:#36acaa">-l</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable assign-left variable" style="color:#36acaa">app</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">redis </span><span class="token variable parameter variable" style="color:#36acaa">-o</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable assign-left variable" style="color:#36acaa">jsonpath</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&quot;{.items[0].metadata.name}&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> -- /bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># redis-cli eval &quot;return redis.call(&#x27;LPUSH&#x27;, KEYS[1], unpack(ARGV))&quot; 1 jobs $(seq -f &quot;task%g&quot; 1 100)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">integer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="8">
<li>透過觀察deployment，我們可以看到Pod從0個建立到5個，直到消耗完畢後變回0個。</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl.exe get deployments worker </span><span class="token parameter variable" style="color:#36acaa">-w</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl.exe get deployments worker </span><span class="token parameter variable" style="color:#36acaa">-w</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME     READY   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/0     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">           51m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">           51m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">           51m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">           51m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">           51m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">           51m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/4     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">           52m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/4     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">           52m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/4     </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">           52m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/4     </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">           52m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/4     </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">           52m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/4     </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">           52m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">/4     </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">           52m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">/5     </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">           53m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">/5     </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">           53m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">/5     </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">           53m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">/5     </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">           53m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">/5     </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">           53m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">/0     </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">           54m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">/0     </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">           54m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/0     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">            </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">           54m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼至剪貼簿" title="複製" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="結論">結論<a href="#結論" class="hash-link" aria-label="結論的直接連結" title="結論的直接連結">​</a></h2>
<p>KEDA 讓 Kubernetes 能夠以事件為驅動，動態調整應用程式的資源配置，特別適合處理非持續性的負載，如訊息佇列、監控警報等。透過與 HPA 的無縫整合，它為開發者提供了一種靈活且高效的自動擴展方案，使 Kubernetes 應用更具彈性與可擴展性。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件選項卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/notes/kubernetes-basics/autoscaling-vertical-pod-autoscaler"><div class="pagination-nav__sublabel">上一頁</div><div class="pagination-nav__label">AutoScaling - Vertical Pod AutoScaler</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/notes/kubernetes-basics/security-user-management-with-kubernetes-context"><div class="pagination-nav__sublabel">下一頁</div><div class="pagination-nav__label">Security - User Management with Kubernetes Context</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#kubernetes-event-driven-autoscaling-keda" class="table-of-contents__link toc-highlight">Kubernetes Event-Driven Autoscaling (KEDA)</a></li><li><a href="#keda-的核心特點" class="table-of-contents__link toc-highlight">KEDA 的核心特點</a></li><li><a href="#keda-的應用場景" class="table-of-contents__link toc-highlight">KEDA 的應用場景</a></li><li><a href="#keda-與-hpa-的比較" class="table-of-contents__link toc-highlight">KEDA 與 HPA 的比較</a></li><li><a href="#keda-crdscaledobject-與-scaledjob" class="table-of-contents__link toc-highlight">KEDA CRD：ScaledObject 與 ScaledJob</a><ul><li><a href="#scaledobject" class="table-of-contents__link toc-highlight">ScaledObject</a></li><li><a href="#scaledobject-主要功能" class="table-of-contents__link toc-highlight">ScaledObject 主要功能</a></li><li><a href="#scaledobject-yaml-範例" class="table-of-contents__link toc-highlight">ScaledObject YAML 範例</a></li><li><a href="#scaledobject-重要參數" class="table-of-contents__link toc-highlight">ScaledObject 重要參數</a></li><li><a href="#scaledobject-可選參數" class="table-of-contents__link toc-highlight">ScaledObject 可選參數</a></li><li><a href="#scaledjob" class="table-of-contents__link toc-highlight">ScaledJob</a></li><li><a href="#scaledjob-主要功能" class="table-of-contents__link toc-highlight">ScaledJob 主要功能</a></li><li><a href="#scaledjob-yaml-範例" class="table-of-contents__link toc-highlight">ScaledJob YAML 範例</a></li><li><a href="#scaledjob-重要參數" class="table-of-contents__link toc-highlight">ScaledJob 重要參數</a></li><li><a href="#scaledjob-可選參數" class="table-of-contents__link toc-highlight">ScaledJob 可選參數</a></li><li><a href="#scaledobject-vs-scaledjob" class="table-of-contents__link toc-highlight">ScaledObject vs ScaledJob</a></li></ul></li><li><a href="#keda-triggers-介紹" class="table-of-contents__link toc-highlight">KEDA Triggers 介紹</a><ul><li><a href="#1-prometheus-trigger" class="table-of-contents__link toc-highlight">1. Prometheus Trigger</a></li><li><a href="#2-kafka-trigger" class="table-of-contents__link toc-highlight">2. Kafka Trigger</a></li><li><a href="#3-postgresql-trigger" class="table-of-contents__link toc-highlight">3. PostgreSQL Trigger</a></li><li><a href="#4-google-cloud-platform-storage-gcs-trigger" class="table-of-contents__link toc-highlight">4. Google Cloud Platform Storage (GCS) Trigger</a></li><li><a href="#5-elasticsearch-trigger" class="table-of-contents__link toc-highlight">5. Elasticsearch Trigger</a></li></ul></li><li><a href="#keda-的彈性伸縮01-及-10-縮放解析" class="table-of-contents__link toc-highlight">KEDA 的彈性伸縮：0→1 及 1→0 縮放解析</a><ul><li><a href="#0--1從-0-啟動-pod" class="table-of-contents__link toc-highlight">0 → 1：從 0 啟動 Pod</a></li><li><a href="#1--0從-1-縮減至-0" class="table-of-contents__link toc-highlight">1 → 0：從 1 縮減至 0</a></li></ul></li><li><a href="#keda-的激活階段與縮放階段解析" class="table-of-contents__link toc-highlight">KEDA 的激活階段與縮放階段解析</a><ul><li><a href="#激活階段activation-phase" class="table-of-contents__link toc-highlight">激活階段（Activation Phase）</a></li><li><a href="#縮放階段scaling-phase" class="table-of-contents__link toc-highlight">縮放階段（Scaling Phase）</a></li><li><a href="#minreplicacount-的影響" class="table-of-contents__link toc-highlight">minReplicaCount 的影響</a></li></ul></li><li><a href="#實作一個-keda" class="table-of-contents__link toc-highlight">實作一個 KEDA</a><ul><li><a href="#安裝-keda" class="table-of-contents__link toc-highlight">安裝 KEDA</a></li><li><a href="#部屬-redis" class="table-of-contents__link toc-highlight">部屬 Redis</a></li><li><a href="#部屬-worker-和-scaledobject" class="table-of-contents__link toc-highlight">部屬 Worker 和 ScaledObject</a></li><li><a href="#測試-keda-自動縮放" class="table-of-contents__link toc-highlight">測試 KEDA 自動縮放</a></li></ul></li><li><a href="#結論" class="table-of-contents__link toc-highlight">結論</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">This Website</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/notes">Notes</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/research">Research</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/koteruon" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://pda.104.com.tw/profile/preview?vno=75wef33ky" target="_blank" rel="noopener noreferrer" class="footer__link-item">104<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/%E7%85%A7%E6%81%A9-%E9%BB%83-93511b25b" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Acknowledgement</div><ul class="footer__items clean-list"><li class="footer__item">
              <p>
              illustrations by <a href="https://storyset.com/web">Storyset</a>
              </p>
              </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Chao-En Huang. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>